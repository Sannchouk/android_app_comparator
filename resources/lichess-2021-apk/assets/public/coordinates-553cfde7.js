import{g as t,aY as r,ci as e,am as o,r as s,cV as n,aH as a,q as i,m as c,C as h,G as d}from"./main.js";import{l}from"./layout-c7d0a2f4.js";import{B as g}from"./Board-c82f4179.js";class u{constructor(){this.coords=[],this.wrongAnswer=!1,this.tempWrong=!1,this.score=0,this.progress=100,this.started=!1,this.orientation=this.getOrientation(t.coordinates.colorChoice()),this.chessground=new r({fen:e,orientation:this.orientation,coordinates:!1,movable:{free:!1,color:null},events:{select:t=>this.handleSelect(t)}}),o.get("coordinates").then((t=>{t&&(this.averageScores=p(t),s())}))}getOrientation(t){return"random"===t?n():t}updateOrientation(){this.orientation=this.getOrientation(t.coordinates.colorChoice()),this.chessground.set({orientation:this.orientation}),s()}nextCoord(){return"abcdefgh"[Math.round(Math.random()*("abcdefgh".length-1))]+"12345678"[Math.round(Math.random()*("12345678".length-1))]}pushCoords(){for(;this.coords.length<3;){const t=this.nextCoord();-1===this.coords.indexOf(t)&&this.coords.push(t)}}handleSelect(t){this.started&&(t===this.coords[0]?(this.coords.shift(),this.pushCoords(),this.wrongAnswer=!1,this.tempWrong=!1,this.score++):(this.wrongAnswer=!0,this.tempWrong=!0,setTimeout((()=>{this.tempWrong=!1,s()}),350)),s())}startTraining(){if(!this.started){this.started=!0,this.pushCoords(),this.progress=0,this.score=0,this.wrongAnswer=!1,this.tempWrong=!1,this.updateOrientation();const t=performance.now(),r=setInterval((()=>{const e=Math.min(3e4,performance.now()-t);e>=3e4?(clearInterval(r),this.progress=100,this.started=!1,this.wrongAnswer=!1,this.tempWrong=!1,this.lastScore=this.score,this.coords=[],this.saveScore().then((t=>{this.averageScores=p(t),s()})),s()):(this.progress=100*e/3e4,s())}),50);s()}}saveScore(){return o.get("coordinates").then((t=>{const r=(t=t||{})[this.orientation]||[];return r.length>=100&&r.shift(),r.push(this.score),t[this.orientation]=r,t})).then((t=>o.set("coordinates",t)))}}function p(t){return{white:t.white?v(t.white):null,black:t.black?v(t.black):null}}function v(t){return Math.round(t.reduce(((t,r)=>t+r),0)/t.length*100)/100}var m={oninit(){this.coordCtrl=new u},oncreate:d,view(){return function(r){const e=t.coordinates;return l.board(a(i("coordinateTraining")),[c("div.coord-trainer__board_wrapper",[c("div.coord-trainer__progress",[c("div.coord-trainer__progress_bar",{className:r.wrongAnswer?"nope":"",style:{width:r.progress+"%"}})]),c("div.coord-trainer__coords",[...r.coords.map(((t,e)=>c("div.next_coord",{className:"coord"+(e+1)+(!0===r.tempWrong&&0===e?" nope":"")},t)))]),c(g,{variant:"standard",chessground:r.chessground})]),c("div.table.training-tableWrapper",[c("div.training-table.coord-trainer__table.native_scroller.box",[r.started?c("div.coord-trainer__score",{className:r.wrongAnswer?"nope":""},r.score):c.fragment({},[void 0!==r.lastScore?c("div.coord-trainer__previous",c.trust(i("lastScore",`<strong>${r.lastScore}</strong>`))):null,r.averageScores?c("div.coord-trainer__average",[c("div",c.trust(i("averageScoreAsWhiteX",`<strong>${null!==r.averageScores.white?r.averageScores.white:"?"}</strong>`))),c("div",c.trust(i("averageScoreAsBlackX",`<strong>${null!==r.averageScores.black?r.averageScores.black:"?"}</strong>`)))]):null,c("button.start.defaultButton.fat.wrap",{oncreate:h((()=>r.startTraining()))},i("startTraining"))])]),c("div.actions_bar.coord-trainer__colorChoice",["black","random","white"].map((t=>c("i.action_bar_button."+t,{className:t===e.colorChoice()?"selected":"",oncreate:h((()=>{r.started||(e.colorChoice(t),r.updateOrientation())}))}))))])])}(this.coordCtrl)}};export default m;
