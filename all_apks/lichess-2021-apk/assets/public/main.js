/*! Capacitor: https://capacitorjs.com/ - MIT License */
const e=(e=>e.CapacitorPlatforms=(e=>{const t=new Map;t.set("web",{name:"web"});const n=e.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:t};return n.addPlatform=(e,t)=>{n.platforms.set(e,t)},n.setPlatform=e=>{n.platforms.has(e)&&(n.currentPlatform=n.platforms.get(e))},n})(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{});e.addPlatform,e.setPlatform;var t;!function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"}(t||(t={}));class n extends Error{constructor(e,t){super(e),this.message=e,this.code=t}}const r=e=>{var r,i,o,a,s;const c=e.CapacitorCustomPlatform||null,l=e.Capacitor||{},u=l.Plugins=l.Plugins||{},d=e.CapacitorPlatforms,h=(null===(r=null==d?void 0:d.currentPlatform)||void 0===r?void 0:r.getPlatform)||(()=>null!==c?c.name:(e=>{var t,n;return(null==e?void 0:e.androidBridge)?"android":(null===(n=null===(t=null==e?void 0:e.webkit)||void 0===t?void 0:t.messageHandlers)||void 0===n?void 0:n.bridge)?"ios":"web"})(e)),m=(null===(i=null==d?void 0:d.currentPlatform)||void 0===i?void 0:i.isNativePlatform)||(()=>"web"!==h()),f=(null===(o=null==d?void 0:d.currentPlatform)||void 0===o?void 0:o.isPluginAvailable)||(e=>{const t=g.get(e);return!!(null==t?void 0:t.platforms.has(h()))||!!p(e)}),p=(null===(a=null==d?void 0:d.currentPlatform)||void 0===a?void 0:a.getPluginHeader)||(e=>{var t;return null===(t=l.PluginHeaders)||void 0===t?void 0:t.find((t=>t.name===e))}),g=new Map,v=(null===(s=null==d?void 0:d.currentPlatform)||void 0===s?void 0:s.registerPlugin)||((e,r={})=>{const i=g.get(e);if(i)return i.proxy;const o=h(),a=p(e);let s;const d=i=>{let u;const d=(...d)=>{const h=(async()=>(!s&&o in r?s=s="function"==typeof r[o]?await r[o]():r[o]:null!==c&&!s&&"web"in r&&(s=s="function"==typeof r.web?await r.web():r.web),s))().then((r=>{const s=((r,i)=>{var s,c;if(!a){if(r)return null===(c=r[i])||void 0===c?void 0:c.bind(r);throw new n(`"${e}" plugin is not implemented on ${o}`,t.Unimplemented)}{const t=null==a?void 0:a.methods.find((e=>i===e.name));if(t)return"promise"===t.rtype?t=>l.nativePromise(e,i.toString(),t):(t,n)=>l.nativeCallback(e,i.toString(),t,n);if(r)return null===(s=r[i])||void 0===s?void 0:s.bind(r)}})(r,i);if(s){const e=s(...d);return u=null==e?void 0:e.remove,e}throw new n(`"${e}.${i}()" is not implemented on ${o}`,t.Unimplemented)}));return"addListener"===i&&(h.remove=async()=>u()),h};return d.toString=()=>`${i.toString()}() { [capacitor code] }`,Object.defineProperty(d,"name",{value:i,writable:!1,configurable:!1}),d},m=d("addListener"),f=d("removeListener"),v=(e,t)=>{const n=m({eventName:e},t),r=async()=>{const r=await n;f({eventName:e,callbackId:r},t)},i=new Promise((e=>n.then((()=>e({remove:r})))));return i.remove=async()=>{await r()},i},b=new Proxy({},{get(e,t){switch(t){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return a?v:m;case"removeListener":return f;default:return d(t)}}});return u[e]=b,g.set(e,{name:e,proxy:b,platforms:new Set([...Object.keys(r),...a?[o]:[]])}),b});return l.convertFileSrc||(l.convertFileSrc=e=>e),l.getPlatform=h,l.handleError=t=>e.console.error(t),l.isNativePlatform=m,l.isPluginAvailable=f,l.pluginMethodNoop=(e,t,n)=>Promise.reject(`${n} does not have an implementation of "${t}".`),l.registerPlugin=v,l.Exception=n,l.DEBUG=!!l.DEBUG,l.isLoggingEnabled=!!l.isLoggingEnabled,l.platform=l.getPlatform(),l.isNative=l.isNativePlatform(),l},i=(e=>e.Capacitor=r(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}),o=i.registerPlugin,a=i.Plugins;class s{constructor(e){this.listeners={},this.windowListeners={},e&&(this.config=e)}addListener(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t);const n=this.windowListeners[e];n&&!n.registered&&this.addWindowListener(n);const r=async()=>this.removeListener(e,t),i=Promise.resolve({remove:r});return Object.defineProperty(i,"remove",{value:async()=>{await r()}}),i}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t){const n=this.listeners[e];n&&n.forEach((e=>e(t)))}hasListeners(e){return!!this.listeners[e].length}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:e=>{this.notifyListeners(t,e)}}}unimplemented(e="not implemented"){return new i.Exception(e,t.Unimplemented)}unavailable(e="not available"){return new i.Exception(e,t.Unavailable)}async removeListener(e,t){const n=this.listeners[e];if(!n)return;const r=n.indexOf(t);this.listeners[e].splice(r,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}}const c=o("App",{web:()=>import("./web-08c92539.js").then((e=>new e.AppWeb))}),l=o("Device",{web:()=>import("./web-bef6db3a.js").then((e=>new e.DeviceWeb))}),u=o("SplashScreen",{web:()=>import("./web-916beeab.js").then((e=>new e.SplashScreenWeb))}),d=o("Network",{web:()=>import("./web-5d49ac27.js").then((e=>new e.NetworkWeb))});var h,m;!function(e){e.Dark="DARK",e.Light="LIGHT",e.Default="DEFAULT"}(h||(h={})),function(e){e.Body="body",e.Ionic="ionic",e.Native="native",e.None="none"}(m||(m={}));const f=o("Keyboard");function p(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var g="object"==typeof global&&global&&global.Object===Object&&global,v="object"==typeof self&&self&&self.Object===Object&&self,b=g||v||Function("return this")(),w=function(){return b.Date.now()},y=/\s/;var k=/^\s+/;function P(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&y.test(e.charAt(t)););return t}(e)+1).replace(k,""):e}var T=b.Symbol,C=Object.prototype,S=C.hasOwnProperty,E=C.toString,x=T?T.toStringTag:void 0;var O=Object.prototype.toString;var M=T?T.toStringTag:void 0;function N(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":M&&M in Object(e)?function(e){var t=S.call(e,x),n=e[x];try{e[x]=void 0;var r=!0}catch(e){}var i=E.call(e);return r&&(t?e[x]=n:delete e[x]),i}(e):function(e){return O.call(e)}(e)}var j=/^[-+]0x[0-9a-f]+$/i,_=/^0b[01]+$/i,L=/^0o[0-7]+$/i,D=parseInt;function I(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return null!=e&&"object"==typeof e}(e)&&"[object Symbol]"==N(e)}(e))return NaN;if(p(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=p(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=P(e);var n=_.test(e);return n||L.test(e)?D(e.slice(2),n?2:8):j.test(e)?NaN:+e}var A=Math.max,R=Math.min;function z(e,t,n){var r,i,o,a,s,c,l=0,u=!1,d=!1,h=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){var n=r,o=i;return r=i=void 0,l=t,a=e.apply(o,n)}function f(e){return l=e,s=setTimeout(v,t),u?m(e):a}function g(e){var n=e-c;return void 0===c||n>=t||n<0||d&&e-l>=o}function v(){var e=w();if(g(e))return b(e);s=setTimeout(v,function(e){var n=t-(e-c);return d?R(n,o-(e-l)):n}(e))}function b(e){return s=void 0,h&&r?m(e):(r=i=void 0,a)}function y(){var e=w(),n=g(e);if(r=arguments,i=this,c=e,n){if(void 0===s)return f(c);if(d)return clearTimeout(s),s=setTimeout(v,t),m(c)}return void 0===s&&(s=setTimeout(v,t)),a}return t=I(t)||0,p(n)&&(u=!!n.leading,o=(d="maxWait"in n)?A(I(n.maxWait)||0,t):o,h="trailing"in n?!!n.trailing:h),y.cancel=function(){void 0!==s&&clearTimeout(s),l=0,r=c=i=s=void 0},y.flush=function(){return void 0===s?a:b(w())},y}const B=o("Toast",{web:()=>import("./web-a0698bba.js").then((e=>new e.ToastWeb))});function $(e){return e.getTime()%6e4}function U(e){var t=new Date(e.getTime()),n=Math.ceil(t.getTimezoneOffset());return t.setSeconds(0,0),6e4*n+(n>0?(6e4+$(t))%6e4:$(t))}function q(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function F(e){q(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):new Date(NaN)}function H(e,t){q(2,arguments);var n=F(e),r=F(t),i=n.getTime()-r.getTime();return i<0?-1:i>0?1:i}function W(e,t){q(2,arguments);var n=F(e),r=F(t);return n.getTime()-r.getTime()}function G(e,t){q(2,arguments);var n=W(e,t)/1e3;return n>0?Math.floor(n):Math.ceil(n)}function V(e){return function(e,t){if(null==e)throw new TypeError("assign requires that input parameter not be null or undefined");for(var n in t=t||{})t.hasOwnProperty(n)&&(e[n]=t[n]);return e}({},e)}var Y={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function K(e){return function(t){var n=t||{},r=n.width?String(n.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}var X={date:K({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:K({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:K({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},Q={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function J(e){return function(t,n){var r,i=n||{};if("formatting"===(i.context?String(i.context):"standalone")&&e.formattingValues){var o=e.defaultFormattingWidth||e.defaultWidth,a=i.width?String(i.width):o;r=e.formattingValues[a]||e.formattingValues[o]}else{var s=e.defaultWidth,c=i.width?String(i.width):e.defaultWidth;r=e.values[c]||e.values[s]}return r[e.argumentCallback?e.argumentCallback(t):t]}}function Z(e){return function(t,n){var r=String(t),i=n||{},o=i.width,a=o&&e.matchPatterns[o]||e.matchPatterns[e.defaultMatchWidth],s=r.match(a);if(!s)return null;var c,l=s[0],u=o&&e.parsePatterns[o]||e.parsePatterns[e.defaultParseWidth];return c="[object Array]"===Object.prototype.toString.call(u)?function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n}(u,(function(e){return e.test(l)})):function(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(e[n]))return n}(u,(function(e){return e.test(l)})),c=e.valueCallback?e.valueCallback(c):c,{value:c=i.valueCallback?i.valueCallback(c):c,rest:r.slice(l.length)}}}var ee,te={code:"en-US",formatDistance:function(e,t,n){var r;return n=n||{},r="string"==typeof Y[e]?Y[e]:1===t?Y[e].one:Y[e].other.replace("{{count}}",t),n.addSuffix?n.comparison>0?"in "+r:r+" ago":r},formatLong:X,formatRelative:function(e,t,n,r){return Q[e]},localize:{ordinalNumber:function(e,t){var n=Number(e),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:J({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:J({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:function(e){return Number(e)-1}}),month:J({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:J({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:J({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:(ee={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e,10)}},function(e,t){var n=String(e),r=t||{},i=n.match(ee.matchPattern);if(!i)return null;var o=i[0],a=n.match(ee.parsePattern);if(!a)return null;var s=ee.valueCallback?ee.valueCallback(a[0]):a[0];return{value:s=r.valueCallback?r.valueCallback(s):s,rest:n.slice(o.length)}}),era:Z({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:Z({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:Z({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:Z({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:Z({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}};function ne(e,t,n){q(2,arguments);var r=n||{},i=r.locale||te;if(!i.formatDistance)throw new RangeError("locale must contain localize.formatDistance property");var o=H(e,t);if(isNaN(o))throw new RangeError("Invalid time value");var a,s,c=V(r);c.addSuffix=Boolean(r.addSuffix),c.comparison=o,o>0?(a=F(t),s=F(e)):(a=F(e),s=F(t));var l,u=null==r.roundingMethod?"round":String(r.roundingMethod);if("floor"===u)l=Math.floor;else if("ceil"===u)l=Math.ceil;else{if("round"!==u)throw new RangeError("roundingMethod must be 'floor', 'ceil' or 'round'");l=Math.round}var d,h=G(s,a),m=(U(s)-U(a))/1e3,f=l((h-m)/60);if("second"===(d=null==r.unit?f<1?"second":f<60?"minute":f<1440?"hour":f<43200?"day":f<525600?"month":"year":String(r.unit)))return i.formatDistance("xSeconds",h,c);if("minute"===d)return i.formatDistance("xMinutes",f,c);if("hour"===d){var p=l(f/60);return i.formatDistance("xHours",p,c)}if("day"===d){var g=l(f/1440);return i.formatDistance("xDays",g,c)}if("month"===d){var v=l(f/43200);return i.formatDistance("xMonths",v,c)}if("year"===d){var b=l(f/525600);return i.formatDistance("xYears",b,c)}throw new RangeError("unit must be 'second', 'minute', 'hour', 'day', 'month' or 'year'")}function re(e){q(1,arguments);var t=F(e);return t.setHours(0,0,0,0),t}function ie(e,t){q(2,arguments);var n=re(e),r=re(t),i=n.getTime()-U(n),o=r.getTime()-U(r);return Math.round((i-o)/864e5)}function oe(e){q(1,arguments);var t=F(e);return!isNaN(t)}function ae(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function se(e,t){q(2,arguments);var n=F(e).getTime(),r=ae(t);return new Date(n+r)}function ce(e,t){q(2,arguments);var n=ae(t);return se(e,-n)}function le(e,t){for(var n=e<0?"-":"",r=Math.abs(e).toString();r.length<t;)r="0"+r;return n+r}var ue=function(e,t){var n=e.getUTCFullYear(),r=n>0?n:1-n;return le("yy"===t?r%100:r,t.length)},de=function(e,t){var n=e.getUTCMonth();return"M"===t?String(n+1):le(n+1,2)},he=function(e,t){return le(e.getUTCDate(),t.length)},me=function(e,t){return le(e.getUTCHours()%12||12,t.length)},fe=function(e,t){return le(e.getUTCHours(),t.length)},pe=function(e,t){return le(e.getUTCMinutes(),t.length)},ge=function(e,t){return le(e.getUTCSeconds(),t.length)},ve=function(e,t){var n=t.length,r=e.getUTCMilliseconds();return le(Math.floor(r*Math.pow(10,n-3)),t.length)};function be(e){q(1,arguments);var t=1,n=F(e),r=n.getUTCDay(),i=(r<t?7:0)+r-t;return n.setUTCDate(n.getUTCDate()-i),n.setUTCHours(0,0,0,0),n}function we(e){q(1,arguments);var t=F(e),n=t.getUTCFullYear(),r=new Date(0);r.setUTCFullYear(n+1,0,4),r.setUTCHours(0,0,0,0);var i=be(r),o=new Date(0);o.setUTCFullYear(n,0,4),o.setUTCHours(0,0,0,0);var a=be(o);return t.getTime()>=i.getTime()?n+1:t.getTime()>=a.getTime()?n:n-1}function ye(e){q(1,arguments);var t=we(e),n=new Date(0);n.setUTCFullYear(t,0,4),n.setUTCHours(0,0,0,0);var r=be(n);return r}function ke(e,t){q(1,arguments);var n=t||{},r=n.locale,i=r&&r.options&&r.options.weekStartsOn,o=null==i?0:ae(i),a=null==n.weekStartsOn?o:ae(n.weekStartsOn);if(!(a>=0&&a<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var s=F(e),c=s.getUTCDay(),l=(c<a?7:0)+c-a;return s.setUTCDate(s.getUTCDate()-l),s.setUTCHours(0,0,0,0),s}function Pe(e,t){q(1,arguments);var n=F(e,t),r=n.getUTCFullYear(),i=t||{},o=i.locale,a=o&&o.options&&o.options.firstWeekContainsDate,s=null==a?1:ae(a),c=null==i.firstWeekContainsDate?s:ae(i.firstWeekContainsDate);if(!(c>=1&&c<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var l=new Date(0);l.setUTCFullYear(r+1,0,c),l.setUTCHours(0,0,0,0);var u=ke(l,t),d=new Date(0);d.setUTCFullYear(r,0,c),d.setUTCHours(0,0,0,0);var h=ke(d,t);return n.getTime()>=u.getTime()?r+1:n.getTime()>=h.getTime()?r:r-1}function Te(e,t){q(1,arguments);var n=t||{},r=n.locale,i=r&&r.options&&r.options.firstWeekContainsDate,o=null==i?1:ae(i),a=null==n.firstWeekContainsDate?o:ae(n.firstWeekContainsDate),s=Pe(e,t),c=new Date(0);c.setUTCFullYear(s,0,a),c.setUTCHours(0,0,0,0);var l=ke(c,t);return l}var Ce="midnight",Se="noon",Ee="morning",xe="afternoon",Oe="evening",Me="night",Ne={G:function(e,t,n){var r=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});case"GGGG":default:return n.era(r,{width:"wide"})}},y:function(e,t,n){if("yo"===t){var r=e.getUTCFullYear(),i=r>0?r:1-r;return n.ordinalNumber(i,{unit:"year"})}return ue(e,t)},Y:function(e,t,n,r){var i=Pe(e,r),o=i>0?i:1-i;return"YY"===t?le(o%100,2):"Yo"===t?n.ordinalNumber(o,{unit:"year"}):le(o,t.length)},R:function(e,t){return le(we(e),t.length)},u:function(e,t){return le(e.getUTCFullYear(),t.length)},Q:function(e,t,n){var r=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(r);case"QQ":return le(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(e,t,n){var r=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(r);case"qq":return le(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(e,t,n){var r=e.getUTCMonth();switch(t){case"M":case"MM":return de(e,t);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(e,t,n){var r=e.getUTCMonth();switch(t){case"L":return String(r+1);case"LL":return le(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(e,t,n,r){var i=function(e,t){q(1,arguments);var n=F(e),r=ke(n,t).getTime()-Te(n,t).getTime();return Math.round(r/6048e5)+1}(e,r);return"wo"===t?n.ordinalNumber(i,{unit:"week"}):le(i,t.length)},I:function(e,t,n){var r=function(e){q(1,arguments);var t=F(e),n=be(t).getTime()-ye(t).getTime();return Math.round(n/6048e5)+1}(e);return"Io"===t?n.ordinalNumber(r,{unit:"week"}):le(r,t.length)},d:function(e,t,n){return"do"===t?n.ordinalNumber(e.getUTCDate(),{unit:"date"}):he(e,t)},D:function(e,t,n){var r=function(e){q(1,arguments);var t=F(e),n=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var r=t.getTime(),i=n-r;return Math.floor(i/864e5)+1}(e);return"Do"===t?n.ordinalNumber(r,{unit:"dayOfYear"}):le(r,t.length)},E:function(e,t,n){var r=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});case"EEEE":default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(e,t,n,r){var i=e.getUTCDay(),o=(i-r.weekStartsOn+8)%7||7;switch(t){case"e":return String(o);case"ee":return le(o,2);case"eo":return n.ordinalNumber(o,{unit:"day"});case"eee":return n.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(i,{width:"short",context:"formatting"});case"eeee":default:return n.day(i,{width:"wide",context:"formatting"})}},c:function(e,t,n,r){var i=e.getUTCDay(),o=(i-r.weekStartsOn+8)%7||7;switch(t){case"c":return String(o);case"cc":return le(o,t.length);case"co":return n.ordinalNumber(o,{unit:"day"});case"ccc":return n.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(i,{width:"narrow",context:"standalone"});case"cccccc":return n.day(i,{width:"short",context:"standalone"});case"cccc":default:return n.day(i,{width:"wide",context:"standalone"})}},i:function(e,t,n){var r=e.getUTCDay(),i=0===r?7:r;switch(t){case"i":return String(i);case"ii":return le(i,t.length);case"io":return n.ordinalNumber(i,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});case"iiii":default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(e,t,n){var r=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":case"aaa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaaaa":return n.dayPeriod(r,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(e,t,n){var r,i=e.getUTCHours();switch(r=12===i?Se:0===i?Ce:i/12>=1?"pm":"am",t){case"b":case"bb":case"bbb":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"bbbbb":return n.dayPeriod(r,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},B:function(e,t,n){var r,i=e.getUTCHours();switch(r=i>=17?Oe:i>=12?xe:i>=4?Ee:Me,t){case"B":case"BB":case"BBB":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(r,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},h:function(e,t,n){if("ho"===t){var r=e.getUTCHours()%12;return 0===r&&(r=12),n.ordinalNumber(r,{unit:"hour"})}return me(e,t)},H:function(e,t,n){return"Ho"===t?n.ordinalNumber(e.getUTCHours(),{unit:"hour"}):fe(e,t)},K:function(e,t,n){var r=e.getUTCHours()%12;return"Ko"===t?n.ordinalNumber(r,{unit:"hour"}):le(r,t.length)},k:function(e,t,n){var r=e.getUTCHours();return 0===r&&(r=24),"ko"===t?n.ordinalNumber(r,{unit:"hour"}):le(r,t.length)},m:function(e,t,n){return"mo"===t?n.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):pe(e,t)},s:function(e,t,n){return"so"===t?n.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):ge(e,t)},S:function(e,t){return ve(e,t)},X:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();if(0===i)return"Z";switch(t){case"X":return _e(i);case"XXXX":case"XX":return Le(i);case"XXXXX":case"XXX":default:return Le(i,":")}},x:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();switch(t){case"x":return _e(i);case"xxxx":case"xx":return Le(i);case"xxxxx":case"xxx":default:return Le(i,":")}},O:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+je(i,":");case"OOOO":default:return"GMT"+Le(i,":")}},z:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+je(i,":");case"zzzz":default:return"GMT"+Le(i,":")}},t:function(e,t,n,r){var i=r._originalDate||e;return le(Math.floor(i.getTime()/1e3),t.length)},T:function(e,t,n,r){return le((r._originalDate||e).getTime(),t.length)}};function je(e,t){var n=e>0?"-":"+",r=Math.abs(e),i=Math.floor(r/60),o=r%60;if(0===o)return n+String(i);var a=t||"";return n+String(i)+a+le(o,2)}function _e(e,t){return e%60==0?(e>0?"-":"+")+le(Math.abs(e)/60,2):Le(e,t)}function Le(e,t){var n=t||"",r=e>0?"-":"+",i=Math.abs(e);return r+le(Math.floor(i/60),2)+n+le(i%60,2)}function De(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}}function Ie(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}}var Ae={p:Ie,P:function(e,t){var n,r=e.match(/(P+)(p+)?/),i=r[1],o=r[2];if(!o)return De(e,t);switch(i){case"P":n=t.dateTime({width:"short"});break;case"PP":n=t.dateTime({width:"medium"});break;case"PPP":n=t.dateTime({width:"long"});break;case"PPPP":default:n=t.dateTime({width:"full"})}return n.replace("{{date}}",De(i,t)).replace("{{time}}",Ie(o,t))}},Re=["D","DD"],ze=["YY","YYYY"];function Be(e){return-1!==Re.indexOf(e)}function $e(e){return-1!==ze.indexOf(e)}function Ue(e){if("YYYY"===e)throw new RangeError("Use `yyyy` instead of `YYYY` for formatting years; see: https://git.io/fxCyr");if("YY"===e)throw new RangeError("Use `yy` instead of `YY` for formatting years; see: https://git.io/fxCyr");if("D"===e)throw new RangeError("Use `d` instead of `D` for formatting days of the month; see: https://git.io/fxCyr");if("DD"===e)throw new RangeError("Use `dd` instead of `DD` for formatting days of the month; see: https://git.io/fxCyr")}var qe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Fe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,He=/^'([^]*?)'?$/,We=/''/g,Ge=/[a-zA-Z]/;function Ve(e,t,n){q(2,arguments);var r=String(t),i=n||{},o=i.locale||te,a=o.options&&o.options.firstWeekContainsDate,s=null==a?1:ae(a),c=null==i.firstWeekContainsDate?s:ae(i.firstWeekContainsDate);if(!(c>=1&&c<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var l=o.options&&o.options.weekStartsOn,u=null==l?0:ae(l),d=null==i.weekStartsOn?u:ae(i.weekStartsOn);if(!(d>=0&&d<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!o.localize)throw new RangeError("locale must contain localize property");if(!o.formatLong)throw new RangeError("locale must contain formatLong property");var h=F(e);if(!oe(h))throw new RangeError("Invalid time value");var m=U(h),f=ce(h,m),p={firstWeekContainsDate:c,weekStartsOn:d,locale:o,_originalDate:h},g=r.match(Fe).map((function(e){var t=e[0];return"p"===t||"P"===t?(0,Ae[t])(e,o.formatLong,p):e})).join("").match(qe).map((function(e){if("''"===e)return"'";var t=e[0];if("'"===t)return Ye(e);var n=Ne[t];if(n)return!i.useAdditionalWeekYearTokens&&$e(e)&&Ue(e),!i.useAdditionalDayOfYearTokens&&Be(e)&&Ue(e),n(f,e,o.localize,p);if(t.match(Ge))throw new RangeError("Format string contains an unescaped latin alphabet character `"+t+"`");return e})).join("");return g}function Ye(e){return e.match(He)[1].replace(We,"'")}function Ke(e,t){q(2,arguments);var n=ae(t);return se(e,1e3*n)}const Xe=o("Storage",{web:()=>import("./web-4e1776c9.js").then((e=>new e.StorageWeb))});var Qe={get:function(e){return Xe.get({key:e}).then((({value:e})=>null!==e?JSON.parse(e):e))},set:function(e,t){return Xe.set({key:e,value:JSON.stringify(t)}).then((()=>t))},remove:e=>Xe.remove({key:e}),async migrate(){await Xe.migrate()}};const Je=Object.prototype.hasOwnProperty;function Ze(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(let r=0;r<n.length;r++)if(!Je.call(t,n[r])||!Object.is(e[n[r]],t[n[r]]))return!1;return!0}function et(e,t){return t.split(".").reduce(((e,t)=>e&&e[t]),e)}function tt(e,t,n){if("string"==typeof t&&(t=t.split(".")),t.length>1){const r=t.shift();null!==e[r]&&"object"==typeof e[r]||(e[r]={}),tt(e[r],t,n)}else e[t[0]]=n}function nt(e,t){return Object.assign({},t.reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:e[n]})),{}))}function rt(e){return[e.toString(),e.toString()]}function it(e,t,n=1){const r=[];for(let i=e;i<=t;i+=n)r.push(i.toString());return r}function ot(e,t,n=1){return it(e,t,n).map(rt)}const at=[["Standard","standard"],["Crazyhouse","crazyhouse"],["Chess960","chess960"],["King of the Hill","kingOfTheHill"],["Three-check","threeCheck"],["Antichess","antichess"],["Atomic","atomic"],["Horde","horde"],["Racing Kings","racingKings"]],st=[["Sudden Death","simple"],["Increment","increment"],["Increment with Handicap","handicapInc"],["Simple Delay","delay"],["Bronstein Delay","bronstein"],["Hourglass","hourglass"],["Stage","stage"]],ct=[...Array(11).keys()].map((e=>50*e)),lt={};var ut={general:{locale:dt("lang",null),sound:dt("sound",!0),theme:{availableBackgroundThemes:[{key:"dark",name:"dark",ext:""},{key:"light",name:"light",ext:""},{key:"bgshapes",name:"Shapes",ext:"jpg"},{key:"anthracite",name:"Anthracite",ext:"jpg"},{key:"blue-maze",name:"Blue Maze",ext:"jpg"},{key:"red-maze",name:"Red Maze",ext:"jpg"},{key:"checkerboard",name:"Checkerboard",ext:"png"},{key:"wood",name:"Wood",ext:"jpg"},{key:"space",name:"Space",ext:"jpg"}],availableBoardThemes:[{key:"blue",name:"Blue",ext:"svg"},{key:"blue2",name:"Blue 2",ext:"jpg"},{key:"blue3",name:"Blue 3",ext:"jpg"},{key:"blue-marble",name:"Blue Marble",ext:"jpg"},{key:"canvas",name:"Canvas",ext:"jpg"},{key:"wood",name:"Wood",ext:"jpg"},{key:"wood2",name:"Wood 2",ext:"jpg"},{key:"wood3",name:"Wood 3",ext:"jpg"},{key:"wood4",name:"Wood 4",ext:"jpg"},{key:"maple",name:"Maple",ext:"jpg"},{key:"maple2",name:"Maple 2",ext:"jpg"},{key:"brown",name:"Brown",ext:"svg"},{key:"leather",name:"Leather",ext:"jpg"},{key:"green",name:"Green",ext:"svg"},{key:"marble",name:"Marble",ext:"jpg"},{key:"green-plastic",name:"Green Plastic",ext:"png"},{key:"grey",name:"Grey",ext:"jpg"},{key:"metal",name:"Metal",ext:"jpg"},{key:"olive",name:"Olive",ext:"jpg"},{key:"newspaper",name:"Newspaper",ext:"png"},{key:"purple",name:"Purple",ext:"svg"},{key:"purple-diag",name:"Purple 2",ext:"png"},{key:"pink",name:"Pink",ext:"png"},{key:"ic",name:"IC",ext:"svg"},{key:"horsey",name:"horsey",ext:"jpg"}],bundledBoardThemes:["brown","blue","green","purple","ic"],availablePieceThemes:[["cburnett","Colin M.L. Burnett"],["merida"],["pirouetti"],["chessnut"],["chess7"],["alpha"],["reilly"],["companion"],["riohacha"],["kosal"],["leipzig"],["fantasy"],["spatial"],["california"],["pixel"],["maestro"],["fresca"],["cardinal"],["gioco"],["tatiana"],["staunty"],["governor"],["symmetric"],["dubrovny"],["icpieces"],["libra"],["shapes"],["letter"],["horsey"]],background:dt("bgTheme","dark"),board:dt("theme.board","brown"),piece:dt("theme.piece","cburnett")},vibrateOnGameEvents:dt("vibrateOnGameEvents",!1),notifications:{enable:dt("notifications",!0),vibrate:dt("notifications.vibrate",!0),sound:dt("notifications.sound",!0)}},game:{supportedVariants:["standard","chess960","antichess","fromPosition","kingOfTheHill","threeCheck","atomic","horde","racingKings","crazyhouse"],animations:dt("gameAnimations",!0),highlights:dt("boardHighlights",!0),pieceDestinations:dt("pieceDestinations",!0),coords:dt("coords",!0),magnified:dt("pieceMagnified",!0),pieceNotation:dt("pieceNotation",!0),zenMode:dt("zenMode",!1),blindfoldChess:dt("blindfoldChess",!1),clockPosition:dt("game.inversedClockPos","right"),pieceMove:dt("game.pieceMove","both"),rookCastle:dt("game.rookCastle",1),moveList:dt("game.moveList",!0),landscapeBoardSide:dt("game.landscapeBoardSide","left")},analyse:{supportedVariants:["standard","chess960","antichess","fromPosition","kingOfTheHill","threeCheck","atomic","horde","racingKings","crazyhouse"],availableVariants:at,syntheticVariant:dt("analyse.syntheticVariant","standard"),enableCeval:dt("analyse.enableCeval",!1),cevalMultiPvs:dt("ceval.multipv",1),cevalCores:dt("ceval.cores",1),cevalHashSize:dt("ceval.hashSize",16),cevalUseNNUE:dt("ceval.useNNUE",!0),cevalInfinite:dt("ceval.infinite",!1),cevalMaxDepth:dt("ceval.maxDepth",18),showBestMove:dt("analyse.showBestMove",!0),showComments:dt("analyse.showComments",!0),smallBoard:dt("analyse.smallBoard",!0),explorer:{db:dt("analyse.explorer.db","lichess"),availableRatings:[1600,1800,2e3,2200,2500],rating:dt("analyse.explorer.rating",[1600,1800,2e3,2200,2500]),availableSpeeds:["bullet","blitz","rapid","classical"],speed:dt("analyse.explorer.speed",["bullet","blitz","rapid","classical"])}},ai:{availableOpponents:[["Stockfish","1"],["Stockfish","2"],["Stockfish","3"],["Stockfish","4"],["Stockfish","5"],["Stockfish","6"],["Stockfish","7"],["Stockfish","8"]],color:dt("ai.color","white"),opponent:dt("ai.opponent","1"),variant:dt("ai.variant","standard"),availableVariants:at},otb:{flipPieces:dt("otb.flipPieces",!1),useSymmetric:dt("otb.useSymmetric",!1),variant:dt("otb.variant","standard"),availableVariants:at,whitePlayer:dt("otb.whitePlayer","White"),blackPlayer:dt("otb.blackPlayer","Black"),clockType:dt("otb.clockType","none"),availableClocks:[["None","none"]].concat(st)},clock:{availableClocks:st,clockType:dt("clock.clockType","simple"),simple:{time:dt("clock.simple.time","5")},increment:{time:dt("clock.increment.time","3"),increment:dt("clock.increment.increment","2")},handicapInc:{topTime:dt("clock.handicapInc.topTime","3"),topIncrement:dt("clock.handicapInc.topIncrement","2"),bottomTime:dt("clock.handicapInc.bottomTime","3"),bottomIncrement:dt("clock.handicapInc.bottomIncrement","2")},delay:{time:dt("clock.delay.time","3"),increment:dt("clock.delay.increment","2")},bronstein:{time:dt("clock.bronstein.time","3"),increment:dt("clock.bronstein.increment","2")},hourglass:{time:dt("clock.hourglass.time","5")},stage:{stages:dt("clock.stage.stages",[{time:"120",moves:"40"},{time:"60",moves:null}]),increment:dt("clock.stage.increment","30")},availableTimes:[["0","0"],["½","0.5"],["¾","0.75"],["1","1"],["2","2"],["3","3"],["4","4"],["5","5"],["6","6"],["7","7"],["8","8"],["9","9"],["10","10"],["15","15"],["20","20"],["25","25"],["30","30"],["45","45"],["60","60"],["90","90"],["120","120"],["150","150"],["180","180"]],availableIncrements:["0","1","2","3","4","5","6","7","8","9","10","15","20","25","30","45","60","90","120","150","180"],availableMoves:["5","10","15","20","25","30","35","40","45","50","55","60"]},gameSetup:{availableTimes:[["0","0"],["¼","0.25"],["½","0.5"],["¾","0.75"],["1","1"],["2","2"],["3","3"],["4","4"],["5","5"],["6","6"],["7","7"],["8","8"],["9","9"],["10","10"],["15","15"],["20","20"],["25","25"],["30","30"],["45","45"],["60","60"],["90","90"],["120","120"],["150","150"],["180","180"]],availableIncrements:["0","1","2","3","4","5","6","7","8","9","10","15","20","25","30","45","60","90","120","150","180"],availableDays:["1","2","3","5","7","10","14"],isTimeValid:function(e){return"1"!==e.timeMode()||"0"!==e.time()||"0"!==e.increment()},ai:{color:dt("game.ai.color","random"),availableVariants:[["Standard","1"],["Crazyhouse","10"],["Chess960","2"],["King of the Hill","4"],["Three-check","5"],["Antichess","6"],["Atomic","7"],["Horde","8"],["Racing Kings","9"],["From Position","3"]],variant:dt("game.ai.variant","1"),availableTimeModes:[["unlimited","0"],["realTime","1"]],timeMode:dt("game.ai.clock","1"),time:dt("game.ai.time","10"),increment:dt("game.ai.increment","0"),days:dt("game.ai.days","2"),level:dt("game.ai.aiLevel","3")},human:{availableVariants:[["Standard","1"],["Crazyhouse","10"],["Chess960","2"],["King of the Hill","4"],["Three-check","5"],["Antichess","6"],["Atomic","7"],["Horde","8"],["Racing Kings","9"]],availableRatingRanges:{min:[...ct].reverse().map((e=>["-"+e,"-"+e])),max:ct.map((e=>["+"+e,"+"+e]))},ratingRangeMin:dt("game.human.rating.range_min","-500"),ratingRangeMax:dt("game.human.rating.range_max","+500"),color:dt("game.human.color","random"),variant:dt("game.human.variant","1"),availableTimeModes:[["realTime","1"],["correspondence","2"],["unlimited","0"]],timeMode:dt("game.human.clock","1"),time:dt("game.human.time","5"),increment:dt("game.human.increment","0"),days:dt("game.human.days","2"),mode:dt("game.human.mode","0"),preset:dt("game.human.preset","quick"),pool:dt("game.human.pool","")},challenge:{availableVariants:[["Standard","1"],["Crazyhouse","10"],["Chess960","2"],["King of the Hill","4"],["Three-check","5"],["Antichess","6"],["Atomic","7"],["Horde","8"],["Racing Kings","9"],["From Position","3"]],color:dt("game.invite.color","random"),variant:dt("game.invite.variant","1"),availableTimeModes:[["realTime","1"],["correspondence","2"],["unlimited","0"]],timeMode:dt("game.invite.clock","1"),time:dt("game.invite.time","5"),increment:dt("game.invite.increment","0"),days:dt("game.invite.days","2"),mode:dt("game.invite.mode","0")}},tournament:{availableVariants:[["Standard","1"],["Crazyhouse","10"],["Chess960","2"],["King of the Hill","4"],["Three-check","5"],["Antichess","6"],["Atomic","7"],["Horde","8"],["Racing Kings","9"]],availableModes:[["Casual","0"],["Rated","1"]],availableTimes:[["0","0"],["½","0.5"],["¾","0.75"],["1","1"],["1.5","1.5"]].concat(ot(2,7,1)).concat(ot(10,25,5)).concat(ot(30,60,10)),availableIncrements:it(0,7,1).concat(it(10,25,5)).concat(it(30,60,10)),availableDurations:it(20,55,5).concat(it(60,110,10)).concat(it(120,360,30)).concat(it(420,540,60)).concat(["600","720"]),availableTimesToStart:["1","2","3","5","10","15","20","30","45","60"],variant:dt("tournament.variant","1"),mode:dt("tournament.mode","0"),time:dt("tournament.time","5"),increment:dt("tournament.increment","0"),duration:dt("tournament.duration","45"),timeToStart:dt("tournament.timeToStart","15"),position:dt("tournament.timeToStart","15"),private:dt("tournament.private",!1),join:{lastTeam:dt("tournament.join.lastTeam","")}},tv:{channel:dt("tv.channel","best")},importer:{analyse:dt("importer.analyse",!1)},training:{puzzleBufferLen:50,ratingDiffThreshold:100},coordinates:{colorChoice:dt("coordinates.colorChoice","random")},study:{tour:dt("study.tour",null)}};function dt(e,t){return function(n){if(void 0!==n)return tt(lt,e,n),Qe.set("settings",lt).then((()=>{})),n;const r=et(lt,e);return void 0!==r?r:t}}const ht={},mt={day:"2-digit",month:"long",year:"numeric"},ft=Object.assign(Object.assign({},mt),{hour:"2-digit",minute:"2-digit"});let pt,gt="en-GB",vt={},bt=new Intl.NumberFormat,wt=new Intl.DateTimeFormat(void 0,mt),yt=new Intl.DateTimeFormat(void 0,ft);function kt(e,...t){const n=vt[e]||Bt[e];return n?Ct(n,...t):e}function Pt(e,...t){const n=vt[e]||Bt[e];return n?function(e,...t){const n=e.split(/(%(?:\d\$)?s)/g);for(let e=1;e<=t.length;e++){const r=n.indexOf("%"+e+"$s");-1!==r&&(n[r]=t[e-1])}for(let e=0;e<t.length;e++){const r=n.indexOf("%s");if(-1===r)break;n[r]=t[e]}return n}(n,...t):e}function Tt(e,t,n){const r=e+":"+function(e,t){const n=t%100,r=t%10;switch(jt(e)){case"fr":case"ff":case"kab":return t<2?"one":"other";case"cs":case"sk":return 1===t?"one":t>=2&&t<=4?"few":"other";case"hr":case"ru":case"sr":case"uk":case"be":case"bs":case"sh":return 1===r&&11!==n?"one":r>=2&&r<=4&&!(n>=12&&n<=14)?"few":0===r||r>=5&&r<=9||n>=11&&n<=14?"many":"other";case"lv":return 0===t?"zero":t%10==1&&t%100!=11?"one":"other";case"lt":return 1!==r||n>=11&&n<=19?r>=2&&r<=9&&!(n>=11&&n<=19)?"few":"other":"one";case"pl":return 1===t?"one":r>=2&&r<=4&&!(n>=12&&n<=14)?"few":"other";case"ro":case"mo":return 1===t?"one":0===t||n>=1&&n<=19?"few":"other";case"sl":return 1===n?"one":2===n?"two":n>=3&&n<=4?"few":"other";case"ar":return 0===t?"zero":1===t?"one":2===t?"two":n>=3&&n<=10?"few":n>=11&&n<=99?"many":"other";case"mk":return t%10==1&&11!==t?"one":"other";case"cy":case"br":return 0===t?"zero":1===t?"one":2===t?"two":3===t?"few":6===t?"many":"other";case"mt":return 1===t?"one":0===t||n>=2&&n<=10?"few":n>=11&&n<=19?"many":"other";case"ga":case"se":case"sma":case"smi":case"smj":case"smn":case"sms":return 1===t?"one":2===t?"two":"other";case"ak":case"am":case"bh":case"fil":case"tl":case"guw":case"hi":case"ln":case"mg":case"nso":case"ti":case"wa":return 0===t||1===t?"one":"other";case"az":case"bm":case"fa":case"ig":case"hu":case"ja":case"kde":case"kea":case"ko":case"my":case"ses":case"sg":case"to":case"tr":case"vi":case"wo":case"yo":case"zh":case"bo":case"dz":case"id":case"jv":case"ka":case"km":case"kn":case"ms":case"th":case"tp":case"io":case"ia":return"other";default:return 1===t?"one":"other"}}(gt,t),i=vt[r]||vt[e+":other"]||vt[e];return i?Ct(i,void 0!==n?n:t):e}function Ct(e,...t){let n=e;if(t.length){if(n.includes("$s"))for(let e=1;e<4;e++)n=n.replace("%"+e+"$s",String(t[e-1]));for(const e of t)n=n.replace("%s",String(e))}return n}function St(e){return bt.format(e)}function Et(e){return wt.format(e)}function xt(e){return yt.format(e)}function Ot(e){const t=new Date(0);return ne(t,Ke(t,e),{locale:pt})}function Mt(e){return function(e,t,n){q(2,arguments);var r=F(e),i=F(t),o=n||{},a=o.locale||te;if(!a.localize)throw new RangeError("locale must contain localize property");if(!a.formatLong)throw new RangeError("locale must contain formatLong property");if(!a.formatRelative)throw new RangeError("locale must contain formatRelative property");var s,c=ie(r,i);if(isNaN(c))throw new RangeError("Invalid time value");s=c<-6?"other":c<-1?"lastWeek":c<0?"yesterday":c<1?"today":c<2?"tomorrow":c<7?"nextWeek":"other";var l=ce(r,U(r)),u=ce(i,U(i)),d=a.formatRelative(s,l,u,o);return Ve(r,d,o)}(e,new Date,{locale:pt})}function Nt(e,t=!1){return function(e,t){return q(1,arguments),ne(e,Date.now(),t)}(e,{locale:pt,addSuffix:t})}function jt(e){return e.split("-")[0]}function _t(e){return zt[e]||Rt.find((t=>jt(t)===e))}function Lt(){return gt}function Dt(e){return function(e){const t=At[e]?e:"en-GB";return import("./i18n/"+t+".js").then((({default:e})=>(gt=t,vt=Object.assign(Object.assign({},ht),e),bt=new Intl.NumberFormat(t),wt=new Intl.DateTimeFormat(t,mt),yt=new Intl.DateTimeFormat(t,ft),t)))}(e).then(ut.general.locale).then((()=>function(e){if("en-GB"===e)return Promise.resolve(e);const t=It.includes(e)?e:jt(e);return import(`./i18n/date/${t}.js`).then((t=>(pt=t.default||void 0,e))).catch((()=>(pt=void 0,e)))}(e)))}const It=["ar-DZ","ar-MA","ar-SA","en-AU","en-CA","en-GB","en-IN","en-US","fa-IR","fr-CA","fr-CH","nl-BE","pt-BR","zh-CN","zh-TW"];const At={"af-ZA":"Afrikaans","an-ES":"aragonés","ar-SA":"العربية","as-IN":"অসমীয়া","az-AZ":"Azərbaycanca","be-BY":"Беларуская","bg-BG":"български език","bn-BD":"বাংলা","br-FR":"brezhoneg","bs-BA":"bosanski","ca-ES":"Català, valencià","cs-CZ":"čeština","cv-CU":"чӑваш чӗлхи","cy-GB":"Cymraeg","da-DK":"Dansk","de-CH":"Schwiizerdüütsch","de-DE":"Deutsch","el-GR":"Ελληνικά","en-GB":"English","en-US":"English (US)","eo-UY":"Esperanto","es-ES":"español","et-EE":"eesti keel","eu-ES":"Euskara","fa-IR":"فارسی","fi-FI":"suomen kieli","fo-FO":"føroyskt","fr-FR":"français","frp-IT":"arpitan","fy-NL":"Frysk","ga-IE":"Gaeilge","gd-GB":"Gàidhlig","gl-ES":"Galego","gu-IN":"ગુજરાતી","he-IL":"עִבְרִית","hi-IN":"हिन्दी, हिंदी","hr-HR":"hrvatski","hu-HU":"Magyar","hy-AM":"Հայերեն","ia-IA":"Interlingua","id-ID":"Bahasa Indonesia","io-EN":"Ido","is-IS":"Íslenska","it-IT":"Italiano","ja-JP":"日本語","jbo-EN":"lojban","jv-ID":"basa Jawa","ka-GE":"ქართული","kab-DZ":"Taqvaylit","kk-KZ":"қазақша","kmr-TR":"Kurdî (Kurmancî)","kn-IN":"ಕನ್ನಡ","ko-KR":"한국어","ky-KG":"кыргызча","la-LA":"lingua Latina","lb-LU":"Lëtzebuergesch","lt-LT":"lietuvių kalba","lv-LV":"latviešu valoda","mg-MG":"fiteny malagasy","mk-MK":"македонски јази","ml-IN":"മലയാളം","mn-MN":"монгол","mr-IN":"मराठी","nb-NO":"Norsk bokmål","ne-NP":"नेपाली","nl-NL":"Nederlands","nn-NO":"Norsk nynorsk","pi-IN":"पालि","pl-PL":"polski","ps-AF":"پښتو","pt-PT":"Português","pt-BR":"Português (BR)","ro-RO":"Română","ru-RU":"русский язык","sa-IN":"संस्कृत","sk-SK":"slovenčina","sl-SI":"slovenščina","sq-AL":"Shqip","sr-SP":"Српски језик","sv-SE":"svenska","sw-KE":"Kiswahili","ta-IN":"தமிழ்","tg-TJ":"тоҷикӣ","th-TH":"ไทย","tk-TM":"Türkmençe","tl-PH":"Tagalog","tp-TP":"toki pona","tr-TR":"Türkçe","uk-UA":"українська","ur-PK":"اُردُو","uz-UZ":"oʻzbekcha","vi-VN":"Tiếng Việt","yo-NG":"Yorùbá","zh-CN":"中文","zh-TW":"繁體中文","zu-ZA":"isiZulu"},Rt=Object.keys(At),zt={de:"de-DE",en:"en-US",pt:"pt-PT",zh:"zh-CN"},Bt={apiUnsupported:"Your version of lichess app is too old! Please upgrade for free to the latest version.",apiDeprecated:"Upgrade for free to the latest lichess app! Support for this version will be dropped on %s.",playerisInvitingYou:"%s is inviting you",unsupportedVariant:"Variant %s is not supported in this version",notesSynchronizationHasFailed:"Notes synchronization with lichess has failed, please try later.",localEvalCaution:"Caution: intensive usage will drain battery.",incorrectThreefoldClaim:"Incorrect threefold repetition claim.",vibrateOnGameEvents:"Vibrate on game events",offline:"Offline"},$t=Object.assign({},{apiVersion:5,fetchTimeoutMs:15e3},window.lichess);var Ut="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function qt(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}var Ft=qt((function(e){
/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
 */
!function(t){function n(e,t,n,r,i){this._listener=t,this._isOnce=n,this.context=r,this._signal=e,this._priority=i||0}function r(e,t){if("function"!=typeof e)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function i(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){i.prototype.dispatch.apply(e,arguments)}}n.prototype={active:!0,params:null,execute:function(e){var t,n;return this.active&&this._listener&&(n=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,n),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},i.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,t,r,i){var o,a=this._indexOfListener(e,r);if(-1!==a){if((o=this._bindings[a]).isOnce()!==t)throw new Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else o=new n(this,e,t,r,i),this._addBinding(o);return this.memorize&&this._prevParams&&o.execute(this._prevParams),o},_addBinding:function(e){var t=this._bindings.length;do{--t}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var n,r=this._bindings.length;r--;)if((n=this._bindings[r])._listener===e&&n.context===t)return r;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,n){return r(e,"add"),this._registerListener(e,!1,t,n)},addOnce:function(e,t,n){return r(e,"addOnce"),this._registerListener(e,!0,t,n)},remove:function(e,t){r(e,"remove");var n=this._indexOfListener(e,t);return-1!==n&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),e},removeAll:function(){for(var e=this._bindings.length;e--;)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var t,n=Array.prototype.slice.call(arguments),r=this._bindings.length;if(this.memorize&&(this._prevParams=n),r){t=this._bindings.slice(),this._shouldPropagate=!0;do{r--}while(t[r]&&this._shouldPropagate&&!1!==t[r].execute(n))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var o=i;o.Signal=i,e.exports?e.exports=o:t.signals=o}(Ut)})),Ht={redraw:new Ft.Signal,afterLogin:new Ft.Signal,afterLogout:new Ft.Signal,sessionRestored:new Ft.Signal,homePong:new Ft.Signal};let Wt=new Set,Gt=!1;function Vt(e){Wt.add(e),Gt||(Gt=!0,requestAnimationFrame((e=>{const t=Wt;Gt=!1,Wt=new Set,t.forEach((t=>t(e)))})))}function Yt(e){Wt.delete(e)}const Kt=Ht.redraw.dispatch;function Xt(){Vt(Kt)}let Qt,Jt;function Zt(){return Qt||en()}function en(){const e=window.crypto.getRandomValues(new Uint8Array(9));return Qt=btoa(String.fromCharCode(...e)).replace(/[/+]/g,"_"),Qt}function tn(e){return new Promise(((t,n)=>{const r=new XMLHttpRequest;r.overrideMimeType("application/json"),r.open("GET",e,!0),r.onreadystatechange=()=>{4===r.readyState&&(0===r.status||200===r.status?t(JSON.parse(r.responseText)):n(r))},r.send(null)}))}function nn(e){return new Promise(((t,n)=>{if(function(e){const t=document.head.getElementsByTagName("script");for(let n=0,r=t.length;n<r;n++)if(t[n].getAttribute("src")===e)return!0;return!1}(e))setTimeout(t,0);else{const r=document.createElement("script");r.src=e,r.onload=()=>t(),r.onerror=()=>n(),document.head.appendChild(r)}}))}function rn(e){return new Promise(((t,n)=>{if(function(e){const t=document.head.getElementsByTagName("link");for(let n=0,r=t.length;n<r;n++)if(t[n].getAttribute("href")===e)return!0;return!1}(e))setTimeout(t,0);else{const r=document.createElement("link");r.rel="stylesheet",r.type="text/css",r.href=e,r.onload=()=>t(),r.onerror=()=>n(),document.head.appendChild(r)}}))}function on(e){const t=e();return Xt(),t}function an(){return Jt.connected}function sn(e){const t=e.status,n=e.body;let r;r=t&&0!==t?401===t?"You are not authorized to do that.":404===t?"Resource not found.":503===t?"lichess.org is temporarily down for maintenance.":t>=500?"Server error.":"Something went wrong.":"lichess.org is unreachable.",n&&("string"==typeof n?r+=` ${n}`:"string"==typeof n.error?r+=` ${n.error}`:n.global&&n.global.constructor===Array&&(r+=` ${kt(n.global[0])}`)),B.show({text:r,duration:"short"})}function cn(e){let t="";return Object.keys(e).forEach((n=>{const r=e[n];null!=r&&(""!==t&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(r))})),t}function ln(){}d.addListener("networkStatusChange",(e=>{Jt=e})),d.getStatus().then((e=>{Jt=e}));const un={bullet:"T",blitz:")",rapid:"#",classical:"+",correspondence:";",chess960:"'",kingOfTheHill:"(",threeCheck:".",antichess:"@",atomic:">",puzzle:"-",horde:"_",fromPosition:"*",racingKings:"",crazyhouse:"",ultraBullet:"{",computer:"n",bot:"n"};function dn(e){return e&&un[e]||"8"}function hn(e){return 0===e?e:e/60}function mn(e){return"white"===e?"black":"white"}function fn(e){return e.charAt(0).toUpperCase()+e.slice(1)}function pn(e,t){return Math.random()*(t-e)+e}function gn(e,t){return"racingKings"===e.game.variant.key?t?"black":"white":t?e.opponent.color:e.player.color}function vn(e,t){let n=e+"";for(;n.length<t;)n="0"+n;return n}function bn(e,t="hour_min_secs"){let n="";const r=Math.floor(e/60/60),i=Math.floor(e/60)-60*r,o=e%60;return n="hour_min_secs"===t?r>0?r+":"+vn(i,2)+":"+vn(o,2):i+":"+vn(o,2):vn(o,2),n}function wn(e){const t=Math.floor(e/60),n=Math.floor(e-60*t);return(t?t+"H ":"")+(n?n+"M":"")}function yn(e){if(e){const t=hn(e.limit);return(.25===t?"¼":.5===t?"½":.75===t?"¾":t.toString())+"+"+e.increment}return"∞"}function kn(e){return null!=e}function Pn(e){return`${$t.apiEndPoint}/assets/${e}`}function Tn(e){const t=Number(e);return isNaN(t)?void 0:t}function Cn(e){if(!(void 0===e||e.length>7||0===e.length||/[^a-zA-Z0-9]/.exec(e)))return e.split("").reduce(((e,t,n)=>e+function(e){const t=e.charCodeAt(0);return t>96?t-71:t>64?t-65:t+4}(t)*Math.pow(62,n)),0)}const Sn=window.requestIdleCallback||window.setTimeout;function En(e){let t=e;return e=>(void 0!==e&&(t=e),t)}function xn(e){return e?250:0}function On(){return Math.random()>.5?"white":"black"}function Mn(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return p(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),z(e,t,{leading:r,maxWait:t,trailing:i})}function Nn(e){try{return window.localStorage?e(window.localStorage):null}catch(e){}}var jn={get:function(e){return Nn((t=>{const n=t.getItem(e);return n?JSON.parse(n):null}))},set:function(e,t){Nn((n=>{try{n.setItem(e,JSON.stringify(t))}catch(r){n.removeItem(e),n.setItem(e,JSON.stringify(t))}}))},remove:function(e){Nn((t=>{t.removeItem(e)}))}};function _n(e,t,n,r,i,o){return{tag:e,key:t,attrs:n,children:r,text:i,dom:o,domSize:void 0,state:void 0,events:void 0,instance:void 0}}_n.normalize=function(e){return Array.isArray(e)?_n("[",void 0,void 0,_n.normalizeChildren(e),void 0,void 0):null==e||"boolean"==typeof e?null:"object"==typeof e?e:_n("#",void 0,void 0,String(e),void 0,void 0)},_n.normalizeChildren=function(e){var t=[];if(window.lichess&&"dev"===window.lichess.mode&&e.length)for(var n=null!=e[0]&&null!=e[0].key,r=1;r<e.length;r++)if((null!=e[r]&&null!=e[r].key)!==n)throw new TypeError(!n||null==e[r]&&"boolean"!=typeof e[r]?"In fragments, vnodes must either all have keys or none have keys.":"In fragments, vnodes must either all have keys or none have keys. You may wish to consider using an explicit keyed empty fragment, m.fragment({key: ...}), instead of a hole.");for(r=0;r<e.length;r++)t[r]=_n.normalize(e[r]);return t};var Ln=_n,Dn=function(){var e,t=arguments[this],n=this+1;if(null==t?t={}:("object"!=typeof t||null!=t.tag||Array.isArray(t))&&(t={},n=this),arguments.length===n+1)e=arguments[n],Array.isArray(e)||(e=[e]);else for(e=[];n<arguments.length;)e.push(arguments[n++]);return Ln("",t.key,t,e)},In={}.hasOwnProperty,An=/(?:(^|#|\.)([^#\.\[\]]+))|(\[(.+?)(?:\s*=\s*("|'|)((?:\\["'\]]|.)*?)\5)?\])/g,Rn={};function zn(e){for(var t in e)if(In.call(e,t))return!1;return!0}function Bn(e){for(var t,n="div",r=[],i={};t=An.exec(e);){var o=t[1],a=t[2];if(""===o&&""!==a)n=a;else if("#"===o)i.id=a;else if("."===o)r.push(a);else if("["===t[3][0]){var s=t[6];s&&(s=s.replace(/\\(["'])/g,"$1").replace(/\\\\/g,"\\")),"class"===t[4]?r.push(s):i[t[4]]=""===s?s:s||!0}}return r.length>0&&(i.className=r.join(" ")),Rn[e]={tag:n,attrs:i}}function $n(e,t){var n=t.attrs,r=Ln.normalizeChildren(t.children),i=In.call(n,"class"),o=i?n.class:n.className;if(t.tag=e.tag,t.attrs=null,t.children=void 0,!zn(e.attrs)&&!zn(n)){var a={};for(var s in n)In.call(n,s)&&(a[s]=n[s]);n=a}for(var s in e.attrs)In.call(e.attrs,s)&&"className"!==s&&!In.call(n,s)&&(n[s]=e.attrs[s]);for(var s in null==o&&null==e.attrs.className||(n.className=null!=o?null!=e.attrs.className?String(e.attrs.className)+" "+String(o):o:null!=e.attrs.className?e.attrs.className:null),i&&(n.class=null),n)if(In.call(n,s)&&"key"!==s){t.attrs=n;break}return Array.isArray(r)&&1===r.length&&null!=r[0]&&"#"===r[0].tag?t.text=r[0].children:t.children=r,t}var Un=function(e){if(null==e||"string"!=typeof e&&"function"!=typeof e&&"function"!=typeof e.view)throw Error("The selector must be either a string or a component.");var t=Dn.apply(1,arguments);return"string"==typeof e&&(t.children=Ln.normalizeChildren(t.children),"["!==e)?$n(Rn[e]||Bn(e),t):(t.tag=e,t)};Un.trust=function(e){return null==e&&(e=""),Ln("<",void 0,void 0,e,void 0,void 0)},Un.fragment=function(){var e=Dn.apply(0,arguments);return e.tag="[",e.children=Ln.normalizeChildren(e.children),e};var qn=Un;let Fn;var Hn={spin(){if(void 0!==Fn||document.getElementById("globalSpinner"))return;const e=document.createElement("div");e.id="globalSpinner",e.className="spinner globalSpinner";const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("viewBox","0 0 40 40");const n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx","20"),n.setAttribute("cy","20"),n.setAttribute("r","18"),n.setAttribute("fill","none"),t.appendChild(n),e.appendChild(t),Fn=setTimeout((()=>{document.body.appendChild(e)}),200)},stop(){clearTimeout(Fn),Fn=void 0;const e=document.getElementsByClassName("globalSpinner");e.length&&setTimeout((function(){for(;e[0];)document.body.removeChild(e[0])}),500)},getVdom:e=>qn("div.spinner",{className:e||""},[qn("svg",{viewBox:"0 0 40 40"},[qn("circle",{cx:"20",cy:"20",r:"18",fill:"none"})])]),getHtml:()=>'<div class="spinner monochrome"><svg viewBox="0 0 40 40"><circle cx=20 cy=20 r=18 fill="none"></circle></svg></div>'};function Wn(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e.toString():"";default:return""}}function Gn(e,t,n,r){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map((r=>{const i=encodeURIComponent(Wn(r))+n;return Array.isArray(e[r])?e[r].map((e=>i+encodeURIComponent(Wn(e)))).join(t):i+encodeURIComponent(Wn(e[r]))})).join(t):r?encodeURIComponent(Wn(r))+n+encodeURIComponent(Wn(e)):""}var Vn=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const Yn="sessionId",Kn=$t.apiEndPoint;function Xn(e,t,n,r=!1){let i;function o(){clearTimeout(i),r&&Hn.stop()}const a=new Headers({"X-Requested-With":"XMLHttpRequest",Accept:"application/vnd.lichess.v"+$t.apiVersion+"+json"}),s=jn.get("sessionId");null!=s&&a.append("sessionId",s);const c={method:"GET",credentials:"include"};let l;if(void 0!==n){const{headers:t,query:r,timeout:i}=n,o=Vn(n,["headers","query","timeout"]);if(l=i,r){const t=Gn(r);""!==t&&(e=function(e,t){const n=e.indexOf("?")<0?"?":"&";return e+n+t}(e,t))}Object.assign(c,o),t&&Object.keys(t).forEach((e=>{const n=t[e];"__delete"!==n?a.set(e,n):a.delete(e)}))}"POST"!==c.method&&"PUT"!==c.method||a.has("Content-Type")||(a.set("Content-Type","application/json; charset=UTF-8"),c.body||(c.body="{}"));const u=e.indexOf("http")>-1?e:Kn+e,d=new Promise(((e,t)=>{i=setTimeout((()=>t(new Error("Request timeout."))),l||$t.fetchTimeoutMs)})),h=Promise.race([fetch(u,Object.assign(Object.assign({},c),{headers:a})),d]);return r&&Hn.spin(),new Promise(((e,n)=>{h.then((r=>{o(),r.ok?e(r[t]()):r.text().then((e=>{try{n({status:r.status,body:JSON.parse(e)})}catch(e){n({status:r.status,body:r.statusText})}}))})).catch((e=>{o(),n({status:0,body:e.message})}))}))}function Qn(e,t,n=!1){return Xn(e,"json",t,n)}function Jn(e,t,n=!1){return Xn(e,"text",t,n)}const Zn=o("PushNotifications",{}),er=o("SoundEffect",{web:()=>import("./web-927e7a9a.js").then((e=>new e.SoundEffectWeb))});let tr;var nr={load(e){tr=ut.general.sound();const t="ios"===e.platform?".aifc":".mp3";return Promise.all([er.loadSound({id:"move",path:`sounds/move${t}`}),er.loadSound({id:"capture",path:`sounds/capture${t}`}),er.loadSound({id:"explosion",path:`sounds/explosion${t}`}),er.loadSound({id:"lowtime",path:`sounds/lowtime${t}`}),er.loadSound({id:"dong",path:`sounds/dong${t}`}),er.loadSound({id:"berserk",path:`sounds/berserk${t}`}),er.loadSound({id:"clock",path:`sounds/clock${t}`}),er.loadSound({id:"confirmation",path:`sounds/confirmation${t}`})]).then((()=>{}))},move(){tr&&er.play({id:"move"})},throttledMove:Mn((()=>{tr&&er.play({id:"move"})}),50),capture(){tr&&er.play({id:"capture"})},throttledCapture:Mn((()=>{tr&&er.play({id:"capture"})}),50),explosion(){tr&&er.play({id:"explosion"})},throttledExplosion:Mn((()=>{tr&&er.play({id:"explosion"})}),50),lowtime(){tr&&er.play({id:"lowtime"})},dong(){tr&&er.play({id:"dong"})},berserk(){tr&&er.play({id:"berserk"})},clock(){tr&&er.play({id:"clock"})},confirmation(){tr&&er.play({id:"confirmation"})},onSettingChange(e){tr=e}};const rr=o("Dialog",{web:()=>import("./web-d9e3f8de.js").then((e=>new e.DialogWeb))});function ir(e){return{mode:Number(e.mode()),variant:Number(e.variant()),timeMode:Number(e.timeMode()),time:Number(e.time()),increment:Number(e.increment()),days:Number(e.days()),color:e.color(),ratingRangeMin:Number(e.ratingRangeMin()),ratingRangeMax:Number(e.ratingRangeMax())}}function or(e,t){const{ratingRangeMin:n,ratingRangeMax:r}=t;let i="correspondence";switch(t.variant){case 1:case 3:if(1===t.timeMode){const e=60*t.time+40*t.increment;i=e<30?"ultraBullet":e<180?"bullet":e<480?"blitz":e<1500?"rapid":"classical"}break;case 2:i="chess960";break;case 4:i="kingOfTheHill";break;case 5:i="threeCheck";break;case 6:i="antichess";break;case 7:i="atomic";break;case 8:i="horde";break;case 9:i="racingKings";break;case 10:i="crazyhouse"}const o=e.perfs[i];return o&&void 0!==n&&void 0!==r?`${o.rating+n}-${o.rating+r}`:null}var ar=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function sr(e){const t=ut.gameSetup.ai,n={variant:t.variant(),timeMode:t.timeMode(),days:t.days(),time:t.time(),increment:t.increment(),level:t.level(),color:t.color()};return e&&(n.fen=e),Qn("/setup/ai",{method:"POST",body:JSON.stringify(n)},!0)}function cr(e){const t=ar(e,["ratingRangeMin","ratingRangeMax"]),n=gi.get(),r=n?or(n,e):null,i=r?Object.assign(Object.assign({},t),{ratingRange:r}):Object.assign({},t);return Qn("/setup/hook/"+Zt(),{method:"POST",body:JSON.stringify(i)},!0)}function lr(){return Qn("/challenge")}function ur(e){return Qn(`/challenge/${e}`,{},!0)}function dr(e){return Jn(`/challenge/${e}/cancel`,{method:"POST"},!0)}function hr(e){return Jn(`/challenge/${e}/decline`,{method:"POST"},!0)}function mr(e){return Qn(`/challenge/${e}/accept`,{method:"POST"},!0)}let fr=[];function pr(e){return Qn("/",void 0,e).then((e=>(void 0!==e.lobby.pools&&(fr=e.lobby.pools),e)))}function gr(e){return Qn("/lobby/seeks",{query:{_:Date.now()}},e)}function vr(e,t){let n="/"+e;return t&&(n+="/"+t),Qn(n)}function br(e){return Jn("/bookmark/"+e,{method:"POST"})}function wr(e,t){return Qn("/tv/"+e,t?{query:{flip:1}}:{})}function yr(e,t){return Qn(`/import/master/${e}/${t}`)}function kr(e){return gi.isConnected()?Qn("/translation/select",{method:"POST",body:JSON.stringify({lang:e})}).then((()=>{})):Promise.resolve()}function Pr(e){return Qn(`/@/${e}/mini`)}function Tr(){return Qn("/timeline",void 0,!1)}let Cr=[],Sr=[];function Er(e){return-1!==ut.game.supportedVariants.indexOf(e.variant.key)&&"created"===e.status}function xr(e){e.in.length>Cr.length&&nr.dong(),Cr=e.in,Sr=e.out}var Or={all:()=>Cr.filter(Er).concat(Sr.filter(Er)),incoming:()=>Cr.filter(Er),sending:()=>Sr.filter(Er),set:xr,refresh:()=>Mn(lr,1e3)().then(xr),remove(e){Cr=Cr.filter((t=>t.id!==e)),Sr=Sr.filter((t=>t.id!==e))},isPersistent:e=>"correspondence"===e.timeControl.type||"unlimited"===e.timeControl.type,challengeTime:e=>function(e){return"clock"===e.type}(e.timeControl)?e.timeControl.show:function(e){return"correspondence"===e.type}(e.timeControl)?Tt("nbDays",e.timeControl.daysPerTurn):"∞"},Mr=qt((function(e){!function(t,n){var r=t.define;r&&r.amd?r("rlite",[],n):e.exports?e.exports=n():t.Rlite=n()}(Ut,(function(){return function(){var e={},t=decodeURIComponent;function n(e){return e}function r(r){var i=function(e){return~e.indexOf("/?")&&(e=e.replace("/?","?")),"/"==e[0]&&(e=e.slice(1)),"/"==e[e.length-1]&&(e=e.slice(0,-1)),e}(r).split("?"),o=~r.indexOf("%")?t:n;return function(e,t,n){if(e&&t.cb)for(var r=e.indexOf("#"),i=(r<0?e:e.slice(0,r)).split("&"),o=0;o<i.length;++o){var a=i[o].split("=");t.params[a[0]]=n(a[1])}return t}(i[1],function(t,n){for(var r=t.split("/"),i=e,o={},a=0;a<r.length&&i;++a){var s=n(r[a]);(i=i[s.toLowerCase()]||i[":"])&&i["~"]&&(o[i["~"]]=s)}return i&&{cb:i["@"],params:o}}(i[0],o)||{},o)}return{add:function(t,n){for(var r=t.split("/"),i=e,o=0;o<r.length;++o){var a=r[o],s=":"==a[0]?":":a.toLowerCase();i=i[s]||(i[s]={}),":"==s&&(i["~"]=a.slice(1))}i["@"]=n},exists:function(e){return!!r(e).cb},lookup:r,run:function(e){var t=r(e);return t.cb&&t.cb({url:e,params:t.params}),!!t.cb}}}}))})),Nr=function(e){var t,n=e&&e.document,r={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"};function i(e){return e.attrs&&e.attrs.xmlns||r[e.tag]}function o(e,t){if(e.state!==t)throw new Error("'vnode.state' must not be modified.")}function a(e){var t=e.state;try{return this.apply(t,arguments)}finally{o(e,t)}}function s(){try{return n.activeElement}catch(e){return null}}function c(e,t,n,r,i,o,a){for(var s=n;s<r;s++){var c=t[s];null!=c&&l(e,c,i,a,o)}}function l(e,t,r,i,o){var a=t.tag;if("string"==typeof a)switch(t.state={},null!=t.attrs&&U(t.attrs,t,r),a){case"#":!function(e,t,r){t.dom=n.createTextNode(t.children),T(e,t.dom,r)}(e,t,o);break;case"<":d(e,t,i,o);break;case"[":!function(e,t,r,i,o){var a=n.createDocumentFragment();if(null!=t.children){var s=t.children;c(a,s,0,s.length,r,null,i)}t.dom=a.firstChild,t.domSize=a.childNodes.length,T(e,a,o)}(e,t,r,i,o);break;default:h(e,t,r,i,o)}else!function(e,t,n,r,i){m(t,n),null!=t.instance?(l(e,t.instance,n,r,i),t.dom=t.instance.dom,t.domSize=null!=t.dom?t.instance.domSize:0):t.domSize=0}(e,t,r,i,o)}var u={caption:"table",thead:"table",tbody:"table",tfoot:"table",tr:"tbody",th:"tr",td:"tr",colgroup:"table",col:"colgroup"};function d(e,t,r,i){var o=t.children.match(/^\s*?<(\w+)/im)||[],a=n.createElement(u[o[1]]||"div");"http://www.w3.org/2000/svg"===r?(a.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+t.children+"</svg>",a=a.firstChild):a.innerHTML=t.children,t.dom=a.firstChild,t.domSize=a.childNodes.length,t.instance=[];for(var s,c=n.createDocumentFragment();s=a.firstChild;)t.instance.push(s),c.appendChild(s);T(e,c,i)}function h(e,t,r,o,a){var s=t.tag,l=t.attrs,u=l&&l.is,d=(o=i(t)||o)?u?n.createElementNS(o,s,{is:u}):n.createElementNS(o,s):u?n.createElement(s,{is:u}):n.createElement(s);if(t.dom=d,null!=l&&function(e,t,n){for(var r in t)N(e,r,null,t[r],n)}(t,l,o),T(e,d,a),!C(t)&&(null!=t.text&&(""!==t.text?d.textContent=t.text:t.children=[Ln("#",void 0,void 0,t.text,void 0,void 0)]),null!=t.children)){var h=t.children;c(d,h,0,h.length,r,null,o),"select"===t.tag&&null!=l&&function(e,t){if("value"in t)if(null===t.value)-1!==e.dom.selectedIndex&&(e.dom.value=null);else{var n=""+t.value;e.dom.value===n&&-1!==e.dom.selectedIndex||(e.dom.value=n)}"selectedIndex"in t&&N(e,"selectedIndex",null,t.selectedIndex,void 0)}(t,l)}}function m(e,t){var n;if("function"==typeof e.tag.view){if(e.state=Object.create(e.tag),null!=(n=e.state.view).$$reentrantLock$$)return;n.$$reentrantLock$$=!0}else{if(e.state=void 0,null!=(n=e.tag).$$reentrantLock$$)return;n.$$reentrantLock$$=!0,e.state=null!=e.tag.prototype&&"function"==typeof e.tag.prototype.view?new e.tag(e):e.tag(e)}if(U(e.state,e,t),null!=e.attrs&&U(e.attrs,e,t),e.instance=Ln.normalize(a.call(e.state.view,e)),e.instance===e)throw Error("A view cannot return the vnode it received as argument");n.$$reentrantLock$$=null}function f(e,t,n,r,i,o){if(t!==n&&(null!=t||null!=n))if(null==t||0===t.length)c(e,n,0,n.length,r,i,o);else if(null==n||0===n.length)S(e,t,0,t.length);else{var a=null!=t[0]&&null!=t[0].key,s=null!=n[0]&&null!=n[0].key,u=0,d=0;if(!a)for(;d<t.length&&null==t[d];)d++;if(!s)for(;u<n.length&&null==n[u];)u++;if(null===s&&null==a)return;if(a!==s)S(e,t,d,t.length),c(e,n,u,n.length,r,i,o);else if(s){for(var h,m,f,g,v,P=t.length-1,T=n.length-1;P>=d&&T>=u&&(f=t[P],g=n[T],f.key===g.key);)f!==g&&p(e,f,g,r,i,o),null!=g.dom&&(i=g.dom),P--,T--;for(;P>=d&&T>=u&&(h=t[d],m=n[u],h.key===m.key);)d++,u++,h!==m&&p(e,h,m,r,y(t,d,i),o);for(;P>=d&&T>=u&&u!==T&&h.key===g.key&&f.key===m.key;)k(e,f,v=y(t,d,i)),f!==m&&p(e,f,m,r,v,o),++u<=--T&&k(e,h,i),h!==g&&p(e,h,g,r,i,o),null!=g.dom&&(i=g.dom),d++,f=t[--P],g=n[T],h=t[d],m=n[u];for(;P>=d&&T>=u&&f.key===g.key;)f!==g&&p(e,f,g,r,i,o),null!=g.dom&&(i=g.dom),T--,f=t[--P],g=n[T];if(u>T)S(e,t,d,P+1);else if(d>P)c(e,n,u,T+1,r,i,o);else{var C,x,O=i,M=T-u+1,N=new Array(M),j=0,_=0,L=2147483647,D=0;for(_=0;_<M;_++)N[_]=-1;for(_=T;_>=u;_--){null==C&&(C=b(t,d,P+1));var I=C[(g=n[_]).key];null!=I&&(L=I<L?I:-1,N[_-u]=I,f=t[I],t[I]=null,f!==g&&p(e,f,g,r,i,o),null!=g.dom&&(i=g.dom),D++)}if(i=O,D!==P-d+1&&S(e,t,d,P+1),0===D)c(e,n,u,T+1,r,i,o);else if(-1===L)for(j=(x=function(e){var t=[0],n=0,r=0,i=0,o=w.length=e.length;for(i=0;i<o;i++)w[i]=e[i];for(i=0;i<o;++i)if(-1!==e[i]){var a=t[t.length-1];if(e[a]<e[i])w[i]=a,t.push(i);else{for(n=0,r=t.length-1;n<r;){var s=(n>>>1)+(r>>>1)+(n&r&1);e[t[s]]<e[i]?n=s+1:r=s}e[i]<e[t[n]]&&(n>0&&(w[i]=t[n-1]),t[n]=i)}}n=t.length,r=t[n-1];for(;n-- >0;)t[n]=r,r=w[r];return w.length=0,t}(N)).length-1,_=T;_>=u;_--)m=n[_],-1===N[_-u]?l(e,m,r,o,i):x[j]===_-u?j--:k(e,m,i),null!=m.dom&&(i=n[_].dom);else for(_=T;_>=u;_--)m=n[_],-1===N[_-u]&&l(e,m,r,o,i),null!=m.dom&&(i=n[_].dom)}}else{var A=t.length<n.length?t.length:n.length;for(u=u<d?u:d;u<A;u++)(h=t[u])===(m=n[u])||null==h&&null==m||(null==h?l(e,m,r,o,y(t,u+1,i)):null==m?E(e,h):p(e,h,m,r,y(t,u+1,i),o));t.length>A&&S(e,t,u,t.length),n.length>A&&c(e,n,u,n.length,r,i,o)}}}function p(e,t,n,r,i,o){var s=t.tag;if(s===n.tag){if(n.state=t.state,n.events=t.events,function(e,t){do{var n;if(null!=e.attrs&&"function"==typeof e.attrs.onbeforeupdate)if(void 0!==(n=a.call(e.attrs.onbeforeupdate,e,t))&&!n)break;if("string"!=typeof e.tag&&"function"==typeof e.state.onbeforeupdate)if(void 0!==(n=a.call(e.state.onbeforeupdate,e,t))&&!n)break;return!1}while(0);return e.dom=t.dom,e.domSize=t.domSize,e.instance=t.instance,e.attrs=t.attrs,e.children=t.children,e.text=t.text,!0}(n,t))return;if("string"==typeof s)switch(null!=n.attrs&&q(n.attrs,n,r),s){case"#":!function(e,t){e.children.toString()!==t.children.toString()&&(e.dom.nodeValue=t.children);t.dom=e.dom}(t,n);break;case"<":!function(e,t,n,r,i){t.children!==n.children?(x(e,t),d(e,n,r,i)):(n.dom=t.dom,n.domSize=t.domSize,n.instance=t.instance)}(e,t,n,o,i);break;case"[":!function(e,t,n,r,i,o){f(e,t.children,n.children,r,i,o);var a=0,s=n.children;if(n.dom=null,null!=s){for(var c=0;c<s.length;c++){var l=s[c];null!=l&&null!=l.dom&&(null==n.dom&&(n.dom=l.dom),a+=l.domSize||1)}1!==a&&(n.domSize=a)}}(e,t,n,r,i,o);break;default:g(t,n,r,o)}else v(e,t,n,r,i,o)}else E(e,t),l(e,n,r,o,i)}function g(e,t,n,r){var o=t.dom=e.dom;r=i(t)||r,"textarea"===t.tag&&(null==t.attrs&&(t.attrs={}),null!=t.text&&(t.attrs.value=t.text,t.text=void 0)),function(e,t,n,r){if(null!=n)for(var i in n)N(e,i,t&&t[i],n[i],r);var o;if(null!=t)for(var i in t)null==(o=t[i])||null!=n&&null!=n[i]||j(e,i,o,r)}(t,e.attrs,t.attrs,r),C(t)||(null!=e.text&&null!=t.text&&""!==t.text?e.text.toString()!==t.text.toString()&&(e.dom.firstChild.nodeValue=t.text):(null!=e.text&&(e.children=[Ln("#",void 0,void 0,e.text,void 0,e.dom.firstChild)]),null!=t.text&&(t.children=[Ln("#",void 0,void 0,t.text,void 0,void 0)]),f(o,e.children,t.children,n,null,r)))}function v(e,t,n,r,i,o){if(n.instance=Ln.normalize(a.call(n.state.view,n)),n.instance===n)throw Error("A view cannot return the vnode it received as argument");q(n.state,n,r),null!=n.attrs&&q(n.attrs,n,r),null!=n.instance?(null==t.instance?l(e,n.instance,r,o,i):p(e,t.instance,n.instance,r,i,o),n.dom=n.instance.dom,n.domSize=n.instance.domSize):null!=t.instance?(E(e,t.instance),n.dom=void 0,n.domSize=0):(n.dom=t.dom,n.domSize=t.domSize)}function b(e,t,n){for(var r=Object.create(null);t<n;t++){var i=e[t];if(null!=i){var o=i.key;null!=o&&(r[o]=t)}}return r}var w=[];function y(e,t,n){for(;t<e.length;t++)if(null!=e[t]&&null!=e[t].dom)return e[t].dom;return n}function k(e,t,r){var i=n.createDocumentFragment();P(e,i,t),T(e,i,r)}function P(e,t,n){for(;null!=n.dom&&n.dom.parentNode===e;){if("string"!=typeof n.tag){if(null!=(n=n.instance))continue}else if("<"===n.tag)for(var r=0;r<n.instance.length;r++)t.appendChild(n.instance[r]);else if("["!==n.tag)t.appendChild(n.dom);else if(1===n.children.length){if(null!=(n=n.children[0]))continue}else for(r=0;r<n.children.length;r++){var i=n.children[r];null!=i&&P(e,t,i)}break}}function T(e,t,n){null!=n?e.insertBefore(t,n):e.appendChild(t)}function C(e){if(null==e.attrs||null==e.attrs.contenteditable&&null==e.attrs.contentEditable)return!1;var t=e.children;if(null!=t&&1===t.length&&"<"===t[0].tag){var n=t[0].children;e.dom.innerHTML!==n&&(e.dom.innerHTML=n)}else if(null!=e.text||null!=t&&0!==t.length)throw new Error("Child node of a contenteditable must be trusted.");return!0}function S(e,t,n,r){for(var i=n;i<r;i++){var o=t[i];null!=o&&E(e,o)}}function E(e,t){var n,r,i,s=0,c=t.state;"string"!=typeof t.tag&&"function"==typeof t.state.onbeforeremove&&(null!=(i=a.call(t.state.onbeforeremove,t))&&"function"==typeof i.then&&(s=1,n=i));t.attrs&&"function"==typeof t.attrs.onbeforeremove&&(null!=(i=a.call(t.attrs.onbeforeremove,t))&&"function"==typeof i.then&&(s|=2,r=i));if(o(t,c),s){if(null!=n){var l=function(){1&s&&((s&=2)||u())};n.then(l,l)}if(null!=r){l=function(){2&s&&((s&=1)||u())};r.then(l,l)}}else M(t),O(e,t);function u(){o(t,c),M(t),O(e,t)}}function x(e,t){for(var n=0;n<t.instance.length;n++)e.removeChild(t.instance[n])}function O(e,t){for(;null!=t.dom&&t.dom.parentNode===e;){if("string"!=typeof t.tag){if(null!=(t=t.instance))continue}else if("<"===t.tag)x(e,t);else{if("["!==t.tag&&(e.removeChild(t.dom),!Array.isArray(t.children)))break;if(1===t.children.length){if(null!=(t=t.children[0]))continue}else for(var n=0;n<t.children.length;n++){var r=t.children[n];null!=r&&O(e,r)}}break}}function M(e){if("string"!=typeof e.tag&&"function"==typeof e.state.onremove&&a.call(e.state.onremove,e),e.attrs&&"function"==typeof e.attrs.onremove&&a.call(e.attrs.onremove,e),"string"!=typeof e.tag)null!=e.instance&&M(e.instance);else{var t=e.children;if(Array.isArray(t))for(var n=0;n<t.length;n++){var r=t[n];null!=r&&M(r)}}}function N(e,t,r,i,o){if("key"!==t&&"is"!==t&&null!=i&&!_(t)&&(r!==i||function(e,t){return"value"===t||"checked"===t||"selectedIndex"===t||"selected"===t&&e.dom===s()||"option"===e.tag&&e.dom.parentNode===n.activeElement}(e,t)||"object"==typeof i)){if("o"===t[0]&&"n"===t[1])return $(e,t,i);if("xlink:"===t.slice(0,6))e.dom.setAttributeNS("http://www.w3.org/1999/xlink",t.slice(6),i);else if("style"===t)z(e.dom,r,i);else if(L(e,t,o)){if("value"===t){if(("input"===e.tag||"textarea"===e.tag)&&e.dom.value===""+i&&e.dom===s())return;if("select"===e.tag&&null!==r&&e.dom.value===""+i)return;if("option"===e.tag&&null!==r&&e.dom.value===""+i)return}"input"===e.tag&&"type"===t?e.dom.setAttribute(t,i):e.dom[t]=i}else"boolean"==typeof i?i?e.dom.setAttribute(t,""):e.dom.removeAttribute(t):e.dom.setAttribute("className"===t?"class":t,i)}}function j(e,t,n,r){if("key"!==t&&"is"!==t&&null!=n&&!_(t))if("o"!==t[0]||"n"!==t[1]||_(t))if("style"===t)z(e.dom,n,null);else if(!L(e,t,r)||"className"===t||"value"===t&&("option"===e.tag||"select"===e.tag&&-1===e.dom.selectedIndex&&e.dom===s())||"input"===e.tag&&"type"===t){var i=t.indexOf(":");-1!==i&&(t=t.slice(i+1)),!1!==n&&e.dom.removeAttribute("className"===t?"class":t)}else e.dom[t]=null;else $(e,t,void 0)}function _(e){return"oninit"===e||"oncreate"===e||"onupdate"===e||"onremove"===e||"onbeforeremove"===e||"onbeforeupdate"===e}function L(e,t,n){return void 0===n&&(e.tag.indexOf("-")>-1||null!=e.attrs&&e.attrs.is||"href"!==t&&"list"!==t&&"form"!==t&&"width"!==t&&"height"!==t)&&t in e.dom}var D,I=/[A-Z]/g;function A(e){return"-"+e.toLowerCase()}function R(e){return"-"===e[0]&&"-"===e[1]?e:"cssFloat"===e?"float":e.replace(I,A)}function z(e,t,n){if(t===n);else if(null==n)e.style.cssText="";else if("object"!=typeof n)e.style.cssText=n;else if(null==t||"object"!=typeof t)for(var r in e.style.cssText="",n){null!=(i=n[r])&&e.style.setProperty(R(r),String(i))}else{for(var r in n){var i;null!=(i=n[r])&&(i=String(i))!==String(t[r])&&e.style.setProperty(R(r),i)}for(var r in t)null!=t[r]&&null==n[r]&&e.style.removeProperty(R(r))}}function B(){this._=t}function $(e,t,n){if(null!=e.events){if(e.events[t]===n)return;null==n||"function"!=typeof n&&"object"!=typeof n?(null!=e.events[t]&&e.dom.removeEventListener(t.slice(2),e.events,!1),e.events[t]=void 0):(null==e.events[t]&&e.dom.addEventListener(t.slice(2),e.events,!1),e.events[t]=n)}else null==n||"function"!=typeof n&&"object"!=typeof n||(e.events=new B,e.dom.addEventListener(t.slice(2),e.events,!1),e.events[t]=n)}function U(e,t,n){"function"==typeof e.oninit&&a.call(e.oninit,t),"function"==typeof e.oncreate&&n.push(a.bind(e.oncreate,t))}function q(e,t,n){"function"==typeof e.onupdate&&n.push(a.bind(e.onupdate,t))}return B.prototype=Object.create(null),B.prototype.handleEvent=function(e){var t,n=this["on"+e.type];"function"==typeof n?t=n.call(e.currentTarget,e):"function"==typeof n.handleEvent&&n.handleEvent(e),this._&&!1!==e.redraw&&(0,this._)(),!1===t&&(e.preventDefault(),e.stopPropagation())},function(e,n,r){if(!e)throw new TypeError("DOM element being rendered to does not exist.");if(null!=D&&e.contains(D))throw new TypeError("Node is currently being rendered to and thus is locked.");var i=t,o=D,a=[],c=s(),l=e.namespaceURI;D=e,t="function"==typeof r?r:void 0;try{null==e.vnodes&&(e.textContent=""),n=Ln.normalizeChildren(Array.isArray(n)?n:[n]),f(e,e.vnodes,n,a,null,"http://www.w3.org/1999/xhtml"===l?void 0:l),e.vnodes=n,null!=c&&s()!==c&&"function"==typeof c.focus&&c.focus();for(var u=0;u<a.length;u++)a[u]()}finally{t=i,D=o}}}(window);function jr(e){if(!p(e))return!1;var t=N(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}const _r=function(){let e=0;return()=>e++}(),Lr=new Mr;let Dr=0,Ir="fwd",Ar="/";const Rr=document.body;function zr(e,t){const n={view:()=>Ln(e,void 0,t)};function r(){Nr(Rr,Ln(n))}Ht.redraw.removeAll(),Ht.redraw.add(r);try{r()}catch(e){throw Ht.redraw.removeAll(),e}}function Br(e){e&&e.state&&(Ir=e.state.id<Dr?"bwd":"fwd",Dr=e.state.id),Ar=Wr();const t=window.location.search||"?=";Lr.run(t.slice(2))||Lr.run("/")}const $r={replaceState(e,t){try{const n=e?Object.assign({},window.history.state,e):window.history.state;void 0!==t?window.history.replaceState(n,"","?="+t):window.history.replaceState(n,"")}catch(e){}},pushState(e){const t=_r();Dr=t,Ir="fwd";try{window.history.pushState({id:t},"","?="+e)}catch(e){}}};function Ur(e,t=!1){const n=(window.location.search||"?=/").substring(2).replace(/\?.+$/,"")+`?${cn(e)}`;t?Hr(n,!0):$r.replaceState(void 0,n)}function qr(){const e=Wr().match(/\?.+$/),t={};if(e&&e[0])for(const[n,r]of new URLSearchParams(e[0]))t[n]=r;return t}const Fr=(()=>{const e=()=>{const t=e.stack.pop();jr(t)?(t("backbutton"),Xt()):/^\/$/.test(Wr())?c.exitApp():/^\/game\/[a-zA-Z0-9]{12}/.test(Wr())&&!gi.isConnected()?rr.confirm({title:"Confirmation",message:"Do you really want to leave the game? You can't go back to it after."}).then((({value:e})=>{e&&Gr()})):Gr()};return e.stack=[],e})();function Hr(e,t=!1){setTimeout((()=>function(e,t=!1){Fr.stack=[],Ar=Wr(),t?$r.replaceState(void 0,e):$r.pushState(e),Lr.run(e)||Lr.run("/")}(e,t)),0)}function Wr(){const e=window.location.search||"?=/";return decodeURIComponent(e.substring(2))}function Gr(){window.history.go(-1)}var Vr={get:Wr,set:Hr,reload(){Hr(Wr(),!0)},setQueryParams:Ur,getQueryParams:qr,deleteQueryParam:function(e,t=!1){const n=qr();n&&(delete n[e],Ur(n,t))},History:$r,backHistory:Gr,getViewSlideDirection:()=>Ir,backbutton:Fr,getPreviousPath:()=>Ar};let Yr=!0;function Kr(){return Yr}var Xr={init(){Zn.addListener("registration",(({value:e})=>{Jn(`/mobile/register/firebase/${e}`,{method:"POST"}).catch(sn)})),Zn.addListener("registrationError",(e=>{})),Zn.addListener("pushNotificationReceived",(e=>{if(Kr())switch(e.data["lichess.type"]){case"corresAlarm":case"gameTakebackOffer":case"gameDrawOffer":case"challengeAccept":case"gameMove":case"gameFinish":gi.refresh()}})),Zn.addListener("pushNotificationActionPerformed",(e=>{if("tap"===e.actionId)switch(e.notification.data["lichess.type"]){case"challengeAccept":Or.refresh(),Vr.set(`/game/${e.notification.data["lichess.challengeId"]}`);break;case"challengeCreate":Vr.set(`/game/${e.notification.data["lichess.challengeId"]}`);break;case"corresAlarm":case"gameMove":case"gameFinish":case"gameTakebackOffer":case"gameDrawOffer":Vr.set(`/game/${e.notification.data["lichess.fullId"]}`);break;case"newMessage":Vr.set(`/inbox/${e.notification.data["lichess.threadId"]}`)}}))},register:async()=>(ut.general.notifications.enable()&&Zn.requestPermissions().then((e=>"granted"===e.receive?Zn.register():Promise.reject("Permission to use push denied"))),Promise.resolve()),unregister:()=>Jn("/mobile/unregister",{method:"POST"})};const Qr=new Map;var Jr={list:()=>[...Qr.values()].sort(((e,t)=>{return r=t,(n=e).name.toLowerCase()<r.name.toLowerCase()?-1:n.name.toLowerCase()>r.name.toLowerCase()?1:0;var n,r})),count:()=>Qr.size,reset(e,t,n){Qr.clear(),e.forEach((e=>{const[r,i]=Zr(e),o=r.toLowerCase(),a=t.includes(o),s=n.includes(o);Qr.set(e,{name:r,title:i,playing:a,patron:s})}))},set(e,t,n){const[r,i]=Zr(e);Qr.set(e,{name:r,title:i,playing:t,patron:n})},playing(e){const t=Qr.get(e);t&&Qr.set(e,Object.assign(Object.assign({},t),{playing:!0}))},stoppedPlaying(e){const t=Qr.get(e);t&&Qr.set(e,Object.assign(Object.assign({},t),{playing:!1}))},remove(e){Qr.delete(e)},clear(){Qr.clear()}};function Zr(e){const t=e.split(" ");return[t.length>1?t[1]:t[0],t.length>1?t[0]:void 0]}let ei;function ti(e){return e.date}function ni(e){return new Date(e)<new Date}var ri={get:function(){return ei&&ni(ei.date)&&(ei=void 0),ei},set:async function(e){if(e){const t=ti(e),n=await Qe.get("announce");if(null==n?void 0:n.includes(t))return}ei=e,Xt()},dismiss:async function(){if(void 0===ei)return;const e=ti(ei);ei=void 0,Xt();const t=(await Qe.get("announce")||[]).filter((e=>!ni(e)));t.push(e),await Qe.set("announce",t)}};let ii;function oi(){return void 0!==ii}function ai(e){Qe.set("session",e)}function si(){Qe.remove("session"),jn.remove("sessionId"),Ht.afterLogout.dispatch()}function ci(){return(ii&&ii.nowPlaying||[]).filter((e=>-1!==ut.game.supportedVariants.indexOf(e.variant.key)))}function li(e){return B.show({text:"✓ lichess.org: "+kt("yourPreferencesHaveBeenSaved"),position:"center",duration:"short"}),e}function ui(e){return!0===e?"1":!1===e?"0":String(e)}function di(e){return function(t,[n,r]){return Object.assign(Object.assign({},t),{[e+n]:ui(r)})}}const hi=Mn((()=>{const e=ii&&ii.prefs||{},t=Object.entries(nt(e,["animation","captured","highlight","destination","coords","replay","blindfold"])).reduce(di("display."),{}),n=Object.entries(nt(e,["premove","takeback","autoQueen","autoThreefold","submitMove","confirmResign","moretime"])).reduce(di("behavior."),{}),r=Object.entries(nt(e,["clockTenths","clockBar","clockSound","follow","challenge","message","insightShare"])).reduce(di(""),{});return Jn("/account/preferences",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json, text/*"},body:cn(Object.assign(Object.assign(Object.assign({},r),t),n))},!0).then(li)}),1e3);function mi(e){return void 0!==e.id}async function fi(){try{const e=await Qn("/account/info",{cache:"reload"});ii=e,ai(e),ri.set(e.announce),ii.nbChallenges!==Or.incoming().length&&Or.refresh().then(Xt),Xt()}catch(e){void 0!==ii&&401===e.status&&(ii=void 0,si(),Xt(),B.show({text:"You have been signed out",position:"center",duration:"short"}))}}function pi(){l.getId().then((({uuid:e})=>{"web"!==e&&Jn(`/auth/set-fp/${e}/0`,{method:"POST"})}))}var gi={isConnected:oi,isKidMode:function(){return!(!ii||!ii.kid)},isShadowban:function(){return!(!ii||!ii.troll)},logout:function(){return Xr.unregister().then((()=>Qn("/logout",{method:"POST"},!0).then((()=>{ii=void 0,si(),Jr.clear(),Xt()})))).catch(sn)},signup:function(e,t,n){return Qn("/signup",{method:"POST",body:JSON.stringify({username:e,email:t,password:n,"can-confirm":!0})},!0).then((e=>(mi(e)&&(ii=e,ii.sessionId&&jn.set("sessionId",ii.sessionId),pi()),e)))},login:Mn((function(e,t,n){return Qn("/login",{method:"POST",body:JSON.stringify({username:e,password:t,token:n})},!0).then((e=>{if(mi(e))return ii=e,ii.sessionId&&jn.set("sessionId",ii.sessionId),ai(e),pi(),ii;throw{ipban:!0}}))}),1e3),rememberLogin:Mn((function(){return Qn("/account/info").then((e=>(ii=e,ai(e),e)))}),1e3),restoreStoredSession:function(){Qe.get("session").then((e=>{ii=e||void 0,null!==e&&(Ht.sessionRestored.dispatch(),Xt())}))},refresh:Mn(fi,1e3),backgroundRefresh:Mn((async function(){if(an()&&oi()){const e=await Qn("/account/info");ii=e,ai(e),ri.set(e.announce),ii.nbChallenges!==Or.incoming().length&&Or.refresh().then(Xt)}}),1e3),get:function(){return ii},getUserId:function(){return ii&&ii.id},appUser:e=>ii?ii&&ii.username:e,nowPlaying:ci,myTurnGames:function(){return ci().filter((e=>e.isMyTurn))},lichessBackedProp:function(e,t){return function(...n){if(n.length){let t;ii&&(t=et(ii,e),tt(ii,e,n[0])),hi().catch((n=>{ii&&tt(ii,e,t),an()&&sn(n)}))}return ii?et(ii,e):t}},setKidMode:function(e,t){return Jn(`/account/kid?v=${e}`,{method:"POST",body:new URLSearchParams(t),headers:{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json, text/*"}},!0).then(fi)},confirmEmail:function(e){return Qn(`/signup/confirm/${e}`,void 0,!0).then((e=>(ii=e,ai(e),ii)))},hasCurrentBan:()=>void 0!==(null==ii?void 0:ii.playban)};function vi(e,t,n,r,i){var o=arguments,a=arguments.length;return 0===a||2===a||a>5?Promise.reject(new Error("Zanimo invalid arguments")):e instanceof Promise?e.then((function(e){return vi.apply(this,[e].concat(Array.prototype.slice.call(o,1)))})):wi(e)?1===a?Promise(e):3===a?yi(e,t,n):window.isNaN(parseInt(r,10))?Promise.reject(new Error("Zanimo transition: duration must be an integer!")):ki(e,t,n,r,i):Promise.reject(new Error("Zanimo require an HTMLElement, or a promise of an HTMLElement"))}function bi(e,t,n){return e+" "+t+"ms "+(n||"linear")}function wi(e){try{return e&&e.nodeType}catch(e){return!1}}function yi(e,t,n){return e._zanimo&&Object.prototype.hasOwnProperty.call(e._zanimo,t),function(e,t,n){return requestAnimationFrame((function(){e.style[t]=n})),Promise(e)}(e,t,n)}function ki(e,t,n,r,i){var o,a=t;return new Promise((function(s,c){function l(t){t.propertyName===a&&(u(!0),s(e))}function u(n){o&&(clearTimeout(o),o=null),function(e,t){e.style.transition=e.style.transition.split(",").filter((function(e){return!e.match(t)})).join(",")}(e,t),e.removeEventListener("transitionend",l),n&&delete e._zanimo[t]}e.addEventListener("transitionend",l),requestAnimationFrame((function(){!function(e,t,n,r,i){var o=e.style.transition;e.style.transition=o?o+", "+bi(t,r,i):bi(t,r,i),e.style[t]=n}(e,t,n,r,i),o=setTimeout((function(){u(!0),s(e)}),r+20),e._zanimo=e._zanimo||{},e._zanimo[t],e._zanimo[t]={value:n}}))}))}function Pi(e,t,n,r,i,o,a,s=!0){let c,l,u,d,h,m,f,p=e;if("function"!=typeof t)throw new Error("ButtonHandler 2nd argument must be a function!");if(n&&"function"!=typeof n)throw new Error("ButtonHandler 3rd argument must be a function!");if(r&&"function"!=typeof r)throw new Error("ButtonHandler 4rd argument must be a function!");function g(){r()&&Vt(g),Kt()}const v={passive:!0};e.addEventListener("touchstart",(function(t){const i=t.changedTouches[0];if(p=a?a(t):e,!p)return;if(!0===p.disabled)return;const o=p.getBoundingClientRect();c=i.clientX,l=i.clientY,u={minX:o.left,maxX:o.right,minY:o.top,maxY:o.bottom},d=!0,clearTimeout(f),p.classList.add("active"),h=setTimeout((()=>function(e){n&&(n(e),d=!1,p&&p.classList.remove("active"))}(t)),600),r&&(m=setTimeout((()=>{Vt(g)}),500))}),v),e.addEventListener("touchmove",(function(e){if(d&&p){const t=e.changedTouches[0];d=function(e){const t=e.clientX,n=e.clientY,r=u;let a=0,s=0;i&&(a=Math.abs(t-c));o&&(s=Math.abs(n-l));return t<r.maxX&&t>r.minX&&n<r.maxY&&n>r.minY&&a<4&&s<4}(t),d||(clearTimeout(h),clearTimeout(m),Yt(g),p.classList.remove("active"))}}),v),e.addEventListener("touchend",(function(e){e.cancelable&&s&&e.preventDefault(),clearTimeout(m),Yt(g),d&&p&&(clearTimeout(h),f=setTimeout((()=>p&&p.classList.remove("active")),80),t(e),d=!1)}),!1),e.addEventListener("touchcancel",(function(){clearTimeout(h),clearTimeout(m),Yt(g),d=!1,p&&p.classList.remove("active")}),!1),e.addEventListener("contextmenu",(function(e){e.preventDefault(),e.stopPropagation()}),!1)}let Ti,Ci=null;function Si(e){return({dom:t})=>e(t)}function Ei(e,t=250,n="0.5",r="1"){let i;function o(){clearTimeout(i),e&&(e.removeAttribute("style"),e.removeEventListener("transitionend",o,!1))}e.style.opacity=n,e.style.transition=`opacity ${t}ms ease-out`,setTimeout((()=>{e.style.opacity=r})),e.addEventListener("transitionend",o,!1),i=setTimeout(o,t+10)}function xi(e){let t;function n(){clearTimeout(t),e&&(e.removeAttribute("style"),e.removeEventListener("transitionend",n,!1))}const r="fwd"===Vr.getViewSlideDirection()?"100%":"-100%";e.style.transform=`translate3d(${r},0,0)`,setTimeout((()=>{e.style.transition="transform 250ms ease-out",e.style.transform="translate3d(0%,0,0)"}),10),e.addEventListener("transitionend",n,!1),t=setTimeout(n,270)}function Oi(e,t){let n;function r(){clearTimeout(n),e&&(e.removeAttribute("style"),e.removeEventListener("transitionend",r,!1))}const i="left"===t?"100%":"-100%";e.style.transform=`translate3d(${i},0,0)`,setTimeout((()=>{e.style.transition="transform 250ms ease-out",e.style.transform="translate3d(0%,0,0)"}),10),e.addEventListener("transitionend",r,!1),n=setTimeout(r,270)}function Mi(e,t){return e.closest(t)||e}function Ni(){if(Ci)return Ci;const e=document.documentElement;return Ci={vw:e.clientWidth,vh:e.clientHeight}}const ji=Si(xi),_i=Si(Ei);function Li(e){const t=e.dom;return t.style.transform="translateY(100%)",e.state.lol=t.offsetHeight,vi(t,"transform","translateY(0)",250,"ease-out").catch(console.log.bind(console))}function Di(e,t){return function(n){const r=document.getElementById(t);r&&vi(r,"transform","translateY(100%)",250,"ease-out").then((()=>on((()=>e(n))))).catch(console.log.bind(console))}}function Ii(e,t){return function(n){const r=document.getElementById(t);r&&vi(r,"transform","translateX(100%)",250,"ease-out").then((()=>on((()=>e(n))))).catch(console.log.bind(console))}}function Ai(e){const t=e.dom;return t.style.transform="translateX(100%)",e.state.lol=t.offsetHeight,vi(t,"transform","translateX(0)",250,"ease-out").catch(console.log.bind(console))}function Ri(e,t,n,r=150){e.stopPropagation();const i=n?Mi(e.target,n):e.target;i?vi(i,"opacity",0,r).then((()=>on(t))).catch(console.log.bind(console)):(t(),Xt())}function zi(e,t,n,r,i,o,a){return function(s){Pi(s.dom,(t=>{e(t),Xt()}),t?e=>on((()=>t(e))):void 0,n,r,i,o,a)}}function Bi(e){return t=>{t.dom.addEventListener("touchstart",e)}}function $i(e,t,n,r){return zi(e,t,n,!1,!1,r)}function Ui(e,t,n){return zi(e,t,void 0,!0,!1,n)}function qi(e,t,n,r=!0){return zi(e,t,void 0,!1,!0,n,r)}function Fi(e,t,n,r=!0){return zi(e,t,void 0,!0,!0,n,r)}function Hi(e){return 0===e?null:qn("span",{className:"progress "+(e>0?"positive":"negative"),"data-icon":e>0?"N":"M"},String(Math.abs(e)))}function Wi(e){const t=[];for(const n in e)e[n]&&t.push(n);return t.join(" ")}function Gi(){const{vw:e,vh:t}=Ni();return e>=768&&t>=768}function Vi(){return void 0!==Ti||(Ti=window.matchMedia("(orientation: portrait)").matches),Ti}let Yi=null;function Ki(e){const t=e.match(/\d{1,3}/),n=t&&t[0],r=Number(n);return isNaN(r)?0:r}function Xi(e,t){const{vh:n,vw:r}=e,i=function(){if(!Yi){const e=getComputedStyle(document.documentElement);return Yi={top:Ki(e.getPropertyValue("--sat")),right:Ki(e.getPropertyValue("--sar")),bottom:Ki(e.getPropertyValue("--sab")),left:Ki(e.getPropertyValue("--sal"))},Yi}return Yi}(),o=Gi();if(t){if(o){const e=.94*r;return{width:e,height:e}}return{width:r,height:r}}if(o){const e=n-56-.06*n-i.top;return{width:e,height:e}}{const e=n-56-i.top;return{width:e,height:e}}}function Qi(e,t){const n=Xi(e,t);return e.vh-n.height-56-45-110>=25}function Ji(e){e.dom.focus()}function Zi(e){return void 0===e.ratingDiff?null:0===e.ratingDiff?qn("span.rp.null"," +0"):e.ratingDiff>0?qn("span.rp.up"," +"+e.ratingDiff):e.ratingDiff<0?qn("span.rp.down"," "+e.ratingDiff):null}function eo(e){const t=e.target;return"BUTTON"===t.tagName?t:t.closest("button")}function to(e){const t=e.target;return"LI"===t.tagName?t:t.closest("li")}function no(e){const t=e.target;return"TR"===t.tagName?t:t.closest("tr")}function ro(e,t){var n;return null===(n=e.target)||void 0===n?void 0:n.closest(t)}function io(e){return t=>{var n;return null===(n=t.target)||void 0===n?void 0:n.closest(e)}}const oo=o("KeepAwake",{web:()=>import("./web-a8b96910.js").then((e=>new e.KeepAwakeWeb))});let ao,so;function co(){oo.keepAwake(),void 0!==so&&so(),so=function(e,t,n){const r=["touchstart"];let i,o=!1,a=!0,s=performance.now();const c=()=>{a||n(),a=!0,s=performance.now(),u()},l=()=>{o||(r.forEach((e=>{document.addEventListener(e,c)})),o=!0)},u=()=>{o&&(r.forEach((e=>{document.removeEventListener(e,c)})),o=!1)},d=()=>{clearInterval(i),u()};return i=setInterval((()=>{a&&performance.now()-s>e&&(t(),a=!1),l()}),3e4),d}(9e5,(()=>{ao=setTimeout((()=>{oo.allowSleep()}),27e5)}),(()=>{clearTimeout(ao)}))}function lo(){void 0!==so&&(so(),so=void 0),oo.allowSleep()}function uo(e,t,n){void 0!==n?e.postMessage({topic:t,payload:n}):e.postMessage({topic:t})}function ho(e,t){return new Promise(((n,r)=>{e.addEventListener("message",(function i(o){o.data.topic!==t.topic||void 0!==t.reqid&&o.data.reqid!==t.reqid?"error"!==o.data.topic||o.data.payload.callerTopic!==t.topic||void 0!==t.reqid&&o.data.reqid!==t.reqid||(e.removeEventListener("message",i),r(o.data.payload.error)):(e.removeEventListener("message",i),n(o.data.payload))})),e.postMessage(t)}))}const mo=new Worker("socketWorker.js");let fo,po=!1,go=0,vo=2e3;const bo={following_onlines:function(e,t){const n=t.playing,r=t.patrons;Jr.reset(e,n,r),Xt()},following_enters:(e,t)=>on((()=>Jr.set(e,t.playing||!1,t.patron||!1))),following_leaves:e=>on((()=>Jr.remove(e))),following_playing:e=>on((()=>Jr.playing(e))),following_stopped_playing:e=>on((()=>Jr.stoppedPlaying(e))),challenges:e=>{Or.set(e),Xt()},mlat:e=>{go=e},deployPost(){uo(mo,"deploy")},resync(){Vr.reload()},announce:e=>{const t=e;t.date?ri.set(t):ri.set(void 0)}};function wo(e,t){const n=jn.get("sessionId");null!==n?e.opts.params?e.opts.params.sessionId=n:e.opts.params={sessionId:n}:e.opts.params&&delete e.opts.params.sessionId,e.opts.options.isAuth=!!n,mo.onmessage=e=>{switch(e.data.topic){case"onOpen":t.onOpen&&t.onOpen();break;case"disconnected":po&&(po=!1,Xt());break;case"connected":po||(po=!0,Xt());break;case"onError":t.onError&&t.onError();break;case"resync":Vr.reload();break;case"handle":{const n=t.events[e.data.payload.t];n&&n(e.data.payload.d,e.data.payload);break}case"pingInterval":vo=e.data.payload}},fo={setup:e,handlers:t},uo(mo,"create",e)}function yo(e){return{send:(t,n,r)=>function(e,t,n,r){uo(mo,"send",[e,t,n,r])}(e,t,n,r),ask:(t,n,r,i)=>function(e,t,n,r,i){return new Promise(((o,a)=>{let s;function c(e){"handle"===e.data.topic&&e.data.payload.t===n&&(clearTimeout(s),mo.removeEventListener("message",c),o(e.data.payload.d))}mo.addEventListener("message",c),uo(mo,"ask",{msg:[e,t,r,i],listenTo:n}),s=setTimeout((()=>{mo.removeEventListener("message",c),a()}),3e3)}))}(e,t,n,r,i)}}function ko(){fo?wo(fo.setup,fo.handlers):uo(mo,"connect")}Ht.afterLogout.add(ko);var Po={createGame:function(e,t,n,r,i){let o=!1;const a={onError:function(){o||(o=!0,vr(r.substring(1)).catch((e=>{401===e.status&&(B.show({text:"Access is unauthorised.",position:"center",duration:"short"}),Vr.set("/"))})))},onOpen:gi.backgroundRefresh,events:Object.assign({},bo,n)},s={options:{name:"game",debug:"dev"===$t.mode,sendOnOpen:[{t:"following_onlines"}],registeredEvents:Object.keys(a.events)}};return i&&(s.params={userTv:i}),wo({clientId:en(),socketEndPoint:$t.socketEndPoint,url:e,version:t,opts:s},a),yo(e)},createChallenge:function(e,t,n,r){const i={onOpen:()=>{gi.backgroundRefresh(),n()},events:Object.assign({},bo,r)},o=`/challenge/${e}/socket/v${$t.apiVersion}`,a={options:{name:"challenge",debug:"dev"===$t.mode,ignoreUnknownMessages:!0,pingDelay:2e3,sendOnOpen:[{t:"following_onlines"}],registeredEvents:Object.keys(i.events)}};return wo({clientId:en(),socketEndPoint:$t.socketEndPoint,url:o,version:t,opts:a},i),yo(o)},createLobby:function(e,t,n){const r={onOpen:()=>{gi.refresh(),t()},events:Object.assign({},bo,n)},i={options:{name:e,debug:"dev"===$t.mode,pingDelay:2e3,sendOnOpen:[{t:"following_onlines"}],registeredEvents:Object.keys(r.events)}},o=`/lobby/socket/v${$t.apiVersion}`;return wo({clientId:en(),socketEndPoint:$t.socketEndPoint,url:o,opts:i},r),yo(o)},createTournament:function(e,t,n,r){const i="/tournament/"+e+`/socket/v${$t.apiVersion}`,o={events:Object.assign({},bo,n),onOpen:gi.backgroundRefresh},a={options:{name:"tournament",debug:"dev"===$t.mode,pingDelay:2e3,sendOnOpen:[{t:"following_onlines"},{t:"startWatching",d:r}],registeredEvents:Object.keys(o.events)}};return wo({clientId:en(),socketEndPoint:$t.socketEndPoint,url:i,version:t,opts:a},o),yo(i)},createDefault:function(){if(an()){const e={events:bo,onOpen:gi.backgroundRefresh},t={options:{name:"default",debug:"dev"===$t.mode,pingDelay:3e3,sendOnOpen:[{t:"following_onlines"}],registeredEvents:Object.keys(e.events)}};wo({clientId:en(),socketEndPoint:$t.socketEndPoint,url:`/socket/v${$t.apiVersion}`,opts:t},e)}},createAnalysis:function(e){const t={events:Object.assign(Object.assign({},bo),e),onOpen:gi.backgroundRefresh},n={options:{name:"analysis",debug:"dev"===$t.mode,pingDelay:3e3,sendOnOpen:[{t:"following_onlines"}],registeredEvents:Object.keys(t.events)}},r=`/analysis/socket/v${$t.apiVersion}`;return wo({clientId:en(),socketEndPoint:$t.socketEndPoint,url:r,opts:n},t),yo(r)},createStudy:function(e,t){const n={events:Object.assign(Object.assign({},bo),t),onOpen:gi.backgroundRefresh},r={options:{name:"study",debug:"dev"===$t.mode,pingDelay:3e3,sendOnOpen:[{t:"following_onlines"}],registeredEvents:Object.keys(n.events)}},i=`/study/${e}/socket/v${$t.apiVersion}`;return wo({clientId:en(),socketEndPoint:$t.socketEndPoint,url:i,opts:r},n),yo(i)},createChat:function(e,t){const n={events:Object.assign(Object.assign({},bo),e),onOpen:()=>{gi.backgroundRefresh(),t&&t()}},r={options:{name:"chat",debug:"dev"===$t.mode,pingDelay:2500,registeredEvents:Object.keys(n.events)}},i=`/socket/v${$t.apiVersion}`;return wo({clientId:en(),socketEndPoint:$t.socketEndPoint,url:i,opts:r},n),yo(i)},redirectToGame:function(e){let t;if("string"==typeof e)t=e;else if(t=e.url,e.cookie){const t=document.domain.replace(/^.+(\.[^.]+\.[^.]+)$/,"$1"),n=[encodeURIComponent(e.cookie.name)+"="+e.cookie.value,"; max-age="+e.cookie.maxAge,"; path=/","; domain="+t].join("");document.cookie=n}Vr.set("/game"+t)},sendWithNoCheck(e,t,n){["moveLat"].includes(e)&&uo(mo,"send",["noCheck",e,t,n])},setVersion(e){uo(mo,"setVersion",e)},connect(){uo(mo,"connect")},reconnectCurrent:ko,disconnect(){uo(mo,"disconnect")},delayedDisconnect(e){uo(mo,"delayedDisconnect",e)},cancelDelayedDisconnect(){uo(mo,"cancelDelayedDisconnect")},isConnected:()=>po,destroy(){uo(mo,"destroy")},getVersion:()=>ho(mo,{topic:"getVersion"}),getCurrentPing:()=>ho(mo,{topic:"averageLag"}),getCurrentMoveLatency:()=>go,getCurrentPingInterval:()=>vo,terminate(){mo&&mo.terminate()}};function To(e){return void 0!==e.id}function Co(e){return void 0!==e.timeMode}function So(e){return void 0!==e.steps}async function Eo(e){return Do(await Qn(`/inbox/${e}`))}async function xo(e,t){return Do(await Qn(`/inbox/${e}?before=${t.getTime()}`))}async function Oo(){return Do(await Qn("/inbox"))}async function Mo(e){const t=await Qn(`/inbox/search?q=${e}`);return Object.assign(Object.assign({},t),{contacts:t.contacts.map(Ro)})}function No(e){return Qn(`/rel/block/${e}`,{method:"POST"})}function jo(e){return Qn(`/rel/unblock/${e}`,{method:"POST"})}async function _o(e){return Qn(`/inbox/${e}/delete`,{method:"POST"}).then(Do)}class Lo{constructor(e){const t=function(e){return{msgNew:t=>{e.receive(Object.assign(Object.assign({},Io(t)),{read:!1}))},msgType:e.receiveTyping,blockedBy:e.changeBlockBy,unblockedBy:e.changeBlockBy}}(e);this.socket=Po.createChat(t)}post(e,t){this.socket.send("msgSend",{dest:e,text:t})}setRead(e){this.socket.send("msgRead",e)}typing(e){this.socket.send("msgType",e)}}function Do(e){return Object.assign(Object.assign({},e),{convo:e.convo&&(t=e.convo,Object.assign(Object.assign({},t),{user:Ao(t.user),msgs:t.msgs.map(Io)})),contacts:e.contacts.map(Ro)});var t}function Io(e){return Object.assign(Object.assign({},e),{date:new Date(e.date)})}function Ao(e){return Object.assign(Object.assign({},e),{id:e.name.toLowerCase()})}function Ro(e){return Object.assign(Object.assign({},e),{user:Ao(e.user),lastMsg:Io(e.lastMsg)})}const zo=.6,Bo=25,$o=.7;function Uo(){const e=Ni().vw;return e*(e>=960?.35:e>=500?.5:.85)}function qo(e,t){e.style.transform=`translate3d(${t}px, 0, 0)`}function Fo(e,t){e.style.opacity=`${t}`}class Ho{constructor(e,t,n,r,i){this.isOpen=!1,this.open=()=>{this.isOpen=!0,Vr.backbutton.stack.push(this.close);const e=document.getElementById(this.menuID),t=document.getElementById(this.backdropID);return this.onOpen&&this.onOpen(),Promise.all([vi(t,"visibility","visible",0),vi(t,"opacity",.7,250,"linear"),vi(e,"visibility","visible",0),vi(e,"transform","translate3d(0,0,0)",250,"ease-out")]).then(Xt).catch(console.error.bind(console))},this.close=e=>{"backbutton"!==e&&this.isOpen&&Vr.backbutton.stack.pop(),this.isOpen=!1;const t=document.getElementById(this.menuID),n=document.getElementById(this.backdropID);return this.onClose&&this.onClose(),Promise.all([vi(n,"opacity",0,250,"linear"),vi(t,"transform",this.closeTranslate(),250,"ease-out")]).then((()=>Promise.all([vi(t,"visibility","hidden",0),vi(n,"visibility","hidden",0)]))).catch(console.error.bind(console))},this.toggle=e=>{e.stopPropagation(),this.isOpen?this.close():this.open()},this.closeTranslate=()=>"left"===this.side?"translate3d(-100%,0,0)":"translate3d(100%,0,0)",this.side=e,this.menuID=t,this.backdropID=n,this.onOpen=r,this.onClose=i}getMenuEl(){return document.getElementById(this.menuID)}getBackdropEl(){return document.getElementById(this.backdropID)}}let Wo;const Go=En(0),Vo=En(!1),Yo=En(0),Ko=En(0);const Xo=new Ho("left","side_menu","menu-close-overlay",(function(){an()&&Po.sendWithNoCheck("moveLat",!0),Wo=setTimeout(ea,2e3)}),(function(){Vo(!1),clearTimeout(Wo),an()&&Po.sendWithNoCheck("moveLat",!1)}));function Qo(e){return function(){return Xo.close().then((()=>Vr.set(e)))}}function Jo(e){return function(){return Xo.close().then((()=>{e(),Xt()}))}}function Zo(){const e=!Vo();e&&Qn("/inbox/unread-count",{},!1).then((e=>{Go(e),Xt()})),Vo(e)}function ea(){an()&&Po.getCurrentPing().then((e=>{Ko(e),Yo(Po.getCurrentMoveLatency()),Xo.isOpen&&(Xt(),setTimeout(ea,2e3))}))}const ta=$i((e=>{e.stopPropagation(),Xo.close()})),na=Symbol("newer"),ra=Symbol("older");class ia{constructor(e,t){"number"!=typeof e&&(t=e,e=0),this.size=0,this.limit=e,this.oldest=this.newest=void 0,this._keymap=new Map,t&&(this.assign(t),e<1&&(this.limit=this.size))}_markEntryAsUsed(e){e!==this.newest&&(e[na]&&(e===this.oldest&&(this.oldest=e[na]),e[na][ra]=e[ra]),e[ra]&&(e[ra][na]=e[na]),e[na]=void 0,e[ra]=this.newest,this.newest&&(this.newest[na]=e),this.newest=e)}assign(e){let t,n=this.limit||Number.MAX_VALUE;this._keymap.clear();let r=e[Symbol.iterator]();for(let e=r.next();!e.done;e=r.next()){let r=new oa(e.value[0],e.value[1]);if(this._keymap.set(r.key,r),t?(t[na]=r,r[ra]=t):this.oldest=r,t=r,0==n--)throw new Error("overflow")}this.newest=t,this.size=this._keymap.size}get(e){var t=this._keymap.get(e);if(t)return this._markEntryAsUsed(t),t.value}set(e,t){var n=this._keymap.get(e);return n?(n.value=t,this._markEntryAsUsed(n),this):(this._keymap.set(e,n=new oa(e,t)),this.newest?(this.newest[na]=n,n[ra]=this.newest):this.oldest=n,this.newest=n,++this.size,this.size>this.limit&&this.shift(),this)}shift(){var e=this.oldest;if(e)return this.oldest[na]?(this.oldest=this.oldest[na],this.oldest[ra]=void 0):(this.oldest=void 0,this.newest=void 0),e[na]=e[ra]=void 0,this._keymap.delete(e.key),--this.size,[e.key,e.value]}toJSON(){for(var e=new Array(this.size),t=0,n=this.oldest;n;)e[t++]=[n.key,n.value],n=n[na];return e}}function oa(e,t){this.key=e,this.value=t,this[na]=void 0,this[ra]=void 0}const aa=new ia(100);function sa(e,t){return e?(e.title?e.title+" "+e.name:e.name)+(t?" ("+e.rating+")":""):"Anonymous"}function ca(e,t=!1,n=!1,r){if(e.name||e.username||e.user){let a=e.name||e.username||e.user.username;return e.user&&e.user.title&&(a=e.user.title+" "+a),n&&(o=r||100,a=(i=a).length>o?i.slice(0,o)+"…":i),t&&(e.user||e.rating)&&(a+=" ("+(e.rating||e.user.rating),e.provisional&&(a+="?"),a+=")"),a}var i,o;return e.ai?la(e):"Anonymous"}function la(e){return kt("aiNameLevelAiLevel","Stockfish",e.ai)}const ua="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",da={standard:{name:"Standard",tinyName:"Std",id:1,link:"https://en.wikipedia.org/wiki/Rules_of_chess",title:"Standard rules of chess (FIDE)"},chess960:{name:"Chess960",tinyName:"960",id:2,link:"https://lichess.org/variant/chess960",alert:"This is a Chess960 game!\n\nThe starting position of the pieces on the players' home ranks is randomized.",title:"Starting position of the home rank pieces is randomized."},fromPosition:{name:"From position",shortName:"Fen",tinyName:"Fen",id:3,title:"Custom starting position"},kingOfTheHill:{name:"King of the Hill",shortName:"KotH",tinyName:"KotH",id:4,link:"https://lichess.org/variant/kingOfTheHill",alert:"This is a King of the Hill game!\n\nThe game can be won by bringing the king to the center.",title:"Bring your King to the center to win the game."},threeCheck:{name:"Three-check",shortName:"3-check",tinyName:"3+",id:5,link:"https://lichess.org/variant/threeCheck",alert:"This is a Three-check game!\n\nThe game can be won by checking the opponent 3 times.",title:"Check your opponent 3 times to win the game.",initialFen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1 +0+0"},antichess:{name:"Antichess",tinyName:"Anti",id:6,link:"https://lichess.org/variant/antichess",alert:"This is an antichess chess game!\n\n If you can take a piece, you must. The game can be won by losing all your pieces.",title:"Lose all your pieces (or reach a stalemate) to win the game."},atomic:{name:"Atomic",tinyName:"Atom",id:7,link:"https://lichess.org/variant/atomic",alert:"This is an atomic chess game!\n\nCapturing a piece causes an explosion, taking out your piece and surrounding non-pawns. Win by mating or exploding your opponent's king.",title:"Nuke your opponent's king to win."},horde:{name:"Horde",tinyName:"Horde",id:8,link:"https://lichess.org/variant/horde",alert:"This is a horde chess game!\n\nBlack must take all white pawns to win. White must checkmate black king.",title:"Destroy the horde to win!",initialFen:"rnbqkbnr/pppppppp/8/1PP2PP1/PPPPPPPP/PPPPPPPP/PPPPPPPP/PPPPPPPP w kq - 0 1"},racingKings:{name:"Racing Kings",shortName:"Racing",tinyName:"Racing",id:9,link:"https://lichess.org/variant/racingKings",alert:"Race to the eighth rank to win.",title:"Race your King to the eighth rank to win.",initialFen:"8/8/8/8/8/8/krbnNBRK/qrbnNBRQ w - - 0 1"},crazyhouse:{name:"Crazyhouse",tinyName:"Crazy",id:10,link:"https://lichess.org/variant/crazyhouse",alert:"This is a crazyhouse game!\n\nEvery time a piece is captured the capturing player gets a piece of the same type and of their color in their pocket.",title:"Captured pieces can be dropped back on the board instead of moving a piece.",initialFen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR/ w KQkq - 0 1"}};function ha(e){return da[e]}function ma(e){const t=da[e];return{key:e,name:t.name,short:t.shortName||t.tinyName||t.name,title:t.title}}function fa(e){return da[e].initialFen||ua}function pa(e){switch(e){case"fromPosition":case"standard":case"chess960":return"chess";case"threeCheck":return"3check";default:return e.toLowerCase()}}const ga=new Set(["crazyhouse","threeCheck"]),va=new Set(["standard","crazyhouse","threeCheck","kingOfTheHill"]);class ba{constructor(e){if(this.config=ba.mergeSettings(e),this.selector="string"==typeof this.config.selector?document.querySelector(this.config.selector):this.config.selector,null===this.selector)throw new Error("Something wrong with your selector ??");this.resolveSlidesNumber(),this.selectorWidth=this.selector.offsetWidth,this.innerElements=[].slice.call(this.selector.children),this.currentSlide=Math.max(0,Math.min(this.config.startIndex,this.innerElements.length-this.perPage)),this.transformProperty="transform",["resizeHandler","touchstartHandler","touchendHandler","touchmoveHandler"].forEach((e=>{this[e]=this[e].bind(this)})),this.init()}static mergeSettings(e){const t={selector:".siema",duration:200,easing:"ease-out",perPage:1,startIndex:0,draggable:!0,threshold:20,rtl:!1,onInit:()=>{},onChange:()=>{}},n=e;for(const e in n)t[e]=n[e];return t}attachEvents(){if(window.addEventListener("resize",this.resizeHandler),this.config.draggable){this.pointerDown=!1,this.drag={startX:0,endX:0,startY:0,letItGo:null,preventClick:!1};const e={passive:!0};this.selector.addEventListener("touchstart",this.touchstartHandler,e),this.selector.addEventListener("touchend",this.touchendHandler,e),this.selector.addEventListener("touchmove",this.touchmoveHandler,e)}}detachEvents(){window.removeEventListener("resize",this.resizeHandler),this.selector.removeEventListener("touchstart",this.touchstartHandler),this.selector.removeEventListener("touchend",this.touchendHandler),this.selector.removeEventListener("touchmove",this.touchmoveHandler)}init(){this.attachEvents(),this.selector.style.overflow="hidden",this.selector.style.direction=this.config.rtl?"rtl":"ltr",this.buildSliderFrame(),this.config.onInit.call(this)}buildSliderFrame(){const e=this.selectorWidth/this.perPage,t=this.innerElements.length;this.sliderFrame=document.createElement("div"),this.sliderFrame.style.width=e*t+"px";const n=document.createDocumentFragment();for(let e=0;e<this.innerElements.length;e++){const t=this.buildSliderFrameItem(this.innerElements[e]);n.appendChild(t)}this.sliderFrame.appendChild(n),this.selector.innerHTML="",this.selector.appendChild(this.sliderFrame),this.slideToCurrent()}buildSliderFrameItem(e){const t=document.createElement("div");return t.style.cssFloat=this.config.rtl?"right":"left",t.style.float=this.config.rtl?"right":"left",t.style.width=100/this.innerElements.length+"%",t.appendChild(e),t}resolveSlidesNumber(){if("number"==typeof this.config.perPage)this.perPage=this.config.perPage;else if("object"==typeof this.config.perPage){this.perPage=1;for(const e in this.config.perPage)window.innerWidth>=e&&(this.perPage=this.config.perPage[e])}}prev(e=1){if(this.innerElements.length<=this.perPage)return;const t=this.currentSlide;this.currentSlide=Math.max(this.currentSlide-e,0),t!==this.currentSlide&&(this.slideToCurrent(),setTimeout((()=>this.config.onChange()),0))}next(e=1){if(this.innerElements.length<=this.perPage)return;const t=this.currentSlide;this.currentSlide=Math.min(this.currentSlide+e,this.innerElements.length-this.perPage),t!==this.currentSlide&&(this.slideToCurrent(),setTimeout((()=>this.config.onChange()),0))}goTo(e){if(this.innerElements.length<=this.perPage)return;const t=this.currentSlide;this.currentSlide=Math.min(Math.max(e,0),this.innerElements.length-this.perPage),t!==this.currentSlide&&(this.slideToCurrent(),setTimeout((()=>this.config.onChange()),0))}slideToCurrent(){const e=this.currentSlide,t=(this.config.rtl?1:-1)*e*(this.selectorWidth/this.perPage);vi(this.sliderFrame,"transform",`translate3d(${t}px, 0, 0)`,this.config.duration,this.config.easing)}updateAfterDrag(){const e=(this.config.rtl?-1:1)*(this.drag.endX-this.drag.startX),t=Math.abs(e);e>0&&t>this.config.threshold&&this.innerElements.length>this.perPage&&this.currentSlide-1>=0?this.prev(1):e<0&&t>this.config.threshold&&this.innerElements.length>this.perPage&&this.currentSlide+1<=this.innerElements.length-this.perPage?this.next(1):this.slideToCurrent()}resizeHandler(){this.resolveSlidesNumber(),this.currentSlide+this.perPage>this.innerElements.length&&(this.currentSlide=this.innerElements.length<=this.perPage?0:this.innerElements.length-this.perPage),this.selectorWidth=this.selector.offsetWidth,this.buildSliderFrame()}clearDrag(){this.drag={startX:0,endX:0,startY:0,letItGo:null,preventClick:this.drag.preventClick}}touchstartHandler(e){-1!==["TEXTAREA","OPTION","INPUT","SELECT"].indexOf(e.target.nodeName)||(e.stopPropagation(),this.pointerDown=!0,this.drag.startX=e.touches[0].pageX,this.drag.startY=e.touches[0].pageY)}touchendHandler(e){e.stopPropagation(),this.pointerDown=!1,this.drag.endX&&this.updateAfterDrag(),this.clearDrag()}touchmoveHandler(e){if(e.stopPropagation(),null===this.drag.letItGo&&(this.drag.letItGo=Math.abs(this.drag.startY-e.touches[0].pageY)<Math.abs(this.drag.startX-e.touches[0].pageX)),this.pointerDown&&this.drag.letItGo){this.drag.endX=e.touches[0].pageX;const t=this.currentSlide*(this.selectorWidth/this.perPage),n=this.drag.endX-this.drag.startX,r=this.config.rtl?t+n:t-n;this.sliderFrame.style[this.transformProperty]=`translate3d(${(this.config.rtl?1:-1)*r}px, 0, 0)`}}remove(e,t){if(e<0||e>=this.innerElements.length)throw new Error("Item to remove doesn't exist ??");const n=e<this.currentSlide,r=this.currentSlide+this.perPage-1===e;(n||r)&&this.currentSlide--,this.innerElements.splice(e,1),this.buildSliderFrame(),t&&t.call(this)}insert(e,t,n){if(t<0||t>this.innerElements.length+1)throw new Error("Unable to inset it at this index ??");if(-1!==this.innerElements.indexOf(e))throw new Error("The same item in a carousel? Really? Nope ??");const r=t<=this.currentSlide>0&&this.innerElements.length;this.currentSlide=r?this.currentSlide+1:this.currentSlide,this.innerElements.splice(t,0,e),this.buildSliderFrame(),n&&n.call(this)}prepend(e,t){this.insert(e,0),t&&t.call(this)}append(e,t){this.insert(e,this.innerElements.length+1),t&&t.call(this)}destroy(e=!1,t){if(this.detachEvents(),this.selector.style.cursor="auto",e){const e=document.createDocumentFragment();for(let t=0;t<this.innerElements.length;t++)e.appendChild(this.innerElements[t]);this.selector.innerHTML="",this.selector.appendChild(e),this.selector.removeAttribute("style")}t&&t.call(this)}}function wa(e,...t){e&&setTimeout((()=>e(...t)),1)}function ya(){}const ka=["a","b","c","d","e","f","g","h"],Pa=ka.slice().reverse(),Ta=[1,2,3,4,5,6,7,8],Ca=[8,7,6,5,4,3,2,1];function Sa(e,t){return Math.round(e*t)/t}function Ea(e){return ka[e[0]-1]+e[1]}function xa(e){return[e.charCodeAt(0)-96,e.charCodeAt(1)-48]}function Oa(e,t,n){return[(t?e[0]-1:8-e[0])*n.width/8,(t?8-e[1]:e[1]-1)*n.height/8]}const Ma=Array.prototype.concat(...ka.map((e=>Ta.map((t=>e+t)))));Ma.slice(0).reverse();function Na(e){return"white"===e?"black":"white"}function ja(e,t){return void 0!==e&&-1!==e.indexOf(t)}function _a(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function La(e,t,n){if(e.otb){const r=e.orientation,i=e.otbMode,o=e.turnColor;return"facing"===i&&"white"===r&&"black"===t||"facing"===i&&"black"===r&&"white"===t||"flip"===i&&"white"===r&&"black"===o||"flip"===i&&"black"===r&&"white"===o?n+" rotate(180deg)":n}return n}function Da(e){return"translate("+e[0]+"px,"+e[1]+"px)"}function Ia(e){return"translate3d("+e[0]+"px,"+e[1]+"px, 0)"}const Aa=Da([-99999,-99999]),Ra=Ia([-99999,-99999]);function za(e){const t=e.targetTouches[0];return[t.clientX,t.clientY]}function Ba(e,t,n){const r=xa(n);return"white"!==e&&(r[0]=9-r[0],r[1]=9-r[1]),{left:t.left+t.width*(r[0]-1)/8,top:t.top+t.height*(8-r[1])/8,width:t.width/8,height:t.height/8}}function $a(e,t){let n=e.board.firstChild;for(;n;){if("PIECE"===n.tagName&&n.cgKey===t)return n;n=n.nextSibling}return null}function Ua(e,t){return Math.abs(e-t)}const qa=(e,t,n,r)=>{const i=Ua(e,n),o=Ua(t,r);return 1===i&&2===o||2===i&&1===o},Fa=(e,t,n,r)=>Ua(e,n)===Ua(t,r),Ha=(e,t,n,r)=>e===n||t===r,Wa=(e,t,n,r)=>Fa(e,t,n,r)||Ha(e,t,n,r);function Ga(e,t,n){const r=e.get(t);if(!r)return[];const i=xa(t);let o;switch(r.role){case"pawn":a=r.color,o=(e,t,n,r)=>Ua(e,n)<2&&("white"===a?r===t+1||t<=2&&r===t+2&&e===n:r===t-1||t>=7&&r===t-2&&e===n);break;case"knight":o=qa;break;case"bishop":o=Fa;break;case"rook":o=Ha;break;case"queen":o=Wa;break;case"king":o=function(e,t,n){return(r,i,o,a)=>Ua(r,o)<2&&Ua(i,a)<2||n&&i===a&&i===("white"===e?1:8)&&(5===r&&(3===o||7===o)||ja(t,o))}(r.color,function(e,t){const n=[];for(const[r,i]of e)i&&i.color===t&&"rook"===i.role&&n.push(xa(r)[0]);return n}(e,r.color),n)}var a;return Ma.map(xa).filter((e=>(i[0]!==e[0]||i[1]!==e[1])&&o(i[0],i[1],e[0],e[1]))).map(Ea)}function Va(e){e.orientation=Na(e.orientation)}function Ya(e,t){for(const[n,r]of t)r?e.pieces.set(n,r):e.pieces.delete(n)}function Ka(e,t){if(e.check=null,!0===t&&(t=e.turnColor),t)for(const[n,r]of e.pieces)"king"===r.role&&r.color===t&&(e.check=n)}function Xa(e){e.premovable.current&&(e.premovable.current=null,wa(e.premovable.events.unset))}function Qa(e){e.predroppable.current&&(e.predroppable.current=null,wa(e.predroppable.events.unset))}function Ja(e,t,n){if(is(e,t,n)){if(us(e,t,n))return ts(e,null),wa(e.movable.events.after,t,n,{premove:!1}),!0}else!function(e,t,n){return t!==n&&os(e,t)&&ja(Ga(e.pieces,t,e.premovable.castle),n)}(e,t,n)?rs(e,n)||os(e,n)?ts(e,n):ns(e):(!function(e,t,n){Qa(e),e.premovable.current=[t,n],wa(e.premovable.events.set,t,n)}(e,t,n),ts(e,null));return!1}function Za(e,t,n,r=!1){const i=e.pieces.get(t);i&&(function(e,t,n){const r=e.pieces.get(t);return!!r&&n&&(t===n||!e.pieces.has(n))&&("both"===e.movable.color||e.movable.color===r.color&&e.turnColor===r.color)}(e,t,n)||r)?(e.pieces.delete(t),ls(e,i,n,r),wa(e.movable.events.afterNewPiece,i.role,n,{predrop:!1})):i&&function(e,t,n){const r=e.pieces.get(t),i=e.pieces.get(n);return!!r&&n&&(!i||i.color!==e.movable.color)&&e.predroppable.enabled&&("pawn"!==r.role||"1"!==n[1]&&"8"!==n[1])&&e.movable.color===r.color&&e.turnColor!==r.color}(e,t,n)?function(e,t,n){Xa(e),e.predroppable.current={role:t,key:n},wa(e.predroppable.events.set,t,n)}(e,i.role,n):(Xa(e),Qa(e)),e.pieces.delete(t),ts(e,null)}function es(e,t){e.selected?e.selected!==t||e.draggable.enabled?e.selectable.enabled&&e.selected!==t&&Ja(e,e.selected,t):ns(e):(rs(e,t)||os(e,t))&&ts(e,t),wa(e.events.select,t)}function ts(e,t){e.selected=t,t&&os(e,t)?e.premovable.dests=Ga(e.pieces,t,e.premovable.castle):e.premovable.dests=null}function ns(e){e.selected=null,e.premovable.dests=null}function rs(e,t){const n=e.pieces.get(t);return!!n&&("both"===e.movable.color||e.movable.color===n.color&&e.turnColor===n.color)}function is(e,t,n){return t!==n&&rs(e,t)&&(e.movable.free||null!==e.movable.dests&&ja(e.movable.dests[t],n))}function os(e,t){const n=e.pieces.get(t);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function as(e){const t=e.premovable.current;if(!t)return;const n=t[0],r=t[1];is(e,n,r)&&us(e,n,r)&&wa(e.movable.events.after,n,r,{premove:!0}),Xa(e)}function ss(e){Xa(e),Qa(e),ts(e,null)}function cs(e,t,n){const r=e.pieces.get(t);if(t===n||!r)return!1;const i=e.pieces.get(n),o=i&&i.color!==r.color?i:void 0;return wa(e.events.move,t,n,o),function(e,t,n){if(!e.autoCastle)return!1;const r=e.pieces.get(t);if(!r||"king"!==r.role)return!1;const i=xa(t),o=xa(n);if(1!==i[1]&&8!==i[1]||i[1]!==o[1])return!1;5!==i[0]||e.pieces.has(n)||(7===o[0]?n=Ea([8,o[1]]):3===o[0]&&(n=Ea([1,o[1]])));const a=e.pieces.get(n);if(!a||a.color!==r.color||"rook"!==a.role)return!1;e.pieces.delete(t),e.pieces.delete(n),i[0]<o[0]?(e.pieces.set(Ea([7,o[1]]),r),e.pieces.set(Ea([6,o[1]]),a)):(e.pieces.set(Ea([3,o[1]]),r),e.pieces.set(Ea([4,o[1]]),a));return!0}(e,t,n)||(e.pieces.set(n,r),e.pieces.delete(t)),e.lastMove=[t,n],e.check=null,wa(e.events.change),!0}function ls(e,t,n,r=!1){if(e.pieces.has(n)){if(!r)return!1;e.pieces.delete(n)}return wa(e.events.dropNewPiece,t,n),e.pieces.set(n,t),e.lastMove=[n,n],e.check=null,wa(e.events.change),e.movable.dests={},e.turnColor=Na(e.turnColor),!0}function us(e,t,n){const r=cs(e,t,n);return r&&(e.movable.dests=null,e.turnColor=Na(e.turnColor),e.animation.current=null),r}const ds="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",hs={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king",P:"pawn",R:"rook",N:"knight",B:"bishop",Q:"queen",K:"king"},ms={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};var fs={initial:ds,read:function(e){"start"===e&&(e=ds);const t=new Map;let n=8,r=0;for(let i=0;i<e.length;i++){const o=e[i];switch(o){case" ":return t;case"/":if(--n,0===n)return t;r=0;break;case"~":{const e=Ea([r,n]),i=t.get(e);i&&(i.promoted=!0,t.set(e,i));break}default:{const e=~~o;if(e)r+=e;else{++r;const e=o.toLowerCase();t.set(Ea([r,n]),{role:hs[e],color:o===e?"black":"white"})}}}}return t},write:function(e){return[8,7,6,5,4,3,2].reduce((function(e,t){return e.replace(new RegExp(Array(t+1).join("1"),"g"),String(t))}),Ca.map((t=>Ta.map((n=>{const r=e.get(Ea([n,t]));if(r){const e=ms[r.role];return"white"===r.color?e.toUpperCase():e}return"1"})).join(""))).join("/"))}};function ps(e){const t={pieces:new Map,orientation:"white",turnColor:"white",check:null,lastMove:null,selected:null,coordinates:!0,symmetricCoordinates:!1,otb:!1,otbMode:"facing",autoCastle:!0,viewOnly:!1,fixed:!1,exploding:null,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200,current:null},movable:{free:!0,color:"both",dests:null,dropped:null,showDests:!0,rookCastle:!0,events:{}},premovable:{enabled:!0,showDests:!0,castle:!0,dests:null,current:null,events:{}},predroppable:{enabled:!1,current:null,events:{}},draggable:{enabled:!0,distance:3,magnified:!0,centerPiece:!1,preventDefault:!0,showGhost:!0,deleteOnDropOff:!1,current:null},selectable:{enabled:!0},events:{},prev:{orientation:null,bounds:null,turnColor:null,otbMode:null}};return gs(t,e||{}),t}function gs(e,t){t&&(t.movable&&t.movable.dests&&(e.movable.dests=null),ws(e,t),t.fen&&(e.pieces=fs.read(t.fen)),Object.prototype.hasOwnProperty.call(t,"check")&&Ka(e,t.check||!1),Object.prototype.hasOwnProperty.call(t,"lastMove")&&!t.lastMove&&(e.lastMove=null),e.selected&&ts(e,e.selected),(!e.animation.duration||e.animation.duration<100)&&(e.animation.enabled=!1),bs(e))}function vs(e,t){t&&(t.fen&&(e.pieces=fs.read(t.fen)),void 0!==t.orientation&&(e.orientation=t.orientation),void 0!==t.turnColor&&(e.turnColor=t.turnColor),void 0!==t.dests&&(e.movable.dests=t.dests),void 0!==t.movableColor&&(e.movable.color=t.movableColor),Object.prototype.hasOwnProperty.call(t,"check")&&Ka(e,t.check||!1),Object.prototype.hasOwnProperty.call(t,"lastMove")&&!t.lastMove?e.lastMove=null:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&ts(e,e.selected),bs(e))}function bs(e){if(!e.movable.rookCastle&&e.movable.dests){const t="white"===e.movable.color?1:8,n="e"+t,r=e.movable.dests[n],i=e.pieces.get(n);if(!r||!i||"king"!==i.role)return;e.movable.dests[n]=r.filter((e=>!(e==="a"+t&&-1!==r.indexOf("c"+t)||e==="h"+t&&-1!==r.indexOf("g"+t))))}}function ws(e,t){for(const n in t)ys(e[n])&&ys(t[n])?ws(e[n],t[n]):e[n]=t[n]}function ys(e){return e&&"object"==typeof e}function ks(e,t){const n=t.board,r="white"===e.orientation,i=e.fixed?Cs:Ts(t.bounds),o=e.prev.orientation&&e.prev.orientation!==e.orientation;e.prev.orientation=e.orientation;const a=e.prev.bounds&&e.prev.bounds!==t.bounds;e.prev.bounds=t.bounds;const s=a||o,c=e.pieces,l=e.animation.current&&e.animation.current.plan.anims,u=e.animation.current&&e.animation.current.plan.captured,d=function(e){const t=new Map;e.lastMove&&e.highlight.lastMove&&(_s(t,e.lastMove[0],"last-move"),_s(t,e.lastMove[1],"last-move"));e.check&&e.highlight.check&&_s(t,e.check,"check");if(e.selected&&(_s(t,e.selected,"selected"),e.movable.showDests)){const n=e.movable.dests&&e.movable.dests[e.selected];if(n)for(let r=0,i=n.length;r<i;r++){const i=n[r];_s(t,i,"move-dest"+(e.pieces.has(i)?" occupied":""))}const r=e.premovable.dests;if(r)for(let n=0,i=r.length;n<i;n++){const i=r[n];_s(t,i,"premove-dest"+(e.pieces.has(i)?" occupied":""))}}const n=e.premovable.current;n&&(_s(t,n[0],"current-premove"),_s(t,n[1],"current-premove"));if(e.exploding)for(const n of e.exploding.keys)_s(t,n,"exploding"+e.exploding.stage);return t}(e),h=new Set,m=new Set,f=new Map,p=new Map;let g,v,b,w,y,k,P,T,C,S,E=!1;e.otb&&(C=e.prev.turnColor&&e.prev.turnColor!==e.turnColor,S=e.prev.otbMode&&e.prev.otbMode!==e.otbMode,e.prev.otbMode=e.otbMode,e.prev.turnColor=e.turnColor,E=!(!C&&!S));let x=t.board.firstChild;for(;x;){const t=x.cgKey;if(xs(x))if(v=c.get(t),g=d.get(t),b=l&&l.get(t),w=u&&u.get(t),k=x.cgPiece,!x.cgDragging||e.draggable.current&&e.draggable.current.orig===t||(x.classList.remove("dragging"),x.classList.remove("magnified"),y=i(xa(t),r),Ss(e,x,x.cgColor,y),x.cgDragging=!1),!w&&x.cgCaptured&&(x.cgCaptured=!1,x.classList.remove("captured")),v){const n=Ms(v);b&&x.cgAnimating&&k===n?(y=i(xa(t),r),y[0]+=b[1][0],y[1]+=b[1][1],x.classList.add("anim"),Ss(e,x,x.cgColor,y)):x.cgAnimating&&(y=i(xa(t),r),Ss(e,x,x.cgColor,y),x.classList.remove("anim"),x.cgAnimating=!1),k!==n||s||E||w&&x.cgCaptured?w&&Ms(w)===k?(x.classList.add("captured"),x.cgCaptured=!0):js(f,k,x):h.add(t)}else js(f,k,x);else Os(x)&&(s||g!==x.className?js(p,x.className,x):m.add(t));x=x.nextSibling}for(const[t,o]of d)if(!m.has(t))if(P=p.get(o),T=P&&P.pop(),T)T.cgKey=t,y=i(xa(t),r),Es(e,T,y);else{const a=document.createElement("square");a.className=o,a.cgKey=t,y=i(xa(t),r),Es(e,a,y),n.insertBefore(a,n.firstChild)}for(const[t,o]of c){const a=o.role+o.color;if(b=l&&l.get(t),!h.has(t))if(P=f.get(a),T=P&&P.pop(),T)T.cgKey=t,y=i(xa(t),r),b&&(T.cgAnimating=!0,y[0]+=b[1][0],y[1]+=b[1][1]),Ss(e,T,T.cgColor,y);else{const a=document.createElement("piece"),s=Ms(o);a.className=s,a.cgPiece=s,a.cgColor=o.color,a.cgKey=t,y=i(xa(t),r),b&&(a.cgAnimating=!0,y[0]+=b[1][0],y[1]+=b[1][1]),Ss(e,a,o.color,y),n.appendChild(a)}}for(const e of f.values())Ns(t,e);for(const e of p.values())Ns(t,e)}function Ps(e,t,n,r){return[(t?e[0]-1:8-e[0])*n,(t?8-e[1]:e[1]-1)*r]}const Ts=e=>{const t=e.width/8,n=e.height/8;return(e,r)=>Ps(e,r,t,n)},Cs=(e,t)=>Ps(e,t,12.5,12.5);function Ss(e,t,n,r){e.fixed?(t.style.left=r[0]+"%",t.style.top=r[1]+"%"):t.style.transform=La(e,n,Da(r))}function Es(e,t,n){e.fixed?(t.style.left=n[0]+"%",t.style.top=n[1]+"%"):t.style.transform=Da(n)}function xs(e){return"PIECE"===e.tagName}function Os(e){return"SQUARE"===e.tagName}function Ms(e){return e.role+" "+e.color}function Ns(e,t){for(const n of t)e.board.removeChild(n)}function js(e,t,n){const r=e.get(t);r?r.push(n):e.set(t,[n])}function _s(e,t,n){e.set(t,(e.get(t)||"")+" "+n)}function Ls(e,t){const n=document.createElement("li-coords");return n.className=t,e.forEach(((e,t)=>{const r=document.createElement("li-coord");r.className=t%2==0?"coord-odd":"coord-even",r.textContent=String(e),n.appendChild(r)})),n}function Ds(e,t){return t.state.animation.enabled?function(e,t){const n=t.state,r=new Map(n.pieces),i=e(n),o=void 0!==t.dom?function(e,t,n){const r=n.bounds,i=r.width/8,o=r.height/8,a=new Map,s=[],c=new Map,l=[],u=[],d=new Map,h="white"===t.orientation;for(const[t,n]of e)d.set(t,As(t,n));for(let e=0,n=Ma.length;e<n;e++){const n=Ma[e],r=t.pieces.get(n),i=d.get(n);r?i?Rs(r,i.piece)||(l.push(i),u.push(As(n,r))):u.push(As(n,r)):i&&l.push(i)}for(const e of u){const t=zs(e,l.filter((t=>Rs(e.piece,t.piece))));if(t){const n=h?t.pos:e.pos,r=h?e.pos:t.pos,c=[(n[0]-r[0])*i,(r[1]-n[1])*o];a.set(e.key,[c,c]),s.push(t.key)}}for(const e of l)ja(s,e.key)||c.set(e.key,e.piece);return{anims:a,captured:c}}(r,n,t.dom):void 0;if(void 0!==o&&(o.anims.size||o.captured.size)){const e=n.animation.current&&null!==n.animation.current.start;n.animation.current={start:null,duration:n.animation.duration,plan:o},e||Vt(t.applyAnim)}else t.redraw();return i}(e,t):Is(e,t)}function Is(e,t){const n=e(t.state);return t.redraw(),n}function As(e,t){return{key:e,pos:xa(e),piece:t}}function Rs(e,t){return e.role===t.role&&e.color===t.color}function zs(e,t){return t.sort(((t,n)=>_a(e.pos,t.pos)-_a(e.pos,n.pos)))[0]}function Bs(e,t){if(t.touches&&t.touches.length>1)return;const n=e.state;n.draggable.preventDefault&&t.preventDefault();const r=n.draggable.current;r&&r.orig&&(r.epos=za(t),!r.started&&_a(r.epos,r.rel)>=n.draggable.distance&&(r.started=!0,Fs(e)))}function $s(e,t){const n=e.state,r=n.draggable,i=r.current;if(!i)return;if(i.originTarget!==t.target&&!i.newPiece)return;n.draggable.preventDefault&&t.preventDefault();const o=i.over;Xa(n),Qa(n),i.started&&o?i.newPiece?Za(n,i.orig,o,i.force):Ja(n,i.orig,o):i.started&&r.deleteOnDropOff?(n.pieces.delete(i.orig),setTimeout(n.events.change||ya,0)):i.newPiece&&n.pieces.delete(i.orig),(!i||i.orig!==i.previouslySelected||i.orig!==o&&o)&&n.selectable.enabled||ns(n),n.draggable.current=null,Vt((()=>Hs(e.dom))),e.redraw()}function Us(e){const t=e.state;e.dom&&Hs(e.dom),t.draggable.current&&(t.draggable.current=null,ns(t))}function qs(e,t,n){if("object"!=typeof n)throw new Error("function getKeyAtDomPos require bounds object arg");const r="white"===e.orientation,i=Math.ceil((t[0]-n.left)/n.width*8),o=r?i:9-i,a=Math.ceil(8-(t[1]-n.top)/n.height*8),s=r?a:9-a;return o>0&&o<9&&s>0&&s<9?Ea([o,s]):null}function Fs(e){const t=e.state,n=e.dom,r=t.draggable.current;r&&(r.scheduledAnimationFrame||(r.scheduledAnimationFrame=!0,requestAnimationFrame((()=>{const i=n.bounds,o="white"===t.orientation;if(r.scheduledAnimationFrame=!1,r.orig){if(t.pieces.get(r.orig)!==r.piece)return void Us(e);t.animation.current&&t.animation.current.plan.anims.get(r.orig)&&(t.animation.current=null);const a=r.element;if(r.started&&a){if(!a.cgDragging){a.cgDragging=!0,a.classList.add("dragging"),t.draggable.magnified&&a.classList.add("magnified");const e=n.elements.ghost;if(e&&r.showGhost){e.className=`ghost ${r.piece.color} ${r.piece.role}`;const n=Oa(xa(r.orig),"white"===t.orientation,i);e.style.transform=La(t,r.piece.color,Da(n))}}r.pos=[r.epos[0]-r.rel[0],r.epos[1]-r.rel[1]],r.over=qs(t,r.epos,i);const e=Oa(r.origPos,o,i);e[0]+=r.pos[0]+r.dec[0],e[1]+=r.pos[1]+r.dec[1],a.style.transform=La(t,r.piece.color,Ia(e));const s=n.elements.shadow;if(s){if(r.over&&r.over!==r.prevOver){const e=i.width/8,t=Oa(xa(r.over),o,i);s.style.transform=Ia([t[0]-e/2,t[1]-e/2])}else r.over||(s.style.transform=Ra);r.prevOver=r.over}}Fs(e)}}))))}function Hs(e){e.elements.shadow&&(e.elements.shadow.style.transform=Ra),e.elements.ghost&&(e.elements.ghost.style.transform=Aa)}const Ws={pawn:1,knight:3,bishop:3,rook:5,queen:9,king:0};class Gs{constructor(e){this.detach=()=>{this.dom=void 0,window.removeEventListener("resize",this.onOrientationChange)},this.applyAnim=e=>{const t=this.state,n=t.animation.current;if(null===n)return void this.redrawSync();null===n.start&&(n.start=e);const r=1-(e-n.start)/n.duration;if(r<=0)t.animation.current=null,this.redrawSync();else{const e=function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}(r);for(const t of n.plan.anims.values())t[1]=[Sa(t[0][0]*e,10),Sa(t[0][1]*e,10)];this.redrawSync(),Vt(this.applyAnim)}},this.setBounds=e=>{this.dom&&(this.dom.bounds=e)},this.redrawSync=()=>{this.dom&&ks(this.state,this.dom)},this.redraw=()=>{Vt(this.redrawSync)},this.getFen=()=>fs.write(this.state.pieces),this.toggleOrientation=()=>{Ds(Va,this)},this.playPremove=()=>{if(this.state.premovable.current){if(Boolean(Ds(as,this)))return!0;this.redraw()}return!1},this.playPredrop=e=>{if(this.state.predroppable.current){const t=function(e,t){const n=e.predroppable.current;if(!n)return!1;let r=!1;t(n)&&ls(e,{role:n.role,color:e.movable.color},n.key)&&(wa(e.movable.events.afterNewPiece,n.role,n.key,{predrop:!0}),r=!0);return Qa(e),r}(this.state,e);return this.redraw(),t}return!1},this.cancelPremove=()=>{Is(Xa,this)},this.cancelPredrop=()=>{Is(Qa,this)},this.setCheck=e=>{Is((t=>Ka(t,e)),this)},this.cancelMove=()=>{Us(this),Is((e=>ss(e)),this)},this.stop=()=>{Us(this),Is((e=>function(e){e.movable.color=null,e.movable.dests={},ss(e)}(e)),this)},this.explode=e=>{this.dom&&(this.state.exploding={stage:1,keys:e},this.redraw(),setTimeout((()=>{this.state.exploding&&(this.state.exploding.stage=2,this.redraw()),setTimeout((()=>{this.state.exploding=null,this.redraw()}),120)}),120))},this.onOrientationChange=()=>{const e=this.dom;e&&requestAnimationFrame((()=>{e.bounds=e.board.getBoundingClientRect(),this.redraw()}))},this.state=ps(e)}attach(e,t){const n=this.state.fixed||this.state.viewOnly,r=document.createElement("div");if(r.className="cg-board",r.className+=n?" view-only":" manipulable",e.appendChild(r),this.dom={board:r,elements:{},bounds:t},this.redrawSync(),!n){const t=document.createElement("div");t.className="cg-square-target",t.style.transform=Ra,e.appendChild(t),this.dom.elements.shadow=t}if(!n&&this.state.draggable.showGhost){const t=document.createElement("piece");t.className="ghost",t.style.transform=Aa,e.appendChild(t),this.dom.elements.ghost=t}this.state.coordinates&&(function(e,t){const n=document.createDocumentFragment();n.appendChild(Ls(Ta,"ranks")),n.appendChild(Ls(ka,"files"+(t?" withSymm":""))),e.appendChild(n)}(e,!!this.state.symmetricCoordinates),this.state.symmetricCoordinates&&function(e){const t=document.createDocumentFragment();t.appendChild(Ls(Ca,"ranks symm")),t.appendChild(Ls(Pa,"files symm")),e.appendChild(t)}(e)),n||(r.addEventListener("touchstart",(e=>function(e,t){if(!t.isTrusted||t.touches&&t.touches.length>1)return;t.preventDefault();const n=e.state,r=e.dom,i=r.bounds,o=za(t),a=qs(n,o,i);if(!a)return;const s=n.selected,c=!!n.premovable.current,l=!!n.predroppable.current;n.selected&&is(n,n.selected,a)?Ds((e=>es(e,a)),e):es(n,a);const u=n.selected===a,d=n.pieces.get(a);if(d&&u&&function(e,t){const n=e.pieces.get(t);return!!n&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}(n,a)){const c=Ba(n.orientation,i,a),l=xa(a);n.draggable.current={previouslySelected:s,orig:a,piece:d,rel:o,epos:o,pos:[0,0],origPos:l,dec:n.draggable.magnified?[o[0]-(c.left+c.width),o[1]-(c.top+2*c.height)]:[o[0]-(c.left+c.width/2),o[1]-(c.top+c.height/2)],started:!1===n.selectable.enabled,over:a,prevOver:null,element:$a(r,a),originTarget:t.target,showGhost:n.draggable.showGhost,scheduledAnimationFrame:!1},n.draggable.magnified&&n.draggable.centerPiece&&(n.draggable.current.dec[1]=o[1]-(c.top+c.height)),n.draggable.current.started&&Fs(e)}else c&&Xa(n),l&&Qa(n);e.redraw()}(this,e))),r.addEventListener("touchmove",(e=>Bs(this,e))),r.addEventListener("touchend",(e=>$s(this,e))),r.addEventListener("touchcancel",(()=>Us(this)))),window.addEventListener("resize",this.onOrientationChange)}getMaterialDiff(){let e=0;const t={king:0,queen:0,rook:0,bishop:0,knight:0,pawn:0};for(const n of this.state.pieces.values())t[n.role]+="white"===n.color?1:-1,e+=Ws[n.role]*("white"===n.color?1:-1);const n={white:{pieces:{},score:e},black:{pieces:{},score:-e}};for(const e in t){const r=t[e];r>0?n.white.pieces[e]=r:r<0&&(n.black.pieces[e]=-r)}return n}set(e){Ds((t=>vs(t,e)),this)}reconfigure(e){Ds((t=>gs(t,e)),this)}setOtbMode(e){Ds((t=>{t.otbMode=e}),this)}setPieces(e){Ds((t=>Ya(t,e)),this)}promote(e,t){const n=new Map,r=this.state.pieces.get(e);r&&"pawn"===r.role&&(n.set(e,{color:r.color,role:t}),this.setPieces(n))}dragNewPiece(e,t,n=!1){!function(e,t,n,r){const i="a0",o=e.state,a=e.dom;o.pieces.set(i,t),e.redrawSync();const s=za(n),c="white"===o.orientation,l=a.bounds,u=Ba(o.orientation,l,i),d=[(c?0:7)*u.width+l.left,(c?8:-1)*u.height+l.top];o.draggable.current={orig:i,origPos:xa(i),piece:t,rel:d,epos:s,pos:[s[0]-d[0],s[1]-d[1]],dec:o.draggable.magnified?[-u.width,2*-u.height]:[-u.width/2,-u.height/2],over:null,prevOver:null,started:!0,element:$a(a,i),originTarget:n.target,previouslySelected:null,newPiece:!0,force:r||!1,showGhost:!1},Fs(e)}(this,t,e,n)}selectSquare(e){e?Ds((t=>es(t,e)),this):this.state.selected&&(ns(this.state),this.redraw())}apiMove(e,t,n,r){Ds((i=>{!function(e,t,n){cs(e,t,n)}(i,e,t),n&&Ya(i,n),r&&vs(i,r)}),this)}apiNewPiece(e,t,n){Ds((r=>{!function(e,t,n){ls(e,t,n)}(r,e,t),n&&vs(r,n)}),this)}}const Vs={P:"pawn",B:"bishop",N:"knight",R:"rook",Q:"queen",p:"pawn",b:"bishop",n:"knight",r:"rook",q:"queen"},Ys={P:"pawn",N:"knight",B:"bishop",R:"rook",Q:"queen"},Ks={e1a1:"e1c1",e1h1:"e1g1",e8a8:"e8c8",e8h8:"e8g8"};function Xs(e){return[e.substr(0,2),e.substr(2,2)]}function Qs(e){return"@"===e[1]?[e.substr(2,2),e.substr(2,2)]:[e.substr(0,2),e.substr(2,2)]}function Js(e){const t=e.substr(4,1);return Vs[t]}function Zs(e){return e.substr(2,2)}function ec(e){return Vs[e.substr(0,1)]}function tc(e){return[e.substr(2,2),e.substr(2,2)]}function nc(e){return"P"===e[0]?e.slice(1):e}function rc(e){return[e.slice(0,2),e.slice(2,4),e.slice(4,5)]}function ic(e){if(void 0===e)return null;if(function(e){return p(e)}(e))return e;const t={};return e&&function(e){return"string"==typeof e}(e)&&e.split(" ").forEach((e=>{t[oc[e[0]]]=e.split("").slice(1).map((e=>oc[e]))})),t}const oc={a:"a1",b:"b1",c:"c1",d:"d1",e:"e1",f:"f1",g:"g1",h:"h1",i:"a2",j:"b2",k:"c2",l:"d2",m:"e2",n:"f2",o:"g2",p:"h2",q:"a3",r:"b3",s:"c3",t:"d3",u:"e3",v:"f3",w:"g3",x:"h3",y:"a4",z:"b4",A:"c4",B:"d4",C:"e4",D:"f4",E:"g4",F:"h4",G:"a5",H:"b5",I:"c5",J:"d5",K:"e5",L:"f5",M:"g5",N:"h5",O:"a6",P:"b6",Q:"c6",R:"d6",S:"e6",T:"f6",U:"g6",V:"h6",W:"a7",X:"b7",Y:"c7",Z:"d7",0:"e7",1:"f7",2:"g7",3:"h7",4:"a8",5:"b8",6:"c8",7:"d8",8:"e8",9:"f8","!":"g8","?":"h8"},ac={oninit({attrs:e}){this.pieceTheme=ut.general.theme.piece(),this.boardTheme=ut.general.theme.board(),this.ground=new Gs(function({fen:e,lastMove:t,orientation:n,fixed:r=!0}){return{batchRAF:Vt,viewOnly:!0,fixed:r,minimalDom:!0,coordinates:!1,fen:e,lastMove:t?Xs(t):null,orientation:n||"white"}}(e))},oncreate({attrs:e,dom:t}){const n=e.fixed?{top:0,bottom:0,left:0,right:0,height:0,width:0}:t.getBoundingClientRect();void 0!==e.delay?setTimeout((()=>{this.ground.attach(t,n)}),e.delay):this.ground.attach(t,n)},onbeforeupdate:({attrs:e},{attrs:t})=>e.fen!==t.fen||e.lastMove!==t.lastMove||e.orientation!==t.orientation,onupdate({attrs:e}){this.ground.set(Object.assign(Object.assign({},e),{lastMove:e.lastMove?Xs(e.lastMove):void 0}))},onremove(){this.ground.detach()},view({attrs:e}){const t=["display_board",e.customPieceTheme||this.pieceTheme,`board-${this.boardTheme}`,e.variant||"standard"].join(" ");return qn("div",{className:t})}};let sc,cc=null,lc=!1;var uc={lastJoined:()=>sc,resetLastJoined(){sc=void 0},open:function(e){Vr.backbutton.stack.push(gc),gi.refresh(),lc=!0,setTimeout((()=>{cc&&!Gi()&&cc.goTo(void 0!==e?e:0)}),500)},close:gc,view:()=>lc?qn("div#games_menu.overlay_popup_wrapper",{onbeforeremove:hc},qn.fragment({key:Vi()?"portrait":"landscape"},[qn("div.wrapper_overlay_close",{oncreate:dc}),Pc(),qn("div#wrapper_games",Cc())])):null};const dc=$i((()=>gc()));function hc({dom:e}){return e.classList.add("fading_out"),new Promise((e=>{setTimeout(e,500)}))}let mc;function fc({dom:e}){Vi()&&(cc=new ba({selector:e,duration:250,loop:!1,perPage:Gi()?2:1,startIndex:0,threshold:50,draggable:!0,onChange:()=>{clearTimeout(mc),mc=setTimeout((()=>{Vt(Tc)}),300)}}),Vt(Tc),Xt())}function pc(){cc&&(cc.destroy(),cc=null)}function gc(e){"backbutton"!==e&&lc&&Vr.backbutton.stack.pop(),lc=!1}function vc(e,t,n,r){return qn("div.boardWrapper",qn(ac,{fen:e,lastMove:n,orientation:t,variant:r}))}function bc(e){return e.isMyTurn?e.secondsLeft?qn("time",{},Mt(Ke(new Date,e.secondsLeft))):kt("yourTurn"):kt("waitingForOpponent")}function wc(e){const t=e.opponent.ai?"n":dn(e.perf),n=ca(e.opponent,!1),r=["card","standard",e.color].join(" "),i=["timeIndication",e.isMyTurn?"myTurn":"opponentTurn"].join(" ");return qn("div",{className:r,key:"game."+e.gameId,oncreate:Fi((()=>function(e){sc=e,aa.set(e.fullId,{fen:e.fen,orientation:e.color}),gc(),Vr.set("/game/"+e.fullId)}(e)))},[vc(e.fen,e.color,e.lastMove,e.variant.key),qn("div.infos",[qn("div.icon-game",{"data-icon":t||""}),qn("div.description",[qn("h2.title",n),qn("p",[qn("span.variant",e.variant.name),qn("span",{className:i},bc(e))])])])])}function yc(e){if(!e.challenger)return null;const t=e.rated?kt("rated"):kt("casual"),n=e.challenger.provisional?"?":"",r=`${e.challenger.id} (${e.challenger.rating}${n})`;return qn("div.card.standard.challenge",{key:"incoming."+e.id},[vc(e.initialFen||ua,"white",void 0,e.variant.key),qn("div.infos",[qn("div.icon-game",{"data-icon":dn(e.speed)}),qn("div.description",[qn("h2.title",kt("playerisInvitingYou",r)),qn("p.variant",[qn("span.time-indication[data-icon=p]",Or.challengeTime(e))," • ",qn("span.variantName",e.variant.name)," • ",qn("span",t)])]),qn("div.actions",[qn("button",{oncreate:Ui((()=>{return mr(t=e.id).then((e=>{Vr.set("/game"+e.url.round)})).then((()=>Or.remove(t))).then((()=>gc()));var t}))},kt("accept")),qn("button",{oncreate:Ui((t=>{return(n=e.id,hr(n).then((()=>{Or.remove(n)}))).then((()=>{Ri(t,(()=>gc()),".card",250)}));var n}))},kt("decline"))])])])}function kc(e){const t=e.rated?kt("rated"):kt("casual");return qn("div.card.standard.challenge.sending",{key:"sending."+e.id},[vc(e.initialFen||ua,"white",void 0,e.variant.key),qn("div.infos",[qn("div.icon-game",{"data-icon":dn(e.speed)}),qn("div.description",[qn("h2.title",e.destUser?function(e){const t=e.provisional?"?":"";return`${e.id} (${e.rating}${t})`}(e.destUser):"Open challenge"),qn("p.variant",[qn("span.time-indication[data-icon=p]",Or.challengeTime(e))," • ",qn("span.variantName",e.variant.name)," • ",qn("span",t)])]),qn("div.actions",[e.destUser?null:qn("button",{oncreate:Ui((()=>{gc(),Vr.set(`/game/${e.id}`)}))},kt("viewInFullSize")),qn("button",{oncreate:Ui((t=>{return(n=e.id,dr(n).then((()=>{Or.remove(n)}))).then((()=>{Ri(t,(()=>gc()),".card",250)}));var n}))},kt("cancel"))])])])}function Pc(){return Vi()?qn("div.#games_menu__dots"):null}function Tc(){if(Vi()&&cc){const e=Gi()?Math.ceil(cc.innerElements.length/2):cc.innerElements.length,t=document.getElementById("games_menu__dots");if(t){const n=e-t.childElementCount;if(0!==n)for(let e=0,r=Math.abs(n);e<r;e++)if(n>0){const e=document.createElement("i");e.className="dot",t.appendChild(e)}else{const e=t.firstChild;e&&t.removeChild(e)}const r=t.childNodes;for(let e=0;e<r.length;e++){const t=r[e];e===cc.currentSlide?t.className="dot current":t.className="dot"}}}}function Cc(){const e=gi.nowPlaying(),t=Or.incoming(),n=Or.sending().filter(Or.isPersistent),r=t.map((e=>yc(e))).filter(kn),i=n.map((e=>kc(e))),o=[...r,...e.map((e=>wc(e))),...i];return qn("div.games_carousel",{oncreate:fc,onremove:pc},o)}var Sc={booleanChoice:[{label:"no",value:!1},{label:"yes",value:!0}],renderRadio(e,t,n,r,i,o,a){const s=t+"_"+n;return[qn("input.radio[type=radio]",{name:t,id:s,className:n,value:n,checked:r,onchange:i,disabled:o}),qn("label",{for:s,className:a},"string"==typeof e?kt(e):e)]},renderSelect(e,t,n,r,i,o){const a=r();return[qn("label",{for:"select_"+t},kt(e)),qn("select",{id:"select_"+t,disabled:i,onchange(e){const t=e.target.value;r(t),o&&o(t),setTimeout(Xt,10)}},n.map((e=>function(e,t,n,r,i){const o=r&&i?kt(e,r,i):r?kt(e,r):kt(e);return qn("option",{key:t,value:t,selected:n===t},o)}(e[0],e[1],a,e[2],e[3]))))]},renderCheckbox(e,t,n,r,i){const o=n();return qn("div.check_container",{className:i?"disabled":""},[qn("label",{for:t},e),qn("input[type=checkbox]",{id:t,name:t,disabled:i,checked:o,onchange:()=>{const e=!o;n(e),r&&r(e),Xt()}})])},renderMultipleChoiceButton(e,t,n,r=!1,i){const o=n();return qn("div.form-multipleChoiceContainer",[qn("label",e),qn("div.form-multipleChoice",{className:r?"wrap":""},t.map((e=>{const t=void 0!==e.labelArg?kt(e.label,e.labelArg):kt(e.label);return qn("div",{className:e.value===o?"selected":"",oncreate:$i((()=>{n(e.value),i&&i(e.value)}))},t)})))])},renderSlider(e,t,n,r,i,o,a,s){const c=o();return qn("div.forms-rangeSlider",{className:s?"disabled":""},[qn("label",{for:t},e),qn("input[type=range]",{id:t,value:c,disabled:s,min:n,max:r,step:i,oninput(e){const t=~~e.target.value;o(t),a&&a(t),setTimeout(Xt,10)}}),qn("div.forms-sliderValue",c+" / "+r)])}};function Ec(e,t,n,r,i){if(!r)return null;const o={overlay_popup:!0,native_scroller:!0};let a;if("object"==typeof e)a=Wi(Object.assign(Object.assign({},o),e));else{if("string"!=typeof e)throw new Error("First popup argument must be either a string or an object");a=Wi(o)+" "+e}const s=Wi({popup_content:!0,noheader:!t});return qn("div",{className:"overlay_popup_wrapper fade-in",onbeforeremove:e=>(e.dom.classList.add("fading_out"),new Promise((e=>{setTimeout(e,500)})))},qn("div",{className:"popup_overlay_close",oncreate:i?$i(i):ln}),qn("div",{className:a},t?qn("header",null,t()):null,qn("div",{className:s},n())))}let xc=!1;const Oc=ut.gameSetup.human;let Mc=Oc.preset(),Nc=null;var jc={open:_c,close:Lc,openRealTime(e){Oc.timeMode("1"),e&&(Mc=e),_c()},openCorrespondence(){Nc=Mc,Mc="custom",Oc.timeMode("2"),_c()},view:()=>Ec("game_form_popup",void 0,Ic,xc,Lc)};function _c(){gi.hasCurrentBan()||(0===fr.length&&pr(!1).then(Xt),Vr.backbutton.stack.push(Lc),xc=!0)}function Lc(e){"backbutton"!==e&&xc&&Vr.backbutton.stack.pop(),xc=!1,Nc&&(Mc=Nc,Nc=null)}function Dc(e){Lc(),To(e)||Co(e)&&1===e.timeMode?gu.startSeeking(e):cr(e).then((()=>Vr.set("/?tab=1"))).catch(sn)}function Ic(){const e=Oc,t=t=>on((()=>{const n=t.target.value;Mc=n,e.preset(n)}));return[qn("div.newGame-preset_switch",[qn("div.nice-radio",Sc.renderRadio(kt("quickPairing"),"preset","quick","quick"===Mc,t)),qn("div.nice-radio",Sc.renderRadio(kt("custom"),"preset","custom","custom"===Mc,t))]),"quick"===Mc?Ac((()=>{Mc="custom",Oc.preset("custom")})):Rc("human",e,e.availableVariants,e.availableTimeModes.filter((e=>"1"===e[1]||gi.isConnected())))]}function Ac(e){return qn("div.newGame-pools",{className:fr.length?"":"loading"},fr.length?fr.map((e=>function(e){return qn("div.newGame-pool",{key:"pool-"+e.id,oncreate:$i((()=>{Oc.pool(e.id),Dc({id:e.id}),Lc()}))},[qn("div.newGame-clock",e.id),qn("div.newGame-perf",e.perf)])}(e))).concat(qn("div.newGame-pool",{key:"pool-custom",oncreate:$i(e)},qn("div.newGame-custom",kt("custom")))):Hn.getVdom("monochrome"))}function Rc(e,t,n,r){const i=t.timeMode(),o="1"===i,a="2"===i&&gi.isConnected(),s=t.variant();"2"===i&&"1"!==s&&t.mode("0");const c=t.mode();gi.isConnected()||Oc.timeMode("1"),"0"===i&&Oc.mode("0");const l=!gi.isConnected()||"0"===i||"2"===i&&"1"!==s?[["casual","0"]]:[["casual","0"],["rated","1"]];let u;"1"===c?(t.color("random"),u=[["randomColor","random"]]):u=[["randomColor","random"],["white","white"],["black","black"]];const d=[qn("div.select_input",Sc.renderSelect("side",e+"color",u,t.color)),qn("div.select_input",Sc.renderSelect("variant",e+"variant",n,t.variant))];d.push(qn("div.select_input",Sc.renderSelect("mode",e+"mode",l,t.mode))),gi.isConnected()&&d.push(qn("div.rating_range",[qn("div.title",kt("ratingRange")),qn("div.select_input.inline",Sc.renderSelect("Min",e+"rating_min",Oc.availableRatingRanges.min,t.ratingRangeMin,!1)),qn("div.select_input.inline",Sc.renderSelect("Max",e+"rating_max",Oc.availableRatingRanges.max,t.ratingRangeMax,!1))]));const h=[qn("div.select_input",Sc.renderSelect("clock",e+"timeMode",r,t.timeMode))];return o&&h.push(qn("div.select_input.inline",Sc.renderSelect("time",e+"time",ut.gameSetup.availableTimes,t.time,!1)),qn("div.select_input.inline",Sc.renderSelect("increment",e+"increment",ut.gameSetup.availableIncrements.map(rt),t.increment,!1))),a&&h.push(qn("div.select_input.large_label",Sc.renderSelect("daysPerTurn",e+"days",ut.gameSetup.availableDays.map(rt),t.days,!1))),qn("form.game_form",{onsubmit(e){e.preventDefault(),ut.gameSetup.isTimeValid(t)&&(Lc(),Dc(ir(t)))}},[qn("fieldset",d),qn("fieldset",h),qn("div.popupActionWrapper",[qn("button[type=submit].defaultButton",kt("createAGame"))])])}function zc(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var Bc,$c=function(){function e(){}var t=e.prototype;return t.unwrap=function(e,t){var n=this._chain((function(t){return Bc.ok(e?e(t):t)}),(function(e){return t?Bc.ok(t(e)):Bc.err(e)}));if(n.isErr)throw n.error;return n.value},t.map=function(e,t){return this._chain((function(t){return Bc.ok(e(t))}),(function(e){return Bc.err(t?t(e):e)}))},t.chain=function(e,t){return this._chain(e,t||function(e){return Bc.err(e)})},e}(),Uc=function(e){function t(t){var n;return(n=e.call(this)||this).value=t,n.isOk=!0,n.isErr=!1,n}return zc(t,e),t.prototype._chain=function(e,t){return e(this.value)},t}($c),qc=function(e){function t(t){var n;return(n=e.call(this)||this).error=t,n.isOk=!1,n.isErr=!0,n}return zc(t,e),t.prototype._chain=function(e,t){return t(this.error)},t}($c);!function(e){e.ok=function(e){return new Uc(e)},e.err=function(e){return new qc(e)},e.all=function(t){if(Array.isArray(t)){for(var n=[],r=0;r<t.length;r++){var i=t[r];if(i.isErr)return i;n.push(i.value)}return e.ok(n)}for(var o={},a=Object.keys(t),s=0;s<a.length;s++){var c=t[a[s]];if(c.isErr)return c;o[a[s]]=c.value}return e.ok(o)}}(Bc||(Bc={}));const Fc=["a","b","c","d","e","f","g","h"],Hc=["1","2","3","4","5","6","7","8"],Wc=["white","black"],Gc=["pawn","knight","bishop","rook","queen","king"],Vc=["a","h"];function Yc(e){return"role"in e}function Kc(e){return e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459),Math.imul(e+(e>>>4)&252645135,16843009)>>24}function Xc(e){return(e=e>>>8&16711935|(16711935&e)<<8)>>>16&65535|(65535&e)<<16}function Qc(e){return Xc(e=(e=(e=e>>>1&1431655765|(1431655765&e)<<1)>>>2&858993459|(858993459&e)<<2)>>>4&252645135|(252645135&e)<<4)}class Jc{constructor(e,t){this.lo=e,this.hi=t,this.lo=0|e,this.hi=0|t}static fromSquare(e){return e>=32?new Jc(0,1<<e-32):new Jc(1<<e,0)}static fromRank(e){return new Jc(255,0).shl64(8*e)}static fromFile(e){return new Jc(16843009<<e,16843009<<e)}static empty(){return new Jc(0,0)}static full(){return new Jc(4294967295,4294967295)}static corners(){return new Jc(129,2164260864)}static center(){return new Jc(402653184,24)}static backranks(){return new Jc(255,4278190080)}static backrank(e){return"white"===e?new Jc(255,0):new Jc(0,4278190080)}static lightSquares(){return new Jc(1437226410,1437226410)}static darkSquares(){return new Jc(2857740885,2857740885)}complement(){return new Jc(~this.lo,~this.hi)}xor(e){return new Jc(this.lo^e.lo,this.hi^e.hi)}union(e){return new Jc(this.lo|e.lo,this.hi|e.hi)}intersect(e){return new Jc(this.lo&e.lo,this.hi&e.hi)}diff(e){return new Jc(this.lo&~e.lo,this.hi&~e.hi)}intersects(e){return this.intersect(e).nonEmpty()}isDisjoint(e){return this.intersect(e).isEmpty()}supersetOf(e){return e.diff(this).isEmpty()}subsetOf(e){return this.diff(e).isEmpty()}shr64(e){return e>=64?Jc.empty():e>=32?new Jc(this.hi>>>e-32,0):e>0?new Jc(this.lo>>>e^this.hi<<32-e,this.hi>>>e):this}shl64(e){return e>=64?Jc.empty():e>=32?new Jc(0,this.lo<<e-32):e>0?new Jc(this.lo<<e,this.hi<<e^this.lo>>>32-e):this}bswap64(){return new Jc(Xc(this.hi),Xc(this.lo))}rbit64(){return new Jc(Qc(this.hi),Qc(this.lo))}minus64(e){const t=this.lo-e.lo,n=(t&e.lo&1)+(e.lo>>>1)+(t>>>1)>>>31;return new Jc(t,this.hi-(e.hi+n))}equals(e){return this.lo===e.lo&&this.hi===e.hi}size(){return Kc(this.lo)+Kc(this.hi)}isEmpty(){return 0===this.lo&&0===this.hi}nonEmpty(){return 0!==this.lo||0!==this.hi}has(e){return 0!=(e>=32?this.hi&1<<e-32:this.lo&1<<e)}set(e,t){return t?this.with(e):this.without(e)}with(e){return e>=32?new Jc(this.lo,this.hi|1<<e-32):new Jc(this.lo|1<<e,this.hi)}without(e){return e>=32?new Jc(this.lo,this.hi&~(1<<e-32)):new Jc(this.lo&~(1<<e),this.hi)}toggle(e){return e>=32?new Jc(this.lo,this.hi^1<<e-32):new Jc(this.lo^1<<e,this.hi)}last(){return 0!==this.hi?63-Math.clz32(this.hi):0!==this.lo?31-Math.clz32(this.lo):void 0}first(){return 0!==this.lo?31-Math.clz32(this.lo&-this.lo):0!==this.hi?63-Math.clz32(this.hi&-this.hi):void 0}withoutFirst(){return 0!==this.lo?new Jc(this.lo&this.lo-1,this.hi):new Jc(0,this.hi&this.hi-1)}moreThanOne(){return 0!==this.hi&&0!==this.lo||0!=(this.lo&this.lo-1)||0!=(this.hi&this.hi-1)}singleSquare(){return this.moreThanOne()?void 0:this.last()}isSingleSquare(){return this.nonEmpty()&&!this.moreThanOne()}*[Symbol.iterator](){let e=this.lo,t=this.hi;for(;0!==e;){const t=31-Math.clz32(e&-e);e^=1<<t,yield t}for(;0!==t;){const e=31-Math.clz32(t&-t);t^=1<<e,yield 32+e}}*reversed(){let e=this.lo,t=this.hi;for(;0!==t;){const e=31-Math.clz32(t);t^=1<<e,yield 32+e}for(;0!==e;){const t=31-Math.clz32(e);e^=1<<t,yield t}}}class Zc{constructor(){}static default(){const e=new Zc;return e.reset(),e}static racingKings(){const e=new Zc;return e.occupied=new Jc(65535,0),e.promoted=Jc.empty(),e.white=new Jc(61680,0),e.black=new Jc(3855,0),e.pawn=Jc.empty(),e.knight=new Jc(6168,0),e.bishop=new Jc(9252,0),e.rook=new Jc(16962,0),e.queen=new Jc(129,0),e.king=new Jc(33024,0),e}static horde(){const e=new Zc;return e.occupied=new Jc(4294967295,4294901862),e.promoted=Jc.empty(),e.white=new Jc(4294967295,102),e.black=new Jc(0,4294901760),e.pawn=new Jc(4294967295,16711782),e.knight=new Jc(0,1107296256),e.bishop=new Jc(0,603979776),e.rook=new Jc(0,2164260864),e.queen=new Jc(0,134217728),e.king=new Jc(0,268435456),e}reset(){this.occupied=new Jc(65535,4294901760),this.promoted=Jc.empty(),this.white=new Jc(65535,0),this.black=new Jc(0,4294901760),this.pawn=new Jc(65280,16711680),this.knight=new Jc(66,1107296256),this.bishop=new Jc(36,603979776),this.rook=new Jc(129,2164260864),this.queen=new Jc(8,134217728),this.king=new Jc(16,268435456)}static empty(){const e=new Zc;return e.clear(),e}clear(){this.occupied=Jc.empty(),this.promoted=Jc.empty();for(const e of Wc)this[e]=Jc.empty();for(const e of Gc)this[e]=Jc.empty()}clone(){const e=new Zc;e.occupied=this.occupied,e.promoted=this.promoted;for(const t of Wc)e[t]=this[t];for(const t of Gc)e[t]=this[t];return e}equalsIgnorePromoted(e){return!!this.white.equals(e.white)&&Gc.every((t=>this[t].equals(e[t])))}equals(e){return this.equalsIgnorePromoted(e)&&this.promoted.equals(e.promoted)}getColor(e){return this.white.has(e)?"white":this.black.has(e)?"black":void 0}getRole(e){for(const t of Gc)if(this[t].has(e))return t}get(e){const t=this.getColor(e);if(!t)return;return{color:t,role:this.getRole(e),promoted:this.promoted.has(e)}}take(e){const t=this.get(e);return t&&(this.occupied=this.occupied.without(e),this[t.color]=this[t.color].without(e),this[t.role]=this[t.role].without(e),t.promoted&&(this.promoted=this.promoted.without(e))),t}set(e,t){const n=this.take(e);return this.occupied=this.occupied.with(e),this[t.color]=this[t.color].with(e),this[t.role]=this[t.role].with(e),t.promoted&&(this.promoted=this.promoted.with(e)),n}has(e){return this.occupied.has(e)}*[Symbol.iterator](){for(const e of this.occupied)yield[e,this.get(e)]}pieces(e,t){return this[e].intersect(this[t])}rooksAndQueens(){return this.rook.union(this.queen)}bishopsAndQueens(){return this.bishop.union(this.queen)}kingOf(e){return this.king.intersect(this[e]).diff(this.promoted).singleSquare()}}class el{constructor(){}static empty(){const e=new el;for(const t of Gc)e[t]=0;return e}static fromBoard(e,t){const n=new el;for(const r of Gc)n[r]=e.pieces(t,r).size();return n}clone(){const e=new el;for(const t of Gc)e[t]=this[t];return e}equals(e){return Gc.every((t=>this[t]===e[t]))}add(e){const t=new el;for(const n of Gc)t[n]=this[n]+e[n];return t}nonEmpty(){return Gc.some((e=>this[e]>0))}isEmpty(){return!this.nonEmpty()}hasPawns(){return this.pawn>0}hasNonPawns(){return this.knight>0||this.bishop>0||this.rook>0||this.queen>0||this.king>0}count(){return this.pawn+this.knight+this.bishop+this.rook+this.queen+this.king}}class tl{constructor(e,t){this.white=e,this.black=t}static empty(){return new tl(el.empty(),el.empty())}static fromBoard(e){return new tl(el.fromBoard(e,"white"),el.fromBoard(e,"black"))}clone(){return new tl(this.white.clone(),this.black.clone())}equals(e){return this.white.equals(e.white)&&this.black.equals(e.black)}add(e){return new tl(this.white.add(e.white),this.black.add(e.black))}count(){return this.white.count()+this.black.count()}isEmpty(){return this.white.isEmpty()&&this.black.isEmpty()}nonEmpty(){return!this.isEmpty()}hasPawns(){return this.white.hasPawns()||this.black.hasPawns()}hasNonPawns(){return this.white.hasNonPawns()||this.black.hasNonPawns()}}class nl{constructor(e,t){this.white=e,this.black=t}static default(){return new nl(3,3)}clone(){return new nl(this.white,this.black)}equals(e){return this.white===e.white&&this.black===e.black}}function rl(e){return void 0!==e}function il(e){return"white"===e?"black":"white"}function ol(e){return e>>3}function al(e){return 7&e}function sl(e){switch(e){case"pawn":return"p";case"knight":return"n";case"bishop":return"b";case"rook":return"r";case"queen":return"q";case"king":return"k"}}function cl(e){switch(e){case"P":case"p":return"pawn";case"N":case"n":return"knight";case"B":case"b":return"bishop";case"R":case"r":return"rook";case"Q":case"q":return"queen";case"K":case"k":return"king";default:return}}function ll(e){if(2!==e.length)return;const t=e.charCodeAt(0)-"a".charCodeAt(0),n=e.charCodeAt(1)-"1".charCodeAt(0);return t<0||t>=8||n<0||n>=8?void 0:t+8*n}function ul(e){return Fc[al(e)]+Hc[ol(e)]}function dl(e){if("@"===e[1]&&4===e.length){const t=cl(e[0]),n=ll(e.slice(2));if(t&&rl(n))return{role:t,to:n}}else if(4===e.length||5===e.length){const t=ll(e.slice(0,2)),n=ll(e.slice(2,4));let r;if(5===e.length&&(r=cl(e[4]),!r))return;if(rl(t)&&rl(n))return{from:t,to:n,promotion:r}}}function hl(e,t){return"white"===e?"a"===t?2:6:"a"===t?58:62}const ml="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",fl="8/8/8/8/8/8/8/8 w - - 0 1";var pl;!function(e){e.Fen="ERR_FEN",e.Board="ERR_BOARD",e.Pockets="ERR_POCKETS",e.Turn="ERR_TURN",e.Castling="ERR_CASTLING",e.EpSquare="ERR_EP_SQUARE",e.RemainingChecks="ERR_REMAINING_CHECKS",e.Halfmoves="ERR_HALFMOVES",e.Fullmoves="ERR_FULLMOVES"}(pl||(pl={}));class gl extends Error{}function vl(e){return/^\d{1,4}$/.test(e)?parseInt(e,10):void 0}function bl(e){const t=cl(e);return t&&{role:t,color:e.toLowerCase()===e?"black":"white"}}function wl(e){const t=Zc.empty();let n=7,r=0;for(let i=0;i<e.length;i++){const o=e[i];if("/"===o&&8===r)r=0,n--;else{const a=parseInt(o,10);if(a>0)r+=a;else{if(r>=8||n<0)return Bc.err(new gl(pl.Board));const a=r+8*n,s=bl(o);if(!s)return Bc.err(new gl(pl.Board));"~"===e[i+1]&&(s.promoted=!0,i++),t.set(a,s),r++}}}return 0!==n||8!==r?Bc.err(new gl(pl.Board)):Bc.ok(t)}function yl(e){if(e.length>64)return Bc.err(new gl(pl.Pockets));const t=tl.empty();for(const n of e){const e=bl(n);if(!e)return Bc.err(new gl(pl.Pockets));t[e.color][e.role]++}return Bc.ok(t)}function kl(e,t){let n=Jc.empty();if("-"===t)return Bc.ok(n);if(!/^[KQABCDEFGH]{0,2}[kqabcdefgh]{0,2}$/.test(t))return Bc.err(new gl(pl.Castling));for(const r of t){const t=r.toLowerCase(),i=r===t?"black":"white",o=Jc.backrank(i).intersect(e[i]);let a;a="q"===t?o:"k"===t?o.reversed():Jc.fromSquare(t.charCodeAt(0)-"a".charCodeAt(0)).intersect(o);for(const t of a){if(e.king.has(t)&&!e.promoted.has(t))break;if(e.rook.has(t)){n=n.with(t);break}}}return Bc.ok(n)}function Pl(e){const t=e.split("+");if(3===t.length&&""===t[0]){const e=vl(t[1]),n=vl(t[2]);return!rl(e)||e>3||!rl(n)||n>3?Bc.err(new gl(pl.RemainingChecks)):Bc.ok(new nl(3-e,3-n))}if(2===t.length){const e=vl(t[0]),n=vl(t[1]);return!rl(e)||e>3||!rl(n)||n>3?Bc.err(new gl(pl.RemainingChecks)):Bc.ok(new nl(e,n))}return Bc.err(new gl(pl.RemainingChecks))}function Tl(e){const t=e.split(" "),n=t.shift();let r,i,o=Bc.ok(void 0);if(n.endsWith("]")){const e=n.indexOf("[");if(-1===e)return Bc.err(new gl(pl.Fen));r=wl(n.substr(0,e)),o=yl(n.substr(e+1,n.length-1-e-1))}else{const e=function(e,t,n){let r=e.indexOf(t);for(;n-- >0&&-1!==r;)r=e.indexOf(t,r+t.length);return r}(n,"/",7);-1===e?r=wl(n):(r=wl(n.substr(0,e)),o=yl(n.substr(e+1)))}const a=t.shift();if(rl(a)&&"w"!==a){if("b"!==a)return Bc.err(new gl(pl.Turn));i="black"}else i="white";return r.chain((e=>{const n=t.shift(),r=rl(n)?kl(e,n):Bc.ok(Jc.empty()),a=t.shift();let s;if(rl(a)&&"-"!==a&&(s=ll(a),!rl(s)))return Bc.err(new gl(pl.EpSquare));let c,l=t.shift();rl(l)&&l.includes("+")&&(c=Pl(l),l=t.shift());const u=rl(l)?vl(l):0;if(!rl(u))return Bc.err(new gl(pl.Halfmoves));const d=t.shift(),h=rl(d)?vl(d):1;if(!rl(h))return Bc.err(new gl(pl.Fullmoves));const m=t.shift();let f=Bc.ok(void 0);if(rl(m)){if(rl(c))return Bc.err(new gl(pl.RemainingChecks));f=Pl(m)}else rl(c)&&(f=c);return t.length>0?Bc.err(new gl(pl.Fen)):o.chain((t=>r.chain((n=>f.map((r=>({board:e,pockets:t,turn:i,unmovedRooks:n,remainingChecks:r,epSquare:s,halfmoves:u,fullmoves:Math.max(1,h)})))))))}))}function Cl(e,t){let n=sl(e.role);return"white"===e.color&&(n=n.toUpperCase()),(null==t?void 0:t.promoted)&&e.promoted&&(n+="~"),n}function Sl(e,t){let n="",r=0;for(let i=7;i>=0;i--)for(let o=0;o<8;o++){const a=o+8*i,s=e.get(a);s?(r>0&&(n+=r,r=0),n+=Cl(s,t)):r++,7===o&&(r>0&&(n+=r,r=0),0!==i&&(n+="/"))}return n}function El(e){return Gc.map((t=>sl(t).repeat(e[t]))).join("")}function xl(e,t,n){const r=null==n?void 0:n.shredder;let i="";for(const n of Wc){const o=Jc.backrank(n),a=e.kingOf(n);if(!rl(a)||!o.has(a))continue;const s=e.pieces(n,"rook").intersect(o);for(const e of t.intersect(s).reversed())if(!r&&e===s.first()&&e<a)i+="white"===n?"Q":"q";else if(!r&&e===s.last()&&a<e)i+="white"===n?"K":"k";else{const t=Fc[al(e)];i+="white"===n?t.toUpperCase():t}}return i||"-"}function Ol(e,t){return[Sl(e.board,t)+(e.pockets?`[${r=e.pockets,El(r.white).toUpperCase()+El(r.black)}]`:""),e.turn[0],xl(e.board,e.unmovedRooks,t),rl(e.epSquare)?ul(e.epSquare):"-",...e.remainingChecks?[(n=e.remainingChecks,`${n.white}+${n.black}`)]:[],...(null==t?void 0:t.epd)?[]:[Math.max(0,Math.min(e.halfmoves,9999)),Math.max(1,Math.min(e.fullmoves,9999))]].join(" ");var n,r}let Ml,Nl,jl="";const _l=En(!1);function Ll(e){e?(Ml=e,jl=kt("challengeToPlay")):(Ml=void 0,jl=kt("playWithAFriend")),Vr.backbutton.stack.push(Dl),_l(!0),Nl=void 0}function Dl(e){"backbutton"!==e&&_l()&&Vr.backbutton.stack.pop(),_l(!1)}function Il(){return function(e,t){const n=ut.gameSetup.challenge,r=e?`/setup/friend?user=${e}`:"/setup/friend",i={variant:n.variant(),timeMode:n.timeMode(),days:n.days(),time:n.time(),increment:n.increment(),color:n.color(),mode:gi.isConnected()?n.mode():"0"};return t&&(i.fen=t),Qn(r,{method:"POST",body:JSON.stringify(i)},!0)}(Ml,Nl).then((e=>{e.challenge.destUser&&Or.isPersistent(e.challenge)?uc.open(gi.nowPlaying().length+Or.all().length):Vr.set(`/game/${e.challenge.id}`)})).catch(sn)}function Al(){const e=ut.gameSetup.challenge,t=ut.gameSetup.challenge.availableVariants,n=ut.gameSetup.challenge.availableTimeModes,r=e.timeMode(),i="1"===r,o="2"===r;let a;"1"===e.mode()&&-1!==["5","6","7","8","9"].indexOf(e.variant())?(e.color("random"),a=[["randomColor","random"]]):a=[["randomColor","random"],["white","white"],["black","black"]];const s=gi.isConnected()?[["casual","0"],["rated","1"]]:[["casual","0"]],c=[qn("div.select_input",Sc.renderSelect("side","invitecolor",a,e.color)),qn("div.select_input",Sc.renderSelect("variant","invitevariant",t,e.variant)),"3"===e.variant()?qn("div.setupPosition",[qn("div.setupPositionInput",[qn("input[type=text][name=fen]",{placeholder:kt("pasteTheFenStringHere"),oninput:e=>{const t=e.target.value;Nl=""===t?void 0:Tl(t).unwrap((e=>Ol(e)),(()=>!1)),Xt()}}),qn("button.withIcon",{oncreate:$i((()=>{Dl(),Vr.set("/editor")}))},qn("span.fa.fa-pencil"))]),!1===Nl?qn("div.setupFenError","Invalid FEN"):null,void 0!==Nl&&!1!==Nl?[qn("div",{style:{width:"100px",height:"100px"},oncreate:$i((()=>{Dl(),Nl&&Vr.set(`/editor/${encodeURIComponent(Nl)}`)}))},[qn(ac,{fen:Nl,orientation:"white"})])]:null]):null,"3"!==e.variant()?qn("div.select_input",Sc.renderSelect("mode","invitemode",s,e.mode)):null],l=[qn("div.select_input",Sc.renderSelect("clock","invitetimeMode",n,e.timeMode))];return i&&l.push(qn("div.select_input.inline",Sc.renderSelect("time","invitetime",ut.gameSetup.availableTimes,e.time,!1)),qn("div.select_input.inline",Sc.renderSelect("increment","inviteincrement",ut.gameSetup.availableIncrements.map(rt),e.increment,!1))),o&&l.push(qn("div.select_input.large_label",Sc.renderSelect("daysPerTurn","invitedays",ut.gameSetup.availableDays.map(rt),e.days,!1))),qn("form#invite_form.game_form",{onsubmit(t){t.preventDefault(),ut.gameSetup.isTimeValid(e)&&(Dl(),Il())}},[qn("fieldset",c),qn("fieldset#clock",l),qn("div.popupActionWrapper",[qn("button[type=submit].defaultButton",jl)])])}var Rl={view:()=>Ec("invite_form_popup game_form_popup",void 0,Al,_l(),Dl),open:Ll,openFromPosition(e){Ll(),Nl=e,ut.gameSetup.challenge.variant("3"),ut.gameSetup.challenge.mode("0")}};let zl=!1;var Bl={open:function(){Vr.backbutton.stack.push($l),zl=!0},close:$l,view:()=>Ec({onlineFriends:!0,native_scroller:!1},(function(){return[qn("span",Tt("nbFriendsOnline",Jr.count()))]}),Ul,zl,$l)};function $l(e){"backbutton"!==e&&zl&&Vr.backbutton.stack.pop(),zl=!1}function Ul(){const e=Jr.list();return e.length?qn("ul",null,e.map(ql)):qn("div",{className:"native_scroller nofriend"})}function ql(e){const t=e.name.toLowerCase(),n="BOT"===e.title;return qn("li",{className:"list_item",key:t,oncreate:qi((function(){$l(),Vr.set("/@/"+t)}))},qn("div",{className:"friend_name"},e.patron?qn("span",{className:"patron is-green","data-icon":""}):null,qn("span",null,e.title?qn("span",{className:"userTitle"+(n?" bot":"")},e.title," "):null,e.name)),qn("div",{className:"onlineFriends_actions"},e.playing?qn("span",{className:"friend_tv","data-icon":"1",oncreate:qi((function(e){e.stopPropagation(),$l(),Vr.set("/@/"+t+"/tv")}))}," "):null,qn("span",{"data-icon":"U",oncreate:qi((e=>{e.stopPropagation(),$l(),Rl.open(t)}))}),qn("span",{"data-icon":"c",oncreate:qi((e=>{e.stopPropagation(),$l(),Vr.set(`/inbox/new/${t}`)}))})))}const Fl=qn("div",{className:"svg_icon"},qn("div",{className:"svg_icon_inner"},qn("svg",{width:"24",height:"24",viewBox:"0 0 24 24"},qn("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})))),Hl=qn("div",{className:"svg_icon"},qn("div",{className:"svg_icon_inner"},qn("svg",{width:"24",height:"24",viewBox:"0 0 24 24"},qn("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})))),Wl=qn("div",{className:"svg_icon"},qn("div",{className:"svg_icon_inner"},qn("svg",{width:"24",height:"24",viewBox:"0 0 24 24"},qn("path",{d:"M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"})))),Gl=qn("div",{className:"svg_icon"},qn("div",{className:"svg_icon_inner"},qn("svg",{width:"24",height:"24",viewBox:"0 0 24 24"},qn("path",{d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}))));function Vl(){return qn("button.fa.fa-navicon.main_header_button.menu_button",{oncreate:$i(Xo.toggle)})}function Yl(e){return qn("div.back_button",[qn("button",{oncreate:$i(Vr.backHistory)},Fl),void 0!==e?"string"==typeof e?qn("div.main_header_title",e):e:null])}function Kl(e,t){return gi.isConnected()?qn("button.main_header_button.bookmarkButton",{oncreate:$i(e,(()=>B.show({text:kt("bookmarkThisGame"),duration:"short",position:"top"})))},qn("span",{"data-icon":t?"t":"s"})):null}let Xl;function Ql(e){Xl=e}function Jl(){Xl=Xl||ut.general.theme.board();const e=gi.myTurnGames().length,t=Or.incoming().length,n=["main_header_button","game_menu_button",Xl,t?"new_challenge":""].join(" ");return qn("button",{className:n,"data-button":"games"},!t&&e?qn("span",{className:"chip nb_playing"},e):null,t?qn("span",{className:"chip nb_challenges"},t):null)}function Zl(e){const t=ro(e,".main_header_button"),n=null==t?void 0:t.dataset.button;if(t&&n)if("games"===n){const e=Or.all().length;gi.nowPlaying().length||e?uc.open():jc.open()}else"friends"===n&&Bl.open()}function eu(){const e=$i(Zl,void 0,void 0,io(".main_header_button"));return gi.isConnected()&&Jr.count()?qn("div",{className:"buttons",oncreate:e},function(){const e=Jr.count();return qn("button",{className:"main_header_button friends_button","data-icon":"f","data-button":"friends"},e>0?qn("span",{className:"chip nb_friends"},e):null)}(),Jl()):qn("div",{className:"buttons",oncreate:e},Jl())}function tu(e,t){return qn("nav",[t||Vl(),"string"==typeof e?qn("div.main_header_title",e):e,eu()])}function nu(e,t){return[qn("nav",[t||Vl(),e?qn("div",{className:"main_header_title"},e):null,eu()])]}const ru=qn("div",{className:"loader_circles"},[1,2,3].map((e=>qn("div",{className:"circle_"+e}))));function iu(e){return qn("nav",null,Vl(),qn("div",{className:"main_header_title reconnecting"+(e?"withTitle":"")},e?qn("span",null,e):null,ru),eu())}function ou(e){return[qn("nav",[Vl(),qn("div.main_header_title.reconnecting",{className:e?"withTitle":""}),e?qn("div.main_header_title",e):null,eu()])]}function au(e){return qn("nav",[Yl(qn("div.main_header_title.reconnecting",{className:e?"withTitle":""},[e?qn("span",e):null,ru])),eu()])}function su(e){const t=e.online?"online":"offline";return qn("div",{className:"user"},e.patron?qn("span",{className:"patron userStatus "+t,"data-icon":""}):qn("span",{className:"fa fa-circle userStatus "+t}),e.title?qn("span",{className:"userTitle"},e.title," "):null,e.username)}let cu,lu,uu=0,du=0,hu=!1,mu=null,fu=null;const pu={redirect:e=>{yu(),null!==mu&&(To(mu)?Cu(mu):jn.set("setup.custom.last",mu)),Po.redirectToGame(e)},n:(e,t)=>{uu=t.d,du=t.r,Xt()}};var gu={startSeeking(e){wu(e)},appCancelSeeking(){hu&&Tu()},onNewOpponent(e){if("pool"===e.game.source){const t=e.clock;wu({id:t.initial/60+"+"+t.increment})}else{wu(mu&&Co(mu)?mu:jn.get("setup.custom.last")||ir(ut.gameSetup.human),e.game.id)}},view:()=>Ec("",void 0,(function(){const e=Tt("nbPlayers",uu,uu?void 0:"?"),t=Tt("nbGames",du,du?void 0:"?");return qn("div.lobby-waitingPopup",null===mu?"Something went wrong. Please try again":[qn("div.lobby-waitingForOpponent",kt("waitingForOpponent")),qn("br"),To(mu)?bu(mu):vu(mu),qn("br"),Hn.getVdom(),qn("div.lobby-nbPlayers",Po.isConnected()?[qn("div",qn.trust(e.replace(/(\d+)/,"<strong>$1</strong>"))),qn("div",qn.trust(t.replace(/(\d+)/,"<strong>$1</strong>")))]:qn("div",[kt("reconnecting"),ru])),qn("button[data-icon=L]",{oncreate:$i((()=>ku()))},kt("cancel"))])}),hu)};function vu(e){const t=ut.gameSetup.human.availableVariants.find((t=>t[1]===String(e.variant))),n=t&&t[0]||"Standard",r=e.timeMode,i=0===e.mode?kt("casual"):kt("rated"),o=e.time;let a;a=1===r?function(e){return"0.75"===e?"¾":"0.5"===e?"½":"0.25"===e?"¼":e}(String(o))+"+"+e.increment:2===r?Tt("nbDays",e.days):"∞";const s=` • ${n} • ${i}`;return qn("div.gameInfos",[qn("span[data-icon=p]",a),s])}function bu(e){const t=` • Standard • ${gi.isConnected()?kt("rated"):kt("casual")}`;return qn("div.gameInfos",[qn("span[data-icon=p]",e.id),t])}function wu(e,t){var n;Vr.backbutton.stack.push(ku),hu=!0,co(),To(e)?(mu=n=e,lu=Po.createLobby("seekLobby",(()=>{hu&&gi.refresh().then((()=>{if(gi.isConnected())Eu("poolIn",n),clearInterval(cu),cu=setInterval((()=>{Eu("poolIn",n)}),1e4);else{const e=fr.find((e=>e.id===n.id));e&&Pu({mode:0,variant:1,timeMode:1,time:e.lim,increment:e.inc,days:1,color:"random"})}}))}),pu)):gi.refresh().then((()=>Pu(e,t)))}function yu(e){"backbutton"!==e&&hu&&Vr.backbutton.stack.pop(),hu=!1}function ku(e){yu(e),Tu(),Vr.reload(),lo()}function Pu(e,t){mu=e,fu&&Su(),lu=Po.createLobby("seekLobby",(()=>{hu&&(fu||(t?function(e,t){const n=gi.get(),r=n?or(n,t):null;Qn(`/setup/hook/${Zt()}/like/${e}?rr=${r||""}`,{method:"POST"},!0)}(t,e):cr(e).then((e=>{fu=e.hook.id})).catch(sn)))}),pu)}function Tu(){null!==mu&&(To(mu)?Cu(mu):fu&&Su())}function Cu(e){clearInterval(cu),Eu("poolOut",e.id)}function Su(){Eu("cancel",fu),fu=null}function Eu(e,t){lu&&lu.send(e,t)}const xu=o("Badge");let Ou=!0;function Mu(e,t,n,r,o,a){window.lichess.cpuArch=a,window.deviceInfo={platform:t.platform,uuid:n.uuid,appVersion:e.version,cpuCores:r,stockfishMaxMemory:16*Math.ceil(o/16)},"ios"===i.getPlatform()&&f.setAccessoryBarVisible({isVisible:!0}),Sn((()=>{Ni(),nr.load(t)})),c.addListener("appStateChange",(e=>{e.isActive?(Yr=!0,gi.refresh().then((()=>{"ios"===i.getPlatform()&&xu.setNumber({badge:gi.myTurnGames().length})})),Po.cancelDelayedDisconnect(),Po.connect(),Xt()):(Yr=!1,Po.delayedDisconnect(18e4),gu.appCancelSeeking())})),d.addListener("networkStatusChange",(e=>{e.connected?ju():Kr()&&!an()&&(Po.disconnect(),Xt())})),c.addListener("backButton",Vr.backbutton),window.addEventListener("resize",z(Nu),!1),an()?ju():gi.restoreStoredSession()}function Nu(){Ci=null,Ti=void 0,Xt()}function ju(){Kr()&&(Ou?(Ou=!1,function(){const e=window.deviceInfo.appVersion||"web-dev";Qn("/api/status",{query:{v:e}}).then((t=>{if(t.mustUpgrade){const t="warn_bug_"+e,n=Number(jn.get(t))||0;0===n?rr.alert({title:"Alert",message:"A new version of lichess mobile is available. Please upgrade as soon as possible."}).then((()=>{jn.set(t,1)})):10===n?jn.remove(t):jn.set(t,n+1)}else if(t.api.current>$t.apiVersion){const e=t.api.olds.find((e=>e.version===$t.apiVersion));if(e){const t=new Date,n=new Date(e.unsupportedAt),r=new Date(e.deprecatedAt),i="warn_old_"+e.version,o=Number(jn.get(i))||0;t>n?rr.alert({title:"Alert",message:kt("apiUnsupported")}):t>r&&(0===o?rr.alert({title:"Alert",message:kt("apiDeprecated",Et(n))}).then((()=>{jn.set(i,1)})):15===o?jn.remove(i):jn.set(i,o+1))}}}))}(),Lu(),gi.rememberLogin().then((()=>{Xr.register(),Or.refresh(),"ios"===i.getPlatform()&&xu.setNumber({badge:gi.myTurnGames().length}),Xt()})).catch((()=>{"ios"===i.getPlatform()&&xu.setNumber({badge:0})}))):(Po.connect(),gi.refresh()))}let _u=1;function Lu(){return pr().then(Xt).catch((()=>{_u<=5&&(_u++,setTimeout(Lu,1e3*_u))}))}const Du=o("Stockfish"),Iu=o("StockfishVariants",{web:()=>import("./StockfishVariantsWeb-55660726.js").then((e=>new e.StockfishVariantsWeb))});class Au{constructor(e){this.variant=e,this.plugin=!this.isVariant()&&Bu()&&ut.analyse.cevalUseNNUE()?Du:Iu}async start(){return new Promise((e=>{let t="Stockfish";const n=r=>{const i=r.output;i.startsWith("id name ")&&(t=i.substring("id name ".length)),i.startsWith("uciok")&&(window.removeEventListener("stockfish",n,!1),e({engineName:t}))};window.addEventListener("stockfish",n,{passive:!0}),this.plugin.start().then((()=>this.send("uci")))}))}isReady(){return new Promise((e=>{const t=n=>{n.output.startsWith("readyok")&&(window.removeEventListener("stockfish",t,!1),e())};window.addEventListener("stockfish",t,{passive:!0}),this.send("isready")}))}send(e){return this.plugin.cmd({cmd:e})}setOption(e,t){return this.send(`setoption name ${e} value ${t}`)}setVariant(){return this.isVariant()?"web"!==i.getPlatform()&&"threeCheck"===this.variant?this.setOption("UCI_Variant","3check"):"web"===i.getPlatform()&&"antichess"===this.variant?this.setOption("UCI_Variant","giveaway"):this.setOption("UCI_Variant",this.variant.toLowerCase()):this.setOption("UCI_Chess960","chess960"===this.variant)}exit(){return this.plugin.exit()}isVariant(){return!("standard"===this.variant||"fromPosition"===this.variant||"chess960"===this.variant)}}async function Ru(){return Promise.resolve(window.deviceInfo.stockfishMaxMemory)}function zu(){const e=window.deviceInfo.cpuCores;return e>2?e-1:1}function Bu(){return"android"===i.getPlatform()?"arm64-v8a"===window.lichess.cpuArch:"ios"===i.getPlatform()}var $u,Uu;!function(e){e.Documents="DOCUMENTS",e.Data="DATA",e.Cache="CACHE",e.External="EXTERNAL",e.ExternalStorage="EXTERNAL_STORAGE"}($u||($u={})),function(e){e.UTF8="utf8",e.ASCII="ascii",e.UTF16="utf16"}(Uu||(Uu={}));const qu=o("Filesystem",{web:()=>import("./web-26c3dcc4.js").then((e=>new e.FilesystemWeb))});var Fu,Hu;!function(e){e.Dark="DARK",e.Light="LIGHT",e.Default="DEFAULT"}(Fu||(Fu={})),function(e){e.None="NONE",e.Slide="SLIDE",e.Fade="FADE"}(Hu||(Hu={}));const Wu=o("StatusBar"),Gu="https://veloce.github.io/lichobile-themes";let Vu;function Yu(e){return"dark"!==e&&"light"!==e}function Ku(e,t){return qu.readFile({path:e+"-"+t,directory:$u.Data})}function Xu(e){return qu.readdir({path:"",directory:$u.Data}).then((({files:t})=>t.filter((t=>t.startsWith(e)))))}function Qu(e){return e.key+"."+e.ext}function Ju(e,t,n){const r=td(e,t);return Ku(e,r).catch((()=>function(e,t,n){return new Promise(((r,i)=>{const o=new XMLHttpRequest,a="bg"===e?"/background":"/board";o.open("GET",`${Gu}${a}/${t}`,!0),o.responseType="blob",n&&(o.onprogress=n),o.onload=()=>{if(200===o.status){const n=o.response;if(n){const i=new FileReader;i.readAsDataURL(n),i.onloadend=()=>{const n=i.result;qu.writeFile({path:e+"-"+t,data:n,directory:$u.Data}).then((()=>r()))}}else i("could not get file")}else i(`Request returned ${o.status}`)},o.send()}))}(e,r,n).then((()=>Ku(e,r))))).then((n=>{ed(e,t,r,n)}))}function Zu(e){B.show({text:"Cannot load theme file",duration:"short"})}function ed(e,t,n,{data:r}){Vu||(Vu=document.createElement("style"),Vu.type="text/css",document.head.appendChild(Vu));const i=r.replace(/\n/g,""),o=("png"===n.split(".").pop()?"data:image/png;base64,":"data:image/jpeg;base64,")+i,a="bg"===e?`.view-container.transp.${t} > main { background-image: url(${o}); }`:`:root { --board-background: url(${o}); }\n.board-${t} > .cg-board { background-image: var(--board-background); }\n.game_menu_button.${t}::before { background-image: var(--board-background); background-size: 40px; }`;Vu.appendChild(document.createTextNode(a))}function td(e,t){return Qu(("bg"===e?ut.general.theme.availableBackgroundThemes:ut.general.theme.availableBoardThemes).find((e=>e.key===t)))}function nd(e){return Promise.all(["android"===i.getPlatform()?Wu.setBackgroundColor({color:"light"===e?"#edebe9":"dark"===e?"#161512":"#000000"}):Promise.resolve(),Wu.setStyle({style:"light"===e?Fu.Light:Fu.Dark})]).then((()=>{}))}var rd={init(){(e=>{e.add("",(({params:e})=>{import("./home-258a874a.js").then((t=>{zr(t.default,e)}))})),e.add("timeline",(({params:e})=>{import("./timeline-8b6b0aef.js").then((t=>{zr(t.default,e)}))})),e.add("otb",(({params:e})=>{import("./otb-97eefdec.js").then((t=>{zr(t.default,e)}))})),e.add("otb/variant/:variant/fen/:fen",(({params:e})=>{import("./otb-97eefdec.js").then((t=>{zr(t.default,e)}))})),e.add("ai",(({params:e})=>{import("./ai-ab8dbdd4.js").then((t=>{zr(t.default,e)}))})),e.add("ai/variant/:variant/fen/:fen/color/:color",(({params:e})=>{import("./ai-ab8dbdd4.js").then((t=>{zr(t.default,e)}))})),e.add("game/:id",(({params:e})=>{import("./game-bf2f1629.js").then((t=>{zr(t.default,e)}))})),e.add("tournament/:tournamentId/game/:id",(({params:e})=>{import("./game-bf2f1629.js").then((t=>{zr(t.default,e)}))})),e.add("analyse/:source/:id/:color",(({params:e})=>{import("./analyse-8569285d.js").then((t=>{zr(t.default,e)}))})),e.add("analyse/:source/:id",(({params:e})=>{import("./analyse-8569285d.js").then((t=>{zr(t.default,e)}))})),e.add("analyse/fen/:fen",(({params:e})=>{import("./analyse-8569285d.js").then((t=>{zr(t.default,e)}))})),e.add("analyse/variant/:variant",(({params:e})=>{import("./analyse-8569285d.js").then((t=>{zr(t.default,e)}))})),e.add("analyse/variant/:variant/fen/:fen",(({params:e})=>{import("./analyse-8569285d.js").then((t=>{zr(t.default,e)}))})),e.add("analyse",(({params:e})=>{import("./analyse-8569285d.js").then((t=>{zr(t.default,e)}))})),e.add("importer",(({params:e})=>{import("./importer-d29bcbf5.js").then((t=>{zr(t.default,e)}))})),e.add("tv",(({params:e})=>{import("./tv-1227c205.js").then((t=>{zr(t.default,e)}))})),e.add("tv/:channel",(({params:e})=>{import("./tv-1227c205.js").then((t=>{zr(t.default,e)}))})),e.add("@/:id",(({params:e})=>{import("./user-4c4957c5.js").then((t=>{zr(t.default,e)}))})),e.add("@/:id/related",(({params:e})=>{import("./related-9f0c55c2.js").then((t=>{zr(t.default,e)}))})),e.add("@/:id/games",(({params:e})=>{import("./games-65f473ec.js").then((t=>{zr(t.default,e)}))})),e.add("@/:id/games/:filter",(({params:e})=>{import("./games-65f473ec.js").then((t=>{zr(t.default,e)}))})),e.add("@/:id/:perf/perf",(({params:e})=>{import("./perfStats-d652ed03.js").then((t=>{zr(t.default,e)}))})),e.add("@/:id/tv",(({params:e})=>{import("./userTv-6eb1fd30.js").then((t=>{zr(t.default,e)}))})),e.add("about",(({params:e})=>{import("./about-eb060deb.js").then((t=>{zr(t.default,e)}))})),e.add("account/preferences",(({params:e})=>{import("./preferences-1258e0e0.js").then((t=>{zr(t.default,e)}))})),e.add("account/preferences/game-display",(({params:e})=>{import("./gameDisplay-221cdc44.js").then((t=>{zr(t.default,e)}))})),e.add("account/preferences/game-behavior",(({params:e})=>{import("./gameBehavior-f854cd0b.js").then((t=>{zr(t.default,e)}))})),e.add("account/preferences/clock",(({params:e})=>{import("./clock-78daaee4.js").then((t=>{zr(t.default,e)}))})),e.add("account/preferences/privacy",(({params:e})=>{import("./privacy-11de36ee.js").then((t=>{zr(t.default,e)}))})),e.add("account/preferences/kidMode",(({params:e})=>{import("./kid-f7911382.js").then((t=>{zr(t.default,e)}))})),e.add("clock",(({params:e})=>{import("./clock-bf554d0f.js").then((t=>{zr(t.default,e)}))})),e.add("editor",(({params:e})=>{import("./editor-2cf6f616.js").then((t=>{zr(t.default,e)}))})),e.add("editor/:fen",(({params:e})=>{import("./editor-2cf6f616.js").then((t=>{zr(t.default,e)}))})),e.add("inbox",(({params:e})=>{import("./msg-3dfaf08b.js").then((t=>{zr(t.default,e)}))})),e.add("inbox/:id",(({params:e})=>{import("./msg-3dfaf08b.js").then((t=>{zr(t.default,e)}))})),e.add("inbox/new",(({params:e})=>{import("./msg-3dfaf08b.js").then((t=>{zr(t.default,e)}))})),e.add("inbox/new/:id",(({params:e})=>{import("./msg-3dfaf08b.js").then((t=>{zr(t.default,e)}))})),e.add("players",(({params:e})=>{import("./players-819ff46a.js").then((t=>{zr(t.default,e)}))})),e.add("search",(({params:e})=>{import("./search-d5ce27e8.js").then((t=>{zr(t.default,e)}))})),e.add("settings",(({params:e})=>{import("./settings-7f3b77f4.js").then((t=>{zr(t.default,e)}))})),e.add("settings/gameDisplay",(({params:e})=>{import("./gameDisplay-a8bd2f29.js").then((t=>{zr(t.default,e)}))})),e.add("settings/clock",(({params:e})=>{import("./clock-f75ec3ee.js").then((t=>{zr(t.default,e)}))})),e.add("settings/gameBehavior",(({params:e})=>{import("./gameBehavior-6008648f.js").then((t=>{zr(t.default,e)}))})),e.add("settings/soundNotifications",(({params:e})=>{import("./soundNotifications-664e3c7a.js").then((t=>{zr(t.default,e)}))})),e.add("settings/background",(({params:e})=>{import("./background-d605e5f7.js").then((t=>{zr(t.default,e)}))})),e.add("settings/themes/board",(({params:e})=>{import("./boardTheme-406ca5a2.js").then((t=>{zr(t.default,e)}))})),e.add("settings/themes/piece",(({params:e})=>{import("./pieceThemes-69eed4d4.js").then((t=>{zr(t.default,e)}))})),e.add("settings/lang",(({params:e})=>{import("./lang-fd4d728c.js").then((t=>{zr(t.default,e)}))})),e.add("teams",(({params:e})=>{import("./teamsList-143c3e69.js").then((t=>{zr(t.default,e)}))})),e.add("teams/:id",(({params:e})=>{import("./teamDetail-7b52255d.js").then((t=>{zr(t.default,e)}))})),e.add("training",(({params:e})=>{import("./training-f3a4f1dc.js").then((t=>{zr(t.default,e)}))})),e.add("training/:id",(({params:e})=>{import("./training-f3a4f1dc.js").then((t=>{zr(t.default,e)}))})),e.add("tournament",(({params:e})=>{import("./tournamentList-27a5455e.js").then((t=>{zr(t.default,e)}))})),e.add("tournament/:id",(({params:e})=>{import("./tournamentDetail-e17c384e.js").then((t=>{zr(t.default,e)}))})),e.add("study",(({params:e})=>{import("./studyIndex-5ec58e40.js").then((t=>{zr(t.default,e)}))})),e.add("study/:id",(({params:e})=>{import("./study-64df8ae0.js").then((t=>{zr(t.default,e)}))})),e.add("study/:id/chapter/:chapterId",(({params:e})=>{import("./study-64df8ae0.js").then((t=>{zr(t.default,e)}))})),e.add("coord",(({params:e})=>{import("./coordinates-553cfde7.js").then((t=>{zr(t.default,e)}))}))})(Lr),window.addEventListener("popstate",Br)}};let id=!1,od=!1,ad=null;var sd={open:function(){Vr.backbutton.stack.push(Di(ud,"loginModal")),id=!0,od=!1,ad=null},close:ud,view:()=>id?qn("div.modal#loginModal",{oncreate:Li},[qn("header",[qn("button.modal_close",{oncreate:$i(Di(ud,"loginModal"))},Hl),qn("h2",kt("signIn"))]),qn("div.modal_content",[qn("form.defaultForm.login",{onsubmit:cd},[ad&&!ld(ad)?qn("div.form-error",ad):null,"InvalidTotpToken"===ad?qn("div.form-error",kt("invalidAuthenticationCode")):null,qn("div.field",[qn("input#username",{type:ld(ad)?"hidden":"text",className:ad?"form-error":"",placeholder:kt("username"),autocomplete:"off",autocapitalize:"off",autocorrect:"off",spellcheck:!1,required:!0})]),qn("div.field",[qn("input#password",{type:ld(ad)?"hidden":"password",className:ad?"form-error":"",placeholder:kt("password"),required:!0})]),ld(ad)?[qn("div.field",[qn("input#token[type=number]",{className:"MissingTotpToken"!==ad?"form-error":"",placeholder:kt("authenticationCode"),pattern:"\\d{6}",required:!0})]),qn("p.twofactorhelp",[qn("i.fa.fa-mobile-phone"),qn.trust("&nbsp"),"Open the two-factor authentication app on your device to view your authentication code and verify your identity."])]:null,qn("div.submit",[qn("button.defaultButton",{disabled:od},kt("signIn"))])]),qn("div.loginActions",[qn("a",{oncreate:$i(pd.open)},[kt("signUp")]),qn("a",{href:"https://lichess.org/password/reset"},[kt("passwordReset")])])])]):null};function cd(e){if(od)return!1;e.preventDefault();const t=e.target,n=t.username.value.trim(),r=t.password.value,i=t.token?t.token.value:null;n&&r&&(Xt(),f.hide(),od=!0,gi.login(n,r,i).then((()=>{od=!1,ud(),Ht.afterLogin.dispatch(),Xt(),Po.reconnectCurrent(),Xr.register(),Or.refresh(),gi.refresh()})).catch((e=>{od=!1,e.body.ipban?ud():400!==e.status&&401!==e.status?sn(e):e.body.global&&(ad=e.body.global[0],Xt())})))}function ld(e){return"MissingTotpToken"===e||"InvalidTotpToken"===e}function ud(e){f.hide(),"backbutton"!==e&&id&&Vr.backbutton.stack.pop(),id=!1}let dd=!1,hd=!1,md=!1,fd=null;var pd={open:function(){Vr.backbutton.stack.push(Di(yd,"signupModal")),fd=null,dd=!0,hd=!1},close:yd,view:()=>dd?qn("div.modal#signupModal",{oncreate:Li},[qn("header",[qn("button.modal_close",{oncreate:$i(Di(yd,"signupModal"))},Hl),qn("h2",kt("signUp"))]),qn("div#signupModalContent.modal_content",{},md?[qn("h1.signup-emailCheck.withIcon[data-icon=E]",kt("checkYourEmail")),qn("p",kt("weHaveSentYouAnEmailClickTheLink")),qn("p",kt("ifYouDoNotSeeTheEmailCheckOtherPlaces")),qn("p","Not receiving it? Visit https://lichess.org/contact to request a manual confirmation.")]:[qn("p.signupWarning.withIcon[data-icon=!]",[kt("computersAreNotAllowedToPlay")]),qn("p.tosWarning",["By registering, you agree to be bound by our ",qn("a",{oncreate:$i((()=>window.open("https://lichess.org/terms-of-service","_blank")))},"Terms of Service"),"."]),qn("form.defaultForm.login",{onsubmit:wd},[qn("div.field",[fd&&fd.username?qn("div.form-error",fd.username[0]):null,qn("input#pseudo[type=text]",{className:fd&&fd.username?"form-error":"",placeholder:kt("username"),autocomplete:"off",autocapitalize:"off",autocorrect:"off",spellcheck:!1,required:!0,onfocus:bd,oninput:z(gd,500)})]),qn("div.field",[fd&&fd.email?qn("div.form-error",fd.email[0]):null,qn("input#email[type=email]",{onfocus:bd,className:fd&&fd.email?"form-error":"",placeholder:kt("email"),autocapitalize:"off",autocorrect:"off",spellcheck:!1,required:!0})]),qn("div.field",[fd&&fd.password?qn("div.form-error",fd.password[0]):null,qn("input#password[type=password]",{onfocus:bd,className:fd&&fd.password?"form-error":"",placeholder:kt("password"),required:!0})]),qn("div.submit",[qn("button.defaultButton",{disabled:hd},kt("signUp"))])])])]):null};function gd(e){const t=e.target.value.trim();var n;t&&t.match(/^[a-z0-9][\w-]{2,29}$/i)?(n=t,Qn("/player/autocomplete?exists=1",{query:{term:n}})).then((e=>{vd(e)})):vd(!1)}function vd(e){fd=e?{username:["This username is already in use, please try another one."]}:null,Xt()}function bd(e){setTimeout((()=>{e.target.scrollIntoView(!0)}),300)}function wd(e){e.preventDefault();const t=e.target,n=t[0].value.trim(),r=t[1].value.trim(),i=t[2].value;!hd&&n&&r&&i&&(f.hide(),hd=!0,fd=null,Xt(),gi.signup(n,r,i).then((e=>{hd=!1,e&&function(e){return void 0!==e.email_confirm}(e)?(md=!0,Xt()):(Po.reconnectCurrent(),Xt(),sd.close(),yd())})).catch((e=>{hd=!1,void 0!==e.body.error?(fd=e.body.error,Xt()):sn(e)})))}function yd(e){!0===md&&sd.close(),f.hide(),"backbutton"!==e&&dd&&Vr.backbutton.stack.pop(),dd=!1}const kd=":r1/:r2/:r3/:r4/:r5/:r6/:r7/:r8";function Pd(e){return e.r1+"/"+e.r2+"/"+e.r3+"/"+e.r4+"/"+e.r5+"/"+e.r6+"/"+e.r7+"/"+e.r8.split("_").join(" ")}var Td={init(){c.addListener("appUrlOpen",(({url:e})=>{setTimeout((()=>{const t=new URL(e),n=t.pathname;if(!Cd.run(n)){const e=n.match(Sd);if(e){const n=e[2],r=t.hash.match(Ed),i={};n&&(i.color=n.substring(1)),r&&(i.ply=r[1]);const o=Gn(i);Vr.set(`/game/${e[1]}?${o}`)}}}),100)}))}};const Cd=new Mr,Sd=/^\/(\w{8})(\/black|\/white)?$/,Ed=/^#(\d+)$/;Cd.add("analysis",(()=>Vr.set("/analyse"))),Cd.add(`analysis/${kd}`,(({params:e})=>{const t=encodeURIComponent(Pd(e));Vr.set(`/analyse/fen/${t}`)})),Cd.add("editor",(()=>Vr.set("/editor"))),Cd.add(`editor/${kd}`,(({params:e})=>{const t=encodeURIComponent(Pd(e));Vr.set(`/editor/${t}`)})),Cd.add("inbox",(()=>Vr.set("/inbox"))),Cd.add("inbox/new",(()=>Vr.set("/inbox/new"))),Cd.add("challenge/:id",(({params:e})=>Vr.set(`/game/${e.id}`))),Cd.add("study",(()=>Vr.set("/study"))),Cd.add("study/:id",(({params:e})=>Vr.set(`/study/${e.id}`))),Cd.add("player",(()=>Vr.set("/players"))),Cd.add("tournament",(()=>Vr.set("/tournament"))),Cd.add("tournament/:id",(({params:e})=>Vr.set(`/tournament/${e.id}`))),Cd.add("training",(()=>Vr.set("/training"))),Cd.add("training/:id",(({params:e})=>Vr.set(`/training/${e.id}`))),Cd.add("tv",(()=>Vr.set("/tv"))),Cd.add("tv/:channel",(({params:e})=>Vr.set(`/tv/${e.channel}`))),Cd.add("@/:id",(({params:e})=>Vr.set(`/@/${e.id}`))),Cd.add("@/:id/tv",(({params:e})=>Vr.set(`/@/${e.id}/tv`))),Cd.add("@/:id/all",(({params:e})=>Vr.set(`/@/${e.id}/games`))),Cd.add("@/:id/perf/:key",(({params:e})=>Vr.set(`/@/${e.id}/${e.key}/perf`))),Cd.add("signup/confirm/:token",(({params:e})=>{const t=e.token;t&&gi.confirmEmail(t).then((e=>{pd.close(),Vr.set(`/@/${e.id}`)})).catch(sn)}));const xd=o("CPUInfo");(async function(){await Qe.migrate();const e=await Qe.get("settings");Object.assign(lt,e)})().then((()=>Promise.all([c.getInfo().catch((()=>({version:$t.packageVersion}))),l.getInfo(),l.getId(),"ios"===i.getPlatform()?xd.nbCores().then((e=>e.value)).catch((()=>1)):Promise.resolve(navigator.hardwareConcurrency||1),Iu.getMaxMemory().then((e=>e.value)).catch((()=>16)),Iu.getCPUArch().then((e=>e.value)).catch((()=>"x86"))]))).then((([e,t,n,r,i,o])=>Mu(e,t,n,r,i,o))).then((()=>{rd.init(),Td.init(),Xr.init()})).then((function(){const e=ut.general.theme.background(),t=ut.general.theme.board();if(nd(e),Yu(e)){const t=td("bg",e);Ku("bg",t).then((n=>{ed("bg",e,t,n)})).catch((()=>{ut.general.theme.background("dark")}))}if(!ut.general.theme.bundledBoardThemes.includes(t)){const e=td("board",t);Ku("board",e).then((n=>{ed("board",t,e,n)})).catch((()=>{ut.general.theme.board("brown")}))}})).then((async function(){const e=import("./i18n/en-GB.js").then((({default:e})=>{Object.assign(ht,e)})),t=ut.general.locale();return t&&void 0!==At[t]?e.then((()=>Dt(t))):e.then((()=>l.getLanguageCode())).then((({value:e})=>Dt(_t(e)||"en-GB")))})).then((()=>Br())).then((()=>{setTimeout((()=>{u.hide()}),500)}));export{Jo as $,c as A,dn as B,$i as C,Hn as D,to as E,Tn as F,_i as G,nu as H,i as I,Uo as J,Ni as K,qo as L,Fo as M,d as N,zo as O,$o as P,Xo as Q,Vo as R,Fi as S,cn as T,Go as U,Jr as V,s as W,Zo as X,sd as Y,vi as Z,Qo as _,Ht as a,hn as a$,Ko as a0,Yo as a1,B as a2,uc as a3,Bl as a4,Ec as a5,sr as a6,sn as a7,Sc as a8,Tl as a9,ha as aA,mn as aB,Qs as aC,Vi as aD,Qi as aE,co as aF,lo as aG,tu as aH,ca as aI,So as aJ,su as aK,Pt as aL,Pn as aM,Kl as aN,Vl as aO,eu as aP,Zi as aQ,la as aR,ru as aS,iu as aT,xa as aU,Ea as aV,gn as aW,xn as aX,Gs as aY,nc as aZ,Ui as a_,Ol as aa,ac as ab,rt as ac,Bo as ad,ri as ae,Hl as af,En as ag,Wi as ah,ta as ai,pd as aj,gu as ak,Yl as al,Qe as am,bn as an,eo as ao,Mi as ap,Oi as aq,ua as ar,yn as as,wn as at,fn as au,vn as av,o as aw,$t as ax,nr as ay,ga as az,gi as b,xt as b$,ho as b0,Di as b1,f as b2,Sn as b3,Li as b4,ia as b5,Jn as b6,Yn as b7,Bs as b8,$s as b9,fa as bA,rn as bB,nn as bC,Bu as bD,Yc as bE,sl as bF,ul as bG,al as bH,Jc as bI,ol as bJ,Fc as bK,Hc as bL,dl as bM,yr as bN,Ze as bO,Na as bP,I as bQ,jr as bR,p as bS,Gi as bT,Ks as bU,Zt as bV,Ho as bW,rc as bX,Ys as bY,va as bZ,pa as b_,Vt as ba,Au as bb,zu as bc,Ru as bd,Js as be,Zs as bf,ec as bg,pn as bh,mr as bi,Or as bj,hr as bk,dr as bl,ur as bm,vr as bn,xi as bo,Ei as bp,aa as bq,au as br,jn as bs,rr as bt,Xs as bu,tc as bv,Pr as bw,br as bx,xu as by,ma as bz,Mt as c,ic as c0,Wc as c1,rl as c2,Vc as c3,Zc as c4,Bc as c5,il as c6,hl as c7,tl as c8,nl as c9,Ju as cA,Zu as cB,nd as cC,Xu as cD,Qu as cE,Ql as cF,At as cG,_t as cH,Rt as cI,kr as cJ,Dt as cK,Lt as cL,Cn as cM,a as cN,no as cO,Ii as cP,Ai as cQ,ou as cR,kn as cS,Wl as cT,Gl as cU,On as cV,Hi as ca,Et as cb,Ot as cc,ji as cd,fs as ce,sa as cf,Wu as cg,Bi as ch,ml as ci,fl as cj,tn as ck,kl as cl,Eo as cm,xo as cn,Oo as co,Mo as cp,_o as cq,No as cr,jo as cs,Lo as ct,ro as cu,Fl as cv,Ji as cw,io as cx,Xr as cy,Yu as cz,z as d,gr as e,Qn as f,ut as g,Mn as h,Kr as i,wr as j,an as k,pr as l,qn as m,ln as n,qi as o,jc as p,kt as q,Xt as r,Po as s,Tr as t,Rl as u,Nt as v,Vr as w,St as x,Ac as y,Tt as z};
