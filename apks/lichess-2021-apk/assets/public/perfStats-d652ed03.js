import{K as t,m as a,q as s,o as r,w as e,ca as n,aD as l,cd as i,ag as o,s as c,D as u,r as d,a7 as f,aH as p,al as v,B as g}from"./main.js";import{l as h}from"./layout-c7d0a2f4.js";import{s as m}from"./perfs-2bc54d35.js";import{e as P,m as k,f as w,t as b,g as M,h as S,i as x,j as y,k as D,n as I,o as j,q as R,r as H,u as G,v as _,w as A,s as B,b as F,l as L,d as q,z as O}from"./axis-5bab4d8c.js";import{u as T,v as W}from"./userXhr-6849aa54.js";function X(t){return new Date(t)}function Y(t){return t instanceof Date?+t:+new Date(+t)}function z(t,a,s,r,e,n,l,i,o){var c=P(G,H),u=c.invert,d=c.domain,f=o(".%L"),p=o(":%S"),v=o("%I:%M"),g=o("%I %p"),h=o("%a %d"),m=o("%b %d"),b=o("%B"),M=o("%Y"),S=[[l,1,1e3],[l,5,5e3],[l,15,15e3],[l,30,3e4],[n,1,6e4],[n,5,3e5],[n,15,9e5],[n,30,18e5],[e,1,36e5],[e,3,108e5],[e,6,216e5],[e,12,432e5],[r,1,864e5],[r,2,1728e5],[s,1,6048e5],[a,1,2592e6],[a,3,7776e6],[t,1,31536e6]];function x(i){return(l(i)<i?f:n(i)<i?p:e(i)<i?v:r(i)<i?g:a(i)<i?s(i)<i?h:m:t(i)<i?b:M)(i)}function y(a,s,r,e){if(null==a&&(a=10),"number"==typeof a){var n=Math.abs(r-s)/a,l=_((function(t){return t[2]})).right(S,n);l===S.length?(e=A(s/31536e6,r/31536e6,a),a=t):l?(e=(l=S[n/S[l-1][2]<S[l][2]/n?l-1:l])[1],a=l[0]):(e=A(s,r,a),a=i)}return null==e?a:a.every(e)}return c.invert=function(t){return new Date(u(t))},c.domain=function(t){return arguments.length?d(k.call(t,Y)):d().map(X)},c.ticks=function(t,a){var s,r=d(),e=r[0],n=r[r.length-1],l=n<e;return l&&(s=e,e=n,n=s),s=(s=y(t,e,n,a))?s.range(e,n+1):[],l?s.reverse():s},c.tickFormat=function(t,a){return null==a?x:o(a)},c.nice=function(t,a){var s=d();return(t=y(t,s[0],s[s.length-1],a))?d(function(t,a){var s,r=0,e=(t=t.slice()).length-1,n=t[r],l=t[e];return l<n&&(s=r,r=e,e=s,s=n,n=l,l=s),t[r]=a.floor(n),t[e]=a.ceil(l),t}(s,t)):c},c.copy=function(){return w(c,z(t,a,s,r,e,n,l,i,o))},c}function E(){return z(R,j,I,D,y,x,S,M,b).domain([new Date(2e3,0,1),new Date(2e3,0,2)])}function K(i){var o;const c=i.perfData();if(!c)return null;const u=Math.floor(c.stat.count.seconds/86400),d=Math.floor(c.stat.count.seconds/3600)-24*u,f=Math.floor(c.stat.count.seconds/60)-24*u*60-60*d,p=Date.now()-94608e6,v=0===c.graph.length?null:function(t){const a=t.slice(),s=t.slice().reverse(),r=a[0].date,e=a[a.length-1].date,n=[];for(let t=new Date(r);t<=e;t.setDate(t.getDate()+1))n.push(new Date(t));const l=[];return n.forEach((t=>{const a=s.find((a=>a.date<=t));a&&l.push({date:t,rating:a.rating})})),l}(c.graph.map(C).filter((t=>t.date.getTime()>p))),{vw:g}=t();return a("div",{class:"variantPerfBody native_scroller page"},v&&v.length>=3?a("div",null,a("svg",{width:g-20,height:"230",id:"variantPerf-graph",className:"variantPerf-graph",oncreate:({dom:t})=>function(t,a){setTimeout((()=>function(t,a){if(a){const r=B(a),e={top:0,right:20,bottom:40,left:30},n=+r.attr("width")-e.left-e.right,l=+r.attr("height")-e.top-e.bottom,i=r.append("g").attr("transform","translate("+e.left+","+e.top+")"),o=E().domain([t[0].date,t[t.length-1].date]).rangeRound([0,n]),c=t.map((t=>t.rating)),u=F().domain([Math.min.apply(null,c)-50,Math.max.apply(null,c)+50]).rangeRound([l,0]),d=L().x((t=>o(t.date))).y((t=>u(t.rating))),f=q(u).tickFormat((t=>String(t))),p=O(o).tickFormat(V);i.append("g").attr("transform","translate(0,"+l+")").call(p).selectAll("text").attr("y",0).attr("x",9).attr("dy",".35em").attr("transform","rotate(60)").style("text-anchor","start").select(".domain").remove(),i.append("g").call(f).append("text").attr("class","legend").attr("transform","rotate(-90)").attr("y",6).attr("dy","0.71em").attr("text-anchor","end").text(s("rating")),i.append("path").attr("class","path").attr("fill","none").attr("stroke","blue").attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("stroke-width",1.5).attr("d",d(t))}}(t,a)),500)}(v,t),key:(l(),"portrait")})):null,a("table",{class:"variantPerf"},a("tbody",null,a("tr",null,a("th",{class:"variantPerfHeading",colspan:"3"}," ",s("yourRating")," ")),a("tr",null,a("th",{class:"variantPerf"}," ",s("rating")," "),a("td",{class:"variantPerf"}," ",c.perf.glicko.rating+(c.perf.glicko.provisional?"?":"")," "),a("td",null," ")),a("tr",{class:N(c.perf.progress)},a("th",{class:"variantPerf"}," ",s("progressOverLastXGames","12").split(":")[0]," "),a("td",{class:"variantPerf"}," ",n(c.perf.progress)," "),a("td",null," ")),a("tr",{class:N(c.rank)},a("th",{class:"variantPerf"}," ",s("rank")," "),a("td",{class:"variantPerf"}," ",null===c.rank?"":c.rank," "),a("td",null," ")),a("tr",{class:N(c.percentile)},a("th",{class:"variantPerf"}," Percentile "),a("td",{class:"variantPerf"}," ",null===c.percentile?"":c.percentile+"%"," "),a("td",null," ")),a("tr",null," ",a("td",{class:"variantPerfSpacer",colspan:"3"}," ")," "),a("tr",null,a("th",{class:"variantPerfHeading",colspan:"3"},s("ratingStats"))),a("tr",null,a("th",{class:"variantPerf"}," ",s("averageOpponent")," "),a("td",{class:"variantPerf"}," ",c.stat.count.opAvg," "),a("td",null," ")),a("tr",{class:N(c.stat.highest)},a("th",{class:"variantPerf"}," ",s("highestRating",0).split(":")[0]," "),a("td",{class:"variantPerf"}," ",a("span",{class:"progress positive"}," ",c.stat.highest?c.stat.highest.int:""," ")," "),a("td",{class:"variantPerf"}," ",a("span",{class:"progress positive"}," ",c.stat.highest?c.stat.highest.at.substring(0,10):""," ")," ")),a("tr",{class:N(c.stat.lowest)},a("th",{class:"variantPerf"}," ",s("lowestRating",0).split(":")[0]," "),a("td",{class:"variantPerf"}," ",a("span",{class:"progress positive"}," ",c.stat.lowest?c.stat.lowest.int:""," ")," "),a("td",{class:"variantPerf"}," ",a("span",{class:"progress positive"}," ",c.stat.lowest?c.stat.lowest.at.substring(0,10):""," ")," ")),a("tr",null,a("th",{class:"variantPerf"}," ",s("timeSpentPlaying",0).split(":")[0]," "),a("td",{class:"variantPerf",colspan:"2"}," ",(u>0?u+"d, ":"")+d+"h, "+f+"m"," ")),a("tr",null," ",a("td",{class:"variantPerfSpacer",colspan:"3"}," ")," "),a("tr",null,a("th",{class:"variantPerfHeading",colspan:"3"}," ",s("games")," ")),a("tr",null,a("th",{class:"variantPerf"}," ",s("wins")," "),a("td",{class:"variantPerf"}," ",a("span",{class:"progress positive"}," ",c.stat.count.win," ")," "),a("td",{class:"variantPerf"}," ",a("span",{class:"progress positive"}," ",Math.round(c.stat.count.win/c.stat.count.all*100)+"%"," ")," ")),a("tr",null,a("th",{class:"variantPerf"}," ",s("draws")," "),a("td",{class:"variantPerf"}," ",c.stat.count.draw," "),a("td",{class:"variantPerf"}," ",Math.round(c.stat.count.draw/c.stat.count.all*100)+"%"," ")),a("tr",null,a("th",{class:"variantPerf"}," ",s("losses")," "),a("td",{class:"variantPerf sumLine"}," ",a("span",{class:"progress negative"}," ",c.stat.count.loss," ")," "),a("td",{class:"variantPerf"}," ",a("span",{class:"progress negative"}," ",Math.round(c.stat.count.loss/c.stat.count.all*100)+"%"," ")," ")),a("tr",null,a("th",{class:"variantPerf"}," ",s("totalGames")," "),a("td",{class:"variantPerf"}," ",c.stat.count.all," "),a("td",null," ")),a("tr",null,a("th",{class:"variantPerfMemo"}," ",s("rated")," "),a("td",{class:"variantPerfMemo"}," ",c.stat.count.rated," "),a("td",{class:"variantPerfMemo"}," ",Math.round(c.stat.count.rated/c.stat.count.all*100)+"%"," ")),a("tr",null,a("th",{class:"variantPerfMemo"}," ",s("tournament")," "),a("td",{class:"variantPerfMemo"}," ",c.stat.count.tour," "),a("td",{class:"variantPerfMemo"}," ",Math.round(c.stat.count.tour/c.stat.count.all*100)+"%"," ")),a("tr",null,a("th",{class:"variantPerfMemo"}," ",s("berserkedGames")," "),a("td",{class:"variantPerfMemo"}," ",c.stat.count.berserk," "),a("td",{class:"variantPerfMemo"}," ",Math.round(c.stat.count.berserk/c.stat.count.all*100)+"%"," ")),a("tr",null,a("th",{class:"variantPerfMemo"}," ",s("disconnections")," "),a("td",{class:"variantPerfMemo"}," ",c.stat.count.disconnects," "),a("td",{class:"variantPerfMemo"}," ",Math.round(c.stat.count.disconnects/c.stat.count.all*100)+"%"," ")),a("tr",null," ",a("td",{class:"variantPerfSpacer",colspan:"3"}," ")," "),a("tr",null,a("th",{class:"variantPerfHeading",colspan:"3"}," Streaks ")),a("tr",{class:N(c.stat.playStreak)},a("th",{class:"variantPerf"}," ",s("gamesInARow")," "),a("td",{class:"variantPerf"}," ",c.stat.playStreak.nb.max.v," "),a("td",{class:"variantPerf"}," ",(null===(o=c.stat.playStreak.nb.max.from)||void 0===o?void 0:o.at)&&c.stat.playStreak.nb.max.from.at.substring(0,10)," ")),a("tr",{class:N(c.stat.resultStreak.win.max.v)},a("th",{class:"variantPerf"}," ",s("winningStreak")," "),a("td",{class:"variantPerf"}," ",a("span",{class:"progress positive"}," ",c.stat.resultStreak.win.max.v?c.stat.resultStreak.win.max.v:""," ")," "),a("td",{class:"variantPerf"}," ",a("span",{class:"progress positive"}," ",c.stat.resultStreak.win.max.to?c.stat.resultStreak.win.max.to.at.substring(0,10):""," ")," ")),a("tr",{class:N(c.stat.resultStreak.loss.max.v)},a("th",{class:"variantPerf"}," ",s("losingStreak")),a("td",{class:"variantPerf"}," ",a("span",{class:"progress negative"}," ",c.stat.resultStreak.loss.max.v?c.stat.resultStreak.loss.max.v:""," ")," "),a("td",{class:"variantPerf"}," ",a("span",{class:"progress negative"}," ",c.stat.resultStreak.loss.max.to?c.stat.resultStreak.loss.max.to.at.substring(0,10):""," ")," ")),a("tr",null," ",a("td",{class:"variantPerfSpacer",colspan:"3"}," ")," "))),a("div",{class:"variantPerfGames noPadding "+N(c.stat.bestWins.results.length)},a("div",{class:"variantPerfHeading"}," ",s("bestRated")," "),c.stat.bestWins.results.map((t=>function(t){const s=(null===t.opId.title?"":t.opId.title)+" "+t.opId.name,n=t.at.substring(0,10),l=t.gameId;return a("div",{class:"list_item nav",oncreate:r((()=>e.set("/analyse/online/"+l)))},s," (",n,")")}(t)))))}function N(t){return t?"":"empty"}function C(t){return{date:new Date(t[0],t[1],t[2]),rating:t[3]}}const J=b("%b %d"),Q=b("%b"),U=b("%Y");function V(t){return(j(t)<t?J:R(t)<t?Q:U)(t)}var Z={oncreate:i,oninit(t){const a=t.attrs.id,s=t.attrs.perf;this.user=o(null),this.perfData=o(null),c.createDefault(),u.spin(),Promise.all([T(a,!1),W(a,s)]).then((t=>{u.stop();const[a,s]=t;this.user(a),this.perfData(s),d()})).catch((t=>{u.stop(),f(t)}))},view(t){const r=t.attrs.id,e=t.attrs.perf,n=p(null,v(a("div.main_header_title",[a("span.withIcon",{"data-icon":g(e)}),r+" "+s("perfStats",m(e))])));return h.free(n,K(this))}};export default Z;
