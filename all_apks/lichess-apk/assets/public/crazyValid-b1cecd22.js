import{a5 as a,m as e,D as t,b as n,aQ as o,C as r,w as s,q as i,aO as c,an as l,B as d,aC as u,ah as p,r as m,k as f,al as b,z as h,a7 as v,aR as g,ar as y,g as k,aS as w,o as N,aT as _,aJ as T,s as O,K as C,ab as D,aK as A,am as B,aU as M,aV as j,aW as S,aX as P,a2 as U,n as L,aY as G,aZ as x,a_ as R,a$ as V,b0 as $}from"./main.js";import{l as I}from"./layout-e08f9316.js";import{a as E}from"./perfs-9aa7202a.js";import{c as z}from"./countries-a19495bf.js";import{e as F}from"./fen-f2d95e2d.js";import{C as Z}from"./CountdownTimer-b4d0f21b.js";import{w as H}from"./tournamentXhr-acdac63d.js";import{a as W,r as K,f as q,u as Q,b as X,g as Y,m as J,c as aa,p as ea,d as ta,e as na,i as oa,h as ra,t as sa,j as ia,k as ca}from"./game-0dbfee7c.js";import{G as la}from"./GameTitle-217d24e1.js";import{B as da}from"./Board-0a9e6a9d.js";import{p as ua}from"./promotion-0e7cb1ce.js";import{S as pa}from"./index-c282ab51.js";import{g as ma,t as fa,n as ba,C as ha}from"./toInteger-d296e300.js";import{c as va}from"./chat-e47e82a7.js";var ga={view({attrs:p}){const{player:m,mini:f,isOpen:b,close:h,opponent:v,score:g}=p;return m.user?a("miniUserInfos",void 0,(()=>function(a,p,m,f){const b=p.user;if(!a||!b)return e("div",{className:"miniUser"},t.getVdom());const h=n.getUserId()===b.id,v=m.user,g=o(b),y=n.get(),k=y&&y.id,w=k&&a.crosstable&&a.crosstable.nbGames>0;return e("div",{className:"miniUser"},e("div",{className:"title"},e("div",{className:"username",oncreate:r((()=>s.set(`/@/${b.username}`)))},g),b.profile&&b.profile.country?e("p",{className:"country"},e("img",{className:"flag",src:u("images/flags/"+b.profile.country+".png")}),z[b.profile.country]):null),b.tosViolation?e("div",{className:"warning"},b.tosViolation?i("thisAccountViolatedTos"):""):null,a.perfs?e("div",{className:"mini_perfs"},Object.keys(a.perfs).map((t=>{const n=a.perfs[t];return e("div",{className:"perf"},e("span",{"data-icon":d(t)}),n.games>0?n.rating+(n.prov?"?":""):"-")}))):null,void 0!==k&&w?e("div",{className:"score_wrapper"},l("yourScore",e("span",{className:"score"},`${a.crosstable.users[k]} - ${a.crosstable.users[b.id]}`))):null,!w&&v&&f&&f.nbGames>0?e("div",{className:"score_wrapper"},"Lifetime score ",e("em",null,"vs")," ",c(m),":",e("br",null),e("span",{className:"score"},f.users[b.id])," - ",e("span",{className:"score"},f.users[v.id])):null,h?null:e("div",{className:"mini_user_actions_wrapper"},e("button",{"data-icon":"1",oncreate:r((()=>{s.set(`/@/${b.id}/tv`)}))},i("watchGames"))))}(f,m,v,g)),b,h):null}};var ya={oninit({attrs:a}){const{ctrl:e,color:t}=a;this.clockOnCreate=({dom:a})=>{e.elements[t]=a,e.updateElement(t,e.millisOf(t))},this.clockOnUpdate=({dom:a})=>{e.elements[t]=a,e.updateElement(t,e.millisOf(t))}},view({attrs:a}){const{ctrl:t,color:n,isBerserk:o}=a,r=t.millisOf(n),s=n===t.times.activeColor,i=p({clock:!0,outoftime:!r,running:s,berserk:o});return e("div",{className:i,oncreate:this.clockOnCreate,onupdate:this.clockOnUpdate},ka(r,!1))}};function ka(a,e,t=!1){const n=new Date(a),o=n.getUTCMilliseconds(),r=wa(n.getUTCMinutes()),s=wa(n.getUTCSeconds());if(a>=36e5){return wa(n.getUTCHours())+(t&&o<500?" ":":")+r}if(e){let e=Math.floor(o/100).toString();return!t&&a<1e3&&(e+="<huns>"+Math.floor(o/10)%10+"</huns>"),r+":"+s+"<tenths>."+e+"</tenths>"}return r+":"+s}function wa(a){return(a<10?"0":"")+a}function Na(a){a.promoting&&a.reloadGameData(),a.promoting=null}var _a={start:function(a,e,t,n){const o=a.chessground.state.pieces.get(t);return!(!o||"pawn"!==o.role||!("8"===t[1]&&"white"===a.player()||"1"===t[1]&&"black"===a.player()))&&(!(3===a.data.pref.autoQueen||2===a.data.pref.autoQueen&&n)&&(a.promoting={orig:e,dest:t,callback:(e,t,n)=>a.sendMove(e,t,n)},m(),!0))},view:a=>ua.view(a,Na)},Ta={standard:(a,t,n,o,s,c)=>t(a.data)&&f()?e("button",{className:s,"data-icon":n,oncreate:r(c||(()=>{a.socket.iface.send(s)}))},i(o)):null,bookmark:a=>n.isConnected()?e("button",{oncreate:r(a.toggleBookmark),"data-icon":a.data.bookmarked?"t":"s"},[i("bookmarkThisGame")]):null,toggleZen:a=>a.zenAvailable()?e("button",{className:a.isZen()?"on":"",oncreate:r(a.toggleZenMode)},[e("span.fa.fa-volume-off"),i("zenMode")]):null,shareLink:a=>e("button",{oncreate:r((()=>{const e=a.chessground.state.orientation;pa.share({url:`${W(a.data)}/${e}#${a.vm.ply}`})}))},[i("shareGameUrl")]),sharePGN:a=>e("button",{oncreate:r((function(){ma(a.data.game.id).catch((a=>{throw v(a),a})).then((a=>pa.share({text:a})))}))},i("sharePgn")),submitMove:a=>e("div.negotiationButtonsWrapper",[e("p",i("moveConfirmation")),e("div.negotiationButtons",{className:a.vm.submitFeedback?"loading":""},[e("button.accept",{"data-icon":a.vm.submitFeedback?null:"E",oncreate:r((()=>a.submitMove(!0)))},a.vm.submitFeedback?t.getVdom("monochrome white"):null),e("button.decline",{"data-icon":"L",oncreate:r((()=>a.submitMove(!1)))})])]),resign:a=>K(a.data)&&!a.vm.confirmResign?e("button",{className:"resign","data-icon":"b",oncreate:r((()=>{a.vm.confirmResign=!0}))},i("resign")):null,resignConfirmation:a=>K(a.data)&&a.vm.confirmResign?e("div",{className:"negotiation"},e("div",{className:"binary_choice_wrapper"},e("button",{className:"binary_choice","data-icon":"E",oncreate:r((()=>{a.socket.iface.send("resign")}))},i("resign")),e("button",{className:"binary_choice","data-icon":"L",oncreate:r((()=>{a.vm.confirmResign=!1}))},i("cancel")))):null,forceResign:a=>q(a.data)?e("div.force_resign_zone",[e("div.notice",i("opponentLeftChoices")),e("div.binary_choice_wrapper",[e("button.binary_choice.left",{oncreate:r((()=>{a.socket.iface.send("resign-force")}))},i("forceResignation")),e("button.binary_choice.right",{oncreate:r((()=>{a.socket.iface.send("draw-force")}))},i("forceDraw"))])]):null,threefoldClaimDraw:a=>a.data.game.threefold?e("div.claim_draw_zone",[e("div.notice",i("threefoldRepetition")),e.trust("&nbsp;"),e("button[data-icon=E]",{oncreate:r((()=>{a.socket.iface.send("draw-claim")}))},i("claimADraw"))]):null,offerDraw:a=>a.vm.confirmDraw?null:e("button",{className:"draw-yes",oncreate:r((()=>{a.vm.confirmDraw=!0})),disabled:!a.canOfferDraw()},e("span","½"),i("offerDraw")),drawConfirmation:a=>a.canOfferDraw()&&a.vm.confirmDraw?e("div",{className:"negotiation"},e("div",{className:"binary_choice_wrapper"},e("button",{className:"binary_choice","data-icon":"E",oncreate:r((()=>{a.vm.confirmDraw=!1,a.offerDraw()}))},i("offerDraw")),e("button",{className:"binary_choice","data-icon":"L",oncreate:r((()=>{a.vm.confirmDraw=!1}))},i("cancel")))):null,cancelDrawOffer:a=>a.data.player.offeringDraw?e("div.negotiation",[e("div.notice",i("drawOfferSent"))]):null,answerOpponentDrawOffer:a=>a.data.opponent.offeringDraw?e("div.negotiation",[e("div.notice",i("yourOpponentOffersADraw")),e("div.binary_choice_wrapper",[e("button.binary_choice[data-icon=E]",{oncreate:r((()=>{a.socket.iface.send("draw-yes")}))},i("accept")),e("button.binary_choice[data-icon=L]",{oncreate:r((()=>{a.socket.iface.send("draw-no")}))},i("decline"))])]):null,cancelTakebackProposition:a=>a.data.player.proposingTakeback?e("div.negotiation",[e("div.notice",i("takebackPropositionSent")),e("button[data-icon=L]",{oncreate:r((()=>{a.socket.iface.send("takeback-no")}))},i("cancel"))]):null,answerOpponentTakebackProposition:a=>a.data.opponent.proposingTakeback?e("div.negotiation",[e("div.notice",i("yourOpponentProposesATakeback")),e("div.binary_choice_wrapper",[e("button.binary_choice[data-icon=E]",{oncreate:r((()=>{a.acceptTakeback()}))},i("accept")),e("button.binary_choice[data-icon=L]",{oncreate:r((()=>{a.socket.iface.send("takeback-no")}))},i("decline"))])]):null,analysisBoard(a){const t=a.data;return Q(t)||X(t)?e("button",{oncreate:r(a.goToAnalysis)},[e("span[data-icon=A].withIcon"),i("analysis")]):null},notes:a=>a.notes?e("button",{oncreate:r((()=>a.notes&&a.notes.open()))},[e("span.fa.fa-pencil.withIcon"),i("notes")]):null,analysisBoardIconOnly(a){const t=a.data;return Q(t)||X(t)?e("button.action_bar_button[data-icon=A]",{oncreate:r(a.goToAnalysis)}):null},newOpponent(a){const t=a.data,n=(Y.finished(t)||Y.aborted(t))&&("lobby"===t.game.source||"pool"===t.game.source);return!a.data.opponent.ai&&n?e("button[data-icon=r]",{oncreate:r((()=>{a.hideActions(),b.onNewOpponent(a.data)}))},i("newOpponent")):null},rematch(a){const t=a.data,n=!t.game.rematch&&(Y.finished(t)||Y.aborted(t))&&!t.game.tournamentId&&!t.game.boosted&&(t.opponent.onGame||!t.clock&&t.player.user&&t.opponent.user);return a.data.opponent.offeringRematch?e("div.negotiation",[e("div.notice",i("yourOpponentWantsToPlayANewGameWithYou")),e("div.binary_choice_wrapper",[e("button.binary_choice[data-icon=E]",{oncreate:r((()=>{a.socket.iface.send("rematch-yes")}))},i("joinTheGame")),e("button.binary_choice[data-icon=L]",{oncreate:r((()=>{a.socket.iface.send("rematch-no")}))},i("decline"))])]):a.data.player.offeringRematch?e("div.negotiation",[e("div.notice",i("rematchOfferSent")),e("div.notice",i("waitingForOpponent")),e("button[data-icon=L]",{oncreate:r((()=>{a.socket.iface.send("rematch-no")}))},i("cancelRematchOffer"))]):e("button",{oncreate:r((()=>{a.socket.iface.send("rematch-yes")})),disabled:!n},[e("span.fa.fa-refresh"),i("rematch")])},moretime:a=>J(a.data)?e("button[data-icon=O]",{oncreate:r(a.socket.moreTime)},h("giveNbSeconds",15)):null,flipBoard(a){const t=p({action_bar_button:!0,highlight:a.vm.flip});return e("button",{className:t,"data-icon":"B",oncreate:r(a.flip)})},first(a){const t=a.vm.ply-1,n=a.vm.ply!==t&&t>=a.firstPly(),o=p({action_bar_button:!0,fa:!0,"fa-fast-backward":!0,disabled:!n});return e("button",{className:o,oncreate:r(a.jumpFirst)})},backward(a){const t=a.vm.ply-1,n=a.vm.ply!==t&&t>=a.firstPly(),o=p({action_bar_button:!0,fa:!0,"fa-backward":!0,disabled:!n});return e("button",{className:o,oncreate:r(a.jumpPrev,void 0,a.jumpPrev)})},forward(a){const t=a.vm.ply+1,n=a.vm.ply!==t&&t<=a.lastPly(),o=p({action_bar_button:!0,fa:!0,"fa-forward":!0,disabled:!n});return e("button",{className:o,oncreate:r(a.jumpNext,void 0,a.jumpNext)})},last(a){const t=a.vm.ply+1,n=a.vm.ply!==t&&t<=a.lastPly(),o=p({action_bar_button:!0,fa:!0,"fa-fast-forward":!0,disabled:!n});return e("button",{className:o,oncreate:r(a.jumpLast)})},returnToTournament:a=>e("button",{oncreate:r((function(){a.hideActions();const e=`/tournament/${a.data.game.tournamentId}`;a.data.tv?s.set(e):s.set(e,!0)}))},e("span",{className:"fa fa-trophy"}),i("backToTournament")),withdrawFromTournament:(a,t)=>e("button",{oncreate:r((function(){a.hideActions(),H(t),s.set(`/tournament/${t}`,!0)}))},e("span",{className:"fa fa-flag"}),"Pause"),goBerserk(a){if(!aa(a.data))return null;if(a.vm.goneBerserk[a.data.player.color])return null;return e("button",{className:"berserk",oncreate:r((function(){a.hideActions(),a.goBerserk()}))},e("span",{"data-icon":"`"})," GO BERSERK!",e("br",null),e("small",null,"Half the time, bonus point"))}};function Oa(a,e){return(a/Math.pow(10,e)).toFixed(e).substr(2)}function Ca(a){const e=new Date(a),t=Oa(e.getUTCMinutes(),2),n=Oa(e.getSeconds(),2);let o,r="";if(a>=864e5){const a=e.getUTCDate()-1;o=e.getUTCHours(),r+=h("nbDays",a),0!==o&&(r+=" "+h("nbHours",o))}else a>=36e5?(o=e.getUTCHours(),r+=Oa(o,2)+":"+t):r+=t+":"+n;return r+(f()?"":"?")}function Da(a,t,n){const o=a.data[t],r="correspondence clock "+p({outoftime:!o,running:n===t,emerg:o<a.data.emerg,offline:!f()});return e("div",{className:r},Ca(1e3*o))}function Aa(a){a&&g((()=>{const e=a.querySelector(".current");e&&(a.scrollTop=e.offsetTop-a.offsetHeight/2+e.offsetHeight/2)}))}function Ba(a){a&&g((()=>{const e=a.querySelector(".current");e&&(a.scrollLeft=e.offsetLeft-a.offsetWidth/2+e.offsetWidth/2)}))}function Ma(a){const e=a.target;return"MOVE"===e.tagName?e:y(e,"move")}function ja(a,e){const t=Ma(e);t&&t.dataset.ply&&a.jump(Number(t.dataset.ply))}const Sa={white:0,black:0};function Pa(a){const t=k.game.pieceNotation();return!a.vm.moveList||a.isZen()?null:e("div.replay.box",{className:p({displayPieces:!!t}),oncreate:e=>{setTimeout((()=>Aa(e.dom)),100),N((e=>ja(a,e)),void 0,Ma)(e)},onupdate:a=>Aa(a.dom)},La(a))}function Ua(a){const t=k.game.pieceNotation();return a.vm.moveList?e("div.replay_inline",{className:p({displayPieces:!!t,hidden:a.isZen()}),oncreate:e=>{setTimeout((()=>Ba(e.dom)),100),_((e=>ja(a,e)),void 0,Ma)(e)},onupdate:a=>Ba(a.dom)},La(a)):null}function La(a){return a.data.steps.filter((a=>null!==a.san)).map((t=>{return e("move.replayMove",{className:t.ply===a.vm.ply?"current":"","data-ply":t.ply},[1&t.ply?(n=t.ply,o=!0,e("index",Ga(n,o))):null,w(t.san)]);var n,o}))}function Ga(a,e){return function(a){return Math.floor((a-1)/2)+1}(a)+(e?a%2==1?".":"...":"")}function xa(a){return a}var Ra=Math.min;function Va(a,e){if((a=fa(a))<1||a>9007199254740991)return[];var t,n=4294967295,o=Ra(a,4294967295);a-=4294967295;for(var r=function(a,e){for(var t=-1,n=Array(a);++t<a;)n[t]=e(t);return n}(o,e="function"==typeof(t=e)?t:xa);++n<a;)e(n);return r}function $a(a){const t=T();return I.board(function(a){let t;t=a.goingBack||!a.data.tv&&!a.data.userTV&&a.data.player.spectator?[B([Fa(a),M(a.toggleBookmark,a.data.bookmarked)])]:[j(),Fa(a)];return t.push(S()),e("nav",{key:"roundHeader",className:O.isConnected()?"":"reconnecting"},t)}(a),function(a,t){const n=C(),o=a.chessground.getMaterialDiff(),r=a.data.player.checks||a.data.opponent.checks?function(a,e){const t=Object.assign({},Sa);for(const n of a){if(e<n.ply)break;n.check&&(n.ply%2==1?t.white++:t.black++)}return t}(a.data.steps,a.vm.ply):Sa,s=!a.data.tv&&a.vm.flip,i=Ka(a,a.data.player,o[a.data.player.color],r[a.data.player.color],"player",s),c=Ka(a,a.data.opponent,o[a.data.opponent.color],r[a.data.opponent.color],"opponent",s),l=ea(a.data),d=oa(a.data),u=e(da,{variant:a.data.game.variant.key,chessground:a.chessground},l?[d?null:Za(a,"opponent",d),d?Za(a,"player",d):null]:[]);return t?[A(n,t)?Ua(a):null,s?i:c,u,s?c:i,Xa(a)]:[u,e("section.table",[s?i:c,Pa(a),Xa(a),s?c:i])]}(a,t),"round",function(a){let t=!a.data.opponent.user||a.data.player.spectator?i("chat"):a.data.opponent.user.username;const n=a.data.watchers;a.data.player.spectator&&n&&n.nb>=2?t=i("spectators")+" "+n.nb:a.data.player.spectator&&(t=i("spectatorRoom"));return[a.chat?va(a.chat,t):null,a.notes?ba(a.notes):null,_a.view(a),Qa(a),Ha(a),e(ga,{player:a.data.player,opponent:a.data.opponent,mini:a.vm.miniUser.player.data,score:a.score,isOpen:a.vm.miniUser.player.showing,close:()=>a.closeUserPopup("player")}),e(ga,{player:a.data.opponent,opponent:a.data.player,mini:a.vm.miniUser.opponent.data,score:a.score,isOpen:a.vm.miniUser.opponent.showing,close:()=>a.closeUserPopup("opponent")})]}(a),void 0,void 0,"roundView")}function Ia(a){return e.fragment({},[e("div.materials",Object.keys(a.pieces).map((t=>e("div.material",Va(a.pieces[t],(a=>e("piece",{className:t}))))))),a.score>0?e("span",`+${a.score}`):null])}function Ea(a,t,n,o,r,s){const i=T(),c=C(),l=e("section",{className:"board_wrapper"+(r?" "+r:"")},e(D,{fen:a,lastMove:n,orientation:t,variant:o,customPieceTheme:s})),d=A(c,i)&&k.game.moveList()&&!k.game.zenMode();return i?e.fragment({},[d?e("div.replay_inline"):null,e("section.playTable.opponent"),l,e("section.playTable.player"),e("section.actions_bar")]):e.fragment({},[l,e("section.table")])}const za={view:()=>I.board(R(),Ea(F,"white"),"roundView")};function Fa(a){const t=a.data,o=a.data.tournament;if(a.vm.offlineWatcher||O.isConnected()){const r=!t.player.spectator&&"correspondence"===t.game.speed;return a.data.tv?e("div.main_header_title.withSub",[e("h1.header-gameTitle",[qa(a)]),e("h2.header-subTitle",sa(a.data))]):a.data.userTV?e("div.main_header_title.withSub",[e("h1.header-gameTitle",[e("span.withIcon[data-icon=1]"),a.data.userTV]),e("h2.header-subTitle",[e(`span.withIcon[data-icon=${d(a.data.game.perf)}]`),sa(a.data)].concat(o?[" • ",e("span.fa.fa-trophy"),e(Z,{seconds:o.secondsToFinish||0})]:[]))]):e(la,{data:a.data,kidMode:n.isKidMode(),subTitle:o?"tournament":r?"corres":"date"})}return e("div",{className:"main_header_title reconnecting"},x)}function Za(a,t,n){const o=a.data.expiration;if(!o)return null;const r=Math.max(0,o.movedAt-Date.now()+o.millisToMove);return e("div.round-expiration",{className:t},e(Z,{seconds:Math.round(r/1e3),emergTime:n?8:void 0,textWrap:(a,e)=>h("nbSecondsToPlayTheFirstMove",a,`<strong>${e}</<strong>`),showOnlySecs:!0}))}function Ha(a){return a.vm.moveToSubmit||a.vm.dropToSubmit||a.vm.submitFeedback?e("div",{className:"overlay_popup_wrapper submitMovePopup"},e("div",{className:"overlay_popup"},Ta.submitMove(a))):null}function Wa(a,t,n,o,s,i,l){const d=t.user,u=function(a){var t,n,o;if(a.name||a.username||a.user){const r=a.name||a.username||(null===(t=a.user)||void 0===t?void 0:t.username);return e("span",[(null===(n=a.user)||void 0===n?void 0:n.title)?[e("span.userTitle"+("BOT"===(null===(o=a.user)||void 0===o?void 0:o.title)?".bot":""),a.user.title)," "]:[],r])}return a.ai?G({ai:a.ai}):"Anonymous"}(t),p=d?r(d?()=>a.openUserPopup(i,d.id):L,(()=>function(a,e,t){let n;n=a?`${t}: ${a.online?"connected to lichess":"offline"}; ${e.onGame?"currently on this game":"currently not on this game"}`:t;U.show({text:n,position:"center",duration:"short"})}(d,t,c(t)))):r(L,(()=>{var a;return U.show({text:t.name||t.username||(null===(a=t.user)||void 0===a?void 0:a.username),position:"center",duration:"short"})})),m=a.data.tournament&&a.data.tournament.ranks?"#"+a.data.tournament.ranks[t.color]+" ":null,f=a.vm.goneBerserk[t.color],b="threeCheck"===a.data.game.variant.key?o:void 0;return e("div",{className:"antagonistInfos"+(l?" crazy":"")+(a.isZen()?" zen":""),oncreate:p},e("h2",{className:"antagonistUser"},d&&d.patron?e("span",{className:"patron status "+(t.onGame?"ongame":"offgame"),"data-icon":""}):e("span",{className:"fa fa-circle status "+(t.onGame?"ongame":"offgame")}),m,u,f?e("span",{className:"berserk","data-icon":"`"}):null,l&&"opponent"===i&&d&&d.tosViolation?e("span",{className:"warning","data-icon":"j"}):null),l?null:e("div",{className:"ratingAndMaterial"},"opponent"===i&&d&&d.tosViolation?e("span",{className:"warning","data-icon":"j"}):null,d?e("h3",{className:"rating"},t.rating,t.provisional?"?":"",P(t)):null,void 0!==b?[...Array(b).keys()].map((a=>e("div.material",e("piece",{className:"king"})))):null,a.vm.showCaptured&&"horde"!==a.data.game.variant.key?Ia(n):null),l&&a.clock?[e(ya,{key:s.toString(),ctrl:a.clock,color:t.color,isBerserk:f})]:l&&a.correspondenceClock?Da(a.correspondenceClock,t.color,a.data.game.player):null)}function Ka(a,t,n,o,r,s){const i=a.plyStep(a.vm.ply),c=!!i.crazy,l=p({playTable:!0,crazy:c,clockOnLeft:"left"===a.vm.clockPosition});return e("section",{className:l+" "+r},Wa(a,t,n,o,s,r,c),i.crazy?e(ha,{ctrl:a,crazyData:i.crazy,color:t.color,position:r}):null,!c&&a.clock?[e(ya,{key:s.toString(),ctrl:a.clock,color:t.color,isBerserk:a.vm.goneBerserk[t.color]})]:!c&&a.correspondenceClock?Da(a.correspondenceClock,t.color,a.data.game.player):null)}function qa(a){const t=E.filter((a=>"correspondence"!==a[0])).map((a=>[a[1],a[0]]));t.unshift(["Top rated","best"]),t.push(["Bot","bot"]),t.push(["Computer","computer"]);const n=k.tv.channel(),o=d(n);return e("div.select_input.main_header-selector.round-tvChannelSelector",[e("label",{for:"channel_selector"},[e(`i[data-icon=${o}]`),e("span",e.trust("&nbsp;")),e("span","Lichess TV")]),e("select#channel_selector",{value:n,onchange(e){const t=e.target.value;k.tv.channel(t),a.onFeatured&&a.onFeatured(),setTimeout(m,10)}},t.map((a=>e("option",{key:a[1],value:a[1]},a[0]))))])}function Qa(t){const n=ea(t.data)?void 0:()=>function(a){const t=ia(a.data),n=ca(a.data,a.data.game.winner),o=Y.toLabel(a.data.game.status.name,a.data.game.turns,a.data.game.winner,a.data.game.variant.key)+(n?". "+i("white"===n.color?"whiteIsVictorious":"blackIsVictorious")+".":"");return(Y.aborted(a.data)?[]:[e("strong",t),e("br")]).concat([e("em.resultStatus",o)])}(t);return a("player_controls",t.vm.showingShareActions?void 0:n,(()=>ea(t.data)?function(a){return e("div.gameControls",{key:"gameRunningActions"},a.data.player.spectator?[Ta.shareLink(a)]:[Ta.toggleZen(a),Ta.analysisBoard(a),Ta.notes(a),Ta.moretime(a),Ta.standard(a,ta,"L","abortGame","abort")].concat(q(a.data)?[Ta.forceResign(a)]:[Ta.standard(a,na,"i","proposeATakeback","takeback-yes"),Ta.cancelTakebackProposition(a),Ta.offerDraw(a),Ta.drawConfirmation(a),Ta.cancelDrawOffer(a),Ta.threefoldClaimDraw(a),Ta.resign(a),Ta.resignConfirmation(a),Ta.goBerserk(a),Ta.answerOpponentDrawOffer(a),Ta.answerOpponentTakebackProposition(a)]))}(t):function(a){let t;const n=a.data.game.tournamentId,o=e("button",{oncreate:r(a.showShareActions)},[e("span.fa.fa-share"),i("shareAndExport")]);return t=a.vm.showingShareActions?[Ta.shareLink(a),Ta.sharePGN(a)]:n?a.data.player.spectator?[o,Ta.analysisBoard(a),Ta.returnToTournament(a)]:[o,Ta.analysisBoard(a),Ta.withdrawFromTournament(a,n),Ta.returnToTournament(a)]:a.data.player.spectator?[o,Ta.analysisBoard(a)]:[o,Ta.analysisBoard(a),Ta.notes(a),Ta.newOpponent(a),Ta.rematch(a)],e("div.game_controls",{key:"gameEndedActions"},e.fragment({key:a.vm.showingShareActions?"shareMenu":"menu"},t))}(t)),t.vm.showingActions,t.hideActions)}function Xa(a){const t=(a.data.opponent.proposingTakeback||a.data.opponent.offeringDraw)&&!Y.finished(a.data)||q(a.data)||a.data.opponent.offeringRematch,n=(a.data.opponent.proposingTakeback?["fa","fa-mail-reply"]:a.data.opponent.offeringDraw?[]:["fa","fa-list"]).concat(["action_bar_button",t?"glow":""]).join(" ");return e("section",{className:"actions_bar"},e("button",{className:n,oncreate:r(a.showActions)},a.data.opponent.offeringDraw?"½":""),a.chat&&!a.isZen()?e("button",{className:"action_bar_button fa fa-comments withChip",oncreate:r(a.chat.open)},a.chat.nbUnread>0?e("span",{className:"chip"},a.chat.nbUnread<=99?a.chat.nbUnread:99):null):null,ra(a.data)?function(a){return e("button.action_bar_button[data-icon=A].withChip",{oncreate:r(a.goToAnalysis)},(a.data.forecastCount||0)>0?e("span.chip",a.data.forecastCount):null)}(a):null,Ta.flipBoard(a),ea(a.data)?null:Ta.analysisBoardIconOnly(a),Ta.backward(a),Ta.forward(a))}function Ya(a,e){const t=[],n=new Map,o=V(e);for(let r=-1;r<2;r++)for(let s=-1;s<2;s++){const i=$([o[0]+r,o[1]+s]);if(i){t.push(i);const o=a.state.pieces.get(i);o&&(i===e||"pawn"!==o.role)&&n.set(i,null)}}a.setPieces(n),a.explode(t)}var Ja={capture:Ya,enpassant:function(a,e,t){const n=V(e),o=[n[0],n[1]+("white"===t?-1:1)];Ya(a,$(o))}},ae={drop(a,e,t,n){if(!a.game.offline&&!oa(a))return!1;if("pawn"===e&&("1"===t[1]||"8"===t[1]))return!1;if(null==n)return!0;return-1!==(Array.isArray(n)?n:n.match(/.{2}/g)||[]).indexOf(t)}};export{za as L,Ja as a,Aa as b,ae as c,Ba as d,$a as e,ka as f,Ma as g,Ca as h,ja as o,_a as p,Ia as r,Ea as v};
