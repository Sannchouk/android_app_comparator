import{aB as t,g as a,bz as s,bA as e,F as o,aF as r,r as i,a7 as n,w as c,az as l,bo as d,bp as m,aG as h,s as p,aD as f,al as u,m as y,q as b,aN as v,aH as j}from"./main.js";import{l as g}from"./layout-c7d0a2f4.js";import{p as k,a as w}from"./fen-acee80a0.js";import"./CountdownTimer-265e230d.js";import"./TabView-c796731e.js";import{g as T,c as B,b as F}from"./offlineGames-d3a3eaac.js";import"./game-2ffc1d0e.js";import"./perfs-2bc54d35.js";import{G}from"./GameTitle-0505073c.js";import"./Board-c82f4179.js";import"./promotion-a7ec34cc.js";import"./index-6048898c.js";import"./CrazyPocket-cee87a95.js";import"./chat-fb252130.js";import"./chess-3e18520f.js";import"./vibrate-6077ecb6.js";import{g as z,A,r as C,a as x,o as $,l as _}from"./AnalyseCtrl-bfd487bf.js";import"./variant-f03d7948.js";import"./studyXhr-6378d14d.js";import"./html-1975aa10.js";import"./tree-aeadfd0f.js";import"./axis-5bab4d8c.js";const I={queen:0,rook:0,knight:0,bishop:0,pawn:0};var q={oninit(d){const m=d.attrs.source||"offline",h=d.attrs.id,p=d.attrs.color||"white",f=d.attrs.fen,u=d.attrs.variant,y=o(d.attrs.ply),b=d.attrs.tabId,v=void 0!==h||void 0!==f||"1"===d.attrs.goBack;if(r(),"online"===m&&h){const t=performance.now();z(h,p).then((a=>{const s=performance.now()-t;setTimeout((()=>{this.ctrl=new A(a,void 0,m,p,v,y,b),i()}),Math.max(400-s,0))})).catch((t=>{n(t),d.attrs.fallback&&d.attrs.curFen&&d.attrs.color?c.set(`/analyse/variant/standard/fen/${encodeURIComponent(d.attrs.curFen)}?color=${d.attrs.color}&goBack=1`):c.set("/analyse",!0),i()}))}else if("offline"===m&&"otb"===h)T().then((t=>{setTimeout((()=>{const a=t&&B(t,p);a?(a.player.spectator=!0,this.ctrl=new A(a,void 0,m,p,v,y,b),i()):c.set("/analyse",!0)}),400)}));else if("offline"===m&&"ai"===h)F().then((t=>{setTimeout((()=>{const a=t&&B(t,p);a?(a.player.spectator=!0,this.ctrl=new A(a,void 0,m,p,v,y,b),i()):c.set("/analyse",!0)}),400)}));else if(void 0===u){let t=a.analyse.syntheticVariant();f&&(t=l.has(t)?"standard":t);let s=`/analyse/variant/${t}`;f&&(s+=`/fen/${encodeURIComponent(f)}`),c.set(s,!0),i()}else this.ctrl=new A(function(o,r){const i=k(r),n=w(r),c=s(o),l=r||e(o);return{game:{fen:l,id:"synthetic",initialFen:l,player:i,source:"offline",status:{id:10,name:"created"},turns:0,startedAtTurn:0,variant:c},takebackable:!1,orientation:"white",opponent:{color:t(i)},player:{color:i},pref:{destination:a.game.pieceDestinations(),highlight:a.game.highlights()},treeParts:[{fen:l,ply:n,crazyhouse:"crazyhouse"===c.key?{pockets:[I,I]}:void 0,pgnMoves:[]}],userAnalysis:!0}}(u,f),void 0,m,p,v,y,b),i()},oncreate(t){"1"===t.attrs.slide?d(t.dom):m(t.dom)},onremove(){h(),p.destroy(),this.ctrl&&(this.ctrl.unload(),this.ctrl=void 0)},view(t){const a=f();if(this.ctrl){let t=null;this.ctrl.shouldGoBack&&(t="synthetic"===this.ctrl.data.game.id?u(y("div.main_header_title",b("analysis"))):u([y(G,{data:this.ctrl.data,subTitle:"date"}),v(this.ctrl.toggleBookmark,this.ctrl.data.bookmarked)]));const s=this.ctrl.shouldGoBack?null:y("div.main_header_title.withSub",[y("div",b("analysis")),C(this.ctrl)]);return g.board(j(s,t),x(this.ctrl,a),void 0,$(this.ctrl))}return _(a,t.attrs.color,t.attrs.curFen)}};export default q;
