import{J as e,K as t,L as a,M as s,O as n,P as i,Q as o,b as l,m as c,R as r,S as u,q as h,T as d,U as p,z as m,V as v,E as f,X as g,k as N,s as k,Y as w,_ as b,$ as _,r as M,a0 as S,a1 as E,a2 as y,a3 as T,p as X,a4 as Y,g as D,a5 as I,a6 as x,w as C,a7 as L,a8 as O,a9 as P,aa as V,C as A,ab as B,ac as z,ad as G,I as $,v as F,ae as R,af as j,ag as H,ah as K,ai as W,aj as q,ak as U,u as Q,al as J}from"./main.js";class Z{constructor(e,t,a){this.element=e,this.vd=t,this.options=a,this.handlers={panstart:[],panmove:[],panend:[],swipeleft:[],swiperight:[],swipeup:[],swipedown:[]},this.swipingDirection=null,this.startInputTimestamp=0,this.onTouchStart=e=>{e.changedTouches.length>1||(this.touchStartX=e.changedTouches[0].pageX,this.touchStartY=e.changedTouches[0].pageY,this.velocityX=0,this.velocityY=0,this.touchMoveX=0,this.touchMoveY=0,this.touchEndX=null,this.touchEndY=null,this.startInputTimestamp=performance.now(),this.fire("panstart",e))},this.onTouchMove=e=>{if(e.changedTouches.length>1)return;this.touchMoveX=e.changedTouches[0].pageX-this.touchStartX;const t=performance.now()-this.startInputTimestamp;this.velocityX=this.touchMoveX/t,this.touchMoveY=e.changedTouches[0].pageY-this.touchStartY,this.velocityY=this.touchMoveY/t;const a=Math.abs(this.touchMoveX),s=Math.abs(this.touchMoveY),n=a>this.swipeThresholdX,i=s>this.swipeThresholdY;this.swipingDirection=a>s?n?"horizontal":"pre-horizontal":i?"vertical":"pre-vertical",this.fire("panmove",e)},this.onTouchEnd=e=>{if(e.changedTouches.length>1)return;this.touchEndX=e.changedTouches[0].pageX,this.touchEndY=e.changedTouches[0].pageY,this.fire("panend",e);const t=this.touchEndX-this.touchStartX,a=Math.abs(t),s=this.touchEndY-this.touchStartY,n=Math.abs(s);if(a>this.swipeThresholdX||n>this.swipeThresholdY){const i=a>=n&&a>this.swipeThresholdX,o=n>a&&n>this.swipeThresholdY;i&&(t<0?this.velocityX<-this.opts.swipeVelocityThreshold&&this.fire("swipeleft",e):this.velocityX>this.opts.swipeVelocityThreshold&&this.fire("swiperight",e)),o&&(s<0?this.velocityY<-this.opts.swipeVelocityThreshold&&this.fire("swipeup",e):this.velocityY>this.opts.swipeVelocityThreshold&&this.fire("swipedown",e))}},this.swipeThresholdX=ee("x",t),this.swipeThresholdY=ee("y",t),this.element=e,this.opts=Object.assign({},te,a),this.touchStartX=null,this.touchStartY=null,this.touchEndX=null,this.touchEndY=null,this.velocityX=0,this.velocityY=0,this.touchMoveX=0,this.touchMoveY=0,this.element.addEventListener("touchstart",this.onTouchStart,ae),this.element.addEventListener("touchmove",this.onTouchMove,!!this.opts.passiveMove&&ae),this.element.addEventListener("touchend",this.onTouchEnd,ae)}destroy(){this.element.removeEventListener("touchstart",this.onTouchStart),this.element.removeEventListener("touchmove",this.onTouchMove),this.element.removeEventListener("touchend",this.onTouchEnd)}on(e,t){if(this.handlers[e])return this.handlers[e].push(t),{type:e,fn:t,cancel:()=>this.off(e,t)}}off(e,t){if(this.handlers[e]){const a=this.handlers[e].indexOf(t);-1!==a&&this.handlers[e].splice(a,1)}}fire(e,t){for(let a=0;a<this.handlers[e].length;a++)this.handlers[e][a](t)}}function ee(e,t){return Math.max(25,Math.floor(.15*("x"===e?t.vw:t.vh)))}const te={swipeVelocityThreshold:.4,passiveMove:!0},ae={passive:!0};function se(o,l){const c=l.side,r=e(),u={backDropElement:null,isScrolling:!1,isClosing:!1},h=new Z(o,t(),{passiveMove:!1});h.on("panstart",(()=>{u.backDropElement=l.getBackdropEl(),u.isScrolling=!1,u.isClosing=!1})),h.on("panmove",(e=>{if(!u.isScrolling){if(u.isClosing)e.preventDefault();else if("left"===c&&h.touchMoveX<-5||"right"===c&&h.touchMoveX>5)e.preventDefault(),u.isClosing=!0;else if(u.isScrolling=Math.abs(h.touchMoveY)>5,u.isScrolling)return;"left"===c?h.touchMoveX<0&&h.touchMoveX>=-r&&(a(o,h.touchMoveX),s(u.backDropElement,(r+h.touchMoveX)/r*100/100*i)):h.touchMoveX>0&&h.touchMoveX<=r&&(a(o,h.touchMoveX),s(u.backDropElement,(r-h.touchMoveX)/r*100/100*i))}})),h.on("panend",(()=>{if(u.isScrolling)return;u.isScrolling=!1,u.isClosing=!1;const e=h.velocityX;0!==e&&("left"===c?e<0&&(h.touchMoveX<-(r-r*n)||e<-.4)?l.close():l.open():e>0&&(h.touchMoveX>r-r*n||e>.4)?l.close():l.open())}))}var ne={onbeforeupdate:()=>o.isOpen,view(){const e=l.get();return c("aside",{id:"side_menu",oncreate:({dom:e})=>{se(e,o)}},function(e){const t=r()?"up":"down";return c("header",{className:"side_menu_header",oncreate:u(g)},l.isKidMode()?c("div",{className:"kiddo"},"ðŸ˜Š"):null,function(e){const t=S(),a=E(),s=`PING: ${h("networkLagBetweenYouAndLichess")}; SERVER: ${h("timeToProcessAMoveOnLichessServer")}`,n=e=>{e.stopPropagation(),y.show({text:s,duration:"long",position:"top"})};return c("div",{className:"pingServer"},function(e){const t=void 0===e?0:e<150?4:e<300?3:e<500?2:1,a=[];for(let e=1;e<=4;e++)a.push(c(e<=t?"i":"i.off"));return c("signal.q"+t,a)}(N()?t:void 0),N()?c("div",null,c("div",null,c("span",{className:"pingKey"},"PingÂ Â Â "),c("strong",{className:"pingValue"},k.isConnected()&&t?t:"?")," ms"),e?c("div",null,c("span",{className:"pingKey"},"ServerÂ "),c("strong",{className:"pingValue"},k.isConnected()&&a?a:"?")," ms"):null):c("div",null,"Offline"),N()?c("i",{className:"fa fa-question-circle-o",oncreate:u(n)}):null)}(e),N()&&!e?c("button",{className:"signInButton",oncreate:u(w.open)},h("signIn")):null,e?c("h2",{className:"username"},e.username,c("i",{className:"fa fa-caret-"+t})):null)}(e),c("div",{className:"native_scroller side_menu_scroller"},e&&r()?function(e){const t={username:e.username};e.title&&(t.title=e.title);e.patron&&(t.patron="1");return c("ul",{className:"side_links profileActions",oncreate:u(oe,void 0,f)},c("li",{className:"side_link","data-route":`/@/${e.id}`},e.patron?c("span",{className:"patron","data-icon":"î€™"}):c("span",{className:"fa fa-circle userStatus online"}),h("profile")),c("li",{className:"side_link","data-route":`/@/${e.id}/games?${d(t)}`},c("span",{className:"menu_icon_game"}),h("games")),c("li",{className:"side_link","data-route":"/inbox"},c("span",{className:"fa fa-envelope"}),h("inbox")+(null!==p()&&p()>0?" ("+p()+")":"")),c("li",{className:"side_link","data-route":"/account/preferences"},c("span",{"data-icon":"%"}),h("preferences")),c("li",{className:"side_link","data-action":"friends"},c("span",{"data-icon":"f"}),m("nbFriendsOnline",v.count())),c("li",{className:"side_link","data-nocloseaction":"logout"},c("span",{"data-icon":"w"}),h("logOut")))}(e):function(e){const t=N();return c("ul",{className:"side_links",oncreate:u(oe,void 0,f)},c("li",{className:"side_link","data-route":"/"},c("span",{className:"fa fa-home"}),h("home")),t?c("li",{className:"sep_link"},h("playOnline")):null,t&&!l.hasCurrentBan()?c("li",{className:"side_link","data-action":"createGame"},c("span",{className:"fa fa-plus-circle"}),h("createAGame")):null,t?c("li",{className:"side_link","data-route":"/tournament"},c("span",{className:"fa fa-trophy"}),h("tournaments")):null,c("li",{className:"sep_link"},h("learnMenu")),t?c("li",{className:"side_link","data-route":"/training"},c("span",{"data-icon":"-"}),h("puzzles")):null,!t&&e?c("li",{className:"side_link","data-route":"/training"},c("span",{"data-icon":"-"}),h("puzzles")):null,t?c("li",{className:"side_link","data-route":"/study"},c("span",{"data-icon":"4"}),h("studyMenu")):null,c("li",{className:"side_link","data-route":"/coord"},c("span",{className:"fa fa-thumb-tack"}),h("coordinates")),t?c("li",{className:"sep_link"},h("watch")):null,t?c("li",{className:"side_link","data-route":"/tv"},c("span",{"data-icon":"1"}),h("watchGames")):null,t?c("li",{className:"sep_link"},h("community")):null,t?c("li",{className:"side_link","data-route":"/players"},c("span",{className:"fa fa-at"}),h("players")):null,c("li",{className:"sep_link"},h("tools")),c("li",{className:"side_link","data-route":"/analyse"},c("span",{"data-icon":"A"}),h("analysis")),c("li",{className:"side_link","data-route":"/editor"},c("span",{className:"fa fa-pencil"}),h("boardEditor")),c("li",{className:"side_link","data-route":"/clock"},c("span",{className:"fa fa-clock-o"}),h("clock")),t?c("li",{className:"side_link","data-route":"/importer"},c("span",{className:"fa fa-cloud-upload"}),h("importGame")):null,t?c("li",{className:"side_link","data-route":"/search"},c("span",{className:"fa fa-search"}),h("advancedSearch")):null,c("li",{className:"sep_link"},h("playOffline")),c("li",{className:"side_link","data-route":"/ai"},c("span",{className:"fa fa-cogs"}),h("computer")),c("li",{className:"side_link","data-route":"/otb"},c("span",{className:"fa fa-beer"}),h("overTheBoard")),c("li",{className:"hr"}),c("li",{className:"side_link","data-route":"/settings"},c("span",{className:"fa fa-cog"}),h("settings")),c("li",{className:"side_link","data-route":"/about"},c("span",{className:"fa fa-info-circle"}),h("about")))}(e)))}};const ie={gamesMenu:()=>T.open(),createGame:()=>X.openRealTime(),friends:()=>Y.open(),logout:()=>{l.logout(),r(!1)}};function oe(e){e.stopPropagation();const t=f(e);if(t){const e=t.dataset;e.route?b(e.route)():t&&e.action?_(ie[e.action])():t&&e.nocloseaction&&(ie[e.nocloseaction](),M())}}let le,ce=!1;var re={open:ue,close:he,openAIFromPosition(e){D.gameSetup.ai.variant("3"),ue(),le=e},view:()=>I("game_form_popup",void 0,(function(){return function(e,t,a,s){const n="1"===t.timeMode(),i=[c("div.select_input",[O.renderSelect("side",e+"color",de,t.color)]),c("div.select_input",[O.renderSelect("variant",e+"variant",a,t.variant)]),"3"===t.variant()?c("div.setupPosition",[c("div.setupPositionInput",[c("input[type=text][name=fen]",{placeholder:h("pasteTheFenStringHere"),oninput:e=>{const t=e.target.value;le=""===t?void 0:P(t).unwrap((e=>V(e)),(()=>!1)),M()}}),c("button.withIcon",{oncreate:A((()=>{he(),C.set("/editor")}))},c("span.fa.fa-pencil"))]),!1===le?c("div.setupFenError","Invalid FEN"):null,void 0!==le&&!1!==le?[c("div",{style:{width:"100px",height:"100px"},oncreate:A((()=>{he(),le&&C.set(`/editor/${encodeURIComponent(le)}`)}))},[c(B,{fen:le,orientation:"white"})])]:null]):null,c("div.select_input",[O.renderSelect("level","ailevel",["1","2","3","4","5","6","7","8"].map(z),t.level)])],o=[c("div.select_input",[O.renderSelect("clock",e+"timeMode",s,t.timeMode)])];n&&o.push(c("div.select_input.inline",[O.renderSelect("time",e+"time",D.gameSetup.availableTimes,t.time,!1)]),c("div.select_input.inline",[O.renderSelect("increment",e+"increment",D.gameSetup.availableIncrements.map(z),t.increment,!1)]));return c("form.game_form",{onsubmit:function(e){e.preventDefault(),D.gameSetup.isTimeValid(t)&&(he(),x(le).then((e=>{C.set("/game"+e.url.round)})).catch(L))}},[c("fieldset",i),c("fieldset",o),c("div.popupActionWrapper",[c("button.defaultButton[type=submit]",h("playWithTheMachine"))])])}("ai",D.gameSetup.ai,D.gameSetup.ai.availableVariants,D.gameSetup.ai.availableTimeModes)}),ce,he)};function ue(){C.backbutton.stack.push(he),le=void 0,ce=!0}function he(e){"backbutton"!==e&&ce&&C.backbutton.stack.pop(),ce=!1}const de=[["randomColor","random"],["white","white"],["black","black"]];function pe(o){const l=o.side,c=e(),r={menuElement:null,backDropElement:null,canSlide:!1};return{panstart:e=>a=>{const s=a.target;"PIECE"===s.nodeName||"SQUARE"===s.nodeName||s.className.startsWith&&s.className.startsWith("cg-board manipulable")||!function(e,t,a){return"left"===t?e<G:e>a-G}(e.touchStartX,l,t().vw)?r.canSlide=!1:(r.menuElement=o.getMenuEl(),r.backDropElement=o.getBackdropEl(),r.menuElement&&r.backDropElement&&(r.menuElement.style.visibility="visible",r.backDropElement.style.visibility="visible",r.canSlide=!0,M()))},panmove:e=>t=>{if(r.canSlide){"ios"===$.platform&&(t.defaultPrevented||t.preventDefault());const n=e.touchMoveX;"left"===l?n<=c&&(a(r.menuElement,-c+n),s(r.backDropElement,n/c*100/100*i)):n>=-c&&(a(r.menuElement,c+n),s(r.backDropElement,-n/c*100/100*i))}},panend:e=>()=>{const t=e.velocityX;if(r.canSlide&&0!==t){r.canSlide=!1;const a=e.touchMoveX;"left"===l?t>0&&(a>=c*n||t>.2)?o.open():o.close():t<0&&(a<=-c*n||t<-.2)?o.open():o.close()}}}}const me=H(!1);function ve(e){return e?c("div.announce",{className:me()?"expanded":""},[c("span.text",{oncreate:A((()=>{me(!me()),M()}))},e.msg),c("small",F(new Date(e.date),!0)),c("button.dismiss",{oncreate:A(R.dismiss)},j)]):null}var fe={oninit(){this.boundHandlers=!1},oncreate({dom:e}){this.gesture=new Z(e,t());const a=pe(o);for(const e in a)this.gesture.on(e,a[e](this.gesture))},onupdate({attrs:e}){if(!this.boundHandlers&&e.handlers){this.boundHandlers=!0;for(const t in e.handlers)this.gesture.on(t,e.handlers[t](this.gesture))}},view({attrs:e,children:t}){const{header:a,color:s}=e,n={righty:"right"===D.game.landscapeBoardSide()};return e.klass&&(n[e.klass]=!0),c("main#page",{className:s},[c("header.main_header.board",a),ve(R.get()),c("div.content_round",{className:K(n)},t),c("div#menu-close-overlay.menu-backdrop",{oncreate:W})])}},ge={board(e,t,a,s,n,i,o){const l=D.general.theme.background(),r=a?Object.assign({key:a},ke(l)):ke(l);return c("div.view-container",r,[c(fe,{header:e,color:i,handlers:n,klass:o},t),c(ne),T.view(),w.view(),U.view(),X.view(),re.view(),Q.view(),Y.view(),J.view(),s])},free(e,t,a,s,n){const i=D.general.theme.background();return c("div.view-container",ke(i),[c("main#page",{oncreate:Ne},[c("header.main_header",e),ve(R.get()),c("div#free_content.content.native_scroller",{className:a?"withFooter":"",oncreate:({dom:e})=>{n&&e.addEventListener("scroll",n)}},t),a?c("footer.main_footer",a):null,c("div#menu-close-overlay.menu-backdrop",{oncreate:W})]),c(ne),T.view(),w.view(),U.view(),X.view(),re.view(),Q.view(),Y.view(),J.view(),s])},clock(e,t){const a=D.general.theme.background();return c("div.view-container",ke(a),[c("main#page",[c("div.content.fullScreen",e())]),t?t():null])}};function Ne({dom:e}){const a=new Z(e,t(),{passiveMove:"ios"!==$.platform}),s=pe(o);for(const e in s)a.on(e,s[e](a))}function ke(e){return{className:(t=e,"dark"===t||"light"===t?t:"system"===t?q():"transp "+t)};var t}export{se as C,pe as E,Z as G,ge as l,re as p};
