import{aH as t,al as s,m as e,C as a,a2 as r,S as o,z as i,cT as n,cU as d,cf as c,E as l,w as u,F as m,aF as h,r as p,a7 as b,bp as y,bo as f,aG as j,s as v,aD as w}from"./main.js";import{l as M,C,E as g}from"./layout-c7d0a2f4.js";import"./fen-acee80a0.js";import"./TabView-c796731e.js";import"./game-2ffc1d0e.js";import"./perfs-2bc54d35.js";import"./Board-c82f4179.js";import"./promotion-a7ec34cc.js";import"./index-6048898c.js";import"./CrazyPocket-cee87a95.js";import"./chat-fb252130.js";import"./chess-3e18520f.js";import"./vibrate-6077ecb6.js";import{A as k,a as T,o as F,l as x}from"./AnalyseCtrl-bfd487bf.js";import"./variant-f03d7948.js";import{c as $}from"./studyXhr-6378d14d.js";import"./html-1975aa10.js";import"./tree-aeadfd0f.js";import"./axis-5bab4d8c.js";var A={oninit({attrs:t}){const{studyCtrl:s}=t,e=Object.keys(s.data.members).length;this.showMembers=e<=5},onbeforeupdate:({attrs:t})=>t.studyCtrl.sideMenu.isOpen,view({attrs:t}){const{studyCtrl:s}=t,a=s.data,r=function(t){return Object.keys(t).map((s=>t[s])).sort(((t,s)=>"r"===t.role&&"w"===s.role?1:"w"===t.role&&"r"===s.role?-1:t.addedAt>s.addedAt?1:-1))}(a.members);return e("aside#studyMenu",{oncreate:({dom:t})=>{C(t,s.sideMenu)}},[e("div.native_scroller",[e("h2.study-menu-title.study-members",{oncreate:o((()=>this.showMembers=!this.showMembers))},[e("span",i("nbMembers",r.length)),this.showMembers?n:d]),this.showMembers?e("ul",r.map((t=>e("li.study-menu-link",{className:"w"===t.role?"contrib":"viewer"},[e("span.bullet.fa",{className:"w"===t.role?"fa-user":"fa-eye"}),e("span",t.user?c(t.user):"?")])))):null,e("h2.study-menu-title.study-chapters",i("nbChapters",a.chapters.length)),e("ol",{oncreate:o((t=>{const e=l(t),r=e&&e.dataset.id;r&&s.sideMenu.close().then((()=>{const t=s.analyseCtrl.currentTab(s.analyseCtrl.availableTabs()).id;u.set(`/study/${a.id}/chapter/${r}?tabId=${t}`,!0)}))}),void 0,l)},a.chapters.map(((t,s)=>e("li.study-menu-link",{"data-id":t.id,className:a.chapter.id===t.id?"current":""},[e("span.bullet",s+1),e("span",t.name)]))))])])}};var N={oninit(t){const s=t.attrs.id,e=t.attrs.chapterId,a=performance.now(),r=m(t.attrs.ply),o=t.attrs.tabId;h(),$(s,e).then((t=>{const s=performance.now()-a;setTimeout((()=>{this.ctrl=new k(t.analysis,t.study,"online",t.study.chapter.setup.orientation,!0,r||0,o),this.handlers=g(this.ctrl.study.sideMenu),p()}),Math.max(400-s,0))})).catch((t=>{404===t.status?(this.notFound=!0,p()):b(t)}))},oncreate(t){u.getPreviousPath().startsWith("/study/")?y(t.dom):f(t.dom)},onremove(){j(),v.destroy(),this.ctrl&&(this.ctrl.unload(),this.ctrl=void 0)},view(o){if(this.notFound)return M.free(t(null,s("Not Found")),e("div"));const i=w(),n=this.ctrl;return n?M.board(function(o){const i=o.name,n=o.chapters.find((t=>t.id===o.chapter.id)).name;return t(null,s(e("div.main_header_title.withSub",{},[e("h1.header-gameTitle",{oncreate:a((()=>{r.show({text:`${i}: ${n}`,duration:"long",position:"top"})}))},i),e("h2.header-subTitle",n)])))}(n.study.data),T(n,i),void 0,[...F(n),e(A,{studyCtrl:n.study}),e("div#studyMenu-backdrop.menu-backdrop",{oncreate:a((()=>n.study.sideMenu.close()))})],this.handlers):x(i,void 0,o.attrs.curFen)}};export default N;
