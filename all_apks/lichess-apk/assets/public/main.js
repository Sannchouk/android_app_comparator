/*! Capacitor: https://capacitorjs.com/ - MIT License */
const e=(e=>e.CapacitorPlatforms=(e=>{const t=new Map;t.set("web",{name:"web"});const n=e.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:t};return n.addPlatform=(e,t)=>{n.platforms.set(e,t)},n.setPlatform=e=>{n.platforms.has(e)&&(n.currentPlatform=n.platforms.get(e))},n})(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{});e.addPlatform,e.setPlatform;var t;!function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"}(t||(t={}));class n extends Error{constructor(e,t,n){super(e),this.message=e,this.code=t,this.data=n}}const r=e=>{var r,i,a,o,s;const c=e.CapacitorCustomPlatform||null,l=e.Capacitor||{},u=l.Plugins=l.Plugins||{},d=e.CapacitorPlatforms,h=(null===(r=null==d?void 0:d.currentPlatform)||void 0===r?void 0:r.getPlatform)||(()=>null!==c?c.name:(e=>{var t,n;return(null==e?void 0:e.androidBridge)?"android":(null===(n=null===(t=null==e?void 0:e.webkit)||void 0===t?void 0:t.messageHandlers)||void 0===n?void 0:n.bridge)?"ios":"web"})(e)),m=(null===(i=null==d?void 0:d.currentPlatform)||void 0===i?void 0:i.isNativePlatform)||(()=>"web"!==h()),f=(null===(a=null==d?void 0:d.currentPlatform)||void 0===a?void 0:a.isPluginAvailable)||(e=>{const t=g.get(e);return!!(null==t?void 0:t.platforms.has(h()))||!!p(e)}),p=(null===(o=null==d?void 0:d.currentPlatform)||void 0===o?void 0:o.getPluginHeader)||(e=>{var t;return null===(t=l.PluginHeaders)||void 0===t?void 0:t.find((t=>t.name===e))}),g=new Map,v=(null===(s=null==d?void 0:d.currentPlatform)||void 0===s?void 0:s.registerPlugin)||((e,r={})=>{const i=g.get(e);if(i)return i.proxy;const a=h(),o=p(e);let s;const d=i=>{let u;const d=(...d)=>{const h=(async()=>(!s&&a in r?s=s="function"==typeof r[a]?await r[a]():r[a]:null!==c&&!s&&"web"in r&&(s=s="function"==typeof r.web?await r.web():r.web),s))().then((r=>{const s=((r,i)=>{var s,c;if(!o){if(r)return null===(c=r[i])||void 0===c?void 0:c.bind(r);throw new n(`"${e}" plugin is not implemented on ${a}`,t.Unimplemented)}{const t=null==o?void 0:o.methods.find((e=>i===e.name));if(t)return"promise"===t.rtype?t=>l.nativePromise(e,i.toString(),t):(t,n)=>l.nativeCallback(e,i.toString(),t,n);if(r)return null===(s=r[i])||void 0===s?void 0:s.bind(r)}})(r,i);if(s){const e=s(...d);return u=null==e?void 0:e.remove,e}throw new n(`"${e}.${i}()" is not implemented on ${a}`,t.Unimplemented)}));return"addListener"===i&&(h.remove=async()=>u()),h};return d.toString=()=>`${i.toString()}() { [capacitor code] }`,Object.defineProperty(d,"name",{value:i,writable:!1,configurable:!1}),d},m=d("addListener"),f=d("removeListener"),v=(e,t)=>{const n=m({eventName:e},t),r=async()=>{const r=await n;f({eventName:e,callbackId:r},t)},i=new Promise((e=>n.then((()=>e({remove:r})))));return i.remove=async()=>{await r()},i},b=new Proxy({},{get(e,t){switch(t){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return o?v:m;case"removeListener":return f;default:return d(t)}}});return u[e]=b,g.set(e,{name:e,proxy:b,platforms:new Set([...Object.keys(r),...o?[a]:[]])}),b});return l.convertFileSrc||(l.convertFileSrc=e=>e),l.getPlatform=h,l.handleError=t=>e.console.error(t),l.isNativePlatform=m,l.isPluginAvailable=f,l.pluginMethodNoop=(e,t,n)=>Promise.reject(`${n} does not have an implementation of "${t}".`),l.registerPlugin=v,l.Exception=n,l.DEBUG=!!l.DEBUG,l.isLoggingEnabled=!!l.isLoggingEnabled,l.platform=l.getPlatform(),l.isNative=l.isNativePlatform(),l},i=(e=>e.Capacitor=r(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}),a=i.registerPlugin,o=i.Plugins;class s{constructor(e){this.listeners={},this.windowListeners={},e&&(this.config=e)}addListener(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t);const n=this.windowListeners[e];n&&!n.registered&&this.addWindowListener(n);const r=async()=>this.removeListener(e,t),i=Promise.resolve({remove:r});return Object.defineProperty(i,"remove",{value:async()=>{await r()}}),i}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t){const n=this.listeners[e];n&&n.forEach((e=>e(t)))}hasListeners(e){return!!this.listeners[e].length}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:e=>{this.notifyListeners(t,e)}}}unimplemented(e="not implemented"){return new i.Exception(e,t.Unimplemented)}unavailable(e="not available"){return new i.Exception(e,t.Unavailable)}async removeListener(e,t){const n=this.listeners[e];if(!n)return;const r=n.indexOf(t);this.listeners[e].splice(r,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}}const c=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),l=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class u extends s{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach((e=>{if(e.length<=0)return;let[n,r]=e.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");n=l(n).trim(),r=l(r).trim(),t[n]=r})),t}async setCookie(e){try{const t=c(e.key),n=c(e.value),r=`; expires=${(e.expires||"").replace("expires=","")}`,i=(e.path||"/").replace("path=",""),a=null!=e.url&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${n||""}${r}; path=${i}; ${a};`}catch(e){return Promise.reject(e)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(e){return Promise.reject(e)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}a("CapacitorCookies",{web:()=>new u});const d=(e,t={})=>{const n=Object.assign({method:e.method||"GET",headers:e.headers},t),r=((e={})=>{const t=Object.keys(e);return Object.keys(e).map((e=>e.toLocaleLowerCase())).reduce(((n,r,i)=>(n[r]=e[t[i]],n)),{})})(e.headers)["content-type"]||"";if("string"==typeof e.data)n.body=e.data;else if(r.includes("application/x-www-form-urlencoded")){const t=new URLSearchParams;for(const[n,r]of Object.entries(e.data||{}))t.set(n,r);n.body=t.toString()}else if(r.includes("multipart/form-data")){const t=new FormData;if(e.data instanceof FormData)e.data.forEach(((e,n)=>{t.append(n,e)}));else for(const n of Object.keys(e.data))t.append(n,e.data[n]);n.body=t;const r=new Headers(n.headers);r.delete("content-type"),n.headers=r}else(r.includes("application/json")||"object"==typeof e.data)&&(n.body=JSON.stringify(e.data));return n};class h extends s{async request(e){const t=d(e,e.webFetchExtra),n=((e,t=!0)=>e?Object.entries(e).reduce(((e,n)=>{const[r,i]=n;let a,o;return Array.isArray(i)?(o="",i.forEach((e=>{a=t?encodeURIComponent(e):e,o+=`${r}=${a}&`})),o.slice(0,-1)):(a=t?encodeURIComponent(i):i,o=`${r}=${a}`),`${e}&${o}`}),"").substr(1):null)(e.params,e.shouldEncodeUrlParams),r=n?`${e.url}?${n}`:e.url,i=await fetch(r,t),a=i.headers.get("content-type")||"";let o,s,{responseType:c="text"}=i.ok?e:{};switch(a.includes("application/json")&&(c="json"),c){case"arraybuffer":case"blob":s=await i.blob(),o=await(async e=>new Promise(((t,n)=>{const r=new FileReader;r.onload=()=>{const e=r.result;t(e.indexOf(",")>=0?e.split(",")[1]:e)},r.onerror=e=>n(e),r.readAsDataURL(e)})))(s);break;case"json":o=await i.json();break;case"document":case"text":default:o=await i.text()}const l={};return i.headers.forEach(((e,t)=>{l[t]=e})),{data:o,headers:l,status:i.status,url:i.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}a("CapacitorHttp",{web:()=>new h});const m=a("App",{web:()=>import("./web-8a8a6a8e.js").then((e=>new e.AppWeb))}),f=a("Device",{web:()=>import("./web-f375c0e2.js").then((e=>new e.DeviceWeb))}),p=a("SplashScreen",{web:()=>import("./web-c9ce21bd.js").then((e=>new e.SplashScreenWeb))}),g=a("Network",{web:()=>import("./web-3c7a35d8.js").then((e=>new e.NetworkWeb))});var v,b;!function(e){e.Dark="DARK",e.Light="LIGHT",e.Default="DEFAULT"}(v||(v={})),function(e){e.Body="body",e.Ionic="ionic",e.Native="native",e.None="none"}(b||(b={}));const w=a("Keyboard");function y(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var k="object"==typeof global&&global&&global.Object===Object&&global,P="object"==typeof self&&self&&self.Object===Object&&self,C=k||P||Function("return this")(),T=function(){return C.Date.now()},S=/\s/;var E=/^\s+/;function x(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&S.test(e.charAt(t)););return t}(e)+1).replace(E,""):e}var O=C.Symbol,M=Object.prototype,N=M.hasOwnProperty,j=M.toString,_=O?O.toStringTag:void 0;var L=Object.prototype.toString;var D=O?O.toStringTag:void 0;function I(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":D&&D in Object(e)?function(e){var t=N.call(e,_),n=e[_];try{e[_]=void 0;var r=!0}catch(e){}var i=j.call(e);return r&&(t?e[_]=n:delete e[_]),i}(e):function(e){return L.call(e)}(e)}var A=/^[-+]0x[0-9a-f]+$/i,R=/^0b[01]+$/i,B=/^0o[0-7]+$/i,$=parseInt;function z(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return null!=e&&"object"==typeof e}(e)&&"[object Symbol]"==I(e)}(e))return NaN;if(y(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=y(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=x(e);var n=R.test(e);return n||B.test(e)?$(e.slice(2),n?2:8):A.test(e)?NaN:+e}var U=Math.max,q=Math.min;function F(e,t,n){var r,i,a,o,s,c,l=0,u=!1,d=!1,h=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){var n=r,a=i;return r=i=void 0,l=t,o=e.apply(a,n)}function f(e){return l=e,s=setTimeout(g,t),u?m(e):o}function p(e){var n=e-c;return void 0===c||n>=t||n<0||d&&e-l>=a}function g(){var e=T();if(p(e))return v(e);s=setTimeout(g,function(e){var n=t-(e-c);return d?q(n,a-(e-l)):n}(e))}function v(e){return s=void 0,h&&r?m(e):(r=i=void 0,o)}function b(){var e=T(),n=p(e);if(r=arguments,i=this,c=e,n){if(void 0===s)return f(c);if(d)return clearTimeout(s),s=setTimeout(g,t),m(c)}return void 0===s&&(s=setTimeout(g,t)),o}return t=z(t)||0,y(n)&&(u=!!n.leading,a=(d="maxWait"in n)?U(z(n.maxWait)||0,t):a,h="trailing"in n?!!n.trailing:h),b.cancel=function(){void 0!==s&&clearTimeout(s),l=0,r=c=i=s=void 0},b.flush=function(){return void 0===s?o:v(T())},b}const H=a("Toast",{web:()=>import("./web-5f4a243b.js").then((e=>new e.ToastWeb))});function W(e){return e.getTime()%6e4}function G(e){var t=new Date(e.getTime()),n=Math.ceil(t.getTimezoneOffset());return t.setSeconds(0,0),6e4*n+(n>0?(6e4+W(t))%6e4:W(t))}function V(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function K(e){V(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):new Date(NaN)}function Y(e,t){V(2,arguments);var n=K(e),r=K(t),i=n.getTime()-r.getTime();return i<0?-1:i>0?1:i}function X(e,t){V(2,arguments);var n=K(e),r=K(t);return n.getTime()-r.getTime()}function Q(e,t){V(2,arguments);var n=X(e,t)/1e3;return n>0?Math.floor(n):Math.ceil(n)}function J(e){return function(e,t){if(null==e)throw new TypeError("assign requires that input parameter not be null or undefined");for(var n in t=t||{})t.hasOwnProperty(n)&&(e[n]=t[n]);return e}({},e)}var Z={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function ee(e){return function(t){var n=t||{},r=n.width?String(n.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}var te={date:ee({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:ee({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:ee({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},ne={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function re(e){return function(t,n){var r,i=n||{};if("formatting"===(i.context?String(i.context):"standalone")&&e.formattingValues){var a=e.defaultFormattingWidth||e.defaultWidth,o=i.width?String(i.width):a;r=e.formattingValues[o]||e.formattingValues[a]}else{var s=e.defaultWidth,c=i.width?String(i.width):e.defaultWidth;r=e.values[c]||e.values[s]}return r[e.argumentCallback?e.argumentCallback(t):t]}}function ie(e){return function(t,n){var r=String(t),i=n||{},a=i.width,o=a&&e.matchPatterns[a]||e.matchPatterns[e.defaultMatchWidth],s=r.match(o);if(!s)return null;var c,l=s[0],u=a&&e.parsePatterns[a]||e.parsePatterns[e.defaultParseWidth];return c="[object Array]"===Object.prototype.toString.call(u)?function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n}(u,(function(e){return e.test(l)})):function(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(e[n]))return n}(u,(function(e){return e.test(l)})),c=e.valueCallback?e.valueCallback(c):c,{value:c=i.valueCallback?i.valueCallback(c):c,rest:r.slice(l.length)}}}var ae,oe={code:"en-US",formatDistance:function(e,t,n){var r;return n=n||{},r="string"==typeof Z[e]?Z[e]:1===t?Z[e].one:Z[e].other.replace("{{count}}",t),n.addSuffix?n.comparison>0?"in "+r:r+" ago":r},formatLong:te,formatRelative:function(e,t,n,r){return ne[e]},localize:{ordinalNumber:function(e,t){var n=Number(e),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:re({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:re({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:function(e){return Number(e)-1}}),month:re({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:re({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:re({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:(ae={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e,10)}},function(e,t){var n=String(e),r=t||{},i=n.match(ae.matchPattern);if(!i)return null;var a=i[0],o=n.match(ae.parsePattern);if(!o)return null;var s=ae.valueCallback?ae.valueCallback(o[0]):o[0];return{value:s=r.valueCallback?r.valueCallback(s):s,rest:n.slice(a.length)}}),era:ie({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:ie({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:ie({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:ie({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:ie({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}};function se(e,t,n){V(2,arguments);var r=n||{},i=r.locale||oe;if(!i.formatDistance)throw new RangeError("locale must contain localize.formatDistance property");var a=Y(e,t);if(isNaN(a))throw new RangeError("Invalid time value");var o,s,c=J(r);c.addSuffix=Boolean(r.addSuffix),c.comparison=a,a>0?(o=K(t),s=K(e)):(o=K(e),s=K(t));var l,u=null==r.roundingMethod?"round":String(r.roundingMethod);if("floor"===u)l=Math.floor;else if("ceil"===u)l=Math.ceil;else{if("round"!==u)throw new RangeError("roundingMethod must be 'floor', 'ceil' or 'round'");l=Math.round}var d,h=Q(s,o),m=(G(s)-G(o))/1e3,f=l((h-m)/60);if("second"===(d=null==r.unit?f<1?"second":f<60?"minute":f<1440?"hour":f<43200?"day":f<525600?"month":"year":String(r.unit)))return i.formatDistance("xSeconds",h,c);if("minute"===d)return i.formatDistance("xMinutes",f,c);if("hour"===d){var p=l(f/60);return i.formatDistance("xHours",p,c)}if("day"===d){var g=l(f/1440);return i.formatDistance("xDays",g,c)}if("month"===d){var v=l(f/43200);return i.formatDistance("xMonths",v,c)}if("year"===d){var b=l(f/525600);return i.formatDistance("xYears",b,c)}throw new RangeError("unit must be 'second', 'minute', 'hour', 'day', 'month' or 'year'")}function ce(e){V(1,arguments);var t=K(e);return t.setHours(0,0,0,0),t}function le(e,t){V(2,arguments);var n=ce(e),r=ce(t),i=n.getTime()-G(n),a=r.getTime()-G(r);return Math.round((i-a)/864e5)}function ue(e){V(1,arguments);var t=K(e);return!isNaN(t)}function de(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function he(e,t){V(2,arguments);var n=K(e).getTime(),r=de(t);return new Date(n+r)}function me(e,t){V(2,arguments);var n=de(t);return he(e,-n)}function fe(e,t){for(var n=e<0?"-":"",r=Math.abs(e).toString();r.length<t;)r="0"+r;return n+r}var pe=function(e,t){var n=e.getUTCFullYear(),r=n>0?n:1-n;return fe("yy"===t?r%100:r,t.length)},ge=function(e,t){var n=e.getUTCMonth();return"M"===t?String(n+1):fe(n+1,2)},ve=function(e,t){return fe(e.getUTCDate(),t.length)},be=function(e,t){return fe(e.getUTCHours()%12||12,t.length)},we=function(e,t){return fe(e.getUTCHours(),t.length)},ye=function(e,t){return fe(e.getUTCMinutes(),t.length)},ke=function(e,t){return fe(e.getUTCSeconds(),t.length)},Pe=function(e,t){var n=t.length,r=e.getUTCMilliseconds();return fe(Math.floor(r*Math.pow(10,n-3)),t.length)};function Ce(e){V(1,arguments);var t=1,n=K(e),r=n.getUTCDay(),i=(r<t?7:0)+r-t;return n.setUTCDate(n.getUTCDate()-i),n.setUTCHours(0,0,0,0),n}function Te(e){V(1,arguments);var t=K(e),n=t.getUTCFullYear(),r=new Date(0);r.setUTCFullYear(n+1,0,4),r.setUTCHours(0,0,0,0);var i=Ce(r),a=new Date(0);a.setUTCFullYear(n,0,4),a.setUTCHours(0,0,0,0);var o=Ce(a);return t.getTime()>=i.getTime()?n+1:t.getTime()>=o.getTime()?n:n-1}function Se(e){V(1,arguments);var t=Te(e),n=new Date(0);n.setUTCFullYear(t,0,4),n.setUTCHours(0,0,0,0);var r=Ce(n);return r}function Ee(e,t){V(1,arguments);var n=t||{},r=n.locale,i=r&&r.options&&r.options.weekStartsOn,a=null==i?0:de(i),o=null==n.weekStartsOn?a:de(n.weekStartsOn);if(!(o>=0&&o<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var s=K(e),c=s.getUTCDay(),l=(c<o?7:0)+c-o;return s.setUTCDate(s.getUTCDate()-l),s.setUTCHours(0,0,0,0),s}function xe(e,t){V(1,arguments);var n=K(e,t),r=n.getUTCFullYear(),i=t||{},a=i.locale,o=a&&a.options&&a.options.firstWeekContainsDate,s=null==o?1:de(o),c=null==i.firstWeekContainsDate?s:de(i.firstWeekContainsDate);if(!(c>=1&&c<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var l=new Date(0);l.setUTCFullYear(r+1,0,c),l.setUTCHours(0,0,0,0);var u=Ee(l,t),d=new Date(0);d.setUTCFullYear(r,0,c),d.setUTCHours(0,0,0,0);var h=Ee(d,t);return n.getTime()>=u.getTime()?r+1:n.getTime()>=h.getTime()?r:r-1}function Oe(e,t){V(1,arguments);var n=t||{},r=n.locale,i=r&&r.options&&r.options.firstWeekContainsDate,a=null==i?1:de(i),o=null==n.firstWeekContainsDate?a:de(n.firstWeekContainsDate),s=xe(e,t),c=new Date(0);c.setUTCFullYear(s,0,o),c.setUTCHours(0,0,0,0);var l=Ee(c,t);return l}var Me="midnight",Ne="noon",je="morning",_e="afternoon",Le="evening",De="night",Ie={G:function(e,t,n){var r=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});case"GGGG":default:return n.era(r,{width:"wide"})}},y:function(e,t,n){if("yo"===t){var r=e.getUTCFullYear(),i=r>0?r:1-r;return n.ordinalNumber(i,{unit:"year"})}return pe(e,t)},Y:function(e,t,n,r){var i=xe(e,r),a=i>0?i:1-i;return"YY"===t?fe(a%100,2):"Yo"===t?n.ordinalNumber(a,{unit:"year"}):fe(a,t.length)},R:function(e,t){return fe(Te(e),t.length)},u:function(e,t){return fe(e.getUTCFullYear(),t.length)},Q:function(e,t,n){var r=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(r);case"QQ":return fe(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(e,t,n){var r=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(r);case"qq":return fe(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(e,t,n){var r=e.getUTCMonth();switch(t){case"M":case"MM":return ge(e,t);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(e,t,n){var r=e.getUTCMonth();switch(t){case"L":return String(r+1);case"LL":return fe(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(e,t,n,r){var i=function(e,t){V(1,arguments);var n=K(e),r=Ee(n,t).getTime()-Oe(n,t).getTime();return Math.round(r/6048e5)+1}(e,r);return"wo"===t?n.ordinalNumber(i,{unit:"week"}):fe(i,t.length)},I:function(e,t,n){var r=function(e){V(1,arguments);var t=K(e),n=Ce(t).getTime()-Se(t).getTime();return Math.round(n/6048e5)+1}(e);return"Io"===t?n.ordinalNumber(r,{unit:"week"}):fe(r,t.length)},d:function(e,t,n){return"do"===t?n.ordinalNumber(e.getUTCDate(),{unit:"date"}):ve(e,t)},D:function(e,t,n){var r=function(e){V(1,arguments);var t=K(e),n=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var r=t.getTime(),i=n-r;return Math.floor(i/864e5)+1}(e);return"Do"===t?n.ordinalNumber(r,{unit:"dayOfYear"}):fe(r,t.length)},E:function(e,t,n){var r=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});case"EEEE":default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(e,t,n,r){var i=e.getUTCDay(),a=(i-r.weekStartsOn+8)%7||7;switch(t){case"e":return String(a);case"ee":return fe(a,2);case"eo":return n.ordinalNumber(a,{unit:"day"});case"eee":return n.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(i,{width:"short",context:"formatting"});case"eeee":default:return n.day(i,{width:"wide",context:"formatting"})}},c:function(e,t,n,r){var i=e.getUTCDay(),a=(i-r.weekStartsOn+8)%7||7;switch(t){case"c":return String(a);case"cc":return fe(a,t.length);case"co":return n.ordinalNumber(a,{unit:"day"});case"ccc":return n.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(i,{width:"narrow",context:"standalone"});case"cccccc":return n.day(i,{width:"short",context:"standalone"});case"cccc":default:return n.day(i,{width:"wide",context:"standalone"})}},i:function(e,t,n){var r=e.getUTCDay(),i=0===r?7:r;switch(t){case"i":return String(i);case"ii":return fe(i,t.length);case"io":return n.ordinalNumber(i,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});case"iiii":default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(e,t,n){var r=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":case"aaa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaaaa":return n.dayPeriod(r,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(e,t,n){var r,i=e.getUTCHours();switch(r=12===i?Ne:0===i?Me:i/12>=1?"pm":"am",t){case"b":case"bb":case"bbb":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"bbbbb":return n.dayPeriod(r,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},B:function(e,t,n){var r,i=e.getUTCHours();switch(r=i>=17?Le:i>=12?_e:i>=4?je:De,t){case"B":case"BB":case"BBB":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(r,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},h:function(e,t,n){if("ho"===t){var r=e.getUTCHours()%12;return 0===r&&(r=12),n.ordinalNumber(r,{unit:"hour"})}return be(e,t)},H:function(e,t,n){return"Ho"===t?n.ordinalNumber(e.getUTCHours(),{unit:"hour"}):we(e,t)},K:function(e,t,n){var r=e.getUTCHours()%12;return"Ko"===t?n.ordinalNumber(r,{unit:"hour"}):fe(r,t.length)},k:function(e,t,n){var r=e.getUTCHours();return 0===r&&(r=24),"ko"===t?n.ordinalNumber(r,{unit:"hour"}):fe(r,t.length)},m:function(e,t,n){return"mo"===t?n.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):ye(e,t)},s:function(e,t,n){return"so"===t?n.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):ke(e,t)},S:function(e,t){return Pe(e,t)},X:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();if(0===i)return"Z";switch(t){case"X":return Re(i);case"XXXX":case"XX":return Be(i);case"XXXXX":case"XXX":default:return Be(i,":")}},x:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();switch(t){case"x":return Re(i);case"xxxx":case"xx":return Be(i);case"xxxxx":case"xxx":default:return Be(i,":")}},O:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+Ae(i,":");case"OOOO":default:return"GMT"+Be(i,":")}},z:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+Ae(i,":");case"zzzz":default:return"GMT"+Be(i,":")}},t:function(e,t,n,r){var i=r._originalDate||e;return fe(Math.floor(i.getTime()/1e3),t.length)},T:function(e,t,n,r){return fe((r._originalDate||e).getTime(),t.length)}};function Ae(e,t){var n=e>0?"-":"+",r=Math.abs(e),i=Math.floor(r/60),a=r%60;if(0===a)return n+String(i);var o=t||"";return n+String(i)+o+fe(a,2)}function Re(e,t){return e%60==0?(e>0?"-":"+")+fe(Math.abs(e)/60,2):Be(e,t)}function Be(e,t){var n=t||"",r=e>0?"-":"+",i=Math.abs(e);return r+fe(Math.floor(i/60),2)+n+fe(i%60,2)}function $e(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}}function ze(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}}var Ue={p:ze,P:function(e,t){var n,r=e.match(/(P+)(p+)?/),i=r[1],a=r[2];if(!a)return $e(e,t);switch(i){case"P":n=t.dateTime({width:"short"});break;case"PP":n=t.dateTime({width:"medium"});break;case"PPP":n=t.dateTime({width:"long"});break;case"PPPP":default:n=t.dateTime({width:"full"})}return n.replace("{{date}}",$e(i,t)).replace("{{time}}",ze(a,t))}},qe=["D","DD"],Fe=["YY","YYYY"];function He(e){return-1!==qe.indexOf(e)}function We(e){return-1!==Fe.indexOf(e)}function Ge(e){if("YYYY"===e)throw new RangeError("Use `yyyy` instead of `YYYY` for formatting years; see: https://git.io/fxCyr");if("YY"===e)throw new RangeError("Use `yy` instead of `YY` for formatting years; see: https://git.io/fxCyr");if("D"===e)throw new RangeError("Use `d` instead of `D` for formatting days of the month; see: https://git.io/fxCyr");if("DD"===e)throw new RangeError("Use `dd` instead of `DD` for formatting days of the month; see: https://git.io/fxCyr")}var Ve=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Ke=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Ye=/^'([^]*?)'?$/,Xe=/''/g,Qe=/[a-zA-Z]/;function Je(e,t,n){V(2,arguments);var r=String(t),i=n||{},a=i.locale||oe,o=a.options&&a.options.firstWeekContainsDate,s=null==o?1:de(o),c=null==i.firstWeekContainsDate?s:de(i.firstWeekContainsDate);if(!(c>=1&&c<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var l=a.options&&a.options.weekStartsOn,u=null==l?0:de(l),d=null==i.weekStartsOn?u:de(i.weekStartsOn);if(!(d>=0&&d<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!a.localize)throw new RangeError("locale must contain localize property");if(!a.formatLong)throw new RangeError("locale must contain formatLong property");var h=K(e);if(!ue(h))throw new RangeError("Invalid time value");var m=G(h),f=me(h,m),p={firstWeekContainsDate:c,weekStartsOn:d,locale:a,_originalDate:h},g=r.match(Ke).map((function(e){var t=e[0];return"p"===t||"P"===t?(0,Ue[t])(e,a.formatLong,p):e})).join("").match(Ve).map((function(e){if("''"===e)return"'";var t=e[0];if("'"===t)return Ze(e);var n=Ie[t];if(n)return!i.useAdditionalWeekYearTokens&&We(e)&&Ge(e),!i.useAdditionalDayOfYearTokens&&He(e)&&Ge(e),n(f,e,a.localize,p);if(t.match(Qe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+t+"`");return e})).join("");return g}function Ze(e){return e.match(Ye)[1].replace(Xe,"'")}function et(e,t){V(2,arguments);var n=de(t);return he(e,1e3*n)}const tt=a("Preferences",{web:()=>import("./web-c43db4f1.js").then((e=>new e.PreferencesWeb))});var nt={get:function(e){return tt.get({key:e}).then((({value:e})=>null!==e?JSON.parse(e):e))},set:function(e,t){return tt.set({key:e,value:JSON.stringify(t)}).then((()=>t))},remove:e=>tt.remove({key:e}),async migrate(){await tt.migrate()}};const rt=Object.prototype.hasOwnProperty;function it(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(let r=0;r<n.length;r++)if(!rt.call(t,n[r])||!Object.is(e[n[r]],t[n[r]]))return!1;return!0}function at(e,t){return t.split(".").reduce(((e,t)=>e&&e[t]),e)}function ot(e,t,n){if("string"==typeof t&&(t=t.split(".")),t.length>1){const r=t.shift();null!==e[r]&&"object"==typeof e[r]||(e[r]={}),ot(e[r],t,n)}else e[t[0]]=n}function st(e,t){return Object.assign({},t.reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:e[n]})),{}))}function ct(e){return[e.toString(),e.toString()]}function lt(e,t,n=1){const r=[];for(let i=e;i<=t;i+=n)r.push(i.toString());return r}function ut(e,t,n=1){return lt(e,t,n).map(ct)}const dt=[["Standard","standard"],["Crazyhouse","crazyhouse"],["Chess960","chess960"],["King of the Hill","kingOfTheHill"],["Three-check","threeCheck"],["Antichess","antichess"],["Atomic","atomic"],["Horde","horde"],["Racing Kings","racingKings"]],ht=[["Sudden Death","simple"],["Increment","increment"],["Increment with Handicap","handicapInc"],["Simple Delay","delay"],["Bronstein Delay","bronstein"],["Hourglass","hourglass"],["Stage","stage"]],mt=[...Array(11).keys()].map((e=>50*e)),ft={};var pt={general:{locale:gt("lang",null),sound:gt("sound",!0),theme:{availableBackgroundThemes:[{key:"dark",name:"dark",ext:""},{key:"light",name:"light",ext:""},{key:"system",name:"bgThemeSyncWithSystem",ext:""},{key:"bgshapes",name:"Shapes",ext:"jpg"},{key:"anthracite",name:"Anthracite",ext:"jpg"},{key:"blue-maze",name:"Blue Maze",ext:"jpg"},{key:"red-maze",name:"Red Maze",ext:"jpg"},{key:"checkerboard",name:"Checkerboard",ext:"png"},{key:"wood",name:"Wood",ext:"jpg"},{key:"space",name:"Space",ext:"jpg"}],availableBoardThemes:[{key:"blue",name:"Blue",ext:"svg"},{key:"blue2",name:"Blue 2",ext:"jpg"},{key:"blue3",name:"Blue 3",ext:"jpg"},{key:"blue-marble",name:"Blue Marble",ext:"jpg"},{key:"canvas",name:"Canvas",ext:"jpg"},{key:"wood",name:"Wood",ext:"jpg"},{key:"wood2",name:"Wood 2",ext:"jpg"},{key:"wood3",name:"Wood 3",ext:"jpg"},{key:"wood4",name:"Wood 4",ext:"jpg"},{key:"maple",name:"Maple",ext:"jpg"},{key:"maple2",name:"Maple 2",ext:"jpg"},{key:"brown",name:"Brown",ext:"svg"},{key:"leather",name:"Leather",ext:"jpg"},{key:"green",name:"Green",ext:"svg"},{key:"marble",name:"Marble",ext:"jpg"},{key:"green-plastic",name:"Green Plastic",ext:"png"},{key:"grey",name:"Grey",ext:"jpg"},{key:"metal",name:"Metal",ext:"jpg"},{key:"olive",name:"Olive",ext:"jpg"},{key:"newspaper",name:"Newspaper",ext:"png"},{key:"purple",name:"Purple",ext:"svg"},{key:"purple-diag",name:"Purple 2",ext:"png"},{key:"pink",name:"Pink",ext:"png"},{key:"ic",name:"IC",ext:"svg"},{key:"horsey",name:"horsey",ext:"jpg"}],bundledBoardThemes:["brown","blue","green","purple","ic"],availablePieceThemes:[["cburnett","Colin M.L. Burnett"],["merida"],["pirouetti"],["chessnut"],["chess7"],["alpha"],["reilly"],["companion"],["riohacha"],["kosal"],["leipzig"],["fantasy"],["spatial"],["california"],["pixel"],["maestro"],["fresca"],["cardinal"],["gioco"],["tatiana"],["staunty"],["governor"],["symmetric"],["dubrovny"],["icpieces"],["libra"],["shapes"],["letter"],["horsey"],["anarcandy"]],background:gt("bgTheme","dark"),board:gt("theme.board","brown"),piece:gt("theme.piece","cburnett")},vibrateOnGameEvents:gt("vibrateOnGameEvents",!1),notifications:{enable:gt("notifications",!0),vibrate:gt("notifications.vibrate",!0),sound:gt("notifications.sound",!0)}},game:{supportedVariants:["standard","chess960","antichess","fromPosition","kingOfTheHill","threeCheck","atomic","horde","racingKings","crazyhouse"],animations:gt("gameAnimations",!0),highlights:gt("boardHighlights",!0),pieceDestinations:gt("pieceDestinations",!0),coords:gt("coords",!0),magnified:gt("pieceMagnified",!0),pieceNotation:gt("pieceNotation",!0),zenMode:gt("zenMode",!1),blindfoldChess:gt("blindfoldChess",!1),clockPosition:gt("game.inversedClockPos","right"),pieceMove:gt("game.pieceMove","both"),rookCastle:gt("game.rookCastle",1),moveList:gt("game.moveList",!0),landscapeBoardSide:gt("game.landscapeBoardSide","left")},analyse:{supportedVariants:["standard","chess960","antichess","fromPosition","kingOfTheHill","threeCheck","atomic","horde","racingKings","crazyhouse"],availableVariants:dt,syntheticVariant:gt("analyse.syntheticVariant","standard"),enableCeval:gt("analyse.enableCeval",!1),cevalMultiPvs:gt("ceval.multipv",1),cevalCores:gt("ceval.cores",1),cevalHashSize:gt("ceval.hashSize",16),cevalUseNNUE:gt("ceval.useNNUE",!0),cevalInfinite:gt("ceval.infinite",!1),cevalMaxDepth:gt("ceval.maxDepth",18),showBestMove:gt("analyse.showBestMove",!0),showComments:gt("analyse.showComments",!0),smallBoard:gt("analyse.smallBoard",!0),explorer:{db:gt("analyse.explorer.db","lichess"),availableRatings:[1600,1800,2e3,2200,2500],rating:gt("analyse.explorer.rating",[1600,1800,2e3,2200,2500]),availableSpeeds:["bullet","blitz","rapid","classical"],speed:gt("analyse.explorer.speed",["bullet","blitz","rapid","classical"])}},ai:{availableOpponents:[["Stockfish","1"],["Stockfish","2"],["Stockfish","3"],["Stockfish","4"],["Stockfish","5"],["Stockfish","6"],["Stockfish","7"],["Stockfish","8"]],color:gt("ai.color","white"),opponent:gt("ai.opponent","1"),variant:gt("ai.variant","standard"),availableVariants:dt},otb:{flipPieces:gt("otb.flipPieces",!1),useSymmetric:gt("otb.useSymmetric",!1),variant:gt("otb.variant","standard"),availableVariants:dt,whitePlayer:gt("otb.whitePlayer","White"),blackPlayer:gt("otb.blackPlayer","Black"),clockType:gt("otb.clockType","none"),availableClocks:[["None","none"]].concat(ht)},clock:{availableClocks:ht,clockType:gt("clock.clockType","simple"),simple:{time:gt("clock.simple.time","5")},increment:{time:gt("clock.increment.time","3"),increment:gt("clock.increment.increment","2")},handicapInc:{topTime:gt("clock.handicapInc.topTime","3"),topIncrement:gt("clock.handicapInc.topIncrement","2"),bottomTime:gt("clock.handicapInc.bottomTime","3"),bottomIncrement:gt("clock.handicapInc.bottomIncrement","2")},delay:{time:gt("clock.delay.time","3"),increment:gt("clock.delay.increment","2")},bronstein:{time:gt("clock.bronstein.time","3"),increment:gt("clock.bronstein.increment","2")},hourglass:{time:gt("clock.hourglass.time","5")},stage:{stages:gt("clock.stage.stages",[{time:"120",moves:"40"},{time:"60",moves:null}]),increment:gt("clock.stage.increment","30")},availableTimes:[["0","0"],["½","0.5"],["¾","0.75"],["1","1"],["2","2"],["3","3"],["4","4"],["5","5"],["6","6"],["7","7"],["8","8"],["9","9"],["10","10"],["15","15"],["20","20"],["25","25"],["30","30"],["45","45"],["60","60"],["90","90"],["120","120"],["150","150"],["180","180"]],availableIncrements:["0","1","2","3","4","5","6","7","8","9","10","15","20","25","30","45","60","90","120","150","180"],availableMoves:["5","10","15","20","25","30","35","40","45","50","55","60"]},gameSetup:{availableTimes:[["0","0"],["¼","0.25"],["½","0.5"],["¾","0.75"],["1","1"],["2","2"],["3","3"],["4","4"],["5","5"],["6","6"],["7","7"],["8","8"],["9","9"],["10","10"],["15","15"],["20","20"],["25","25"],["30","30"],["45","45"],["60","60"],["90","90"],["120","120"],["150","150"],["180","180"]],availableIncrements:["0","1","2","3","4","5","6","7","8","9","10","15","20","25","30","45","60","90","120","150","180"],availableDays:["1","2","3","5","7","10","14"],isTimeValid:function(e){return"1"!==e.timeMode()||"0"!==e.time()||"0"!==e.increment()},ai:{color:gt("game.ai.color","random"),availableVariants:[["Standard","1"],["Crazyhouse","10"],["Chess960","2"],["King of the Hill","4"],["Three-check","5"],["Antichess","6"],["Atomic","7"],["Horde","8"],["Racing Kings","9"],["From Position","3"]],variant:gt("game.ai.variant","1"),availableTimeModes:[["unlimited","0"],["realTime","1"]],timeMode:gt("game.ai.clock","1"),time:gt("game.ai.time","10"),increment:gt("game.ai.increment","0"),days:gt("game.ai.days","2"),level:gt("game.ai.aiLevel","3")},human:{availableVariants:[["Standard","1"],["Crazyhouse","10"],["Chess960","2"],["King of the Hill","4"],["Three-check","5"],["Antichess","6"],["Atomic","7"],["Horde","8"],["Racing Kings","9"]],availableRatingRanges:{min:[...mt].reverse().map((e=>["-"+e,"-"+e])),max:mt.map((e=>["+"+e,"+"+e]))},ratingRangeMin:gt("game.human.rating.range_min","-500"),ratingRangeMax:gt("game.human.rating.range_max","+500"),color:gt("game.human.color","random"),variant:gt("game.human.variant","1"),availableTimeModes:[["realTime","1"],["correspondence","2"],["unlimited","0"]],timeMode:gt("game.human.clock","1"),time:gt("game.human.time","5"),increment:gt("game.human.increment","0"),days:gt("game.human.days","2"),mode:gt("game.human.mode","0"),preset:gt("game.human.preset","quick"),pool:gt("game.human.pool","")},challenge:{availableVariants:[["Standard","1"],["Crazyhouse","10"],["Chess960","2"],["King of the Hill","4"],["Three-check","5"],["Antichess","6"],["Atomic","7"],["Horde","8"],["Racing Kings","9"],["From Position","3"]],color:gt("game.invite.color","random"),variant:gt("game.invite.variant","1"),availableTimeModes:[["realTime","1"],["correspondence","2"],["unlimited","0"]],timeMode:gt("game.invite.clock","1"),time:gt("game.invite.time","5"),increment:gt("game.invite.increment","0"),days:gt("game.invite.days","2"),mode:gt("game.invite.mode","0")}},tournament:{availableVariants:[["Standard","1"],["Crazyhouse","10"],["Chess960","2"],["King of the Hill","4"],["Three-check","5"],["Antichess","6"],["Atomic","7"],["Horde","8"],["Racing Kings","9"]],availableModes:[["Casual","0"],["Rated","1"]],availableTimes:[["0","0"],["½","0.5"],["¾","0.75"],["1","1"],["1.5","1.5"]].concat(ut(2,7,1)).concat(ut(10,25,5)).concat(ut(30,60,10)),availableIncrements:lt(0,7,1).concat(lt(10,25,5)).concat(lt(30,60,10)),availableDurations:lt(20,55,5).concat(lt(60,110,10)).concat(lt(120,360,30)).concat(lt(420,540,60)).concat(["600","720"]),availableTimesToStart:["1","2","3","5","10","15","20","30","45","60"],variant:gt("tournament.variant","1"),mode:gt("tournament.mode","0"),time:gt("tournament.time","5"),increment:gt("tournament.increment","0"),duration:gt("tournament.duration","45"),timeToStart:gt("tournament.timeToStart","15"),position:gt("tournament.timeToStart","15"),private:gt("tournament.private",!1),join:{lastTeam:gt("tournament.join.lastTeam","")}},tv:{channel:gt("tv.channel","best")},importer:{analyse:gt("importer.analyse",!1)},training:{puzzleBufferLen:50,ratingDiffThreshold:100},coordinates:{colorChoice:gt("coordinates.colorChoice","random")},study:{tour:gt("study.tour",null)}};function gt(e,t){return function(n){if(void 0!==n)return ot(ft,e,n),nt.set("settings",ft).then((()=>{})),n;const r=at(ft,e);return void 0!==r?r:t}}const vt={},bt={day:"2-digit",month:"long",year:"numeric"},wt=Object.assign(Object.assign({},bt),{hour:"2-digit",minute:"2-digit"});let yt,kt="en-GB",Pt={},Ct=new Intl.NumberFormat,Tt=new Intl.DateTimeFormat(void 0,bt),St=new Intl.DateTimeFormat(void 0,wt);function Et(e,...t){const n=Pt[e]||Ht[e];return n?Mt(n,...t):e}function xt(e,...t){const n=Pt[e]||Ht[e];return n?function(e,...t){const n=e.split(/(%(?:\d\$)?s)/g);for(let e=1;e<=t.length;e++){const r=n.indexOf("%"+e+"$s");-1!==r&&(n[r]=t[e-1])}for(let e=0;e<t.length;e++){const r=n.indexOf("%s");if(-1===r)break;n[r]=t[e]}return n}(n,...t):e}function Ot(e,t,n){const r=e+":"+function(e,t){const n=t%100,r=t%10;switch(At(e)){case"fr":case"ff":case"kab":return t<2?"one":"other";case"cs":case"sk":return 1===t?"one":t>=2&&t<=4?"few":"other";case"hr":case"ru":case"sr":case"uk":case"be":case"bs":case"sh":return 1===r&&11!==n?"one":r>=2&&r<=4&&!(n>=12&&n<=14)?"few":0===r||r>=5&&r<=9||n>=11&&n<=14?"many":"other";case"lv":return 0===t?"zero":t%10==1&&t%100!=11?"one":"other";case"lt":return 1!==r||n>=11&&n<=19?r>=2&&r<=9&&!(n>=11&&n<=19)?"few":"other":"one";case"pl":return 1===t?"one":r>=2&&r<=4&&!(n>=12&&n<=14)?"few":"other";case"ro":case"mo":return 1===t?"one":0===t||n>=1&&n<=19?"few":"other";case"sl":return 1===n?"one":2===n?"two":n>=3&&n<=4?"few":"other";case"ar":return 0===t?"zero":1===t?"one":2===t?"two":n>=3&&n<=10?"few":n>=11&&n<=99?"many":"other";case"mk":return t%10==1&&11!==t?"one":"other";case"cy":case"br":return 0===t?"zero":1===t?"one":2===t?"two":3===t?"few":6===t?"many":"other";case"mt":return 1===t?"one":0===t||n>=2&&n<=10?"few":n>=11&&n<=19?"many":"other";case"ga":case"se":case"sma":case"smi":case"smj":case"smn":case"sms":return 1===t?"one":2===t?"two":"other";case"ak":case"am":case"bh":case"fil":case"tl":case"guw":case"hi":case"ln":case"mg":case"nso":case"ti":case"wa":return 0===t||1===t?"one":"other";case"az":case"bm":case"fa":case"ig":case"hu":case"ja":case"kde":case"kea":case"ko":case"my":case"ses":case"sg":case"to":case"tr":case"vi":case"wo":case"yo":case"zh":case"bo":case"dz":case"id":case"jv":case"ka":case"km":case"kn":case"ms":case"th":case"tp":case"io":case"ia":return"other";default:return 1===t?"one":"other"}}(kt,t),i=Pt[r]||Pt[e+":other"]||Pt[e];return i?Mt(i,void 0!==n?n:t):e}function Mt(e,...t){let n=e;if(t.length){if(n.includes("$s"))for(let e=1;e<4;e++)n=n.replace("%"+e+"$s",String(t[e-1]));for(const e of t)n=n.replace("%s",String(e))}return n}function Nt(e){return Ct.format(e)}function jt(e){return Tt.format(e)}function _t(e){return St.format(e)}function Lt(e){const t=new Date(0);return se(t,et(t,e),{locale:yt})}function Dt(e){return function(e,t,n){V(2,arguments);var r=K(e),i=K(t),a=n||{},o=a.locale||oe;if(!o.localize)throw new RangeError("locale must contain localize property");if(!o.formatLong)throw new RangeError("locale must contain formatLong property");if(!o.formatRelative)throw new RangeError("locale must contain formatRelative property");var s,c=le(r,i);if(isNaN(c))throw new RangeError("Invalid time value");s=c<-6?"other":c<-1?"lastWeek":c<0?"yesterday":c<1?"today":c<2?"tomorrow":c<7?"nextWeek":"other";var l=me(r,G(r)),u=me(i,G(i)),d=o.formatRelative(s,l,u,a);return Je(r,d,a)}(e,new Date,{locale:yt})}function It(e,t=!1){return function(e,t){return V(1,arguments),se(e,Date.now(),t)}(e,{locale:yt,addSuffix:t})}function At(e){return e.split("-")[0]}function Rt(e){return Ft[e]||qt.find((t=>At(t)===e))}function Bt(){return kt}function $t(e){return function(e){const t=Ut[e]?e:"en-GB";return import("./i18n/"+t+".js").then((({default:e})=>(kt=t,Pt=Object.assign(Object.assign({},vt),e),Ct=new Intl.NumberFormat(t),Tt=new Intl.DateTimeFormat(t,bt),St=new Intl.DateTimeFormat(t,wt),t)))}(e).then(pt.general.locale).then((()=>function(e){if("en-GB"===e)return Promise.resolve(e);const t=zt.includes(e)?e:At(e);return import(`./i18n/date/${t}.js`).then((t=>(yt=t.default||void 0,e))).catch((()=>(yt=void 0,e)))}(e)))}const zt=["ar-DZ","ar-MA","ar-SA","en-AU","en-CA","en-GB","en-IN","en-US","fa-IR","fr-CA","fr-CH","nl-BE","pt-BR","zh-CN","zh-TW"];const Ut={"af-ZA":"Afrikaans","an-ES":"aragonés","ar-SA":"العربية","as-IN":"অসমীয়া","az-AZ":"Azərbaycanca","be-BY":"Беларуская","bg-BG":"български език","bn-BD":"বাংলা","br-FR":"brezhoneg","bs-BA":"bosanski","ca-ES":"Català, valencià","cs-CZ":"čeština","cv-CU":"чӑваш чӗлхи","cy-GB":"Cymraeg","da-DK":"Dansk","de-CH":"Schwiizerdüütsch","de-DE":"Deutsch","el-GR":"Ελληνικά","en-GB":"English","en-US":"English (US)","eo-UY":"Esperanto","es-ES":"español","et-EE":"eesti keel","eu-ES":"Euskara","fa-IR":"فارسی","fi-FI":"suomen kieli","fo-FO":"føroyskt","fr-FR":"français","frp-IT":"arpitan","fy-NL":"Frysk","ga-IE":"Gaeilge","gd-GB":"Gàidhlig","gl-ES":"Galego","gu-IN":"ગુજરાતી","he-IL":"עִבְרִית","hi-IN":"हिन्दी, हिंदी","hr-HR":"hrvatski","hu-HU":"Magyar","hy-AM":"Հայերեն","ia-IA":"Interlingua","id-ID":"Bahasa Indonesia","io-EN":"Ido","is-IS":"Íslenska","it-IT":"Italiano","ja-JP":"日本語","jbo-EN":"lojban","jv-ID":"basa Jawa","ka-GE":"ქართული","kab-DZ":"Taqvaylit","kk-KZ":"қазақша","kmr-TR":"Kurdî (Kurmancî)","kn-IN":"ಕನ್ನಡ","ko-KR":"한국어","ky-KG":"кыргызча","la-LA":"lingua Latina","lb-LU":"Lëtzebuergesch","lt-LT":"lietuvių kalba","lv-LV":"latviešu valoda","mg-MG":"fiteny malagasy","mk-MK":"македонски јази","ml-IN":"മലയാളം","mn-MN":"монгол","mr-IN":"मराठी","nb-NO":"Norsk bokmål","ne-NP":"नेपाली","nl-NL":"Nederlands","nn-NO":"Norsk nynorsk","pi-IN":"पालि","pl-PL":"polski","ps-AF":"پښتو","pt-PT":"Português","pt-BR":"Português (BR)","ro-RO":"Română","ru-RU":"русский язык","sa-IN":"संस्कृत","sk-SK":"slovenčina","sl-SI":"slovenščina","sq-AL":"Shqip","sr-SP":"Српски језик","sv-SE":"svenska","sw-KE":"Kiswahili","ta-IN":"தமிழ்","tg-TJ":"тоҷикӣ","th-TH":"ไทย","tk-TM":"Türkmençe","tl-PH":"Tagalog","tp-TP":"toki pona","tr-TR":"Türkçe","uk-UA":"українська","ur-PK":"اُردُو","uz-UZ":"oʻzbekcha","vi-VN":"Tiếng Việt","yo-NG":"Yorùbá","zh-CN":"中文","zh-TW":"繁體中文","zu-ZA":"isiZulu"},qt=Object.keys(Ut),Ft={de:"de-DE",en:"en-US",pt:"pt-PT",zh:"zh-CN"},Ht={apiUnsupported:"Your version of lichess app is too old! Please upgrade for free to the latest version.",apiDeprecated:"Upgrade for free to the latest lichess app! Support for this version will be dropped on %s.",playerisInvitingYou:"%s is inviting you",unsupportedVariant:"Variant %s is not supported in this version",notesSynchronizationHasFailed:"Notes synchronization with lichess has failed, please try later.",localEvalCaution:"Caution: intensive usage will drain battery.",incorrectThreefoldClaim:"Incorrect threefold repetition claim.",vibrateOnGameEvents:"Vibrate on game events",offline:"Offline"},Wt=Object.assign({},{apiVersion:5,fetchTimeoutMs:15e3},window.lichess);var Gt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Vt(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}var Kt=Vt((function(e){
/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
 */
!function(t){function n(e,t,n,r,i){this._listener=t,this._isOnce=n,this.context=r,this._signal=e,this._priority=i||0}function r(e,t){if("function"!=typeof e)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function i(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){i.prototype.dispatch.apply(e,arguments)}}n.prototype={active:!0,params:null,execute:function(e){var t,n;return this.active&&this._listener&&(n=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,n),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},i.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,t,r,i){var a,o=this._indexOfListener(e,r);if(-1!==o){if((a=this._bindings[o]).isOnce()!==t)throw new Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else a=new n(this,e,t,r,i),this._addBinding(a);return this.memorize&&this._prevParams&&a.execute(this._prevParams),a},_addBinding:function(e){var t=this._bindings.length;do{--t}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var n,r=this._bindings.length;r--;)if((n=this._bindings[r])._listener===e&&n.context===t)return r;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,n){return r(e,"add"),this._registerListener(e,!1,t,n)},addOnce:function(e,t,n){return r(e,"addOnce"),this._registerListener(e,!0,t,n)},remove:function(e,t){r(e,"remove");var n=this._indexOfListener(e,t);return-1!==n&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),e},removeAll:function(){for(var e=this._bindings.length;e--;)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var t,n=Array.prototype.slice.call(arguments),r=this._bindings.length;if(this.memorize&&(this._prevParams=n),r){t=this._bindings.slice(),this._shouldPropagate=!0;do{r--}while(t[r]&&this._shouldPropagate&&!1!==t[r].execute(n))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var a=i;a.Signal=i,e.exports?e.exports=a:t.signals=a}(Gt)})),Yt={redraw:new Kt.Signal,afterLogin:new Kt.Signal,afterLogout:new Kt.Signal,sessionRestored:new Kt.Signal,homePong:new Kt.Signal,gameBackButton:new Kt.Signal};let Xt=new Set,Qt=!1;function Jt(e){Xt.add(e),Qt||(Qt=!0,requestAnimationFrame((e=>{const t=Xt;Qt=!1,Xt=new Set,t.forEach((t=>t(e)))})))}function Zt(e){Xt.delete(e)}const en=Yt.redraw.dispatch;function tn(){Jt(en)}let nn,rn;function an(){return nn||on()}function on(){const e=window.crypto.getRandomValues(new Uint8Array(9));return nn=btoa(String.fromCharCode(...e)).replace(/[/+]/g,"_"),nn}function sn(e){return new Promise(((t,n)=>{const r=new XMLHttpRequest;r.overrideMimeType("application/json"),r.open("GET",e,!0),r.onreadystatechange=()=>{4===r.readyState&&(0===r.status||200===r.status?t(JSON.parse(r.responseText)):n(r))},r.send(null)}))}function cn(e){return new Promise(((t,n)=>{if(function(e){const t=document.head.getElementsByTagName("script");for(let n=0,r=t.length;n<r;n++)if(t[n].getAttribute("src")===e)return!0;return!1}(e))setTimeout(t,0);else{const r=document.createElement("script");r.src=e,r.onload=()=>t(),r.onerror=()=>n(),document.head.appendChild(r)}}))}function ln(e){return new Promise(((t,n)=>{if(function(e){const t=document.head.getElementsByTagName("link");for(let n=0,r=t.length;n<r;n++)if(t[n].getAttribute("href")===e)return!0;return!1}(e))setTimeout(t,0);else{const r=document.createElement("link");r.rel="stylesheet",r.type="text/css",r.href=e,r.onload=()=>t(),r.onerror=()=>n(),document.head.appendChild(r)}}))}function un(e){const t=e();return tn(),t}function dn(){return rn.connected}function hn(e){const t=e.status,n=e.body;let r;r=t&&0!==t?401===t?"You are not authorized to do that.":404===t?"Resource not found.":503===t?"lichess.org is temporarily down for maintenance.":t>=500?"Server error.":"Something went wrong.":"lichess.org is unreachable.",n&&("string"==typeof n?r+=` ${n}`:"string"==typeof n.error?r+=` ${n.error}`:n.global&&n.global.constructor===Array&&(r+=` ${Et(n.global[0])}`)),H.show({text:r,duration:"short"})}function mn(e){let t="";return Object.keys(e).forEach((n=>{const r=e[n];null!=r&&(""!==t&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(r))})),t}function fn(){}g.addListener("networkStatusChange",(e=>{rn=e})),g.getStatus().then((e=>{rn=e}));const pn={bullet:"T",blitz:")",rapid:"#",classical:"+",correspondence:";",chess960:"'",kingOfTheHill:"(",threeCheck:".",antichess:"@",atomic:">",puzzle:"-",horde:"_",fromPosition:"*",racingKings:"",crazyhouse:"",ultraBullet:"{",computer:"n",bot:"n"};function gn(e){return e&&pn[e]||"8"}function vn(e){return 0===e?e:e/60}function bn(e){return"white"===e?"black":"white"}function wn(e){return e.charAt(0).toUpperCase()+e.slice(1)}function yn(e,t){return Math.random()*(t-e)+e}function kn(e,t){return"racingKings"===e.game.variant.key?t?"black":"white":t?e.opponent.color:e.player.color}function Pn(e,t){let n=e+"";for(;n.length<t;)n="0"+n;return n}function Cn(e,t="hour_min_secs"){let n="";const r=Math.floor(e/60/60),i=Math.floor(e/60)-60*r,a=e%60;return n="hour_min_secs"===t?r>0?r+":"+Pn(i,2)+":"+Pn(a,2):i+":"+Pn(a,2):Pn(a,2),n}function Tn(e){const t=Math.floor(e/60),n=Math.floor(e-60*t);return(t?t+"H ":"")+(n?n+"M":"")}function Sn(e){if(e){const t=vn(e.limit);return(.25===t?"¼":.5===t?"½":.75===t?"¾":t.toString())+"+"+e.increment}return"∞"}function En(e){return null!=e}function xn(e){return`${Wt.apiEndPoint}/assets/${e}`}function On(e){const t=Number(e);return isNaN(t)?void 0:t}function Mn(e){if(!(void 0===e||e.length>7||0===e.length||/[^a-zA-Z0-9]/.exec(e)))return e.split("").reduce(((e,t,n)=>e+function(e){const t=e.charCodeAt(0);return t>96?t-71:t>64?t-65:t+4}(t)*Math.pow(62,n)),0)}const Nn=window.requestIdleCallback||window.setTimeout;function jn(e){let t=e;return e=>(void 0!==e&&(t=e),t)}function _n(e){return e?250:0}function Ln(){return Math.random()>.5?"white":"black"}function Dn(e,t){return"1"===e&&-1!==["5","6","7","8","9"].indexOf(t)?[["randomColor","random"]]:[["randomColor","random"],["white","white"],["black","black"]]}function In(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return y(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),F(e,t,{leading:r,maxWait:t,trailing:i})}function An(e){try{return window.localStorage?e(window.localStorage):null}catch(e){}}var Rn={get:function(e){return An((t=>{const n=t.getItem(e);return n?JSON.parse(n):null}))},set:function(e,t){An((n=>{try{n.setItem(e,JSON.stringify(t))}catch(r){n.removeItem(e),n.setItem(e,JSON.stringify(t))}}))},remove:function(e){An((t=>{t.removeItem(e)}))}};function Bn(e,t,n,r,i,a){return{tag:e,key:t,attrs:n,children:r,text:i,dom:a,domSize:void 0,state:void 0,events:void 0,instance:void 0}}Bn.normalize=function(e){return Array.isArray(e)?Bn("[",void 0,void 0,Bn.normalizeChildren(e),void 0,void 0):null==e||"boolean"==typeof e?null:"object"==typeof e?e:Bn("#",void 0,void 0,String(e),void 0,void 0)},Bn.normalizeChildren=function(e){var t=[];if(window.lichess&&"dev"===window.lichess.mode&&e.length)for(var n=null!=e[0]&&null!=e[0].key,r=1;r<e.length;r++)if((null!=e[r]&&null!=e[r].key)!==n)throw new TypeError(!n||null==e[r]&&"boolean"!=typeof e[r]?"In fragments, vnodes must either all have keys or none have keys.":"In fragments, vnodes must either all have keys or none have keys. You may wish to consider using an explicit keyed empty fragment, m.fragment({key: ...}), instead of a hole.");for(r=0;r<e.length;r++)t[r]=Bn.normalize(e[r]);return t};var $n=Bn,zn=function(){var e,t=arguments[this],n=this+1;if(null==t?t={}:("object"!=typeof t||null!=t.tag||Array.isArray(t))&&(t={},n=this),arguments.length===n+1)e=arguments[n],Array.isArray(e)||(e=[e]);else for(e=[];n<arguments.length;)e.push(arguments[n++]);return $n("",t.key,t,e)},Un={}.hasOwnProperty,qn=/(?:(^|#|\.)([^#\.\[\]]+))|(\[(.+?)(?:\s*=\s*("|'|)((?:\\["'\]]|.)*?)\5)?\])/g,Fn={};function Hn(e){for(var t in e)if(Un.call(e,t))return!1;return!0}function Wn(e){for(var t,n="div",r=[],i={};t=qn.exec(e);){var a=t[1],o=t[2];if(""===a&&""!==o)n=o;else if("#"===a)i.id=o;else if("."===a)r.push(o);else if("["===t[3][0]){var s=t[6];s&&(s=s.replace(/\\(["'])/g,"$1").replace(/\\\\/g,"\\")),"class"===t[4]?r.push(s):i[t[4]]=""===s?s:s||!0}}return r.length>0&&(i.className=r.join(" ")),Fn[e]={tag:n,attrs:i}}function Gn(e,t){var n=t.attrs,r=$n.normalizeChildren(t.children),i=Un.call(n,"class"),a=i?n.class:n.className;if(t.tag=e.tag,t.attrs=null,t.children=void 0,!Hn(e.attrs)&&!Hn(n)){var o={};for(var s in n)Un.call(n,s)&&(o[s]=n[s]);n=o}for(var s in e.attrs)Un.call(e.attrs,s)&&"className"!==s&&!Un.call(n,s)&&(n[s]=e.attrs[s]);for(var s in null==a&&null==e.attrs.className||(n.className=null!=a?null!=e.attrs.className?String(e.attrs.className)+" "+String(a):a:null!=e.attrs.className?e.attrs.className:null),i&&(n.class=null),n)if(Un.call(n,s)&&"key"!==s){t.attrs=n;break}return Array.isArray(r)&&1===r.length&&null!=r[0]&&"#"===r[0].tag?t.text=r[0].children:t.children=r,t}var Vn=function(e){if(null==e||"string"!=typeof e&&"function"!=typeof e&&"function"!=typeof e.view)throw Error("The selector must be either a string or a component.");var t=zn.apply(1,arguments);return"string"==typeof e&&(t.children=$n.normalizeChildren(t.children),"["!==e)?Gn(Fn[e]||Wn(e),t):(t.tag=e,t)};Vn.trust=function(e){return null==e&&(e=""),$n("<",void 0,void 0,e,void 0,void 0)},Vn.fragment=function(){var e=zn.apply(0,arguments);return e.tag="[",e.children=$n.normalizeChildren(e.children),e};var Kn=Vn;let Yn;var Xn={spin(){if(void 0!==Yn||document.getElementById("globalSpinner"))return;const e=document.createElement("div");e.id="globalSpinner",e.className="spinner globalSpinner";const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("viewBox","0 0 40 40");const n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx","20"),n.setAttribute("cy","20"),n.setAttribute("r","18"),n.setAttribute("fill","none"),t.appendChild(n),e.appendChild(t),Yn=setTimeout((()=>{document.body.appendChild(e)}),200)},stop(){clearTimeout(Yn),Yn=void 0;const e=document.getElementsByClassName("globalSpinner");e.length&&setTimeout((function(){for(;e[0];)document.body.removeChild(e[0])}),500)},getVdom:e=>Kn("div.spinner",{className:e||""},[Kn("svg",{viewBox:"0 0 40 40"},[Kn("circle",{cx:"20",cy:"20",r:"18",fill:"none"})])]),getHtml:()=>'<div class="spinner monochrome"><svg viewBox="0 0 40 40"><circle cx=20 cy=20 r=18 fill="none"></circle></svg></div>'};function Qn(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e.toString():"";default:return""}}function Jn(e,t,n,r){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map((r=>{const i=encodeURIComponent(Qn(r))+n;return Array.isArray(e[r])?e[r].map((e=>i+encodeURIComponent(Qn(e)))).join(t):i+encodeURIComponent(Qn(e[r]))})).join(t):r?encodeURIComponent(Qn(r))+n+encodeURIComponent(Qn(e)):""}var Zn=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const er="sessionId",tr=Wt.apiEndPoint;function nr(e,t,n,r=!1){let i;function a(){clearTimeout(i),r&&Xn.stop()}const o=new Headers({"X-Requested-With":"XMLHttpRequest",Accept:"application/vnd.lichess.v"+Wt.apiVersion+"+json"}),s=Rn.get("sessionId");null!=s&&o.append("sessionId",s);const c={method:"GET",credentials:"include"};let l;if(void 0!==n){const{headers:t,query:r,timeout:i}=n,a=Zn(n,["headers","query","timeout"]);if(l=i,r){const t=Jn(r);""!==t&&(e=function(e,t){const n=e.indexOf("?")<0?"?":"&";return e+n+t}(e,t))}Object.assign(c,a),t&&Object.keys(t).forEach((e=>{const n=t[e];"__delete"!==n?o.set(e,n):o.delete(e)}))}"POST"!==c.method&&"PUT"!==c.method||o.has("Content-Type")||(o.set("Content-Type","application/json; charset=UTF-8"),c.body||(c.body="{}"));const u=e.indexOf("http")>-1?e:tr+e,d=new Promise(((e,t)=>{i=setTimeout((()=>t(new Error("Request timeout."))),l||Wt.fetchTimeoutMs)})),h=Promise.race([fetch(u,Object.assign(Object.assign({},c),{headers:o})),d]);return r&&Xn.spin(),new Promise(((e,n)=>{h.then((r=>{a(),r.ok?e(r[t]()):r.text().then((e=>{try{n({status:r.status,body:JSON.parse(e)})}catch(e){n({status:r.status,body:r.statusText})}}))})).catch((e=>{a(),n({status:0,body:e.message})}))}))}function rr(e,t,n=!1){return nr(e,"json",t,n)}function ir(e,t,n=!1){return nr(e,"text",t,n)}const ar=a("PushNotifications",{}),or=a("SoundEffect",{web:()=>import("./web-5ad10ebf.js").then((e=>new e.SoundEffectWeb))});let sr=!0;function cr(){return sr}let lr=void 0!==window.AudioContext?new AudioContext:null;var ur={load:()=>Promise.all([hr("move"),hr("capture"),hr("explosion"),hr("lowtime"),hr("dong"),hr("berserk"),hr("clock"),hr("confirmation")]).then((()=>{})),resume(){null!=lr&&(lr.close(),lr=new AudioContext)},move(){mr("move")},throttledMove:In((()=>{mr("move")}),50),capture(){mr("capture")},throttledCapture:In((()=>{mr("capture")}),50),explosion(){mr("explosion")},throttledExplosion:In((()=>{mr("explosion")}),50),lowtime(){mr("lowtime")},dong(){mr("dong")},berserk(){mr("berserk")},clock(){mr("clock")},confirmation(){mr("confirmation")}};const dr={};async function hr(e){const t=`sounds/${e}.mp3`;"ios"===i.getPlatform()&&null!=lr?window.fetch(t).then((e=>e.arrayBuffer())).then((e=>lr.decodeAudioData(e))).then((t=>dr[e]=t)):or.loadSound({id:e,path:t})}function mr(e){if(pt.general.sound()&&cr())if("ios"===i.getPlatform()&&null!=lr){const t=lr.createBufferSource();t.buffer=dr[e],t.connect(lr.destination),t.start()}else or.play({id:e})}const fr=a("Dialog",{web:()=>import("./web-58f151bf.js").then((e=>new e.DialogWeb))});function pr(e){return{mode:Number(e.mode()),variant:Number(e.variant()),timeMode:Number(e.timeMode()),time:Number(e.time()),increment:Number(e.increment()),days:Number(e.days()),color:e.color(),ratingRangeMin:Number(e.ratingRangeMin()),ratingRangeMax:Number(e.ratingRangeMax())}}function gr(e,t){const{ratingRangeMin:n,ratingRangeMax:r}=t;let i="correspondence";switch(t.variant){case 1:case 3:if(1===t.timeMode){const e=60*t.time+40*t.increment;i=e<30?"ultraBullet":e<180?"bullet":e<480?"blitz":e<1500?"rapid":"classical"}break;case 2:i="chess960";break;case 4:i="kingOfTheHill";break;case 5:i="threeCheck";break;case 6:i="antichess";break;case 7:i="atomic";break;case 8:i="horde";break;case 9:i="racingKings";break;case 10:i="crazyhouse"}const a=e.perfs[i];return a&&void 0!==n&&void 0!==r?`${a.rating+n}-${a.rating+r}`:null}var vr=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function br(e){const t=pt.gameSetup.ai,n={variant:t.variant(),timeMode:t.timeMode(),days:t.days(),time:t.time(),increment:t.increment(),level:t.level(),color:t.color()};return e&&(n.fen=e),rr("/setup/ai",{method:"POST",body:JSON.stringify(n)},!0)}function wr(e){const t=vr(e,["ratingRangeMin","ratingRangeMax"]),n=Si.get(),r=n?gr(n,e):null,i=r?Object.assign(Object.assign({},t),{ratingRange:r}):Object.assign({},t);return rr("/setup/hook/"+an(),{method:"POST",body:JSON.stringify(i)},!0)}function yr(){return rr("/challenge")}function kr(e){return rr(`/challenge/${e}`,{},!0)}function Pr(e){return ir(`/challenge/${e}/cancel`,{method:"POST"},!0)}function Cr(e){return ir(`/challenge/${e}/decline`,{method:"POST"},!0)}function Tr(e){return rr(`/challenge/${e}/accept`,{method:"POST"},!0)}let Sr=[];function Er(e){return rr("/",void 0,e).then((e=>(void 0!==e.lobby.pools&&(Sr=e.lobby.pools),e)))}function xr(e){return rr("/lobby/seeks",{query:{_:Date.now()}},e)}function Or(e,t){let n="/"+e;return t&&(n+="/"+t),rr(n)}function Mr(e){return ir("/bookmark/"+e,{method:"POST"})}function Nr(e,t){return rr("/tv/"+e,t?{query:{flip:1}}:{})}function jr(e,t){return rr(`/import/master/${e}/${t}`)}function _r(e){return Si.isConnected()?rr("/translation/select",{method:"POST",body:JSON.stringify({lang:e})}).then((()=>{})):Promise.resolve()}function Lr(e){return rr(`/@/${e}/mini`)}function Dr(){return rr("/timeline",{query:{nb:10}},!1)}let Ir=[],Ar=[];function Rr(e){return-1!==pt.game.supportedVariants.indexOf(e.variant.key)&&"created"===e.status}function Br(e){e.in.length>Ir.length&&ur.dong(),Ir=e.in,Ar=e.out}var $r={all:()=>Ir.filter(Rr).concat(Ar.filter(Rr)),incoming:()=>Ir.filter(Rr),sending:()=>Ar.filter(Rr),set:Br,refresh:()=>In(yr,1e3)().then(Br),remove(e){Ir=Ir.filter((t=>t.id!==e)),Ar=Ar.filter((t=>t.id!==e))},isPersistent:e=>"correspondence"===e.timeControl.type||"unlimited"===e.timeControl.type,challengeTime:e=>function(e){return"clock"===e.type}(e.timeControl)?e.timeControl.show:function(e){return"correspondence"===e.type}(e.timeControl)?Ot("nbDays",e.timeControl.daysPerTurn):"∞"},zr=Vt((function(e){!function(t,n){var r=t.define;r&&r.amd?r("rlite",[],n):e.exports?e.exports=n():t.Rlite=n()}(Gt,(function(){return function(){var e={},t=decodeURIComponent;function n(e){return e}function r(r){var i=function(e){return~e.indexOf("/?")&&(e=e.replace("/?","?")),"/"==e[0]&&(e=e.slice(1)),"/"==e[e.length-1]&&(e=e.slice(0,-1)),e}(r).split("?"),a=~r.indexOf("%")?t:n;return function(e,t,n){if(e&&t.cb)for(var r=e.indexOf("#"),i=(r<0?e:e.slice(0,r)).split("&"),a=0;a<i.length;++a){var o=i[a].split("=");t.params[o[0]]=n(o[1])}return t}(i[1],function(t,n){for(var r=t.split("/"),i=e,a={},o=0;o<r.length&&i;++o){var s=n(r[o]);(i=i[s.toLowerCase()]||i[":"])&&i["~"]&&(a[i["~"]]=s)}return i&&{cb:i["@"],params:a}}(i[0],a)||{},a)}return{add:function(t,n){for(var r=t.split("/"),i=e,a=0;a<r.length;++a){var o=r[a],s=":"==o[0]?":":o.toLowerCase();i=i[s]||(i[s]={}),":"==s&&(i["~"]=o.slice(1))}i["@"]=n},exists:function(e){return!!r(e).cb},lookup:r,run:function(e){var t=r(e);return t.cb&&t.cb({url:e,params:t.params}),!!t.cb}}}}))})),Ur=function(e){var t,n=e&&e.document,r={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"};function i(e){return e.attrs&&e.attrs.xmlns||r[e.tag]}function a(e,t){if(e.state!==t)throw new Error("'vnode.state' must not be modified.")}function o(e){var t=e.state;try{return this.apply(t,arguments)}finally{a(e,t)}}function s(){try{return n.activeElement}catch(e){return null}}function c(e,t,n,r,i,a,o){for(var s=n;s<r;s++){var c=t[s];null!=c&&l(e,c,i,o,a)}}function l(e,t,r,i,a){var o=t.tag;if("string"==typeof o)switch(t.state={},null!=t.attrs&&U(t.attrs,t,r),o){case"#":!function(e,t,r){t.dom=n.createTextNode(t.children),C(e,t.dom,r)}(e,t,a);break;case"<":d(e,t,i,a);break;case"[":!function(e,t,r,i,a){var o=n.createDocumentFragment();if(null!=t.children){var s=t.children;c(o,s,0,s.length,r,null,i)}t.dom=o.firstChild,t.domSize=o.childNodes.length,C(e,o,a)}(e,t,r,i,a);break;default:h(e,t,r,i,a)}else!function(e,t,n,r,i){m(t,n),null!=t.instance?(l(e,t.instance,n,r,i),t.dom=t.instance.dom,t.domSize=null!=t.dom?t.instance.domSize:0):t.domSize=0}(e,t,r,i,a)}var u={caption:"table",thead:"table",tbody:"table",tfoot:"table",tr:"tbody",th:"tr",td:"tr",colgroup:"table",col:"colgroup"};function d(e,t,r,i){var a=t.children.match(/^\s*?<(\w+)/im)||[],o=n.createElement(u[a[1]]||"div");"http://www.w3.org/2000/svg"===r?(o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+t.children+"</svg>",o=o.firstChild):o.innerHTML=t.children,t.dom=o.firstChild,t.domSize=o.childNodes.length,t.instance=[];for(var s,c=n.createDocumentFragment();s=o.firstChild;)t.instance.push(s),c.appendChild(s);C(e,c,i)}function h(e,t,r,a,o){var s=t.tag,l=t.attrs,u=l&&l.is,d=(a=i(t)||a)?u?n.createElementNS(a,s,{is:u}):n.createElementNS(a,s):u?n.createElement(s,{is:u}):n.createElement(s);if(t.dom=d,null!=l&&function(e,t,n){for(var r in t)N(e,r,null,t[r],n)}(t,l,a),C(e,d,o),!T(t)&&(null!=t.text&&(""!==t.text?d.textContent=t.text:t.children=[$n("#",void 0,void 0,t.text,void 0,void 0)]),null!=t.children)){var h=t.children;c(d,h,0,h.length,r,null,a),"select"===t.tag&&null!=l&&function(e,t){if("value"in t)if(null===t.value)-1!==e.dom.selectedIndex&&(e.dom.value=null);else{var n=""+t.value;e.dom.value===n&&-1!==e.dom.selectedIndex||(e.dom.value=n)}"selectedIndex"in t&&N(e,"selectedIndex",null,t.selectedIndex,void 0)}(t,l)}}function m(e,t){var n;if("function"==typeof e.tag.view){if(e.state=Object.create(e.tag),null!=(n=e.state.view).$$reentrantLock$$)return;n.$$reentrantLock$$=!0}else{if(e.state=void 0,null!=(n=e.tag).$$reentrantLock$$)return;n.$$reentrantLock$$=!0,e.state=null!=e.tag.prototype&&"function"==typeof e.tag.prototype.view?new e.tag(e):e.tag(e)}if(U(e.state,e,t),null!=e.attrs&&U(e.attrs,e,t),e.instance=$n.normalize(o.call(e.state.view,e)),e.instance===e)throw Error("A view cannot return the vnode it received as argument");n.$$reentrantLock$$=null}function f(e,t,n,r,i,a){if(t!==n&&(null!=t||null!=n))if(null==t||0===t.length)c(e,n,0,n.length,r,i,a);else if(null==n||0===n.length)S(e,t,0,t.length);else{var o=null!=t[0]&&null!=t[0].key,s=null!=n[0]&&null!=n[0].key,u=0,d=0;if(!o)for(;d<t.length&&null==t[d];)d++;if(!s)for(;u<n.length&&null==n[u];)u++;if(null===s&&null==o)return;if(o!==s)S(e,t,d,t.length),c(e,n,u,n.length,r,i,a);else if(s){for(var h,m,f,g,v,P=t.length-1,C=n.length-1;P>=d&&C>=u&&(f=t[P],g=n[C],f.key===g.key);)f!==g&&p(e,f,g,r,i,a),null!=g.dom&&(i=g.dom),P--,C--;for(;P>=d&&C>=u&&(h=t[d],m=n[u],h.key===m.key);)d++,u++,h!==m&&p(e,h,m,r,y(t,d,i),a);for(;P>=d&&C>=u&&u!==C&&h.key===g.key&&f.key===m.key;)k(e,f,v=y(t,d,i)),f!==m&&p(e,f,m,r,v,a),++u<=--C&&k(e,h,i),h!==g&&p(e,h,g,r,i,a),null!=g.dom&&(i=g.dom),d++,f=t[--P],g=n[C],h=t[d],m=n[u];for(;P>=d&&C>=u&&f.key===g.key;)f!==g&&p(e,f,g,r,i,a),null!=g.dom&&(i=g.dom),C--,f=t[--P],g=n[C];if(u>C)S(e,t,d,P+1);else if(d>P)c(e,n,u,C+1,r,i,a);else{var T,x,O=i,M=C-u+1,N=new Array(M),j=0,_=0,L=2147483647,D=0;for(_=0;_<M;_++)N[_]=-1;for(_=C;_>=u;_--){null==T&&(T=b(t,d,P+1));var I=T[(g=n[_]).key];null!=I&&(L=I<L?I:-1,N[_-u]=I,f=t[I],t[I]=null,f!==g&&p(e,f,g,r,i,a),null!=g.dom&&(i=g.dom),D++)}if(i=O,D!==P-d+1&&S(e,t,d,P+1),0===D)c(e,n,u,C+1,r,i,a);else if(-1===L)for(j=(x=function(e){var t=[0],n=0,r=0,i=0,a=w.length=e.length;for(i=0;i<a;i++)w[i]=e[i];for(i=0;i<a;++i)if(-1!==e[i]){var o=t[t.length-1];if(e[o]<e[i])w[i]=o,t.push(i);else{for(n=0,r=t.length-1;n<r;){var s=(n>>>1)+(r>>>1)+(n&r&1);e[t[s]]<e[i]?n=s+1:r=s}e[i]<e[t[n]]&&(n>0&&(w[i]=t[n-1]),t[n]=i)}}n=t.length,r=t[n-1];for(;n-- >0;)t[n]=r,r=w[r];return w.length=0,t}(N)).length-1,_=C;_>=u;_--)m=n[_],-1===N[_-u]?l(e,m,r,a,i):x[j]===_-u?j--:k(e,m,i),null!=m.dom&&(i=n[_].dom);else for(_=C;_>=u;_--)m=n[_],-1===N[_-u]&&l(e,m,r,a,i),null!=m.dom&&(i=n[_].dom)}}else{var A=t.length<n.length?t.length:n.length;for(u=u<d?u:d;u<A;u++)(h=t[u])===(m=n[u])||null==h&&null==m||(null==h?l(e,m,r,a,y(t,u+1,i)):null==m?E(e,h):p(e,h,m,r,y(t,u+1,i),a));t.length>A&&S(e,t,u,t.length),n.length>A&&c(e,n,u,n.length,r,i,a)}}}function p(e,t,n,r,i,a){var s=t.tag;if(s===n.tag){if(n.state=t.state,n.events=t.events,function(e,t){do{var n;if(null!=e.attrs&&"function"==typeof e.attrs.onbeforeupdate)if(void 0!==(n=o.call(e.attrs.onbeforeupdate,e,t))&&!n)break;if("string"!=typeof e.tag&&"function"==typeof e.state.onbeforeupdate)if(void 0!==(n=o.call(e.state.onbeforeupdate,e,t))&&!n)break;return!1}while(0);return e.dom=t.dom,e.domSize=t.domSize,e.instance=t.instance,e.attrs=t.attrs,e.children=t.children,e.text=t.text,!0}(n,t))return;if("string"==typeof s)switch(null!=n.attrs&&q(n.attrs,n,r),s){case"#":!function(e,t){e.children.toString()!==t.children.toString()&&(e.dom.nodeValue=t.children);t.dom=e.dom}(t,n);break;case"<":!function(e,t,n,r,i){t.children!==n.children?(x(e,t),d(e,n,r,i)):(n.dom=t.dom,n.domSize=t.domSize,n.instance=t.instance)}(e,t,n,a,i);break;case"[":!function(e,t,n,r,i,a){f(e,t.children,n.children,r,i,a);var o=0,s=n.children;if(n.dom=null,null!=s){for(var c=0;c<s.length;c++){var l=s[c];null!=l&&null!=l.dom&&(null==n.dom&&(n.dom=l.dom),o+=l.domSize||1)}1!==o&&(n.domSize=o)}}(e,t,n,r,i,a);break;default:g(t,n,r,a)}else v(e,t,n,r,i,a)}else E(e,t),l(e,n,r,a,i)}function g(e,t,n,r){var a=t.dom=e.dom;r=i(t)||r,"textarea"===t.tag&&(null==t.attrs&&(t.attrs={}),null!=t.text&&(t.attrs.value=t.text,t.text=void 0)),function(e,t,n,r){if(null!=n)for(var i in n)N(e,i,t&&t[i],n[i],r);var a;if(null!=t)for(var i in t)null==(a=t[i])||null!=n&&null!=n[i]||j(e,i,a,r)}(t,e.attrs,t.attrs,r),T(t)||(null!=e.text&&null!=t.text&&""!==t.text?e.text.toString()!==t.text.toString()&&(e.dom.firstChild.nodeValue=t.text):(null!=e.text&&(e.children=[$n("#",void 0,void 0,e.text,void 0,e.dom.firstChild)]),null!=t.text&&(t.children=[$n("#",void 0,void 0,t.text,void 0,void 0)]),f(a,e.children,t.children,n,null,r)))}function v(e,t,n,r,i,a){if(n.instance=$n.normalize(o.call(n.state.view,n)),n.instance===n)throw Error("A view cannot return the vnode it received as argument");q(n.state,n,r),null!=n.attrs&&q(n.attrs,n,r),null!=n.instance?(null==t.instance?l(e,n.instance,r,a,i):p(e,t.instance,n.instance,r,i,a),n.dom=n.instance.dom,n.domSize=n.instance.domSize):null!=t.instance?(E(e,t.instance),n.dom=void 0,n.domSize=0):(n.dom=t.dom,n.domSize=t.domSize)}function b(e,t,n){for(var r=Object.create(null);t<n;t++){var i=e[t];if(null!=i){var a=i.key;null!=a&&(r[a]=t)}}return r}var w=[];function y(e,t,n){for(;t<e.length;t++)if(null!=e[t]&&null!=e[t].dom)return e[t].dom;return n}function k(e,t,r){var i=n.createDocumentFragment();P(e,i,t),C(e,i,r)}function P(e,t,n){for(;null!=n.dom&&n.dom.parentNode===e;){if("string"!=typeof n.tag){if(null!=(n=n.instance))continue}else if("<"===n.tag)for(var r=0;r<n.instance.length;r++)t.appendChild(n.instance[r]);else if("["!==n.tag)t.appendChild(n.dom);else if(1===n.children.length){if(null!=(n=n.children[0]))continue}else for(r=0;r<n.children.length;r++){var i=n.children[r];null!=i&&P(e,t,i)}break}}function C(e,t,n){null!=n?e.insertBefore(t,n):e.appendChild(t)}function T(e){if(null==e.attrs||null==e.attrs.contenteditable&&null==e.attrs.contentEditable)return!1;var t=e.children;if(null!=t&&1===t.length&&"<"===t[0].tag){var n=t[0].children;e.dom.innerHTML!==n&&(e.dom.innerHTML=n)}else if(null!=e.text||null!=t&&0!==t.length)throw new Error("Child node of a contenteditable must be trusted.");return!0}function S(e,t,n,r){for(var i=n;i<r;i++){var a=t[i];null!=a&&E(e,a)}}function E(e,t){var n,r,i,s=0,c=t.state;"string"!=typeof t.tag&&"function"==typeof t.state.onbeforeremove&&(null!=(i=o.call(t.state.onbeforeremove,t))&&"function"==typeof i.then&&(s=1,n=i));t.attrs&&"function"==typeof t.attrs.onbeforeremove&&(null!=(i=o.call(t.attrs.onbeforeremove,t))&&"function"==typeof i.then&&(s|=2,r=i));if(a(t,c),s){if(null!=n){var l=function(){1&s&&((s&=2)||u())};n.then(l,l)}if(null!=r){l=function(){2&s&&((s&=1)||u())};r.then(l,l)}}else M(t),O(e,t);function u(){a(t,c),M(t),O(e,t)}}function x(e,t){for(var n=0;n<t.instance.length;n++)e.removeChild(t.instance[n])}function O(e,t){for(;null!=t.dom&&t.dom.parentNode===e;){if("string"!=typeof t.tag){if(null!=(t=t.instance))continue}else if("<"===t.tag)x(e,t);else{if("["!==t.tag&&(e.removeChild(t.dom),!Array.isArray(t.children)))break;if(1===t.children.length){if(null!=(t=t.children[0]))continue}else for(var n=0;n<t.children.length;n++){var r=t.children[n];null!=r&&O(e,r)}}break}}function M(e){if("string"!=typeof e.tag&&"function"==typeof e.state.onremove&&o.call(e.state.onremove,e),e.attrs&&"function"==typeof e.attrs.onremove&&o.call(e.attrs.onremove,e),"string"!=typeof e.tag)null!=e.instance&&M(e.instance);else{var t=e.children;if(Array.isArray(t))for(var n=0;n<t.length;n++){var r=t[n];null!=r&&M(r)}}}function N(e,t,r,i,a){if("key"!==t&&"is"!==t&&null!=i&&!_(t)&&(r!==i||function(e,t){return"value"===t||"checked"===t||"selectedIndex"===t||"selected"===t&&e.dom===s()||"option"===e.tag&&e.dom.parentNode===n.activeElement}(e,t)||"object"==typeof i)){if("o"===t[0]&&"n"===t[1])return z(e,t,i);if("xlink:"===t.slice(0,6))e.dom.setAttributeNS("http://www.w3.org/1999/xlink",t.slice(6),i);else if("style"===t)B(e.dom,r,i);else if(L(e,t,a)){if("value"===t){if(("input"===e.tag||"textarea"===e.tag)&&e.dom.value===""+i&&e.dom===s())return;if("select"===e.tag&&null!==r&&e.dom.value===""+i)return;if("option"===e.tag&&null!==r&&e.dom.value===""+i)return}"input"===e.tag&&"type"===t?e.dom.setAttribute(t,i):e.dom[t]=i}else"boolean"==typeof i?i?e.dom.setAttribute(t,""):e.dom.removeAttribute(t):e.dom.setAttribute("className"===t?"class":t,i)}}function j(e,t,n,r){if("key"!==t&&"is"!==t&&null!=n&&!_(t))if("o"!==t[0]||"n"!==t[1]||_(t))if("style"===t)B(e.dom,n,null);else if(!L(e,t,r)||"className"===t||"value"===t&&("option"===e.tag||"select"===e.tag&&-1===e.dom.selectedIndex&&e.dom===s())||"input"===e.tag&&"type"===t){var i=t.indexOf(":");-1!==i&&(t=t.slice(i+1)),!1!==n&&e.dom.removeAttribute("className"===t?"class":t)}else e.dom[t]=null;else z(e,t,void 0)}function _(e){return"oninit"===e||"oncreate"===e||"onupdate"===e||"onremove"===e||"onbeforeremove"===e||"onbeforeupdate"===e}function L(e,t,n){return void 0===n&&(e.tag.indexOf("-")>-1||null!=e.attrs&&e.attrs.is||"href"!==t&&"list"!==t&&"form"!==t&&"width"!==t&&"height"!==t)&&t in e.dom}var D,I=/[A-Z]/g;function A(e){return"-"+e.toLowerCase()}function R(e){return"-"===e[0]&&"-"===e[1]?e:"cssFloat"===e?"float":e.replace(I,A)}function B(e,t,n){if(t===n);else if(null==n)e.style.cssText="";else if("object"!=typeof n)e.style.cssText=n;else if(null==t||"object"!=typeof t)for(var r in e.style.cssText="",n){null!=(i=n[r])&&e.style.setProperty(R(r),String(i))}else{for(var r in n){var i;null!=(i=n[r])&&(i=String(i))!==String(t[r])&&e.style.setProperty(R(r),i)}for(var r in t)null!=t[r]&&null==n[r]&&e.style.removeProperty(R(r))}}function $(){this._=t}function z(e,t,n){if(null!=e.events){if(e.events[t]===n)return;null==n||"function"!=typeof n&&"object"!=typeof n?(null!=e.events[t]&&e.dom.removeEventListener(t.slice(2),e.events,!1),e.events[t]=void 0):(null==e.events[t]&&e.dom.addEventListener(t.slice(2),e.events,!1),e.events[t]=n)}else null==n||"function"!=typeof n&&"object"!=typeof n||(e.events=new $,e.dom.addEventListener(t.slice(2),e.events,!1),e.events[t]=n)}function U(e,t,n){"function"==typeof e.oninit&&o.call(e.oninit,t),"function"==typeof e.oncreate&&n.push(o.bind(e.oncreate,t))}function q(e,t,n){"function"==typeof e.onupdate&&n.push(o.bind(e.onupdate,t))}return $.prototype=Object.create(null),$.prototype.handleEvent=function(e){var t,n=this["on"+e.type];"function"==typeof n?t=n.call(e.currentTarget,e):"function"==typeof n.handleEvent&&n.handleEvent(e),this._&&!1!==e.redraw&&(0,this._)(),!1===t&&(e.preventDefault(),e.stopPropagation())},function(e,n,r){if(!e)throw new TypeError("DOM element being rendered to does not exist.");if(null!=D&&e.contains(D))throw new TypeError("Node is currently being rendered to and thus is locked.");var i=t,a=D,o=[],c=s(),l=e.namespaceURI;D=e,t="function"==typeof r?r:void 0;try{null==e.vnodes&&(e.textContent=""),n=$n.normalizeChildren(Array.isArray(n)?n:[n]),f(e,e.vnodes,n,o,null,"http://www.w3.org/1999/xhtml"===l?void 0:l),e.vnodes=n,null!=c&&s()!==c&&"function"==typeof c.focus&&c.focus();for(var u=0;u<o.length;u++)o[u]()}finally{t=i,D=a}}}(window);function qr(e){if(!y(e))return!1;var t=I(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}const Fr=function(){let e=0;return()=>e++}(),Hr=new zr;let Wr=0,Gr="fwd",Vr="/";const Kr=document.body;function Yr(e,t){const n={view:()=>$n(e,void 0,t)};function r(){Ur(Kr,$n(n))}Yt.redraw.removeAll(),Yt.redraw.add(r);try{r()}catch(e){throw Yt.redraw.removeAll(),e}}function Xr(e){e&&e.state&&(Gr=e.state.id<Wr?"bwd":"fwd",Wr=e.state.id),Vr=ni();const t=window.location.search||"?=";Hr.run(t.slice(2))||Hr.run("/")}const Qr={replaceState(e,t){try{const n=e?Object.assign({},window.history.state,e):window.history.state;void 0!==t?window.history.replaceState(n,"","?="+t):window.history.replaceState(n,"")}catch(e){}},pushState(e){const t=Fr();Wr=t,Gr="fwd";try{window.history.pushState({id:t},"","?="+e)}catch(e){}}};function Jr(e,t=!1){const n=(window.location.search||"?=/").substring(2).replace(/\?.+$/,"")+`?${mn(e)}`;t?ti(n,!0):Qr.replaceState(void 0,n)}function Zr(){const e=ni(),t=/\?.+$/.exec(e),n={};if(t&&t[0])for(const[e,r]of new URLSearchParams(t[0]))n[e]=r;return n}const ei=(()=>{const e=()=>{const t=e.stack.pop();qr(t)?(t("backbutton"),tn()):/^\/$/.test(ni())?m.exitApp():/^\/game\/[a-zA-Z0-9]{12}/.test(ni())?Yt.gameBackButton.dispatch(event):ri()};return e.stack=[],e})();function ti(e,t=!1){setTimeout((()=>function(e,t=!1){ei.stack=[],Vr=ni(),t?Qr.replaceState(void 0,e):Qr.pushState(e),Hr.run(e)||Hr.run("/")}(e,t)),0)}function ni(){const e=window.location.search||"?=/";return decodeURIComponent(e.substring(2))}function ri(){window.history.go(-1)}window.backButton=ei;var ii={get:ni,set:ti,reload(){ti(ni(),!0)},setQueryParams:Jr,getQueryParams:Zr,deleteQueryParam:function(e,t=!1){const n=Zr();n&&(delete n[e],Jr(n,t))},History:Qr,backHistory:ri,getViewSlideDirection:()=>Gr,backbutton:ei,getPreviousPath:()=>Vr},ai={isStub:!1,init(){ar.addListener("registration",(({value:e})=>{ir(`/mobile/register/firebase/${e}`,{method:"POST"}).catch(hn)})),ar.addListener("registrationError",(e=>{})),ar.addListener("pushNotificationReceived",(e=>{if(cr())switch(e.data["lichess.type"]){case"corresAlarm":case"gameTakebackOffer":case"gameDrawOffer":case"challengeAccept":case"gameMove":case"gameFinish":Si.refresh()}})),ar.addListener("pushNotificationActionPerformed",(e=>{if("tap"===e.actionId)switch(e.notification.data["lichess.type"]){case"challengeAccept":$r.refresh(),ii.set(`/game/${e.notification.data["lichess.challengeId"]}`);break;case"challengeCreate":ii.set(`/game/${e.notification.data["lichess.challengeId"]}`);break;case"corresAlarm":case"gameMove":case"gameFinish":case"gameTakebackOffer":case"gameDrawOffer":ii.set(`/game/${e.notification.data["lichess.fullId"]}`);break;case"newMessage":ii.set(`/inbox/${e.notification.data["lichess.threadId"]}`)}}))},register:async()=>(pt.general.notifications.enable()&&ar.requestPermissions().then((e=>"granted"===e.receive?ar.register():Promise.reject("Permission to use push denied"))),Promise.resolve()),unregister:()=>ir("/mobile/unregister",{method:"POST"})};const oi=new Map;var si={list:()=>[...oi.values()].sort(((e,t)=>{return r=t,(n=e).name.toLowerCase()<r.name.toLowerCase()?-1:n.name.toLowerCase()>r.name.toLowerCase()?1:0;var n,r})),count:()=>oi.size,reset(e,t,n){oi.clear(),e.forEach((e=>{const[r,i]=ci(e),a=r.toLowerCase(),o=t.includes(a),s=n.includes(a);oi.set(e,{name:r,title:i,playing:o,patron:s})}))},set(e,t,n){const[r,i]=ci(e);oi.set(e,{name:r,title:i,playing:t,patron:n})},playing(e){const t=oi.get(e);t&&oi.set(e,Object.assign(Object.assign({},t),{playing:!0}))},stoppedPlaying(e){const t=oi.get(e);t&&oi.set(e,Object.assign(Object.assign({},t),{playing:!1}))},remove(e){oi.delete(e)},clear(){oi.clear()}};function ci(e){const t=e.split(" ");return[t.length>1?t[1]:t[0],t.length>1?t[0]:void 0]}let li;function ui(e){return e.date}function di(e){return new Date(e)<new Date}var hi={get:function(){return li&&di(li.date)&&(li=void 0),li},set:async function(e){if(e){const t=ui(e),n=await nt.get("announce");if(null==n?void 0:n.includes(t))return}li=e,tn()},dismiss:async function(){if(void 0===li)return;const e=ui(li);li=void 0,tn();const t=(await nt.get("announce")||[]).filter((e=>!di(e)));t.push(e),await nt.set("announce",t)}};let mi;function fi(){return void 0!==mi}function pi(e){nt.set("session",e)}function gi(){nt.remove("session"),Rn.remove("sessionId"),Yt.afterLogout.dispatch()}function vi(){return(mi&&mi.nowPlaying||[]).filter((e=>-1!==pt.game.supportedVariants.indexOf(e.variant.key)))}function bi(e){return H.show({text:"✓ lichess.org: "+Et("yourPreferencesHaveBeenSaved"),position:"center",duration:"short"}),e}function wi(e){return!0===e?"1":!1===e?"0":String(e)}function yi(e){return function(t,[n,r]){return Object.assign(Object.assign({},t),{[e+n]:wi(r)})}}const ki=In((()=>{const e=mi&&mi.prefs||{},t=Object.entries(st(e,["animation","captured","highlight","destination","coords","replay","blindfold"])).reduce(yi("display."),{}),n=Object.entries(st(e,["premove","takeback","autoQueen","autoThreefold","submitMove","confirmResign","moretime"])).reduce(yi("behavior."),{}),r=Object.entries(st(e,["clockTenths","clockBar","clockSound","follow","challenge","message","insightShare"])).reduce(yi(""),{});return ir("/account/preferences",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json, text/*"},body:mn(Object.assign(Object.assign(Object.assign({},r),t),n))},!0).then(bi)}),1e3);function Pi(e){return void 0!==e.id}async function Ci(){try{const e=await rr("/account/info",{cache:"reload"});mi=e,pi(e),hi.set(e.announce),mi.nbChallenges!==$r.incoming().length&&$r.refresh().then(tn),tn()}catch(e){void 0!==mi&&401===e.status&&(mi=void 0,gi(),tn(),H.show({text:"You have been signed out",position:"center",duration:"short"}))}}function Ti(){f.getId().then((({uuid:e})=>{"web"!==e&&ir(`/auth/set-fp/${e}/0`,{method:"POST"})}))}var Si={isConnected:fi,isKidMode:function(){return!(!mi||!mi.kid)},isShadowban:function(){return!(!mi||!mi.troll)},logout:function(){return ai.unregister().then((()=>rr("/logout",{method:"POST"},!0).then((()=>{mi=void 0,gi(),si.clear(),tn()})))).catch(hn)},signup:function(e,t,n){return rr("/signup",{method:"POST",body:JSON.stringify({username:e,email:t,password:n,"can-confirm":!0})},!0).then((e=>(Pi(e)&&(mi=e,mi.sessionId&&Rn.set("sessionId",mi.sessionId),Ti()),e)))},login:In((function(e,t,n){return rr("/login",{method:"POST",body:JSON.stringify({username:e,password:t,token:n})},!0).then((e=>{if(Pi(e))return mi=e,mi.sessionId&&Rn.set("sessionId",mi.sessionId),pi(e),Ti(),mi;throw{ipban:!0}}))}),1e3),rememberLogin:In((function(){return rr("/account/info").then((e=>(mi=e,pi(e),e)))}),1e3),restoreStoredSession:function(){nt.get("session").then((e=>{mi=e||void 0,null!==e&&(Yt.sessionRestored.dispatch(),tn())}))},refresh:In(Ci,1e3),backgroundRefresh:In((async function(){if(dn()&&fi()){const e=await rr("/account/info");mi=e,pi(e),hi.set(e.announce),mi.nbChallenges!==$r.incoming().length&&$r.refresh().then(tn)}}),1e3),get:function(){return mi},getUserId:function(){return mi&&mi.id},appUser:e=>mi?mi&&mi.username:e,nowPlaying:vi,myTurnGames:function(){return vi().filter((e=>e.isMyTurn))},lichessBackedProp:function(e,t){return function(...n){if(n.length){let t;mi&&(t=at(mi,e),ot(mi,e,n[0])),ki().catch((n=>{mi&&ot(mi,e,t),dn()&&hn(n)}))}return mi?at(mi,e):t}},setKidMode:function(e,t){return ir(`/account/kid?v=${e}`,{method:"POST",body:new URLSearchParams(t),headers:{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json, text/*"}},!0).then(Ci)},confirmEmail:function(e){return rr(`/signup/confirm/${e}`,void 0,!0).then((e=>(mi=e,pi(e),mi)))},hasCurrentBan:()=>void 0!==(null==mi?void 0:mi.playban)};function Ei(e,t,n,r,i){var a=arguments,o=arguments.length;return 0===o||2===o||o>5?Promise.reject(new Error("Zanimo invalid arguments")):e instanceof Promise?e.then((function(e){return Ei.apply(this,[e].concat(Array.prototype.slice.call(a,1)))})):Oi(e)?1===o?Promise(e):3===o?Mi(e,t,n):window.isNaN(parseInt(r,10))?Promise.reject(new Error("Zanimo transition: duration must be an integer!")):Ni(e,t,n,r,i):Promise.reject(new Error("Zanimo require an HTMLElement, or a promise of an HTMLElement"))}function xi(e,t,n){return e+" "+t+"ms "+(n||"linear")}function Oi(e){try{return e&&e.nodeType}catch(e){return!1}}function Mi(e,t,n){return e._zanimo&&Object.prototype.hasOwnProperty.call(e._zanimo,t),function(e,t,n){return requestAnimationFrame((function(){e.style[t]=n})),Promise(e)}(e,t,n)}function Ni(e,t,n,r,i){var a,o=t;return new Promise((function(s,c){function l(t){t.propertyName===o&&(u(!0),s(e))}function u(n){a&&(clearTimeout(a),a=null),function(e,t){e.style.transition=e.style.transition.split(",").filter((function(e){return!e.match(t)})).join(",")}(e,t),e.removeEventListener("transitionend",l),n&&delete e._zanimo[t]}e.addEventListener("transitionend",l),requestAnimationFrame((function(){!function(e,t,n,r,i){var a=e.style.transition;e.style.transition=a?a+", "+xi(t,r,i):xi(t,r,i),e.style[t]=n}(e,t,n,r,i),a=setTimeout((function(){u(!0),s(e)}),r+20),e._zanimo=e._zanimo||{},e._zanimo[t],e._zanimo[t]={value:n}}))}))}function ji(e,t,n,r,i,a,o,s=!0){let c,l,u,d,h,m,f,p=e;if("function"!=typeof t)throw new Error("ButtonHandler 2nd argument must be a function!");if(n&&"function"!=typeof n)throw new Error("ButtonHandler 3rd argument must be a function!");if(r&&"function"!=typeof r)throw new Error("ButtonHandler 4rd argument must be a function!");function g(){r()&&Jt(g),en()}const v={passive:!0};e.addEventListener("touchstart",(function(t){const i=t.changedTouches[0];if(p=o?o(t):e,!p)return;if(!0===p.disabled)return;const a=p.getBoundingClientRect();c=i.clientX,l=i.clientY,u={minX:a.left,maxX:a.right,minY:a.top,maxY:a.bottom},d=!0,clearTimeout(f),p.classList.add("active"),h=setTimeout((()=>function(e){n&&(n(e),d=!1,p&&p.classList.remove("active"))}(t)),600),r&&(m=setTimeout((()=>{Jt(g)}),500))}),v),e.addEventListener("touchmove",(function(e){if(d&&p){const t=e.changedTouches[0];d=function(e){const t=e.clientX,n=e.clientY,r=u;let o=0,s=0;i&&(o=Math.abs(t-c));a&&(s=Math.abs(n-l));return t<r.maxX&&t>r.minX&&n<r.maxY&&n>r.minY&&o<4&&s<4}(t),d||(clearTimeout(h),clearTimeout(m),Zt(g),p.classList.remove("active"))}}),v),e.addEventListener("touchend",(function(e){e.cancelable&&s&&e.preventDefault(),clearTimeout(m),Zt(g),d&&p&&(clearTimeout(h),f=setTimeout((()=>p&&p.classList.remove("active")),80),t(e),d=!1)}),!1),e.addEventListener("touchcancel",(function(){clearTimeout(h),clearTimeout(m),Zt(g),d=!1,p&&p.classList.remove("active")}),!1),e.addEventListener("contextmenu",(function(e){e.preventDefault(),e.stopPropagation()}),!1)}let _i,Li=null;function Di(e){return({dom:t})=>e(t)}function Ii(e,t=250,n="0.5",r="1"){let i;function a(){clearTimeout(i),e&&(e.removeAttribute("style"),e.removeEventListener("transitionend",a,!1))}e.style.opacity=n,e.style.transition=`opacity ${t}ms ease-out`,setTimeout((()=>{e.style.opacity=r})),e.addEventListener("transitionend",a,!1),i=setTimeout(a,t+10)}function Ai(e){let t;function n(){clearTimeout(t),e&&(e.removeAttribute("style"),e.removeEventListener("transitionend",n,!1))}const r="fwd"===ii.getViewSlideDirection()?"100%":"-100%";e.style.transform=`translate3d(${r},0,0)`,setTimeout((()=>{e.style.transition="transform 250ms ease-out",e.style.transform="translate3d(0%,0,0)"}),10),e.addEventListener("transitionend",n,!1),t=setTimeout(n,270)}function Ri(e,t){let n;function r(){clearTimeout(n),e&&(e.removeAttribute("style"),e.removeEventListener("transitionend",r,!1))}const i="left"===t?"100%":"-100%";e.style.transform=`translate3d(${i},0,0)`,setTimeout((()=>{e.style.transition="transform 250ms ease-out",e.style.transform="translate3d(0%,0,0)"}),10),e.addEventListener("transitionend",r,!1),n=setTimeout(r,270)}function Bi(e,t){return e.closest(t)||e}function $i(){if(Li)return Li;const e=document.documentElement;return Li={vw:e.clientWidth,vh:e.clientHeight}}const zi=Di(Ai),Ui=Di(Ii);function qi(e){const t=e.dom;return t.style.transform="translateY(100%)",e.state.lol=t.offsetHeight,Ei(t,"transform","translateY(0)",250,"ease-out").catch(console.log.bind(console))}function Fi(e,t){return function(n){const r=document.getElementById(t);r&&Ei(r,"transform","translateY(100%)",250,"ease-out").then((()=>un((()=>e(n))))).catch(console.log.bind(console))}}function Hi(e,t){return function(n){const r=document.getElementById(t);r&&Ei(r,"transform","translateX(100%)",250,"ease-out").then((()=>un((()=>e(n))))).catch(console.log.bind(console))}}function Wi(e){const t=e.dom;return t.style.transform="translateX(100%)",e.state.lol=t.offsetHeight,Ei(t,"transform","translateX(0)",250,"ease-out").catch(console.log.bind(console))}function Gi(e,t,n,r=150){e.stopPropagation();const i=n?Bi(e.target,n):e.target;i?Ei(i,"opacity",0,r).then((()=>un(t))).catch(console.log.bind(console)):(t(),tn())}function Vi(e,t,n,r,i,a,o){return function(s){ji(s.dom,(t=>{e(t),tn()}),t?e=>un((()=>t(e))):void 0,n,r,i,a,o)}}function Ki(e){return t=>{t.dom.addEventListener("touchstart",e)}}function Yi(e,t,n,r){return Vi(e,t,n,!1,!1,r)}function Xi(e,t,n){return Vi(e,t,void 0,!0,!1,n)}function Qi(e,t,n,r=!0){return Vi(e,t,void 0,!1,!0,n,r)}function Ji(e,t,n,r=!0){return Vi(e,t,void 0,!0,!0,n,r)}function Zi(e){return 0===e?null:Kn("span",{className:"progress "+(e>0?"positive":"negative"),"data-icon":e>0?"N":"M"},String(Math.abs(e)))}function ea(e){const t=[];for(const n in e)e[n]&&t.push(n);return t.join(" ")}function ta(){const{vw:e,vh:t}=$i();return e>=768&&t>=768}function na(){return void 0!==_i||(_i=window.matchMedia("(orientation: portrait)").matches),_i}let ra=null;function ia(e){const t=/\d{1,3}/.exec(e),n=t&&t[0],r=Number(n);return isNaN(r)?0:r}function aa(e,t){const{vh:n,vw:r}=e,i=function(){if(!ra){const e=getComputedStyle(document.documentElement);return ra={top:ia(e.getPropertyValue("--sat")),right:ia(e.getPropertyValue("--sar")),bottom:ia(e.getPropertyValue("--sab")),left:ia(e.getPropertyValue("--sal"))},ra}return ra}(),a=ta();if(t){if(a){const e=.94*r;return{width:e,height:e}}return{width:r,height:r}}if(a){const e=n-56-.06*n-i.top;return{width:e,height:e}}{const e=n-56-i.top;return{width:e,height:e}}}function oa(e,t){const n=aa(e,t);return e.vh-n.height-56-45-110>=25}function sa(e){e.dom.focus()}function ca(e){return void 0===e.ratingDiff?null:0===e.ratingDiff?Kn("span.rp.null"," +0"):e.ratingDiff>0?Kn("span.rp.up"," +"+e.ratingDiff):e.ratingDiff<0?Kn("span.rp.down"," "+e.ratingDiff):null}function la(e){const t=e.target;return"BUTTON"===t.tagName?t:t.closest("button")}function ua(e){const t=e.target;return"LI"===t.tagName?t:t.closest("li")}function da(e){const t=e.target;return"TR"===t.tagName?t:t.closest("tr")}function ha(e,t){var n;return null===(n=e.target)||void 0===n?void 0:n.closest(t)}function ma(e){return t=>{var n;return null===(n=t.target)||void 0===n?void 0:n.closest(e)}}const fa=a("KeepAwake",{web:()=>import("./web-a7ddb9f9.js").then((e=>new e.KeepAwakeWeb))});let pa,ga;function va(){fa.keepAwake(),void 0!==ga&&ga(),ga=function(e,t,n){const r=["touchstart"];let i,a=!1,o=!0,s=performance.now();const c=()=>{o||n(),o=!0,s=performance.now(),u()},l=()=>{a||(r.forEach((e=>{document.addEventListener(e,c)})),a=!0)},u=()=>{a&&(r.forEach((e=>{document.removeEventListener(e,c)})),a=!1)},d=()=>{clearInterval(i),u()};return i=setInterval((()=>{o&&performance.now()-s>e&&(t(),o=!1),l()}),3e4),d}(9e5,(()=>{pa=setTimeout((()=>{fa.allowSleep()}),27e5)}),(()=>{clearTimeout(pa)}))}function ba(){void 0!==ga&&(ga(),ga=void 0),fa.allowSleep()}function wa(e,t,n){void 0!==n?e.postMessage({topic:t,payload:n}):e.postMessage({topic:t})}function ya(e,t){return new Promise(((n,r)=>{e.addEventListener("message",(function i(a){a.data.topic!==t.topic||void 0!==t.reqid&&a.data.reqid!==t.reqid?"error"!==a.data.topic||a.data.payload.callerTopic!==t.topic||void 0!==t.reqid&&a.data.reqid!==t.reqid||(e.removeEventListener("message",i),r(a.data.payload.error)):(e.removeEventListener("message",i),n(a.data.payload))})),e.postMessage(t)}))}const ka=new Worker("socketWorker.js");let Pa,Ca=!1,Ta=0,Sa=2e3;const Ea={following_onlines:function(e,t){const n=t.playing,r=t.patrons;si.reset(e,n,r),tn()},following_enters:(e,t)=>un((()=>si.set(e,t.playing||!1,t.patron||!1))),following_leaves:e=>un((()=>si.remove(e))),following_playing:e=>un((()=>si.playing(e))),following_stopped_playing:e=>un((()=>si.stoppedPlaying(e))),challenges:e=>{$r.set(e),tn()},mlat:e=>{Ta=e},deployPost(){wa(ka,"deploy")},resync(){ii.reload()},announce:e=>{const t=e;t.date?hi.set(t):hi.set(void 0)}};function xa(e,t){const n=Rn.get("sessionId");null!==n?e.opts.params?e.opts.params.sessionId=n:e.opts.params={sessionId:n}:e.opts.params&&delete e.opts.params.sessionId,e.opts.options.isAuth=!!n,ka.onmessage=e=>{switch(e.data.topic){case"onOpen":t.onOpen&&t.onOpen();break;case"disconnected":Ca&&(Ca=!1,tn());break;case"connected":Ca||(Ca=!0,tn());break;case"onError":t.onError&&t.onError();break;case"resync":ii.reload();break;case"handle":{const n=t.events[e.data.payload.t];n&&n(e.data.payload.d,e.data.payload);break}case"pingInterval":Sa=e.data.payload}},Pa={setup:e,handlers:t},wa(ka,"create",e)}function Oa(e){return{send:(t,n,r)=>function(e,t,n,r){wa(ka,"send",[e,t,n,r])}(e,t,n,r),ask:(t,n,r,i)=>function(e,t,n,r,i){return new Promise(((a,o)=>{let s;function c(e){"handle"===e.data.topic&&e.data.payload.t===n&&(clearTimeout(s),ka.removeEventListener("message",c),a(e.data.payload.d))}ka.addEventListener("message",c),wa(ka,"ask",{msg:[e,t,r,i],listenTo:n}),s=setTimeout((()=>{ka.removeEventListener("message",c),o()}),3e3)}))}(e,t,n,r,i)}}function Ma(){Pa?xa(Pa.setup,Pa.handlers):wa(ka,"connect")}Yt.afterLogout.add(Ma);var Na={createGame:function(e,t,n,r,i){let a=!1;const o={onError:function(){a||(a=!0,Or(r.substring(1)).catch((e=>{401===e.status&&(H.show({text:"Access is unauthorised.",position:"center",duration:"short"}),ii.set("/"))})))},onOpen:Si.backgroundRefresh,events:Object.assign({},Ea,n)},s={options:{name:"game",debug:"dev"===Wt.mode,sendOnOpen:[{t:"following_onlines"}],registeredEvents:Object.keys(o.events)}};return i&&(s.params={userTv:i}),xa({clientId:on(),socketEndPoint:Wt.socketEndPoint,url:e,version:t,opts:s},o),Oa(e)},createChallenge:function(e,t,n,r){const i={onOpen:()=>{Si.backgroundRefresh(),n()},events:Object.assign({},Ea,r)},a=`/challenge/${e}/socket/v${Wt.apiVersion}`,o={options:{name:"challenge",debug:"dev"===Wt.mode,ignoreUnknownMessages:!0,pingDelay:2e3,sendOnOpen:[{t:"following_onlines"}],registeredEvents:Object.keys(i.events)}};return xa({clientId:on(),socketEndPoint:Wt.socketEndPoint,url:a,version:t,opts:o},i),Oa(a)},createLobby:function(e,t,n){const r={onOpen:()=>{Si.refresh(),t()},events:Object.assign({},Ea,n)},i={options:{name:e,debug:"dev"===Wt.mode,pingDelay:2e3,sendOnOpen:[{t:"following_onlines"}],registeredEvents:Object.keys(r.events)}},a=`/lobby/socket/v${Wt.apiVersion}`;return xa({clientId:on(),socketEndPoint:Wt.socketEndPoint,url:a,opts:i},r),Oa(a)},createTournament:function(e,t,n,r){const i="/tournament/"+e+`/socket/v${Wt.apiVersion}`,a={events:Object.assign({},Ea,n),onOpen:Si.backgroundRefresh},o={options:{name:"tournament",debug:"dev"===Wt.mode,pingDelay:2e3,sendOnOpen:[{t:"following_onlines"},{t:"startWatching",d:r}],registeredEvents:Object.keys(a.events)}};return xa({clientId:on(),socketEndPoint:Wt.socketEndPoint,url:i,version:t,opts:o},a),Oa(i)},createDefault:function(){if(dn()){const e={events:Ea,onOpen:Si.backgroundRefresh},t={options:{name:"default",debug:"dev"===Wt.mode,pingDelay:3e3,sendOnOpen:[{t:"following_onlines"}],registeredEvents:Object.keys(e.events)}};xa({clientId:on(),socketEndPoint:Wt.socketEndPoint,url:`/socket/v${Wt.apiVersion}`,opts:t},e)}},createAnalysis:function(e){const t={events:Object.assign(Object.assign({},Ea),e),onOpen:Si.backgroundRefresh},n={options:{name:"analysis",debug:"dev"===Wt.mode,pingDelay:3e3,sendOnOpen:[{t:"following_onlines"}],registeredEvents:Object.keys(t.events)}},r=`/analysis/socket/v${Wt.apiVersion}`;return xa({clientId:on(),socketEndPoint:Wt.socketEndPoint,url:r,opts:n},t),Oa(r)},createStudy:function(e,t){const n={events:Object.assign(Object.assign({},Ea),t),onOpen:Si.backgroundRefresh},r={options:{name:"study",debug:"dev"===Wt.mode,pingDelay:3e3,sendOnOpen:[{t:"following_onlines"}],registeredEvents:Object.keys(n.events)}},i=`/study/${e}/socket/v${Wt.apiVersion}`;return xa({clientId:on(),socketEndPoint:Wt.socketEndPoint,url:i,opts:r},n),Oa(i)},createChat:function(e,t){const n={events:Object.assign(Object.assign({},Ea),e),onOpen:()=>{Si.backgroundRefresh(),t&&t()}},r={options:{name:"chat",debug:"dev"===Wt.mode,pingDelay:2500,registeredEvents:Object.keys(n.events)}},i=`/socket/v${Wt.apiVersion}`;return xa({clientId:on(),socketEndPoint:Wt.socketEndPoint,url:i,opts:r},n),Oa(i)},redirectToGame:function(e){let t;if("string"==typeof e)t=e;else if(t=e.url,e.cookie){const t=document.domain.replace(/^.+(\.[^.]+\.[^.]+)$/,"$1"),n=[encodeURIComponent(e.cookie.name)+"="+e.cookie.value,"; max-age="+e.cookie.maxAge,"; path=/","; domain="+t].join("");document.cookie=n}ii.set("/game"+t)},sendWithNoCheck(e,t,n){["moveLat"].includes(e)&&wa(ka,"send",["noCheck",e,t,n])},setVersion(e){wa(ka,"setVersion",e)},connect(){wa(ka,"connect")},reconnectCurrent:Ma,disconnect(){wa(ka,"disconnect")},delayedDisconnect(e){wa(ka,"delayedDisconnect",e)},cancelDelayedDisconnect(){wa(ka,"cancelDelayedDisconnect")},isConnected:()=>Ca,destroy(){wa(ka,"destroy")},getVersion:()=>ya(ka,{topic:"getVersion"}),getCurrentPing:()=>ya(ka,{topic:"averageLag"}),getCurrentMoveLatency:()=>Ta,getCurrentPingInterval:()=>Sa,terminate(){ka&&ka.terminate()}};function ja(e){return void 0!==e.id}function _a(e){return void 0!==e.timeMode}function La(e){return void 0!==e.steps}async function Da(e){return qa(await rr(`/inbox/${e}`))}async function Ia(e,t){return qa(await rr(`/inbox/${e}?before=${t.getTime()}`))}async function Aa(){return qa(await rr("/inbox"))}async function Ra(e){const t=await rr(`/inbox/search?q=${e}`);return Object.assign(Object.assign({},t),{contacts:t.contacts.map(Wa)})}function Ba(e){return rr(`/rel/block/${e}`,{method:"POST"})}function $a(e){return rr(`/rel/unblock/${e}`,{method:"POST"})}async function za(e){return rr(`/inbox/${e}/delete`,{method:"POST"}).then(qa)}class Ua{constructor(e){const t=function(e){return{msgNew:t=>{e.receive(Object.assign(Object.assign({},Fa(t)),{read:!1}))},msgType:e.receiveTyping,blockedBy:e.changeBlockBy,unblockedBy:e.changeBlockBy}}(e);this.socket=Na.createChat(t)}post(e,t){this.socket.send("msgSend",{dest:e,text:t})}setRead(e){this.socket.send("msgRead",e)}typing(e){this.socket.send("msgType",e)}}function qa(e){return Object.assign(Object.assign({},e),{convo:e.convo&&(t=e.convo,Object.assign(Object.assign({},t),{user:Ha(t.user),msgs:t.msgs.map(Fa)})),contacts:e.contacts.map(Wa)});var t}function Fa(e){return Object.assign(Object.assign({},e),{date:new Date(e.date)})}function Ha(e){return Object.assign(Object.assign({},e),{id:e.name.toLowerCase()})}function Wa(e){return Object.assign(Object.assign({},e),{user:Ha(e.user),lastMsg:Fa(e.lastMsg)})}const Ga=.6,Va=25,Ka=.7;function Ya(){const e=$i().vw;return e*(e>=960?.35:e>=500?.5:.85)}function Xa(e,t){e.style.transform=`translate3d(${t}px, 0, 0)`}function Qa(e,t){e.style.opacity=`${t}`}class Ja{constructor(e,t,n,r,i){this.isOpen=!1,this.open=()=>{this.isOpen=!0,ii.backbutton.stack.push(this.close);const e=document.getElementById(this.menuID),t=document.getElementById(this.backdropID);return this.onOpen&&this.onOpen(),Promise.all([Ei(t,"visibility","visible",0),Ei(t,"opacity",.7,250,"linear"),Ei(e,"visibility","visible",0),Ei(e,"transform","translate3d(0,0,0)",250,"ease-out")]).then(tn).catch(console.error.bind(console))},this.close=e=>{"backbutton"!==e&&this.isOpen&&ii.backbutton.stack.pop(),this.isOpen=!1;const t=document.getElementById(this.menuID),n=document.getElementById(this.backdropID);return this.onClose&&this.onClose(),Promise.all([Ei(n,"opacity",0,250,"linear"),Ei(t,"transform",this.closeTranslate(),250,"ease-out")]).then((()=>Promise.all([Ei(t,"visibility","hidden",0),Ei(n,"visibility","hidden",0)]))).catch(console.error.bind(console))},this.toggle=e=>{e.stopPropagation(),this.isOpen?this.close():this.open()},this.closeTranslate=()=>"left"===this.side?"translate3d(-100%,0,0)":"translate3d(100%,0,0)",this.side=e,this.menuID=t,this.backdropID=n,this.onOpen=r,this.onClose=i}getMenuEl(){return document.getElementById(this.menuID)}getBackdropEl(){return document.getElementById(this.backdropID)}}let Za;const eo=jn(0),to=jn(!1),no=jn(0),ro=jn(0);const io=new Ja("left","side_menu","menu-close-overlay",(function(){dn()&&Na.sendWithNoCheck("moveLat",!0),Za=setTimeout(co,2e3)}),(function(){to(!1),clearTimeout(Za),dn()&&Na.sendWithNoCheck("moveLat",!1)}));function ao(e){return function(){return io.close().then((()=>ii.set(e)))}}function oo(e){return function(){return io.close().then((()=>{e(),tn()}))}}function so(){const e=!to();e&&rr("/inbox/unread-count",{},!1).then((e=>{eo(e),tn()})),to(e)}function co(){dn()&&Na.getCurrentPing().then((e=>{ro(e),no(Na.getCurrentMoveLatency()),io.isOpen&&(tn(),setTimeout(co,2e3))}))}const lo=Yi((e=>{e.stopPropagation(),io.close()})),uo=Symbol("newer"),ho=Symbol("older");class mo{constructor(e,t){"number"!=typeof e&&(t=e,e=0),this.size=0,this.limit=e,this.oldest=this.newest=void 0,this._keymap=new Map,t&&(this.assign(t),e<1&&(this.limit=this.size))}_markEntryAsUsed(e){e!==this.newest&&(e[uo]&&(e===this.oldest&&(this.oldest=e[uo]),e[uo][ho]=e[ho]),e[ho]&&(e[ho][uo]=e[uo]),e[uo]=void 0,e[ho]=this.newest,this.newest&&(this.newest[uo]=e),this.newest=e)}assign(e){let t,n=this.limit||Number.MAX_VALUE;this._keymap.clear();let r=e[Symbol.iterator]();for(let e=r.next();!e.done;e=r.next()){let r=new fo(e.value[0],e.value[1]);if(this._keymap.set(r.key,r),t?(t[uo]=r,r[ho]=t):this.oldest=r,t=r,0==n--)throw new Error("overflow")}this.newest=t,this.size=this._keymap.size}get(e){var t=this._keymap.get(e);if(t)return this._markEntryAsUsed(t),t.value}set(e,t){var n=this._keymap.get(e);return n?(n.value=t,this._markEntryAsUsed(n),this):(this._keymap.set(e,n=new fo(e,t)),this.newest?(this.newest[uo]=n,n[ho]=this.newest):this.oldest=n,this.newest=n,++this.size,this.size>this.limit&&this.shift(),this)}shift(){var e=this.oldest;if(e)return this.oldest[uo]?(this.oldest=this.oldest[uo],this.oldest[ho]=void 0):(this.oldest=void 0,this.newest=void 0),e[uo]=e[ho]=void 0,this._keymap.delete(e.key),--this.size,[e.key,e.value]}toJSON(){for(var e=new Array(this.size),t=0,n=this.oldest;n;)e[t++]=[n.key,n.value],n=n[uo];return e}}function fo(e,t){this.key=e,this.value=t,this[uo]=void 0,this[ho]=void 0}const po=new mo(100);function go(e,t){return e?(e.title?e.title+" "+e.name:e.name)+(t?" ("+e.rating+")":""):"Anonymous"}function vo(e,t=!1,n=!1,r){if(e.name||e.username||e.user){let o=e.name||e.username||e.user.username;return e.user&&e.user.title&&(o=e.user.title+" "+o),n&&(a=r||100,o=(i=o).length>a?i.slice(0,a)+"…":i),t&&(e.user||e.rating)&&(o+=" ("+(e.rating||e.user.rating),e.provisional&&(o+="?"),o+=")"),o}var i,a;return e.ai?bo(e):"Anonymous"}function bo(e){return Et("aiNameLevelAiLevel","Stockfish",e.ai)}const wo="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",yo={standard:{name:"Standard",tinyName:"Std",id:1,link:"https://en.wikipedia.org/wiki/Rules_of_chess",title:"Standard rules of chess (FIDE)"},chess960:{name:"Chess960",tinyName:"960",id:2,link:"https://lichess.org/variant/chess960",alert:"This is a Chess960 game!\n\nThe starting position of the pieces on the players' home ranks is randomized.",title:"Starting position of the home rank pieces is randomized."},fromPosition:{name:"From position",shortName:"Fen",tinyName:"Fen",id:3,title:"Custom starting position"},kingOfTheHill:{name:"King of the Hill",shortName:"KotH",tinyName:"KotH",id:4,link:"https://lichess.org/variant/kingOfTheHill",alert:"This is a King of the Hill game!\n\nThe game can be won by bringing the king to the center.",title:"Bring your King to the center to win the game."},threeCheck:{name:"Three-check",shortName:"3-check",tinyName:"3+",id:5,link:"https://lichess.org/variant/threeCheck",alert:"This is a Three-check game!\n\nThe game can be won by checking the opponent 3 times.",title:"Check your opponent 3 times to win the game.",initialFen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1 +0+0"},antichess:{name:"Antichess",tinyName:"Anti",id:6,link:"https://lichess.org/variant/antichess",alert:"This is an antichess chess game!\n\n If you can take a piece, you must. The game can be won by losing all your pieces.",title:"Lose all your pieces (or reach a stalemate) to win the game."},atomic:{name:"Atomic",tinyName:"Atom",id:7,link:"https://lichess.org/variant/atomic",alert:"This is an atomic chess game!\n\nCapturing a piece causes an explosion, taking out your piece and surrounding non-pawns. Win by mating or exploding your opponent's king.",title:"Nuke your opponent's king to win."},horde:{name:"Horde",tinyName:"Horde",id:8,link:"https://lichess.org/variant/horde",alert:"This is a horde chess game!\n\nBlack must take all white pawns to win. White must checkmate black king.",title:"Destroy the horde to win!",initialFen:"rnbqkbnr/pppppppp/8/1PP2PP1/PPPPPPPP/PPPPPPPP/PPPPPPPP/PPPPPPPP w kq - 0 1"},racingKings:{name:"Racing Kings",shortName:"Racing",tinyName:"Racing",id:9,link:"https://lichess.org/variant/racingKings",alert:"Race to the eighth rank to win.",title:"Race your King to the eighth rank to win.",initialFen:"8/8/8/8/8/8/krbnNBRK/qrbnNBRQ w - - 0 1"},crazyhouse:{name:"Crazyhouse",tinyName:"Crazy",id:10,link:"https://lichess.org/variant/crazyhouse",alert:"This is a crazyhouse game!\n\nEvery time a piece is captured the capturing player gets a piece of the same type and of their color in their pocket.",title:"Captured pieces can be dropped back on the board instead of moving a piece.",initialFen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR/ w KQkq - 0 1"}};function ko(e){return yo[e]}function Po(e){const t=yo[e];return{key:e,name:t.name,short:t.shortName||t.tinyName||t.name,title:t.title}}function Co(e){return yo[e].initialFen||wo}function To(e){switch(e){case"fromPosition":case"standard":case"chess960":return"chess";case"threeCheck":return"3check";default:return e.toLowerCase()}}const So=new Set(["crazyhouse","threeCheck"]),Eo=new Set(["standard","crazyhouse","threeCheck","kingOfTheHill"]);class xo{constructor(e){if(this.config=xo.mergeSettings(e),this.selector="string"==typeof this.config.selector?document.querySelector(this.config.selector):this.config.selector,null===this.selector)throw new Error("Something wrong with your selector ??");this.resolveSlidesNumber(),this.selectorWidth=this.selector.offsetWidth,this.innerElements=[].slice.call(this.selector.children),this.currentSlide=Math.max(0,Math.min(this.config.startIndex,this.innerElements.length-this.perPage)),this.transformProperty="transform",["resizeHandler","touchstartHandler","touchendHandler","touchmoveHandler"].forEach((e=>{this[e]=this[e].bind(this)})),this.init()}static mergeSettings(e){const t={selector:".siema",duration:200,easing:"ease-out",perPage:1,startIndex:0,draggable:!0,threshold:20,rtl:!1,onInit:()=>{},onChange:()=>{}},n=e;for(const e in n)t[e]=n[e];return t}attachEvents(){if(window.addEventListener("resize",this.resizeHandler),this.config.draggable){this.pointerDown=!1,this.drag={startX:0,endX:0,startY:0,letItGo:null,preventClick:!1};const e={passive:!0};this.selector.addEventListener("touchstart",this.touchstartHandler,e),this.selector.addEventListener("touchend",this.touchendHandler,e),this.selector.addEventListener("touchmove",this.touchmoveHandler,e)}}detachEvents(){window.removeEventListener("resize",this.resizeHandler),this.selector.removeEventListener("touchstart",this.touchstartHandler),this.selector.removeEventListener("touchend",this.touchendHandler),this.selector.removeEventListener("touchmove",this.touchmoveHandler)}init(){this.attachEvents(),this.selector.style.overflow="hidden",this.selector.style.direction=this.config.rtl?"rtl":"ltr",this.buildSliderFrame(),this.config.onInit.call(this)}buildSliderFrame(){const e=this.selectorWidth/this.perPage,t=this.innerElements.length;this.sliderFrame=document.createElement("div"),this.sliderFrame.style.width=e*t+"px";const n=document.createDocumentFragment();for(let e=0;e<this.innerElements.length;e++){const t=this.buildSliderFrameItem(this.innerElements[e]);n.appendChild(t)}this.sliderFrame.appendChild(n),this.selector.innerHTML="",this.selector.appendChild(this.sliderFrame),this.slideToCurrent()}buildSliderFrameItem(e){const t=document.createElement("div");return t.style.cssFloat=this.config.rtl?"right":"left",t.style.float=this.config.rtl?"right":"left",t.style.width=100/this.innerElements.length+"%",t.appendChild(e),t}resolveSlidesNumber(){if("number"==typeof this.config.perPage)this.perPage=this.config.perPage;else if("object"==typeof this.config.perPage){this.perPage=1;for(const e in this.config.perPage)window.innerWidth>=e&&(this.perPage=this.config.perPage[e])}}prev(e=1){if(this.innerElements.length<=this.perPage)return;const t=this.currentSlide;this.currentSlide=Math.max(this.currentSlide-e,0),t!==this.currentSlide&&(this.slideToCurrent(),setTimeout((()=>this.config.onChange()),0))}next(e=1){if(this.innerElements.length<=this.perPage)return;const t=this.currentSlide;this.currentSlide=Math.min(this.currentSlide+e,this.innerElements.length-this.perPage),t!==this.currentSlide&&(this.slideToCurrent(),setTimeout((()=>this.config.onChange()),0))}goTo(e){if(this.innerElements.length<=this.perPage)return;const t=this.currentSlide;this.currentSlide=Math.min(Math.max(e,0),this.innerElements.length-this.perPage),t!==this.currentSlide&&(this.slideToCurrent(),setTimeout((()=>this.config.onChange()),0))}slideToCurrent(){const e=this.currentSlide,t=(this.config.rtl?1:-1)*e*(this.selectorWidth/this.perPage);Ei(this.sliderFrame,"transform",`translate3d(${t}px, 0, 0)`,this.config.duration,this.config.easing)}updateAfterDrag(){const e=(this.config.rtl?-1:1)*(this.drag.endX-this.drag.startX),t=Math.abs(e);e>0&&t>this.config.threshold&&this.innerElements.length>this.perPage&&this.currentSlide-1>=0?this.prev(1):e<0&&t>this.config.threshold&&this.innerElements.length>this.perPage&&this.currentSlide+1<=this.innerElements.length-this.perPage?this.next(1):this.slideToCurrent()}resizeHandler(){this.resolveSlidesNumber(),this.currentSlide+this.perPage>this.innerElements.length&&(this.currentSlide=this.innerElements.length<=this.perPage?0:this.innerElements.length-this.perPage),this.selectorWidth=this.selector.offsetWidth,this.buildSliderFrame()}clearDrag(){this.drag={startX:0,endX:0,startY:0,letItGo:null,preventClick:this.drag.preventClick}}touchstartHandler(e){-1!==["TEXTAREA","OPTION","INPUT","SELECT"].indexOf(e.target.nodeName)||(e.stopPropagation(),this.pointerDown=!0,this.drag.startX=e.touches[0].pageX,this.drag.startY=e.touches[0].pageY)}touchendHandler(e){e.stopPropagation(),this.pointerDown=!1,this.drag.endX&&this.updateAfterDrag(),this.clearDrag()}touchmoveHandler(e){if(e.stopPropagation(),null===this.drag.letItGo&&(this.drag.letItGo=Math.abs(this.drag.startY-e.touches[0].pageY)<Math.abs(this.drag.startX-e.touches[0].pageX)),this.pointerDown&&this.drag.letItGo){this.drag.endX=e.touches[0].pageX;const t=this.currentSlide*(this.selectorWidth/this.perPage),n=this.drag.endX-this.drag.startX,r=this.config.rtl?t+n:t-n;this.sliderFrame.style[this.transformProperty]=`translate3d(${(this.config.rtl?1:-1)*r}px, 0, 0)`}}remove(e,t){if(e<0||e>=this.innerElements.length)throw new Error("Item to remove doesn't exist ??");const n=e<this.currentSlide,r=this.currentSlide+this.perPage-1===e;(n||r)&&this.currentSlide--,this.innerElements.splice(e,1),this.buildSliderFrame(),t&&t.call(this)}insert(e,t,n){if(t<0||t>this.innerElements.length+1)throw new Error("Unable to inset it at this index ??");if(-1!==this.innerElements.indexOf(e))throw new Error("The same item in a carousel? Really? Nope ??");const r=t<=this.currentSlide>0&&this.innerElements.length;this.currentSlide=r?this.currentSlide+1:this.currentSlide,this.innerElements.splice(t,0,e),this.buildSliderFrame(),n&&n.call(this)}prepend(e,t){this.insert(e,0),t&&t.call(this)}append(e,t){this.insert(e,this.innerElements.length+1),t&&t.call(this)}destroy(e=!1,t){if(this.detachEvents(),this.selector.style.cursor="auto",e){const e=document.createDocumentFragment();for(let t=0;t<this.innerElements.length;t++)e.appendChild(this.innerElements[t]);this.selector.innerHTML="",this.selector.appendChild(e),this.selector.removeAttribute("style")}t&&t.call(this)}}function Oo(e,...t){e&&setTimeout((()=>e(...t)),1)}function Mo(){}const No=["a","b","c","d","e","f","g","h"],jo=No.slice().reverse(),_o=[1,2,3,4,5,6,7,8],Lo=[8,7,6,5,4,3,2,1];function Do(e,t){return Math.round(e*t)/t}function Io(e){return No[e[0]-1]+e[1]}function Ao(e){return[e.charCodeAt(0)-96,e.charCodeAt(1)-48]}function Ro(e,t,n){return[(t?e[0]-1:8-e[0])*n.width/8,(t?8-e[1]:e[1]-1)*n.height/8]}const Bo=Array.prototype.concat(...No.map((e=>_o.map((t=>e+t)))));Bo.slice(0).reverse();function $o(e){return"white"===e?"black":"white"}function zo(e,t){return void 0!==e&&-1!==e.indexOf(t)}function Uo(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function qo(e,t,n){if(e.otb){const r=e.orientation,i=e.otbMode,a=e.turnColor;return"facing"===i&&"white"===r&&"black"===t||"facing"===i&&"black"===r&&"white"===t||"flip"===i&&"white"===r&&"black"===a||"flip"===i&&"black"===r&&"white"===a?n+" rotate(180deg)":n}return n}function Fo(e){return"translate("+e[0]+"px,"+e[1]+"px)"}function Ho(e){return"translate3d("+e[0]+"px,"+e[1]+"px, 0)"}const Wo=Fo([-99999,-99999]),Go=Ho([-99999,-99999]);function Vo(e){const t=e.targetTouches[0];return[t.clientX,t.clientY]}function Ko(e,t,n){const r=Ao(n);return"white"!==e&&(r[0]=9-r[0],r[1]=9-r[1]),{left:t.left+t.width*(r[0]-1)/8,top:t.top+t.height*(8-r[1])/8,width:t.width/8,height:t.height/8}}function Yo(e,t){let n=e.board.firstChild;for(;n;){if("PIECE"===n.tagName&&n.cgKey===t)return n;n=n.nextSibling}return null}function Xo(e,t){return Math.abs(e-t)}const Qo=(e,t,n,r)=>{const i=Xo(e,n),a=Xo(t,r);return 1===i&&2===a||2===i&&1===a},Jo=(e,t,n,r)=>Xo(e,n)===Xo(t,r),Zo=(e,t,n,r)=>e===n||t===r,es=(e,t,n,r)=>Jo(e,t,n,r)||Zo(e,t,n,r);function ts(e,t,n){const r=e.get(t);if(!r)return[];const i=Ao(t);let a;switch(r.role){case"pawn":o=r.color,a=(e,t,n,r)=>Xo(e,n)<2&&("white"===o?r===t+1||t<=2&&r===t+2&&e===n:r===t-1||t>=7&&r===t-2&&e===n);break;case"knight":a=Qo;break;case"bishop":a=Jo;break;case"rook":a=Zo;break;case"queen":a=es;break;case"king":a=function(e,t,n){return(r,i,a,o)=>Xo(r,a)<2&&Xo(i,o)<2||n&&i===o&&i===("white"===e?1:8)&&(5===r&&(3===a||7===a)||zo(t,a))}(r.color,function(e,t){const n=[];for(const[r,i]of e)i&&i.color===t&&"rook"===i.role&&n.push(Ao(r)[0]);return n}(e,r.color),n)}var o;return Bo.map(Ao).filter((e=>(i[0]!==e[0]||i[1]!==e[1])&&a(i[0],i[1],e[0],e[1]))).map(Io)}function ns(e){e.orientation=$o(e.orientation)}function rs(e,t){for(const[n,r]of t)r?e.pieces.set(n,r):e.pieces.delete(n)}function is(e,t){if(e.check=null,!0===t&&(t=e.turnColor),t)for(const[n,r]of e.pieces)"king"===r.role&&r.color===t&&(e.check=n)}function as(e){e.premovable.current&&(e.premovable.current=null,Oo(e.premovable.events.unset))}function os(e){e.predroppable.current&&(e.predroppable.current=null,Oo(e.predroppable.events.unset))}function ss(e,t,n){if(ms(e,t,n)){if(ws(e,t,n))return us(e,null),Oo(e.movable.events.after,t,n,{premove:!1}),!0}else!function(e,t,n){return t!==n&&fs(e,t)&&zo(ts(e.pieces,t,e.premovable.castle),n)}(e,t,n)?hs(e,n)||fs(e,n)?us(e,n):ds(e):(!function(e,t,n){os(e),e.premovable.current=[t,n],Oo(e.premovable.events.set,t,n)}(e,t,n),us(e,null));return!1}function cs(e,t,n,r=!1){const i=e.pieces.get(t);i&&(function(e,t,n){const r=e.pieces.get(t);return!!r&&n&&(t===n||!e.pieces.has(n))&&("both"===e.movable.color||e.movable.color===r.color&&e.turnColor===r.color)}(e,t,n)||r)?(e.pieces.delete(t),bs(e,i,n,r),Oo(e.movable.events.afterNewPiece,i.role,n,{predrop:!1})):i&&function(e,t,n){const r=e.pieces.get(t),i=e.pieces.get(n);return!!r&&n&&(!i||i.color!==e.movable.color)&&e.predroppable.enabled&&("pawn"!==r.role||"1"!==n[1]&&"8"!==n[1])&&e.movable.color===r.color&&e.turnColor!==r.color}(e,t,n)?function(e,t,n){as(e),e.predroppable.current={role:t,key:n},Oo(e.predroppable.events.set,t,n)}(e,i.role,n):(as(e),os(e)),e.pieces.delete(t),us(e,null)}function ls(e,t){e.selected?e.selected!==t||e.draggable.enabled?e.selectable.enabled&&e.selected!==t&&ss(e,e.selected,t):ds(e):(hs(e,t)||fs(e,t))&&us(e,t),Oo(e.events.select,t)}function us(e,t){e.selected=t,t&&fs(e,t)?e.premovable.dests=ts(e.pieces,t,e.premovable.castle):e.premovable.dests=null}function ds(e){e.selected=null,e.premovable.dests=null}function hs(e,t){const n=e.pieces.get(t);return!!n&&("both"===e.movable.color||e.movable.color===n.color&&e.turnColor===n.color)}function ms(e,t,n){return t!==n&&hs(e,t)&&(e.movable.free||null!==e.movable.dests&&zo(e.movable.dests[t],n))}function fs(e,t){const n=e.pieces.get(t);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function ps(e){const t=e.premovable.current;if(!t)return;const n=t[0],r=t[1];ms(e,n,r)&&ws(e,n,r)&&Oo(e.movable.events.after,n,r,{premove:!0}),as(e)}function gs(e){as(e),os(e),us(e,null)}function vs(e,t,n){const r=e.pieces.get(t);if(t===n||!r)return!1;const i=e.pieces.get(n),a=i&&i.color!==r.color?i:void 0;return Oo(e.events.move,t,n,a),function(e,t,n){if(!e.autoCastle)return!1;const r=e.pieces.get(t);if(!r||"king"!==r.role)return!1;const i=Ao(t),a=Ao(n);if(1!==i[1]&&8!==i[1]||i[1]!==a[1])return!1;5!==i[0]||e.pieces.has(n)||(7===a[0]?n=Io([8,a[1]]):3===a[0]&&(n=Io([1,a[1]])));const o=e.pieces.get(n);if(!o||o.color!==r.color||"rook"!==o.role)return!1;e.pieces.delete(t),e.pieces.delete(n),i[0]<a[0]?(e.pieces.set(Io([7,a[1]]),r),e.pieces.set(Io([6,a[1]]),o)):(e.pieces.set(Io([3,a[1]]),r),e.pieces.set(Io([4,a[1]]),o));return!0}(e,t,n)||(e.pieces.set(n,r),e.pieces.delete(t)),e.lastMove=[t,n],e.check=null,Oo(e.events.change),!0}function bs(e,t,n,r=!1){if(e.pieces.has(n)){if(!r)return!1;e.pieces.delete(n)}return Oo(e.events.dropNewPiece,t,n),e.pieces.set(n,t),e.lastMove=[n,n],e.check=null,Oo(e.events.change),e.movable.dests={},e.turnColor=$o(e.turnColor),!0}function ws(e,t,n){const r=vs(e,t,n);return r&&(e.movable.dests=null,e.turnColor=$o(e.turnColor),e.animation.current=null),r}const ys="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",ks={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king",P:"pawn",R:"rook",N:"knight",B:"bishop",Q:"queen",K:"king"},Ps={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};var Cs={initial:ys,read:function(e){"start"===e&&(e=ys);const t=new Map;let n=8,r=0;for(let i=0;i<e.length;i++){const a=e[i];switch(a){case" ":return t;case"/":if(--n,0===n)return t;r=0;break;case"~":{const e=Io([r,n]),i=t.get(e);i&&(i.promoted=!0,t.set(e,i));break}default:{const e=~~a;if(e)r+=e;else{++r;const e=a.toLowerCase();t.set(Io([r,n]),{role:ks[e],color:a===e?"black":"white"})}}}}return t},write:function(e){return[8,7,6,5,4,3,2].reduce((function(e,t){return e.replace(new RegExp(Array(t+1).join("1"),"g"),String(t))}),Lo.map((t=>_o.map((n=>{const r=e.get(Io([n,t]));if(r){const e=Ps[r.role];return"white"===r.color?e.toUpperCase():e}return"1"})).join(""))).join("/"))}};function Ts(e){const t={pieces:new Map,orientation:"white",turnColor:"white",check:null,lastMove:null,selected:null,coordinates:!0,symmetricCoordinates:!1,otb:!1,otbMode:"facing",autoCastle:!0,viewOnly:!1,fixed:!1,exploding:null,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200,current:null},movable:{free:!0,color:"both",dests:null,dropped:null,showDests:!0,rookCastle:!0,events:{}},premovable:{enabled:!0,showDests:!0,castle:!0,dests:null,current:null,events:{}},predroppable:{enabled:!1,current:null,events:{}},draggable:{enabled:!0,distance:3,magnified:!0,centerPiece:!1,preventDefault:!0,showGhost:!0,deleteOnDropOff:!1,current:null},selectable:{enabled:!0},events:{},prev:{orientation:null,bounds:null,turnColor:null,otbMode:null}};return Ss(t,e||{}),t}function Ss(e,t){t&&(t.movable&&t.movable.dests&&(e.movable.dests=null),Os(e,t),t.fen&&(e.pieces=Cs.read(t.fen)),Object.prototype.hasOwnProperty.call(t,"check")&&is(e,t.check||!1),Object.prototype.hasOwnProperty.call(t,"lastMove")&&!t.lastMove&&(e.lastMove=null),e.selected&&us(e,e.selected),(!e.animation.duration||e.animation.duration<100)&&(e.animation.enabled=!1),xs(e))}function Es(e,t){t&&(t.fen&&(e.pieces=Cs.read(t.fen)),void 0!==t.orientation&&(e.orientation=t.orientation),void 0!==t.turnColor&&(e.turnColor=t.turnColor),void 0!==t.dests&&(e.movable.dests=t.dests),void 0!==t.movableColor&&(e.movable.color=t.movableColor),Object.prototype.hasOwnProperty.call(t,"check")&&is(e,t.check||!1),Object.prototype.hasOwnProperty.call(t,"lastMove")&&!t.lastMove?e.lastMove=null:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&us(e,e.selected),xs(e))}function xs(e){if(!e.movable.rookCastle&&e.movable.dests){const t="white"===e.movable.color?1:8,n="e"+t,r=e.movable.dests[n],i=e.pieces.get(n);if(!r||!i||"king"!==i.role)return;e.movable.dests[n]=r.filter((e=>!(e==="a"+t&&-1!==r.indexOf("c"+t)||e==="h"+t&&-1!==r.indexOf("g"+t))))}}function Os(e,t){for(const n in t)Ms(e[n])&&Ms(t[n])?Os(e[n],t[n]):e[n]=t[n]}function Ms(e){return e&&"object"==typeof e}function Ns(e,t){const n=t.board,r="white"===e.orientation,i=e.fixed?Ls:_s(t.bounds),a=e.prev.orientation&&e.prev.orientation!==e.orientation;e.prev.orientation=e.orientation;const o=e.prev.bounds&&e.prev.bounds!==t.bounds;e.prev.bounds=t.bounds;const s=o||a,c=e.pieces,l=e.animation.current&&e.animation.current.plan.anims,u=e.animation.current&&e.animation.current.plan.captured,d=function(e){const t=new Map;e.lastMove&&e.highlight.lastMove&&(Us(t,e.lastMove[0],"last-move"),Us(t,e.lastMove[1],"last-move"));e.check&&e.highlight.check&&Us(t,e.check,"check");if(e.selected&&(Us(t,e.selected,"selected"),e.movable.showDests)){const n=e.movable.dests&&e.movable.dests[e.selected];if(n)for(let r=0,i=n.length;r<i;r++){const i=n[r];Us(t,i,"move-dest"+(e.pieces.has(i)?" occupied":""))}const r=e.premovable.dests;if(r)for(let n=0,i=r.length;n<i;n++){const i=r[n];Us(t,i,"premove-dest"+(e.pieces.has(i)?" occupied":""))}}const n=e.premovable.current;n&&(Us(t,n[0],"current-premove"),Us(t,n[1],"current-premove"));if(e.exploding)for(const n of e.exploding.keys)Us(t,n,"exploding"+e.exploding.stage);return t}(e),h=new Set,m=new Set,f=new Map,p=new Map;let g,v,b,w,y,k,P,C,T,S,E=!1;e.otb&&(T=e.prev.turnColor&&e.prev.turnColor!==e.turnColor,S=e.prev.otbMode&&e.prev.otbMode!==e.otbMode,e.prev.otbMode=e.otbMode,e.prev.turnColor=e.turnColor,E=!(!T&&!S));let x=t.board.firstChild;for(;x;){const t=x.cgKey;if(As(x))if(v=c.get(t),g=d.get(t),b=l&&l.get(t),w=u&&u.get(t),k=x.cgPiece,!x.cgDragging||e.draggable.current&&e.draggable.current.orig===t||(x.classList.remove("dragging"),x.classList.remove("magnified"),y=i(Ao(t),r),Ds(e,x,x.cgColor,y),x.cgDragging=!1),!w&&x.cgCaptured&&(x.cgCaptured=!1,x.classList.remove("captured")),v){const n=Bs(v);b&&x.cgAnimating&&k===n?(y=i(Ao(t),r),y[0]+=b[1][0],y[1]+=b[1][1],x.classList.add("anim"),Ds(e,x,x.cgColor,y)):x.cgAnimating&&(y=i(Ao(t),r),Ds(e,x,x.cgColor,y),x.classList.remove("anim"),x.cgAnimating=!1),k!==n||s||E||w&&x.cgCaptured?w&&Bs(w)===k?(x.classList.add("captured"),x.cgCaptured=!0):zs(f,k,x):h.add(t)}else zs(f,k,x);else Rs(x)&&(s||g!==x.className?zs(p,x.className,x):m.add(t));x=x.nextSibling}for(const[t,a]of d)if(!m.has(t))if(P=p.get(a),C=P&&P.pop(),C)C.cgKey=t,y=i(Ao(t),r),Is(e,C,y);else{const o=document.createElement("square");o.className=a,o.cgKey=t,y=i(Ao(t),r),Is(e,o,y),n.insertBefore(o,n.firstChild)}for(const[t,a]of c){const o=a.role+a.color;if(b=l&&l.get(t),!h.has(t))if(P=f.get(o),C=P&&P.pop(),C)C.cgKey=t,y=i(Ao(t),r),b&&(C.cgAnimating=!0,y[0]+=b[1][0],y[1]+=b[1][1]),Ds(e,C,C.cgColor,y);else{const o=document.createElement("piece"),s=Bs(a);o.className=s,o.cgPiece=s,o.cgColor=a.color,o.cgKey=t,y=i(Ao(t),r),b&&(o.cgAnimating=!0,y[0]+=b[1][0],y[1]+=b[1][1]),Ds(e,o,a.color,y),n.appendChild(o)}}for(const e of f.values())$s(t,e);for(const e of p.values())$s(t,e)}function js(e,t,n,r){return[(t?e[0]-1:8-e[0])*n,(t?8-e[1]:e[1]-1)*r]}const _s=e=>{const t=e.width/8,n=e.height/8;return(e,r)=>js(e,r,t,n)},Ls=(e,t)=>js(e,t,12.5,12.5);function Ds(e,t,n,r){e.fixed?(t.style.left=r[0]+"%",t.style.top=r[1]+"%"):t.style.transform=qo(e,n,Fo(r))}function Is(e,t,n){e.fixed?(t.style.left=n[0]+"%",t.style.top=n[1]+"%"):t.style.transform=Fo(n)}function As(e){return"PIECE"===e.tagName}function Rs(e){return"SQUARE"===e.tagName}function Bs(e){return e.role+" "+e.color}function $s(e,t){for(const n of t)e.board.removeChild(n)}function zs(e,t,n){const r=e.get(t);r?r.push(n):e.set(t,[n])}function Us(e,t,n){e.set(t,(e.get(t)||"")+" "+n)}function qs(e,t){const n=document.createElement("li-coords");return n.className=t,e.forEach(((e,t)=>{const r=document.createElement("li-coord");r.className=t%2==0?"coord-odd":"coord-even",r.textContent=String(e),n.appendChild(r)})),n}function Fs(e,t){return t.state.animation.enabled?function(e,t){const n=t.state,r=new Map(n.pieces),i=e(n),a=void 0!==t.dom?function(e,t,n){const r=n.bounds,i=r.width/8,a=r.height/8,o=new Map,s=[],c=new Map,l=[],u=[],d=new Map,h="white"===t.orientation;for(const[t,n]of e)d.set(t,Ws(t,n));for(let e=0,n=Bo.length;e<n;e++){const n=Bo[e],r=t.pieces.get(n),i=d.get(n);r?i?Gs(r,i.piece)||(l.push(i),u.push(Ws(n,r))):u.push(Ws(n,r)):i&&l.push(i)}for(const e of u){const t=Vs(e,l.filter((t=>Gs(e.piece,t.piece))));if(t){const n=h?t.pos:e.pos,r=h?e.pos:t.pos,c=[(n[0]-r[0])*i,(r[1]-n[1])*a];o.set(e.key,[c,c]),s.push(t.key)}}for(const e of l)zo(s,e.key)||c.set(e.key,e.piece);return{anims:o,captured:c}}(r,n,t.dom):void 0;if(void 0!==a&&(a.anims.size||a.captured.size)){const e=n.animation.current&&null!==n.animation.current.start;n.animation.current={start:null,duration:n.animation.duration,plan:a},e||Jt(t.applyAnim)}else t.redraw();return i}(e,t):Hs(e,t)}function Hs(e,t){const n=e(t.state);return t.redraw(),n}function Ws(e,t){return{key:e,pos:Ao(e),piece:t}}function Gs(e,t){return e.role===t.role&&e.color===t.color}function Vs(e,t){return t.sort(((t,n)=>Uo(e.pos,t.pos)-Uo(e.pos,n.pos)))[0]}function Ks(e,t){if(t.touches&&t.touches.length>1)return;const n=e.state;n.draggable.preventDefault&&t.preventDefault();const r=n.draggable.current;r&&r.orig&&(r.epos=Vo(t),!r.started&&Uo(r.epos,r.rel)>=n.draggable.distance&&(r.started=!0,Js(e)))}function Ys(e,t){const n=e.state,r=n.draggable,i=r.current;if(!i)return;if(i.originTarget!==t.target&&!i.newPiece)return;n.draggable.preventDefault&&t.preventDefault();const a=i.over;as(n),os(n),i.started&&a?i.newPiece?cs(n,i.orig,a,i.force):ss(n,i.orig,a):i.started&&r.deleteOnDropOff?(n.pieces.delete(i.orig),setTimeout(n.events.change||Mo,0)):i.newPiece&&n.pieces.delete(i.orig),(!i||i.orig!==i.previouslySelected||i.orig!==a&&a)&&n.selectable.enabled||ds(n),n.draggable.current=null,Jt((()=>Zs(e.dom))),e.redraw()}function Xs(e){const t=e.state;e.dom&&Zs(e.dom),t.draggable.current&&(t.draggable.current=null,ds(t))}function Qs(e,t,n){if("object"!=typeof n)throw new Error("function getKeyAtDomPos require bounds object arg");const r="white"===e.orientation,i=Math.ceil((t[0]-n.left)/n.width*8),a=r?i:9-i,o=Math.ceil(8-(t[1]-n.top)/n.height*8),s=r?o:9-o;return a>0&&a<9&&s>0&&s<9?Io([a,s]):null}function Js(e){const t=e.state,n=e.dom,r=t.draggable.current;r&&(r.scheduledAnimationFrame||(r.scheduledAnimationFrame=!0,requestAnimationFrame((()=>{const i=n.bounds,a="white"===t.orientation;if(r.scheduledAnimationFrame=!1,r.orig){if(t.pieces.get(r.orig)!==r.piece)return void Xs(e);t.animation.current&&t.animation.current.plan.anims.get(r.orig)&&(t.animation.current=null);const o=r.element;if(r.started&&o){if(!o.cgDragging){o.cgDragging=!0,o.classList.add("dragging"),t.draggable.magnified&&o.classList.add("magnified");const e=n.elements.ghost;if(e&&r.showGhost){e.className=`ghost ${r.piece.color} ${r.piece.role}`;const n=Ro(Ao(r.orig),"white"===t.orientation,i);e.style.transform=qo(t,r.piece.color,Fo(n))}}r.pos=[r.epos[0]-r.rel[0],r.epos[1]-r.rel[1]],r.over=Qs(t,r.epos,i);const e=Ro(r.origPos,a,i);e[0]+=r.pos[0]+r.dec[0],e[1]+=r.pos[1]+r.dec[1],o.style.transform=qo(t,r.piece.color,Ho(e));const s=n.elements.shadow;if(s){if(r.over&&r.over!==r.prevOver){const e=i.width/8,t=Ro(Ao(r.over),a,i);s.style.transform=Ho([t[0]-e/2,t[1]-e/2])}else r.over||(s.style.transform=Go);r.prevOver=r.over}}Js(e)}}))))}function Zs(e){e.elements.shadow&&(e.elements.shadow.style.transform=Go),e.elements.ghost&&(e.elements.ghost.style.transform=Wo)}const ec={pawn:1,knight:3,bishop:3,rook:5,queen:9,king:0};class tc{constructor(e){this.detach=()=>{this.dom=void 0,window.removeEventListener("resize",this.onOrientationChange)},this.applyAnim=e=>{const t=this.state,n=t.animation.current;if(null===n)return void this.redrawSync();null===n.start&&(n.start=e);const r=1-(e-n.start)/n.duration;if(r<=0)t.animation.current=null,this.redrawSync();else{const e=function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}(r);for(const t of n.plan.anims.values())t[1]=[Do(t[0][0]*e,10),Do(t[0][1]*e,10)];this.redrawSync(),Jt(this.applyAnim)}},this.setBounds=e=>{this.dom&&(this.dom.bounds=e)},this.redrawSync=()=>{this.dom&&Ns(this.state,this.dom)},this.redraw=()=>{Jt(this.redrawSync)},this.getFen=()=>Cs.write(this.state.pieces),this.toggleOrientation=()=>{Fs(ns,this)},this.playPremove=()=>{if(this.state.premovable.current){if(Boolean(Fs(ps,this)))return!0;this.redraw()}return!1},this.playPredrop=e=>{if(this.state.predroppable.current){const t=function(e,t){const n=e.predroppable.current;if(!n)return!1;let r=!1;t(n)&&bs(e,{role:n.role,color:e.movable.color},n.key)&&(Oo(e.movable.events.afterNewPiece,n.role,n.key,{predrop:!0}),r=!0);return os(e),r}(this.state,e);return this.redraw(),t}return!1},this.cancelPremove=()=>{Hs(as,this)},this.cancelPredrop=()=>{Hs(os,this)},this.setCheck=e=>{Hs((t=>is(t,e)),this)},this.cancelMove=()=>{Xs(this),Hs((e=>gs(e)),this)},this.stop=()=>{Xs(this),Hs((e=>function(e){e.movable.color=null,e.movable.dests={},gs(e)}(e)),this)},this.explode=e=>{this.dom&&(this.state.exploding={stage:1,keys:e},this.redraw(),setTimeout((()=>{this.state.exploding&&(this.state.exploding.stage=2,this.redraw()),setTimeout((()=>{this.state.exploding=null,this.redraw()}),120)}),120))},this.onOrientationChange=()=>{const e=this.dom;e&&requestAnimationFrame((()=>{e.bounds=e.board.getBoundingClientRect(),this.redraw()}))},this.state=Ts(e)}attach(e,t){const n=this.state.fixed||this.state.viewOnly,r=document.createElement("div");if(r.className="cg-board",r.className+=n?" view-only":" manipulable",e.appendChild(r),this.dom={board:r,elements:{},bounds:t},this.redrawSync(),!n){const t=document.createElement("div");t.className="cg-square-target",t.style.transform=Go,e.appendChild(t),this.dom.elements.shadow=t}if(!n&&this.state.draggable.showGhost){const t=document.createElement("piece");t.className="ghost",t.style.transform=Wo,e.appendChild(t),this.dom.elements.ghost=t}this.state.coordinates&&(function(e,t){const n=document.createDocumentFragment();n.appendChild(qs(_o,"ranks")),n.appendChild(qs(No,"files"+(t?" withSymm":""))),e.appendChild(n)}(e,!!this.state.symmetricCoordinates),this.state.symmetricCoordinates&&function(e){const t=document.createDocumentFragment();t.appendChild(qs(Lo,"ranks symm")),t.appendChild(qs(jo,"files symm")),e.appendChild(t)}(e)),n||(r.addEventListener("touchstart",(e=>function(e,t){if(!t.isTrusted||t.touches&&t.touches.length>1)return;t.preventDefault();const n=e.state,r=e.dom,i=r.bounds,a=Vo(t),o=Qs(n,a,i);if(!o)return;const s=n.selected,c=!!n.premovable.current,l=!!n.predroppable.current;n.selected&&ms(n,n.selected,o)?Fs((e=>ls(e,o)),e):ls(n,o);const u=n.selected===o,d=n.pieces.get(o);if(d&&u&&function(e,t){const n=e.pieces.get(t);return!!n&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}(n,o)){const c=Ko(n.orientation,i,o),l=Ao(o);n.draggable.current={previouslySelected:s,orig:o,piece:d,rel:a,epos:a,pos:[0,0],origPos:l,dec:n.draggable.magnified?[a[0]-(c.left+c.width),a[1]-(c.top+2*c.height)]:[a[0]-(c.left+c.width/2),a[1]-(c.top+c.height/2)],started:!1===n.selectable.enabled,over:o,prevOver:null,element:Yo(r,o),originTarget:t.target,showGhost:n.draggable.showGhost,scheduledAnimationFrame:!1},n.draggable.magnified&&n.draggable.centerPiece&&(n.draggable.current.dec[1]=a[1]-(c.top+c.height)),n.draggable.current.started&&Js(e)}else c&&as(n),l&&os(n);e.redraw()}(this,e))),r.addEventListener("touchmove",(e=>Ks(this,e))),r.addEventListener("touchend",(e=>Ys(this,e))),r.addEventListener("touchcancel",(()=>Xs(this)))),window.addEventListener("resize",this.onOrientationChange)}getMaterialDiff(){let e=0;const t={king:0,queen:0,rook:0,bishop:0,knight:0,pawn:0};for(const n of this.state.pieces.values())t[n.role]+="white"===n.color?1:-1,e+=ec[n.role]*("white"===n.color?1:-1);const n={white:{pieces:{},score:e},black:{pieces:{},score:-e}};for(const e in t){const r=t[e];r>0?n.white.pieces[e]=r:r<0&&(n.black.pieces[e]=-r)}return n}set(e){Fs((t=>Es(t,e)),this)}reconfigure(e){Fs((t=>Ss(t,e)),this)}setOtbMode(e){Fs((t=>{t.otbMode=e}),this)}setPieces(e){Fs((t=>rs(t,e)),this)}promote(e,t){const n=new Map,r=this.state.pieces.get(e);r&&"pawn"===r.role&&(n.set(e,{color:r.color,role:t}),this.setPieces(n))}dragNewPiece(e,t,n=!1){!function(e,t,n,r){const i="a0",a=e.state,o=e.dom;a.pieces.set(i,t),e.redrawSync();const s=Vo(n),c="white"===a.orientation,l=o.bounds,u=Ko(a.orientation,l,i),d=[(c?0:7)*u.width+l.left,(c?8:-1)*u.height+l.top];a.draggable.current={orig:i,origPos:Ao(i),piece:t,rel:d,epos:s,pos:[s[0]-d[0],s[1]-d[1]],dec:a.draggable.magnified?[-u.width,2*-u.height]:[-u.width/2,-u.height/2],over:null,prevOver:null,started:!0,element:Yo(o,i),originTarget:n.target,previouslySelected:null,newPiece:!0,force:r||!1,showGhost:!1},Js(e)}(this,t,e,n)}selectSquare(e){e?Fs((t=>ls(t,e)),this):this.state.selected&&(ds(this.state),this.redraw())}apiMove(e,t,n,r){Fs((i=>{!function(e,t,n){vs(e,t,n)}(i,e,t),n&&rs(i,n),r&&Es(i,r)}),this)}apiNewPiece(e,t,n){Fs((r=>{!function(e,t,n){bs(e,t,n)}(r,e,t),n&&Es(r,n)}),this)}}const nc={P:"pawn",B:"bishop",N:"knight",R:"rook",Q:"queen",p:"pawn",b:"bishop",n:"knight",r:"rook",q:"queen"},rc={P:"pawn",N:"knight",B:"bishop",R:"rook",Q:"queen"},ic={e1a1:"e1c1",e1h1:"e1g1",e8a8:"e8c8",e8h8:"e8g8"};function ac(e){return[e.substr(0,2),e.substr(2,2)]}function oc(e){return"@"===e[1]?[e.substr(2,2),e.substr(2,2)]:[e.substr(0,2),e.substr(2,2)]}function sc(e){const t=e.substr(4,1);return nc[t]}function cc(e){return e.substr(2,2)}function lc(e){return nc[e.substr(0,1)]}function uc(e){return[e.substr(2,2),e.substr(2,2)]}function dc(e){return"P"===e[0]?e.slice(1):e}function hc(e){return[e.slice(0,2),e.slice(2,4),e.slice(4,5)]}function mc(e){if(void 0===e)return null;if(function(e){return y(e)}(e))return e;const t={};return e&&function(e){return"string"==typeof e}(e)&&e.split(" ").forEach((e=>{t[fc[e[0]]]=e.split("").slice(1).map((e=>fc[e]))})),t}const fc={a:"a1",b:"b1",c:"c1",d:"d1",e:"e1",f:"f1",g:"g1",h:"h1",i:"a2",j:"b2",k:"c2",l:"d2",m:"e2",n:"f2",o:"g2",p:"h2",q:"a3",r:"b3",s:"c3",t:"d3",u:"e3",v:"f3",w:"g3",x:"h3",y:"a4",z:"b4",A:"c4",B:"d4",C:"e4",D:"f4",E:"g4",F:"h4",G:"a5",H:"b5",I:"c5",J:"d5",K:"e5",L:"f5",M:"g5",N:"h5",O:"a6",P:"b6",Q:"c6",R:"d6",S:"e6",T:"f6",U:"g6",V:"h6",W:"a7",X:"b7",Y:"c7",Z:"d7",0:"e7",1:"f7",2:"g7",3:"h7",4:"a8",5:"b8",6:"c8",7:"d8",8:"e8",9:"f8","!":"g8","?":"h8"},pc={oninit({attrs:e}){this.pieceTheme=pt.general.theme.piece(),this.boardTheme=pt.general.theme.board(),this.ground=new tc(function({fen:e,lastMove:t,orientation:n,fixed:r=!0}){return{batchRAF:Jt,viewOnly:!0,fixed:r,minimalDom:!0,coordinates:!1,fen:e,lastMove:t?ac(t):null,orientation:n||"white"}}(e))},oncreate({attrs:e,dom:t}){const n=e.fixed?{top:0,bottom:0,left:0,right:0,height:0,width:0}:t.getBoundingClientRect();void 0!==e.delay?setTimeout((()=>{this.ground.attach(t,n)}),e.delay):this.ground.attach(t,n)},onbeforeupdate:({attrs:e},{attrs:t})=>e.fen!==t.fen||e.lastMove!==t.lastMove||e.orientation!==t.orientation,onupdate({attrs:e}){this.ground.set(Object.assign(Object.assign({},e),{lastMove:e.lastMove?ac(e.lastMove):void 0}))},onremove(){this.ground.detach()},view({attrs:e}){const t=["display_board",e.customPieceTheme||this.pieceTheme,`board-${this.boardTheme}`,e.variant||"standard"].join(" ");return Kn("div",{className:t})}};let gc,vc=null,bc=!1;var wc={lastJoined:()=>gc,resetLastJoined(){gc=void 0},open:function(e){ii.backbutton.stack.push(Sc),Si.refresh(),bc=!0,setTimeout((()=>{vc&&!ta()&&vc.goTo(void 0!==e?e:0)}),500)},close:Sc,view:()=>bc?Kn("div#games_menu.overlay_popup_wrapper",{onbeforeremove:kc},Kn.fragment({key:na()?"portrait":"landscape"},[Kn("div.wrapper_overlay_close",{oncreate:yc}),jc(),Kn("div#wrapper_games",Lc())])):null};const yc=Yi((()=>Sc()));function kc({dom:e}){return e.classList.add("fading_out"),new Promise((e=>{setTimeout(e,500)}))}let Pc;function Cc({dom:e}){na()&&(vc=new xo({selector:e,duration:250,loop:!1,perPage:ta()?2:1,startIndex:0,threshold:50,draggable:!0,onChange:()=>{clearTimeout(Pc),Pc=setTimeout((()=>{Jt(_c)}),300)}}),Jt(_c),tn())}function Tc(){vc&&(vc.destroy(),vc=null)}function Sc(e){"backbutton"!==e&&bc&&ii.backbutton.stack.pop(),bc=!1}function Ec(e,t,n,r){return Kn("div.boardWrapper",Kn(pc,{fen:e,lastMove:n,orientation:t,variant:r}))}function xc(e){return e.isMyTurn?e.secondsLeft?Kn("time",{},Dt(et(new Date,e.secondsLeft))):Et("yourTurn"):Et("waitingForOpponent")}function Oc(e){const t=e.opponent.ai?"n":gn(e.perf),n=vo(e.opponent,!1),r=["card","standard",e.color].join(" "),i=["timeIndication",e.isMyTurn?"myTurn":"opponentTurn"].join(" ");return Kn("div",{className:r,key:"game."+e.gameId,oncreate:Ji((()=>function(e){gc=e,po.set(e.fullId,{fen:e.fen,orientation:e.color}),Sc(),ii.set("/game/"+e.fullId)}(e)))},[Ec(e.fen,e.color,e.lastMove,e.variant.key),Kn("div.infos",[Kn("div.icon-game",{"data-icon":t||""}),Kn("div.description",[Kn("h2.title",n),Kn("p",[Kn("span.variant",e.variant.name),Kn("span",{className:i},xc(e))])])])])}function Mc(e){if(!e.challenger)return null;const t=e.rated?Et("rated"):Et("casual"),n=e.challenger.provisional?"?":"",r=`${e.challenger.id} (${e.challenger.rating}${n})`;return Kn("div.card.standard.challenge",{key:"incoming."+e.id},[Ec(e.initialFen||wo,"white",void 0,e.variant.key),Kn("div.infos",[Kn("div.icon-game",{"data-icon":gn(e.speed)}),Kn("div.description",[Kn("h2.title",Et("playerisInvitingYou",r)),Kn("p.variant",[Kn("span.time-indication[data-icon=p]",$r.challengeTime(e))," • ",Kn("span.variantName",e.variant.name)," • ",Kn("span",t)])]),Kn("div.actions",[Kn("button",{oncreate:Xi((()=>{return Tr(t=e.id).then((e=>{ii.set("/game"+e.url.round)})).then((()=>$r.remove(t))).then((()=>Sc()));var t}))},Et("accept")),Kn("button",{oncreate:Xi((t=>{return(n=e.id,Cr(n).then((()=>{$r.remove(n)}))).then((()=>{Gi(t,(()=>Sc()),".card",250)}));var n}))},Et("decline"))])])])}function Nc(e){const t=e.rated?Et("rated"):Et("casual");return Kn("div.card.standard.challenge.sending",{key:"sending."+e.id},[Ec(e.initialFen||wo,"white",void 0,e.variant.key),Kn("div.infos",[Kn("div.icon-game",{"data-icon":gn(e.speed)}),Kn("div.description",[Kn("h2.title",e.destUser?function(e){const t=e.provisional?"?":"";return`${e.id} (${e.rating}${t})`}(e.destUser):"Open challenge"),Kn("p.variant",[Kn("span.time-indication[data-icon=p]",$r.challengeTime(e))," • ",Kn("span.variantName",e.variant.name)," • ",Kn("span",t)])]),Kn("div.actions",[e.destUser?null:Kn("button",{oncreate:Xi((()=>{Sc(),ii.set(`/game/${e.id}`)}))},Et("viewInFullSize")),Kn("button",{oncreate:Xi((t=>{return(n=e.id,Pr(n).then((()=>{$r.remove(n)}))).then((()=>{Gi(t,(()=>Sc()),".card",250)}));var n}))},Et("cancel"))])])])}function jc(){return na()?Kn("div.#games_menu__dots"):null}function _c(){if(na()&&vc){const e=ta()?Math.ceil(vc.innerElements.length/2):vc.innerElements.length,t=document.getElementById("games_menu__dots");if(t){const n=e-t.childElementCount;if(0!==n)for(let e=0,r=Math.abs(n);e<r;e++)if(n>0){const e=document.createElement("i");e.className="dot",t.appendChild(e)}else{const e=t.firstChild;e&&t.removeChild(e)}const r=t.childNodes;for(let e=0;e<r.length;e++){const t=r[e];e===vc.currentSlide?t.className="dot current":t.className="dot"}}}}function Lc(){const e=Si.nowPlaying(),t=$r.incoming(),n=$r.sending().filter($r.isPersistent),r=t.map((e=>Mc(e))).filter(En),i=n.map((e=>Nc(e))),a=[...r,...e.map((e=>Oc(e))),...i];return Kn("div.games_carousel",{oncreate:Cc,onremove:Tc},a)}var Dc={booleanChoice:[{label:"no",value:!1},{label:"yes",value:!0}],renderRadio(e,t,n,r,i,a,o){const s=t+"_"+n;return[Kn("input.radio[type=radio]",{name:t,id:s,className:n,value:n,checked:r,onchange:i,disabled:a}),Kn("label",{for:s,className:o},"string"==typeof e?Et(e):e)]},renderSelect(e,t,n,r,i,a){const o=r();return[Kn("label",{for:"select_"+t},Et(e)),Kn("select",{id:"select_"+t,disabled:i,onchange(e){const t=e.target.value;r(t),a&&a(t),setTimeout(tn,10)}},n.map((e=>function(e,t,n,r,i){const a=r&&i?Et(e,r,i):r?Et(e,r):Et(e);return Kn("option",{key:t,value:t,selected:n===t},a)}(e[0],e[1],o,e[2],e[3]))))]},renderCheckbox(e,t,n,r,i){const a=n();return Kn("div.check_container",{className:i?"disabled":""},[Kn("label",{for:t},e),Kn("input[type=checkbox]",{id:t,name:t,disabled:i,checked:a,onchange:()=>{const e=!a;n(e),r&&r(e),tn()}})])},renderMultipleChoiceButton(e,t,n,r=!1,i){const a=n();return Kn("div.form-multipleChoiceContainer",[Kn("label",e),Kn("div.form-multipleChoice",{className:r?"wrap":""},t.map((e=>{const t=void 0!==e.labelArg?Et(e.label,e.labelArg):Et(e.label);return Kn("div",{className:e.value===a?"selected":"",oncreate:Yi((()=>{n(e.value),i&&i(e.value)}))},t)})))])},renderSlider(e,t,n,r,i,a,o,s){const c=a();return Kn("div.forms-rangeSlider",{className:s?"disabled":""},[Kn("label",{for:t},e),Kn("input[type=range]",{id:t,value:c,disabled:s,min:n,max:r,step:i,oninput(e){const t=~~e.target.value;a(t),o&&o(t),setTimeout(tn,10)}}),Kn("div.forms-sliderValue",c+" / "+r)])}};function Ic(e,t,n,r,i){if(!r)return null;const a={overlay_popup:!0,native_scroller:!0};let o;if("object"==typeof e)o=ea(Object.assign(Object.assign({},a),e));else{if("string"!=typeof e)throw new Error("First popup argument must be either a string or an object");o=ea(a)+" "+e}const s=ea({popup_content:!0,noheader:!t});return Kn("div",{className:"overlay_popup_wrapper fade-in",onbeforeremove:e=>(e.dom.classList.add("fading_out"),new Promise((e=>{setTimeout(e,500)})))},Kn("div",{className:"popup_overlay_close",oncreate:i?Yi(i):fn}),Kn("div",{className:o},t?Kn("header",null,t()):null,Kn("div",{className:s},n())))}let Ac=!1;const Rc=pt.gameSetup.human;let Bc=Rc.preset(),$c=null;var zc={open:Uc,close:qc,openRealTime(e){Rc.timeMode("1"),e&&(Bc=e),Uc()},openCorrespondence(){$c=Bc,Bc="custom",Rc.timeMode("2"),Uc()},view:()=>Ic("game_form_popup",void 0,Hc,Ac,qc)};function Uc(){Si.hasCurrentBan()||(0===Sr.length&&Er(!1).then(tn),ii.backbutton.stack.push(qc),Ac=!0)}function qc(e){"backbutton"!==e&&Ac&&ii.backbutton.stack.pop(),Ac=!1,$c&&(Bc=$c,$c=null)}function Fc(e){qc(),ja(e)||_a(e)&&1===e.timeMode?Su.startSeeking(e):wr(e).then((()=>ii.set("/?tab=1"))).catch(hn)}function Hc(){const e=Rc,t=t=>un((()=>{const n=t.target.value;Bc=n,e.preset(n)}));return[Kn("div.newGame-preset_switch",[Kn("div.nice-radio",Dc.renderRadio(Et("quickPairing"),"preset","quick","quick"===Bc,t)),Kn("div.nice-radio",Dc.renderRadio(Et("custom"),"preset","custom","custom"===Bc,t))]),"quick"===Bc?Wc((()=>{Bc="custom",Rc.preset("custom")})):Gc("human",e,e.availableVariants,e.availableTimeModes.filter((e=>"1"===e[1]||Si.isConnected())))]}function Wc(e){return Kn("div.newGame-pools",{className:Sr.length?"":"loading"},Sr.length?Sr.map((e=>function(e){return Kn("div.newGame-pool",{key:"pool-"+e.id,oncreate:Yi((()=>{Rc.pool(e.id),Fc({id:e.id}),qc()}))},[Kn("div.newGame-clock",e.id),Kn("div.newGame-perf",e.perf)])}(e))).concat(Kn("div.newGame-pool",{key:"pool-custom",oncreate:Yi(e)},Kn("div.newGame-custom",Et("custom")))):Xn.getVdom("monochrome"))}function Gc(e,t,n,r){const i=t.timeMode(),a="1"===i,o="2"===i&&Si.isConnected(),s=t.variant();"2"===i&&"1"!==s&&t.mode("0");const c=t.mode();Si.isConnected()||Rc.timeMode("1"),"0"===i&&Rc.mode("0");const l=!Si.isConnected()||"0"===i||"2"===i&&"1"!==s?[["casual","0"]]:[["casual","0"],["rated","1"]],u=Dn(c,t.variant());1===u.length&&t.color(u[0][1]);const d=[Kn("div.select_input",Dc.renderSelect("side",e+"color",u,t.color)),Kn("div.select_input",Dc.renderSelect("variant",e+"variant",n,t.variant))];d.push(Kn("div.select_input",Dc.renderSelect("mode",e+"mode",l,t.mode))),Si.isConnected()&&d.push(Kn("div.rating_range",[Kn("div.title",Et("ratingRange")),Kn("div.select_input.inline",Dc.renderSelect("Min",e+"rating_min",Rc.availableRatingRanges.min,t.ratingRangeMin,!1)),Kn("div.select_input.inline",Dc.renderSelect("Max",e+"rating_max",Rc.availableRatingRanges.max,t.ratingRangeMax,!1))]));const h=[Kn("div.select_input",Dc.renderSelect("clock",e+"timeMode",r,t.timeMode))];return a&&h.push(Kn("div.select_input.inline",Dc.renderSelect("time",e+"time",pt.gameSetup.availableTimes,t.time,!1)),Kn("div.select_input.inline",Dc.renderSelect("increment",e+"increment",pt.gameSetup.availableIncrements.map(ct),t.increment,!1))),o&&h.push(Kn("div.select_input.large_label",Dc.renderSelect("daysPerTurn",e+"days",pt.gameSetup.availableDays.map(ct),t.days,!1))),Kn("form.game_form",{onsubmit(e){e.preventDefault(),pt.gameSetup.isTimeValid(t)&&(qc(),Fc(pr(t)))}},[Kn("fieldset",d),Kn("fieldset",h),Kn("div.popupActionWrapper",[Kn("button[type=submit].defaultButton",Et("createAGame"))])])}function Vc(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var Kc,Yc=function(){function e(){}var t=e.prototype;return t.unwrap=function(e,t){var n=this._chain((function(t){return Kc.ok(e?e(t):t)}),(function(e){return t?Kc.ok(t(e)):Kc.err(e)}));if(n.isErr)throw n.error;return n.value},t.map=function(e,t){return this._chain((function(t){return Kc.ok(e(t))}),(function(e){return Kc.err(t?t(e):e)}))},t.chain=function(e,t){return this._chain(e,t||function(e){return Kc.err(e)})},e}(),Xc=function(e){function t(t){var n;return(n=e.call(this)||this).value=t,n.isOk=!0,n.isErr=!1,n}return Vc(t,e),t.prototype._chain=function(e,t){return e(this.value)},t}(Yc),Qc=function(e){function t(t){var n;return(n=e.call(this)||this).error=t,n.isOk=!1,n.isErr=!0,n}return Vc(t,e),t.prototype._chain=function(e,t){return t(this.error)},t}(Yc);!function(e){e.ok=function(e){return new Xc(e)},e.err=function(e){return new Qc(e)},e.all=function(t){if(Array.isArray(t)){for(var n=[],r=0;r<t.length;r++){var i=t[r];if(i.isErr)return i;n.push(i.value)}return e.ok(n)}for(var a={},o=Object.keys(t),s=0;s<o.length;s++){var c=t[o[s]];if(c.isErr)return c;a[o[s]]=c.value}return e.ok(a)}}(Kc||(Kc={}));const Jc=["a","b","c","d","e","f","g","h"],Zc=["1","2","3","4","5","6","7","8"],el=["white","black"],tl=["pawn","knight","bishop","rook","queen","king"],nl=["a","h"];function rl(e){return"role"in e}function il(e){return e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459),Math.imul(e+(e>>>4)&252645135,16843009)>>24}function al(e){return(e=e>>>8&16711935|(16711935&e)<<8)>>>16&65535|(65535&e)<<16}function ol(e){return al(e=(e=(e=e>>>1&1431655765|(1431655765&e)<<1)>>>2&858993459|(858993459&e)<<2)>>>4&252645135|(252645135&e)<<4)}class sl{constructor(e,t){this.lo=e,this.hi=t,this.lo=0|e,this.hi=0|t}static fromSquare(e){return e>=32?new sl(0,1<<e-32):new sl(1<<e,0)}static fromRank(e){return new sl(255,0).shl64(8*e)}static fromFile(e){return new sl(16843009<<e,16843009<<e)}static empty(){return new sl(0,0)}static full(){return new sl(4294967295,4294967295)}static corners(){return new sl(129,2164260864)}static center(){return new sl(402653184,24)}static backranks(){return new sl(255,4278190080)}static backrank(e){return"white"===e?new sl(255,0):new sl(0,4278190080)}static lightSquares(){return new sl(1437226410,1437226410)}static darkSquares(){return new sl(2857740885,2857740885)}complement(){return new sl(~this.lo,~this.hi)}xor(e){return new sl(this.lo^e.lo,this.hi^e.hi)}union(e){return new sl(this.lo|e.lo,this.hi|e.hi)}intersect(e){return new sl(this.lo&e.lo,this.hi&e.hi)}diff(e){return new sl(this.lo&~e.lo,this.hi&~e.hi)}intersects(e){return this.intersect(e).nonEmpty()}isDisjoint(e){return this.intersect(e).isEmpty()}supersetOf(e){return e.diff(this).isEmpty()}subsetOf(e){return this.diff(e).isEmpty()}shr64(e){return e>=64?sl.empty():e>=32?new sl(this.hi>>>e-32,0):e>0?new sl(this.lo>>>e^this.hi<<32-e,this.hi>>>e):this}shl64(e){return e>=64?sl.empty():e>=32?new sl(0,this.lo<<e-32):e>0?new sl(this.lo<<e,this.hi<<e^this.lo>>>32-e):this}bswap64(){return new sl(al(this.hi),al(this.lo))}rbit64(){return new sl(ol(this.hi),ol(this.lo))}minus64(e){const t=this.lo-e.lo,n=(t&e.lo&1)+(e.lo>>>1)+(t>>>1)>>>31;return new sl(t,this.hi-(e.hi+n))}equals(e){return this.lo===e.lo&&this.hi===e.hi}size(){return il(this.lo)+il(this.hi)}isEmpty(){return 0===this.lo&&0===this.hi}nonEmpty(){return 0!==this.lo||0!==this.hi}has(e){return 0!=(e>=32?this.hi&1<<e-32:this.lo&1<<e)}set(e,t){return t?this.with(e):this.without(e)}with(e){return e>=32?new sl(this.lo,this.hi|1<<e-32):new sl(this.lo|1<<e,this.hi)}without(e){return e>=32?new sl(this.lo,this.hi&~(1<<e-32)):new sl(this.lo&~(1<<e),this.hi)}toggle(e){return e>=32?new sl(this.lo,this.hi^1<<e-32):new sl(this.lo^1<<e,this.hi)}last(){return 0!==this.hi?63-Math.clz32(this.hi):0!==this.lo?31-Math.clz32(this.lo):void 0}first(){return 0!==this.lo?31-Math.clz32(this.lo&-this.lo):0!==this.hi?63-Math.clz32(this.hi&-this.hi):void 0}withoutFirst(){return 0!==this.lo?new sl(this.lo&this.lo-1,this.hi):new sl(0,this.hi&this.hi-1)}moreThanOne(){return 0!==this.hi&&0!==this.lo||0!=(this.lo&this.lo-1)||0!=(this.hi&this.hi-1)}singleSquare(){return this.moreThanOne()?void 0:this.last()}isSingleSquare(){return this.nonEmpty()&&!this.moreThanOne()}*[Symbol.iterator](){let e=this.lo,t=this.hi;for(;0!==e;){const t=31-Math.clz32(e&-e);e^=1<<t,yield t}for(;0!==t;){const e=31-Math.clz32(t&-t);t^=1<<e,yield 32+e}}*reversed(){let e=this.lo,t=this.hi;for(;0!==t;){const e=31-Math.clz32(t);t^=1<<e,yield 32+e}for(;0!==e;){const t=31-Math.clz32(e);e^=1<<t,yield t}}}class cl{constructor(){}static default(){const e=new cl;return e.reset(),e}static racingKings(){const e=new cl;return e.occupied=new sl(65535,0),e.promoted=sl.empty(),e.white=new sl(61680,0),e.black=new sl(3855,0),e.pawn=sl.empty(),e.knight=new sl(6168,0),e.bishop=new sl(9252,0),e.rook=new sl(16962,0),e.queen=new sl(129,0),e.king=new sl(33024,0),e}static horde(){const e=new cl;return e.occupied=new sl(4294967295,4294901862),e.promoted=sl.empty(),e.white=new sl(4294967295,102),e.black=new sl(0,4294901760),e.pawn=new sl(4294967295,16711782),e.knight=new sl(0,1107296256),e.bishop=new sl(0,603979776),e.rook=new sl(0,2164260864),e.queen=new sl(0,134217728),e.king=new sl(0,268435456),e}reset(){this.occupied=new sl(65535,4294901760),this.promoted=sl.empty(),this.white=new sl(65535,0),this.black=new sl(0,4294901760),this.pawn=new sl(65280,16711680),this.knight=new sl(66,1107296256),this.bishop=new sl(36,603979776),this.rook=new sl(129,2164260864),this.queen=new sl(8,134217728),this.king=new sl(16,268435456)}static empty(){const e=new cl;return e.clear(),e}clear(){this.occupied=sl.empty(),this.promoted=sl.empty();for(const e of el)this[e]=sl.empty();for(const e of tl)this[e]=sl.empty()}clone(){const e=new cl;e.occupied=this.occupied,e.promoted=this.promoted;for(const t of el)e[t]=this[t];for(const t of tl)e[t]=this[t];return e}equalsIgnorePromoted(e){return!!this.white.equals(e.white)&&tl.every((t=>this[t].equals(e[t])))}equals(e){return this.equalsIgnorePromoted(e)&&this.promoted.equals(e.promoted)}getColor(e){return this.white.has(e)?"white":this.black.has(e)?"black":void 0}getRole(e){for(const t of tl)if(this[t].has(e))return t}get(e){const t=this.getColor(e);if(!t)return;return{color:t,role:this.getRole(e),promoted:this.promoted.has(e)}}take(e){const t=this.get(e);return t&&(this.occupied=this.occupied.without(e),this[t.color]=this[t.color].without(e),this[t.role]=this[t.role].without(e),t.promoted&&(this.promoted=this.promoted.without(e))),t}set(e,t){const n=this.take(e);return this.occupied=this.occupied.with(e),this[t.color]=this[t.color].with(e),this[t.role]=this[t.role].with(e),t.promoted&&(this.promoted=this.promoted.with(e)),n}has(e){return this.occupied.has(e)}*[Symbol.iterator](){for(const e of this.occupied)yield[e,this.get(e)]}pieces(e,t){return this[e].intersect(this[t])}rooksAndQueens(){return this.rook.union(this.queen)}bishopsAndQueens(){return this.bishop.union(this.queen)}kingOf(e){return this.king.intersect(this[e]).diff(this.promoted).singleSquare()}}class ll{constructor(){}static empty(){const e=new ll;for(const t of tl)e[t]=0;return e}static fromBoard(e,t){const n=new ll;for(const r of tl)n[r]=e.pieces(t,r).size();return n}clone(){const e=new ll;for(const t of tl)e[t]=this[t];return e}equals(e){return tl.every((t=>this[t]===e[t]))}add(e){const t=new ll;for(const n of tl)t[n]=this[n]+e[n];return t}nonEmpty(){return tl.some((e=>this[e]>0))}isEmpty(){return!this.nonEmpty()}hasPawns(){return this.pawn>0}hasNonPawns(){return this.knight>0||this.bishop>0||this.rook>0||this.queen>0||this.king>0}count(){return this.pawn+this.knight+this.bishop+this.rook+this.queen+this.king}}class ul{constructor(e,t){this.white=e,this.black=t}static empty(){return new ul(ll.empty(),ll.empty())}static fromBoard(e){return new ul(ll.fromBoard(e,"white"),ll.fromBoard(e,"black"))}clone(){return new ul(this.white.clone(),this.black.clone())}equals(e){return this.white.equals(e.white)&&this.black.equals(e.black)}add(e){return new ul(this.white.add(e.white),this.black.add(e.black))}count(){return this.white.count()+this.black.count()}isEmpty(){return this.white.isEmpty()&&this.black.isEmpty()}nonEmpty(){return!this.isEmpty()}hasPawns(){return this.white.hasPawns()||this.black.hasPawns()}hasNonPawns(){return this.white.hasNonPawns()||this.black.hasNonPawns()}}class dl{constructor(e,t){this.white=e,this.black=t}static default(){return new dl(3,3)}clone(){return new dl(this.white,this.black)}equals(e){return this.white===e.white&&this.black===e.black}}function hl(e){return void 0!==e}function ml(e){return"white"===e?"black":"white"}function fl(e){return e>>3}function pl(e){return 7&e}function gl(e){switch(e){case"pawn":return"p";case"knight":return"n";case"bishop":return"b";case"rook":return"r";case"queen":return"q";case"king":return"k"}}function vl(e){switch(e){case"P":case"p":return"pawn";case"N":case"n":return"knight";case"B":case"b":return"bishop";case"R":case"r":return"rook";case"Q":case"q":return"queen";case"K":case"k":return"king";default:return}}function bl(e){if(2!==e.length)return;const t=e.charCodeAt(0)-"a".charCodeAt(0),n=e.charCodeAt(1)-"1".charCodeAt(0);return t<0||t>=8||n<0||n>=8?void 0:t+8*n}function wl(e){return Jc[pl(e)]+Zc[fl(e)]}function yl(e){if("@"===e[1]&&4===e.length){const t=vl(e[0]),n=bl(e.slice(2));if(t&&hl(n))return{role:t,to:n}}else if(4===e.length||5===e.length){const t=bl(e.slice(0,2)),n=bl(e.slice(2,4));let r;if(5===e.length&&(r=vl(e[4]),!r))return;if(hl(t)&&hl(n))return{from:t,to:n,promotion:r}}}function kl(e,t){return"white"===e?"a"===t?2:6:"a"===t?58:62}const Pl="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",Cl="8/8/8/8/8/8/8/8 w - - 0 1";var Tl;!function(e){e.Fen="ERR_FEN",e.Board="ERR_BOARD",e.Pockets="ERR_POCKETS",e.Turn="ERR_TURN",e.Castling="ERR_CASTLING",e.EpSquare="ERR_EP_SQUARE",e.RemainingChecks="ERR_REMAINING_CHECKS",e.Halfmoves="ERR_HALFMOVES",e.Fullmoves="ERR_FULLMOVES"}(Tl||(Tl={}));class Sl extends Error{}function El(e){return/^\d{1,4}$/.test(e)?parseInt(e,10):void 0}function xl(e){const t=vl(e);return t&&{role:t,color:e.toLowerCase()===e?"black":"white"}}function Ol(e){const t=cl.empty();let n=7,r=0;for(let i=0;i<e.length;i++){const a=e[i];if("/"===a&&8===r)r=0,n--;else{const o=parseInt(a,10);if(o>0)r+=o;else{if(r>=8||n<0)return Kc.err(new Sl(Tl.Board));const o=r+8*n,s=xl(a);if(!s)return Kc.err(new Sl(Tl.Board));"~"===e[i+1]&&(s.promoted=!0,i++),t.set(o,s),r++}}}return 0!==n||8!==r?Kc.err(new Sl(Tl.Board)):Kc.ok(t)}function Ml(e){if(e.length>64)return Kc.err(new Sl(Tl.Pockets));const t=ul.empty();for(const n of e){const e=xl(n);if(!e)return Kc.err(new Sl(Tl.Pockets));t[e.color][e.role]++}return Kc.ok(t)}function Nl(e,t){let n=sl.empty();if("-"===t)return Kc.ok(n);if(!/^[KQABCDEFGH]{0,2}[kqabcdefgh]{0,2}$/.test(t))return Kc.err(new Sl(Tl.Castling));for(const r of t){const t=r.toLowerCase(),i=r===t?"black":"white",a=sl.backrank(i).intersect(e[i]);let o;o="q"===t?a:"k"===t?a.reversed():sl.fromSquare(t.charCodeAt(0)-"a".charCodeAt(0)).intersect(a);for(const t of o){if(e.king.has(t)&&!e.promoted.has(t))break;if(e.rook.has(t)){n=n.with(t);break}}}return Kc.ok(n)}function jl(e){const t=e.split("+");if(3===t.length&&""===t[0]){const e=El(t[1]),n=El(t[2]);return!hl(e)||e>3||!hl(n)||n>3?Kc.err(new Sl(Tl.RemainingChecks)):Kc.ok(new dl(3-e,3-n))}if(2===t.length){const e=El(t[0]),n=El(t[1]);return!hl(e)||e>3||!hl(n)||n>3?Kc.err(new Sl(Tl.RemainingChecks)):Kc.ok(new dl(e,n))}return Kc.err(new Sl(Tl.RemainingChecks))}function _l(e){const t=e.split(" "),n=t.shift();let r,i,a=Kc.ok(void 0);if(n.endsWith("]")){const e=n.indexOf("[");if(-1===e)return Kc.err(new Sl(Tl.Fen));r=Ol(n.substr(0,e)),a=Ml(n.substr(e+1,n.length-1-e-1))}else{const e=function(e,t,n){let r=e.indexOf(t);for(;n-- >0&&-1!==r;)r=e.indexOf(t,r+t.length);return r}(n,"/",7);-1===e?r=Ol(n):(r=Ol(n.substr(0,e)),a=Ml(n.substr(e+1)))}const o=t.shift();if(hl(o)&&"w"!==o){if("b"!==o)return Kc.err(new Sl(Tl.Turn));i="black"}else i="white";return r.chain((e=>{const n=t.shift(),r=hl(n)?Nl(e,n):Kc.ok(sl.empty()),o=t.shift();let s;if(hl(o)&&"-"!==o&&(s=bl(o),!hl(s)))return Kc.err(new Sl(Tl.EpSquare));let c,l=t.shift();hl(l)&&l.includes("+")&&(c=jl(l),l=t.shift());const u=hl(l)?El(l):0;if(!hl(u))return Kc.err(new Sl(Tl.Halfmoves));const d=t.shift(),h=hl(d)?El(d):1;if(!hl(h))return Kc.err(new Sl(Tl.Fullmoves));const m=t.shift();let f=Kc.ok(void 0);if(hl(m)){if(hl(c))return Kc.err(new Sl(Tl.RemainingChecks));f=jl(m)}else hl(c)&&(f=c);return t.length>0?Kc.err(new Sl(Tl.Fen)):a.chain((t=>r.chain((n=>f.map((r=>({board:e,pockets:t,turn:i,unmovedRooks:n,remainingChecks:r,epSquare:s,halfmoves:u,fullmoves:Math.max(1,h)})))))))}))}function Ll(e,t){let n=gl(e.role);return"white"===e.color&&(n=n.toUpperCase()),(null==t?void 0:t.promoted)&&e.promoted&&(n+="~"),n}function Dl(e,t){let n="",r=0;for(let i=7;i>=0;i--)for(let a=0;a<8;a++){const o=a+8*i,s=e.get(o);s?(r>0&&(n+=r,r=0),n+=Ll(s,t)):r++,7===a&&(r>0&&(n+=r,r=0),0!==i&&(n+="/"))}return n}function Il(e){return tl.map((t=>gl(t).repeat(e[t]))).join("")}function Al(e,t,n){const r=null==n?void 0:n.shredder;let i="";for(const n of el){const a=sl.backrank(n),o=e.kingOf(n);if(!hl(o)||!a.has(o))continue;const s=e.pieces(n,"rook").intersect(a);for(const e of t.intersect(s).reversed())if(!r&&e===s.first()&&e<o)i+="white"===n?"Q":"q";else if(!r&&e===s.last()&&o<e)i+="white"===n?"K":"k";else{const t=Jc[pl(e)];i+="white"===n?t.toUpperCase():t}}return i||"-"}function Rl(e,t){return[Dl(e.board,t)+(e.pockets?`[${r=e.pockets,Il(r.white).toUpperCase()+Il(r.black)}]`:""),e.turn[0],Al(e.board,e.unmovedRooks,t),hl(e.epSquare)?wl(e.epSquare):"-",...e.remainingChecks?[(n=e.remainingChecks,`${n.white}+${n.black}`)]:[],...(null==t?void 0:t.epd)?[]:[Math.max(0,Math.min(e.halfmoves,9999)),Math.max(1,Math.min(e.fullmoves,9999))]].join(" ");var n,r}let Bl,$l,zl="";const Ul=jn(!1);function ql(e){e?(Bl=e,zl=Et("challengeToPlay")):(Bl=void 0,zl=Et("playWithAFriend")),ii.backbutton.stack.push(Fl),Ul(!0),$l=void 0}function Fl(e){"backbutton"!==e&&Ul()&&ii.backbutton.stack.pop(),Ul(!1)}function Hl(){return function(e,t){const n=pt.gameSetup.challenge,r=e?`/setup/friend?user=${e}`:"/setup/friend",i={variant:n.variant(),timeMode:n.timeMode(),days:n.days(),time:n.time(),increment:n.increment(),color:n.color(),mode:Si.isConnected()?n.mode():"0"};return t&&(i.fen=t),rr(r,{method:"POST",body:JSON.stringify(i)},!0)}(Bl,$l).then((e=>{e.challenge.destUser&&$r.isPersistent(e.challenge)?wc.open(Si.nowPlaying().length+$r.all().length):ii.set(`/game/${e.challenge.id}`)})).catch(hn)}function Wl(){const e=pt.gameSetup.challenge,t=pt.gameSetup.challenge.availableVariants,n=pt.gameSetup.challenge.availableTimeModes,r=e.timeMode(),i="1"===r,a="2"===r,o=Dn(e.mode(),e.variant());1===o.length&&e.color(o[0][1]);const s=Si.isConnected()?[["casual","0"],["rated","1"]]:[["casual","0"]],c=[Kn("div.select_input",Dc.renderSelect("side","invitecolor",o,e.color)),Kn("div.select_input",Dc.renderSelect("variant","invitevariant",t,e.variant)),"3"===e.variant()?Kn("div.setupPosition",[Kn("div.setupPositionInput",[Kn("input[type=text][name=fen]",{placeholder:Et("pasteTheFenStringHere"),oninput:e=>{const t=e.target.value;$l=""===t?void 0:_l(t).unwrap((e=>Rl(e)),(()=>!1)),tn()}}),Kn("button.withIcon",{oncreate:Yi((()=>{Fl(),ii.set("/editor")}))},Kn("span.fa.fa-pencil"))]),!1===$l?Kn("div.setupFenError","Invalid FEN"):null,void 0!==$l&&!1!==$l?[Kn("div",{style:{width:"100px",height:"100px"},oncreate:Yi((()=>{Fl(),$l&&ii.set(`/editor/${encodeURIComponent($l)}`)}))},[Kn(pc,{fen:$l,orientation:"white"})])]:null]):null,"3"!==e.variant()?Kn("div.select_input",Dc.renderSelect("mode","invitemode",s,e.mode)):null],l=[Kn("div.select_input",Dc.renderSelect("clock","invitetimeMode",n,e.timeMode))];return i&&l.push(Kn("div.select_input.inline",Dc.renderSelect("time","invitetime",pt.gameSetup.availableTimes,e.time,!1)),Kn("div.select_input.inline",Dc.renderSelect("increment","inviteincrement",pt.gameSetup.availableIncrements.map(ct),e.increment,!1))),a&&l.push(Kn("div.select_input.large_label",Dc.renderSelect("daysPerTurn","invitedays",pt.gameSetup.availableDays.map(ct),e.days,!1))),Kn("form#invite_form.game_form",{onsubmit(t){t.preventDefault(),pt.gameSetup.isTimeValid(e)&&(Fl(),Hl())}},[Kn("fieldset",c),Kn("fieldset#clock",l),Kn("div.popupActionWrapper",[Kn("button[type=submit].defaultButton",zl)])])}var Gl={view:()=>Ic("invite_form_popup game_form_popup",void 0,Wl,Ul(),Fl),open:ql,openFromPosition(e){ql(),$l=e,pt.gameSetup.challenge.variant("3"),pt.gameSetup.challenge.mode("0")}};let Vl=!1;var Kl={open:function(){ii.backbutton.stack.push(Yl),Vl=!0},close:Yl,view:()=>Ic({onlineFriends:!0,native_scroller:!1},(function(){return[Kn("span",Ot("nbFriendsOnline",si.count()))]}),Xl,Vl,Yl)};function Yl(e){"backbutton"!==e&&Vl&&ii.backbutton.stack.pop(),Vl=!1}function Xl(){const e=si.list();return e.length?Kn("ul",null,e.map(Ql)):Kn("div",{className:"native_scroller nofriend"})}function Ql(e){const t=e.name.toLowerCase(),n="BOT"===e.title;return Kn("li",{className:"list_item",key:t,oncreate:Qi((function(){Yl(),ii.set("/@/"+t)}))},Kn("div",{className:"friend_name"},e.patron?Kn("span",{className:"patron is-green","data-icon":""}):null,Kn("span",null,e.title?Kn("span",{className:"userTitle"+(n?" bot":"")},e.title," "):null,e.name)),Kn("div",{className:"onlineFriends_actions"},e.playing?Kn("span",{className:"friend_tv","data-icon":"1",oncreate:Qi((function(e){e.stopPropagation(),Yl(),ii.set("/@/"+t+"/tv")}))}," "):null,Kn("span",{"data-icon":"U",oncreate:Qi((e=>{e.stopPropagation(),Yl(),Gl.open(t)}))}),Kn("span",{"data-icon":"c",oncreate:Qi((e=>{e.stopPropagation(),Yl(),ii.set(`/inbox/new/${t}`)}))})))}const Jl=Kn("div",{className:"svg_icon"},Kn("div",{className:"svg_icon_inner"},Kn("svg",{width:"24",height:"24",viewBox:"0 0 24 24"},Kn("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})))),Zl=Kn("div",{className:"svg_icon"},Kn("div",{className:"svg_icon_inner"},Kn("svg",{width:"24",height:"24",viewBox:"0 0 24 24"},Kn("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})))),eu=Kn("div",{className:"svg_icon"},Kn("div",{className:"svg_icon_inner"},Kn("svg",{width:"24",height:"24",viewBox:"0 0 24 24"},Kn("path",{d:"M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"})))),tu=Kn("div",{className:"svg_icon"},Kn("div",{className:"svg_icon_inner"},Kn("svg",{width:"24",height:"24",viewBox:"0 0 24 24"},Kn("path",{d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}))));function nu(){return Kn("button.fa.fa-navicon.main_header_button.menu_button",{oncreate:Yi(io.toggle)})}function ru(e){return Kn("div.back_button",[Kn("button",{oncreate:Yi(ii.backHistory)},Jl),void 0!==e?"string"==typeof e?Kn("div.main_header_title",e):e:null])}function iu(e,t){return Si.isConnected()?Kn("button.main_header_button.bookmarkButton",{oncreate:Yi(e,(()=>H.show({text:Et("bookmarkThisGame"),duration:"short",position:"top"})))},Kn("span",{"data-icon":t?"t":"s"})):null}let au;function ou(e){au=e}function su(){au=au||pt.general.theme.board();const e=Si.myTurnGames().length,t=$r.incoming().length,n=["main_header_button","game_menu_button",au,t?"new_challenge":""].join(" ");return Kn("button",{className:n,"data-button":"games"},!t&&e?Kn("span",{className:"chip nb_playing"},e):null,t?Kn("span",{className:"chip nb_challenges"},t):null)}function cu(e){const t=ha(e,".main_header_button"),n=null==t?void 0:t.dataset.button;if(t&&n)if("games"===n){const e=$r.all().length;Si.nowPlaying().length||e?wc.open():zc.open()}else"friends"===n&&Kl.open()}function lu(){const e=Yi(cu,void 0,void 0,ma(".main_header_button"));return Si.isConnected()&&si.count()?Kn("div",{className:"buttons",oncreate:e},function(){const e=si.count();return Kn("button",{className:"main_header_button friends_button","data-icon":"f","data-button":"friends"},e>0?Kn("span",{className:"chip nb_friends"},e):null)}(),su()):Kn("div",{className:"buttons",oncreate:e},su())}function uu(e,t){return Kn("nav",[t||nu(),"string"==typeof e?Kn("div.main_header_title",e):e,lu()])}function du(e,t){return[Kn("nav",[t||nu(),e?Kn("div",{className:"main_header_title"},e):null,lu()])]}const hu=Kn("div",{className:"loader_circles"},[1,2,3].map((e=>Kn("div",{className:"circle_"+e}))));function mu(e){return Kn("nav",null,nu(),Kn("div",{className:"main_header_title reconnecting"+(e?"withTitle":"")},e?Kn("span",null,e):null,hu),lu())}function fu(e){return[Kn("nav",[nu(),Kn("div.main_header_title.reconnecting",{className:e?"withTitle":""}),e?Kn("div.main_header_title",e):null,lu()])]}function pu(e){return Kn("nav",[ru(Kn("div.main_header_title.reconnecting",{className:e?"withTitle":""},[e?Kn("span",e):null,hu])),lu()])}function gu(e){const t=e.online?"online":"offline";return Kn("div",{className:"user"},e.patron?Kn("span",{className:"patron userStatus "+t,"data-icon":""}):Kn("span",{className:"fa fa-circle userStatus "+t}),e.title?Kn("span",{className:"userTitle"},e.title," "):null,e.username)}let vu,bu,wu=0,yu=0,ku=!1,Pu=null,Cu=null;const Tu={redirect:e=>{Mu(),null!==Pu&&(ja(Pu)?Lu(Pu):Rn.set("setup.custom.last",Pu)),Na.redirectToGame(e)},n:(e,t)=>{wu=t.d,yu=t.r,tn()}};var Su={startSeeking(e){Ou(e)},appCancelSeeking(){ku&&_u()},onNewOpponent(e){if("pool"===e.game.source){const t=e.clock;Ou({id:t.initial/60+"+"+t.increment})}else{Ou(Pu&&_a(Pu)?Pu:Rn.get("setup.custom.last")||pr(pt.gameSetup.human),e.game.id)}},view:()=>Ic("",void 0,(function(){const e=Ot("nbPlayers",wu,wu?void 0:"?"),t=Ot("nbGames",yu,yu?void 0:"?");return Kn("div.lobby-waitingPopup",null===Pu?"Something went wrong. Please try again":[Kn("div.lobby-waitingForOpponent",Et("waitingForOpponent")),Kn("br"),ja(Pu)?xu(Pu):Eu(Pu),Kn("br"),Xn.getVdom(),Kn("div.lobby-nbPlayers",Na.isConnected()?[Kn("div",Kn.trust(e.replace(/(\d+)/,"<strong>$1</strong>"))),Kn("div",Kn.trust(t.replace(/(\d+)/,"<strong>$1</strong>")))]:Kn("div",[Et("reconnecting"),hu])),Kn("button[data-icon=L]",{oncreate:Yi((()=>Nu()))},Et("cancel"))])}),ku)};function Eu(e){const t=pt.gameSetup.human.availableVariants.find((t=>t[1]===String(e.variant))),n=t&&t[0]||"Standard",r=e.timeMode,i=0===e.mode?Et("casual"):Et("rated"),a=e.time;let o;o=1===r?function(e){return"0.75"===e?"¾":"0.5"===e?"½":"0.25"===e?"¼":e}(String(a))+"+"+e.increment:2===r?Ot("nbDays",e.days):"∞";const s=` • ${n} • ${i}`;return Kn("div.gameInfos",[Kn("span[data-icon=p]",o),s])}function xu(e){const t=` • Standard • ${Si.isConnected()?Et("rated"):Et("casual")}`;return Kn("div.gameInfos",[Kn("span[data-icon=p]",e.id),t])}function Ou(e,t){var n;ii.backbutton.stack.push(Nu),ku=!0,va(),ja(e)?(Pu=n=e,bu=Na.createLobby("seekLobby",(()=>{ku&&Si.refresh().then((()=>{if(Si.isConnected())Iu("poolIn",n),clearInterval(vu),vu=setInterval((()=>{Iu("poolIn",n)}),1e4);else{const e=Sr.find((e=>e.id===n.id));e&&ju({mode:0,variant:1,timeMode:1,time:e.lim,increment:e.inc,days:1,color:"random"})}}))}),Tu)):Si.refresh().then((()=>ju(e,t)))}function Mu(e){"backbutton"!==e&&ku&&ii.backbutton.stack.pop(),ku=!1}function Nu(e){Mu(e),_u(),ii.reload(),ba()}function ju(e,t){Pu=e,Cu&&Du(),bu=Na.createLobby("seekLobby",(()=>{ku&&(Cu||(t?function(e,t){const n=Si.get(),r=n?gr(n,t):null;rr(`/setup/hook/${an()}/like/${e}?rr=${r||""}`,{method:"POST"},!0)}(t,e):wr(e).then((e=>{Cu=e.hook.id})).catch(hn)))}),Tu)}function _u(){null!==Pu&&(ja(Pu)?Lu(Pu):Cu&&Du())}function Lu(e){clearInterval(vu),Iu("poolOut",e.id)}function Du(){Iu("cancel",Cu),Cu=null}function Iu(e,t){bu&&bu.send(e,t)}const Au=a("Badge");let Ru=!0;function Bu(e,t,n,r,a,o){window.lichess.cpuArch=o,window.deviceInfo={platform:t.platform,osVersion:t.osVersion,uuid:n.uuid,appVersion:e.version,cpuCores:r,stockfishMaxMemory:16*Math.ceil(a/16)},"ios"===i.getPlatform()&&w.setAccessoryBarVisible({isVisible:!0}),Nn((()=>{$i(),ur.load()})),m.addListener("appStateChange",(e=>{e.isActive?(ur.resume(),sr=!0,Si.refresh().then((()=>{"ios"===i.getPlatform()&&Au.setNumber({badge:Si.myTurnGames().length})})),Na.cancelDelayedDisconnect(),Na.connect(),tn()):(sr=!1,Na.delayedDisconnect(18e4),Su.appCancelSeeking())})),g.addListener("networkStatusChange",(e=>{e.connected?zu():cr()&&!dn()&&(Na.disconnect(),tn())})),m.addListener("backButton",ii.backbutton),window.addEventListener("resize",F($u),!1),dn()?zu():Si.restoreStoredSession()}function $u(){Li=null,_i=void 0,tn()}function zu(){cr()&&(Ru?(Ru=!1,function(){const e=window.deviceInfo.appVersion||"web-dev";rr("/api/status",{query:{v:e}}).then((t=>{if(t.mustUpgrade){const t="warn_bug_"+e,n=Number(Rn.get(t))||0;0===n?fr.alert({title:"Alert",message:"A new version of lichess mobile is available. Please upgrade as soon as possible."}).then((()=>{Rn.set(t,1)})):10===n?Rn.remove(t):Rn.set(t,n+1)}else if(t.api.current>Wt.apiVersion){const e=t.api.olds.find((e=>e.version===Wt.apiVersion));if(e){const t=new Date,n=new Date(e.unsupportedAt),r=new Date(e.deprecatedAt),i="warn_old_"+e.version,a=Number(Rn.get(i))||0;t>n?fr.alert({title:"Alert",message:Et("apiUnsupported")}):t>r&&(0===a?fr.alert({title:"Alert",message:Et("apiDeprecated",jt(n))}).then((()=>{Rn.set(i,1)})):15===a?Rn.remove(i):Rn.set(i,a+1))}}}))}(),qu(),Si.rememberLogin().then((()=>{ai.register(),$r.refresh(),"ios"===i.getPlatform()&&Au.setNumber({badge:Si.myTurnGames().length}),tn()})).catch((()=>{"ios"===i.getPlatform()&&Au.setNumber({badge:0})}))):(Na.connect(),Si.refresh()))}let Uu=1;function qu(){return Er().then(tn).catch((()=>{Uu<=5&&(Uu++,setTimeout(qu,1e3*Uu))}))}const Fu=a("Stockfish"),Hu=a("StockfishVariants",{web:()=>import("./StockfishVariantsWeb-b149dc22.js").then((e=>new e.StockfishVariantsWeb))});class Wu{constructor(e){this.variant=e,this.plugin=!this.isVariant()&&Ku()&&pt.analyse.cevalUseNNUE()?Fu:Hu}async start(){return new Promise((e=>{let t="Stockfish";const n=r=>{const i=r.output;i.startsWith("id name ")&&(t=i.substring("id name ".length)),i.startsWith("uciok")&&(window.removeEventListener("stockfish",n,!1),e({engineName:t}))};window.addEventListener("stockfish",n,{passive:!0}),this.plugin.start().then((()=>this.send("uci")))}))}isReady(){return new Promise((e=>{const t=n=>{n.output.startsWith("readyok")&&(window.removeEventListener("stockfish",t,!1),e())};window.addEventListener("stockfish",t,{passive:!0}),this.send("isready")}))}send(e){return this.plugin.cmd({cmd:e})}setOption(e,t){return this.send(`setoption name ${e} value ${t}`)}setVariant(){return this.isVariant()?"web"!==i.getPlatform()&&"threeCheck"===this.variant?this.setOption("UCI_Variant","3check"):"web"===i.getPlatform()&&"antichess"===this.variant?this.setOption("UCI_Variant","giveaway"):this.setOption("UCI_Variant",this.variant.toLowerCase()):this.setOption("UCI_Chess960","chess960"===this.variant)}exit(){return this.plugin.exit()}isVariant(){return!("standard"===this.variant||"fromPosition"===this.variant||"chess960"===this.variant)}}async function Gu(){return Promise.resolve(window.deviceInfo.stockfishMaxMemory)}function Vu(){const e=window.deviceInfo.cpuCores;return e>2?e-1:1}function Ku(){return"android"===i.getPlatform()?"arm64-v8a"===window.lichess.cpuArch:"ios"===i.getPlatform()}var Yu,Xu;!function(e){e.Documents="DOCUMENTS",e.Data="DATA",e.Library="LIBRARY",e.Cache="CACHE",e.External="EXTERNAL",e.ExternalStorage="EXTERNAL_STORAGE"}(Yu||(Yu={})),function(e){e.UTF8="utf8",e.ASCII="ascii",e.UTF16="utf16"}(Xu||(Xu={}));const Qu=a("Filesystem",{web:()=>import("./web-ee1bc7a2.js").then((e=>new e.FilesystemWeb))});var Ju,Zu;!function(e){e.Dark="DARK",e.Light="LIGHT",e.Default="DEFAULT"}(Ju||(Ju={})),function(e){e.None="NONE",e.Slide="SLIDE",e.Fade="FADE"}(Zu||(Zu={}));const ed=a("StatusBar"),td="https://veloce.github.io/lichobile-themes";let nd,rd;function id(e){return"dark"!==e&&"light"!==e&&"system"!==e}function ad(e,t){return Qu.readFile({path:e+"-"+t,directory:Yu.Data})}function od(e){return Qu.readdir({path:"",directory:Yu.Data}).then((({files:t})=>t.map((e=>e.name)).filter((t=>t.startsWith(e)))))}function sd(e){return e.key+"."+e.ext}function cd(e,t,n){const r=dd(e,t);return ad(e,r).catch((()=>function(e,t,n){return new Promise(((r,i)=>{const a=new XMLHttpRequest,o="bg"===e?"/background":"/board";a.open("GET",`${td}${o}/${t}`,!0),a.responseType="blob",n&&(a.onprogress=n),a.onload=()=>{if(200===a.status){const n=a.response;if(n){const i=new FileReader;i.readAsDataURL(n),i.onloadend=()=>{const n=i.result;Qu.writeFile({path:e+"-"+t,data:n,directory:Yu.Data}).then((()=>r()))}}else i("could not get file")}else i(`Request returned ${a.status}`)},a.send()}))}(e,r,n).then((()=>ad(e,r))))).then((n=>{ud(e,t,r,n)}))}function ld(e){H.show({text:"Cannot load theme file",duration:"short"})}function ud(e,t,n,{data:r}){nd||(nd=document.createElement("style"),nd.type="text/css",document.head.appendChild(nd));const i=r.replace(/\n/g,""),a=("png"===n.split(".").pop()?"data:image/png;base64,":"data:image/jpeg;base64,")+i,o="bg"===e?`.view-container.transp.${t} > main { background-image: url(${a}); }`:`:root { --board-background: url(${a}); }\n.board-${t} > .cg-board { background-image: var(--board-background); }\n.game_menu_button.${t}::before { background-image: var(--board-background); background-size: 40px; }`;nd.appendChild(document.createTextNode(o))}function dd(e,t){return sd(("bg"===e?pt.general.theme.availableBackgroundThemes:pt.general.theme.availableBoardThemes).find((e=>e.key===t)))}function hd(){if(void 0===rd){const e=window.matchMedia("(prefers-color-scheme: light)");rd=e.matches?"light":"dark",e.addEventListener("change",(e=>{rd=e.matches?"light":"dark"}))}return rd}function md(e){const t="system"===e?hd():e;return Promise.all(["android"===i.getPlatform()?ed.setBackgroundColor({color:"light"===t?"#edebe9":"dark"===t?"#161512":"#000000"}):Promise.resolve(),ed.setStyle({style:"light"===t?Ju.Light:Ju.Dark})]).then((()=>{}))}var fd={init(){(e=>{e.add("",(({params:e})=>{import("./home-00f1040a.js").then((t=>{Yr(t.default,e)}))})),e.add("timeline",(({params:e})=>{import("./timeline-43c5689d.js").then((t=>{Yr(t.default,e)}))})),e.add("otb",(({params:e})=>{import("./otb-a7f47aef.js").then((t=>{Yr(t.default,e)}))})),e.add("otb/variant/:variant/fen/:fen",(({params:e})=>{import("./otb-a7f47aef.js").then((t=>{Yr(t.default,e)}))})),e.add("ai",(({params:e})=>{import("./ai-f7e75b59.js").then((t=>{Yr(t.default,e)}))})),e.add("ai/variant/:variant/fen/:fen/color/:color",(({params:e})=>{import("./ai-f7e75b59.js").then((t=>{Yr(t.default,e)}))})),e.add("game/:id",(({params:e})=>{import("./game-a66223dc.js").then((t=>{Yr(t.default,e)}))})),e.add("tournament/:tournamentId/game/:id",(({params:e})=>{import("./game-a66223dc.js").then((t=>{Yr(t.default,e)}))})),e.add("analyse/:source/:id/:color",(({params:e})=>{import("./analyse-6289788d.js").then((t=>{Yr(t.default,e)}))})),e.add("analyse/:source/:id",(({params:e})=>{import("./analyse-6289788d.js").then((t=>{Yr(t.default,e)}))})),e.add("analyse/fen/:fen",(({params:e})=>{import("./analyse-6289788d.js").then((t=>{Yr(t.default,e)}))})),e.add("analyse/variant/:variant",(({params:e})=>{import("./analyse-6289788d.js").then((t=>{Yr(t.default,e)}))})),e.add("analyse/variant/:variant/fen/:fen",(({params:e})=>{import("./analyse-6289788d.js").then((t=>{Yr(t.default,e)}))})),e.add("analyse",(({params:e})=>{import("./analyse-6289788d.js").then((t=>{Yr(t.default,e)}))})),e.add("importer",(({params:e})=>{import("./importer-d7a9f56c.js").then((t=>{Yr(t.default,e)}))})),e.add("tv",(({params:e})=>{import("./tv-f9a04908.js").then((t=>{Yr(t.default,e)}))})),e.add("tv/:channel",(({params:e})=>{import("./tv-f9a04908.js").then((t=>{Yr(t.default,e)}))})),e.add("@/:id",(({params:e})=>{import("./user-bf076f8e.js").then((t=>{Yr(t.default,e)}))})),e.add("@/:id/related",(({params:e})=>{import("./related-0a50361d.js").then((t=>{Yr(t.default,e)}))})),e.add("@/:id/games",(({params:e})=>{import("./games-ac554d3b.js").then((t=>{Yr(t.default,e)}))})),e.add("@/:id/games/:filter",(({params:e})=>{import("./games-ac554d3b.js").then((t=>{Yr(t.default,e)}))})),e.add("@/:id/:perf/perf",(({params:e})=>{import("./perfStats-9cf7006d.js").then((t=>{Yr(t.default,e)}))})),e.add("@/:id/tv",(({params:e})=>{import("./userTv-40c18904.js").then((t=>{Yr(t.default,e)}))})),e.add("about",(({params:e})=>{import("./about-5bcd2c4c.js").then((t=>{Yr(t.default,e)}))})),e.add("account/preferences",(({params:e})=>{import("./preferences-a1fcf62a.js").then((t=>{Yr(t.default,e)}))})),e.add("account/preferences/game-display",(({params:e})=>{import("./gameDisplay-c2ff01ab.js").then((t=>{Yr(t.default,e)}))})),e.add("account/preferences/game-behavior",(({params:e})=>{import("./gameBehavior-731a9a68.js").then((t=>{Yr(t.default,e)}))})),e.add("account/preferences/clock",(({params:e})=>{import("./clock-5bbd42e4.js").then((t=>{Yr(t.default,e)}))})),e.add("account/preferences/privacy",(({params:e})=>{import("./privacy-6e599bed.js").then((t=>{Yr(t.default,e)}))})),e.add("account/preferences/kidMode",(({params:e})=>{import("./kid-4fd8e5f5.js").then((t=>{Yr(t.default,e)}))})),e.add("clock",(({params:e})=>{import("./clock-a0edd16c.js").then((t=>{Yr(t.default,e)}))})),e.add("editor",(({params:e})=>{import("./editor-7bfe6efb.js").then((t=>{Yr(t.default,e)}))})),e.add("editor/:fen",(({params:e})=>{import("./editor-7bfe6efb.js").then((t=>{Yr(t.default,e)}))})),e.add("inbox",(({params:e})=>{import("./msg-92dfd188.js").then((t=>{Yr(t.default,e)}))})),e.add("inbox/:id",(({params:e})=>{import("./msg-92dfd188.js").then((t=>{Yr(t.default,e)}))})),e.add("inbox/new",(({params:e})=>{import("./msg-92dfd188.js").then((t=>{Yr(t.default,e)}))})),e.add("inbox/new/:id",(({params:e})=>{import("./msg-92dfd188.js").then((t=>{Yr(t.default,e)}))})),e.add("players",(({params:e})=>{import("./players-d9f70372.js").then((t=>{Yr(t.default,e)}))})),e.add("search",(({params:e})=>{import("./search-1605ac8c.js").then((t=>{Yr(t.default,e)}))})),e.add("settings",(({params:e})=>{import("./settings-63865287.js").then((t=>{Yr(t.default,e)}))})),e.add("settings/gameDisplay",(({params:e})=>{import("./gameDisplay-f1351384.js").then((t=>{Yr(t.default,e)}))})),e.add("settings/clock",(({params:e})=>{import("./clock-c3545d77.js").then((t=>{Yr(t.default,e)}))})),e.add("settings/gameBehavior",(({params:e})=>{import("./gameBehavior-63ffc7e2.js").then((t=>{Yr(t.default,e)}))})),e.add("settings/soundNotifications",(({params:e})=>{import("./soundNotifications-8d2e7679.js").then((t=>{Yr(t.default,e)}))})),e.add("settings/background",(({params:e})=>{import("./background-3fe89176.js").then((t=>{Yr(t.default,e)}))})),e.add("settings/themes/board",(({params:e})=>{import("./boardTheme-2bc7945c.js").then((t=>{Yr(t.default,e)}))})),e.add("settings/themes/piece",(({params:e})=>{import("./pieceThemes-0ece62d0.js").then((t=>{Yr(t.default,e)}))})),e.add("settings/lang",(({params:e})=>{import("./lang-038559b6.js").then((t=>{Yr(t.default,e)}))})),e.add("teams",(({params:e})=>{import("./teamsList-258361a0.js").then((t=>{Yr(t.default,e)}))})),e.add("teams/:id",(({params:e})=>{import("./teamDetail-9e999635.js").then((t=>{Yr(t.default,e)}))})),e.add("training",(({params:e})=>{import("./training-a7104c3e.js").then((t=>{Yr(t.default,e)}))})),e.add("training/:id",(({params:e})=>{import("./training-a7104c3e.js").then((t=>{Yr(t.default,e)}))})),e.add("tournament",(({params:e})=>{import("./tournamentList-8be3730d.js").then((t=>{Yr(t.default,e)}))})),e.add("tournament/:id",(({params:e})=>{import("./tournamentDetail-a4912955.js").then((t=>{Yr(t.default,e)}))})),e.add("study",(({params:e})=>{import("./studyIndex-93d26a08.js").then((t=>{Yr(t.default,e)}))})),e.add("study/:id",(({params:e})=>{import("./study-bbe2967b.js").then((t=>{Yr(t.default,e)}))})),e.add("study/:id/:chapterId",(({params:e})=>{import("./study-bbe2967b.js").then((t=>{Yr(t.default,e)}))})),e.add("coord",(({params:e})=>{import("./coordinates-e2d92333.js").then((t=>{Yr(t.default,e)}))}))})(Hr),window.addEventListener("popstate",Xr)}};let pd=!1,gd=!1,vd=null;var bd={open:function(){ii.backbutton.stack.push(Fi(kd,"loginModal")),pd=!0,gd=!1,vd=null},close:kd,view:()=>pd?Kn("div.modal#loginModal",{oncreate:qi},[Kn("header",[Kn("button.modal_close",{oncreate:Yi(Fi(kd,"loginModal"))},Zl),Kn("h2",Et("signIn"))]),Kn("div.modal_content",[Kn("form.defaultForm.login",{onsubmit:wd},[vd&&!yd(vd)?Kn("div.form-error",vd):null,"InvalidTotpToken"===vd?Kn("div.form-error",Et("invalidAuthenticationCode")):null,Kn("div.field",[Kn("input#username",{type:yd(vd)?"hidden":"text",className:vd?"form-error":"",placeholder:Et("username"),autocomplete:"off",autocapitalize:"off",autocorrect:"off",spellcheck:!1,required:!0})]),Kn("div.field",[Kn("input#password",{type:yd(vd)?"hidden":"password",className:vd?"form-error":"",placeholder:Et("password"),required:!0})]),yd(vd)?[Kn("div.field",[Kn("input#token[type=number]",{className:"MissingTotpToken"!==vd?"form-error":"",placeholder:Et("authenticationCode"),pattern:"\\d{6}",required:!0})]),Kn("p.twofactorhelp",[Kn("i.fa.fa-mobile-phone"),Kn.trust("&nbsp"),"Open the two-factor authentication app on your device to view your authentication code and verify your identity."])]:null,Kn("div.submit",[Kn("button.defaultButton",{disabled:gd},Et("signIn"))])]),Kn("div.loginActions",[Kn("a",{oncreate:Yi(Ed.open)},[Et("signUp")]),Kn("a",{href:"https://lichess.org/password/reset"},[Et("passwordReset")])])])]):null};function wd(e){if(gd)return!1;e.preventDefault();const t=e.target,n=t.username.value.trim(),r=t.password.value,i=t.token?t.token.value:null;n&&r&&(tn(),w.hide(),gd=!0,Si.login(n,r,i).then((()=>{gd=!1,kd(),Yt.afterLogin.dispatch(),tn(),Na.reconnectCurrent(),ai.register(),$r.refresh(),Si.refresh()})).catch((e=>{gd=!1,e.body.ipban?kd():400!==e.status&&401!==e.status?hn(e):e.body.global&&(vd=e.body.global[0],tn())})))}function yd(e){return"MissingTotpToken"===e||"InvalidTotpToken"===e}function kd(e){w.hide(),"backbutton"!==e&&pd&&ii.backbutton.stack.pop(),pd=!1}let Pd=!1,Cd=!1,Td=!1,Sd=null;var Ed={open:function(){ii.backbutton.stack.push(Fi(jd,"signupModal")),Sd=null,Pd=!0,Cd=!1},close:jd,view:()=>Pd?Kn("div.modal#signupModal",{oncreate:qi},[Kn("header",[Kn("button.modal_close",{oncreate:Yi(Fi(jd,"signupModal"))},Zl),Kn("h2",Et("signUp"))]),Kn("div#signupModalContent.modal_content",{},Td?[Kn("h1.signup-emailCheck.withIcon[data-icon=E]",Et("checkYourEmail")),Kn("p",Et("weHaveSentYouAnEmailClickTheLink")),Kn("p",Et("ifYouDoNotSeeTheEmailCheckOtherPlaces")),Kn("p","Not receiving it? Visit https://lichess.org/contact to request a manual confirmation.")]:[Kn("p.signupWarning.withIcon[data-icon=!]",[Et("computersAreNotAllowedToPlay")]),Kn("p.tosWarning",["By registering, you agree to be bound by our ",Kn("a",{oncreate:Yi((()=>window.open("https://lichess.org/terms-of-service","_blank")))},"Terms of Service"),"."]),Kn("form.defaultForm.login",{onsubmit:Nd},[Kn("div.field",[Sd&&Sd.username?Kn("div.form-error",Sd.username[0]):null,Kn("input#pseudo[type=text]",{className:Sd&&Sd.username?"form-error":"",placeholder:Et("username"),autocomplete:"off",autocapitalize:"off",autocorrect:"off",spellcheck:!1,required:!0,onfocus:Md,oninput:F(xd,500)})]),Kn("div.field",[Sd&&Sd.email?Kn("div.form-error",Sd.email[0]):null,Kn("input#email[type=email]",{onfocus:Md,className:Sd&&Sd.email?"form-error":"",placeholder:Et("email"),autocapitalize:"off",autocorrect:"off",spellcheck:!1,required:!0})]),Kn("div.field",[Sd&&Sd.password?Kn("div.form-error",Sd.password[0]):null,Kn("input#password[type=password]",{onfocus:Md,className:Sd&&Sd.password?"form-error":"",placeholder:Et("password"),required:!0})]),Kn("div.submit",[Kn("button.defaultButton",{disabled:Cd},Et("signUp"))])])])]):null};function xd(e){const t=e.target.value.trim();var n;t&&t.match(/^[a-z0-9][\w-]{2,29}$/i)?(n=t,rr("/player/autocomplete?exists=1",{query:{term:n}})).then((e=>{Od(e)})):Od(!1)}function Od(e){Sd=e?{username:["This username is already in use, please try another one."]}:null,tn()}function Md(e){setTimeout((()=>{e.target.scrollIntoView(!0)}),300)}function Nd(e){e.preventDefault();const t=e.target,n=t[0].value.trim(),r=t[1].value.trim(),i=t[2].value;!Cd&&n&&r&&i&&(w.hide(),Cd=!0,Sd=null,tn(),Si.signup(n,r,i).then((e=>{Cd=!1,e&&function(e){return void 0!==e.email_confirm}(e)?(Td=!0,tn()):(Na.reconnectCurrent(),tn(),bd.close(),jd())})).catch((e=>{Cd=!1,void 0!==e.body.error?(Sd=e.body.error,tn()):hn(e)})))}function jd(e){!0===Td&&bd.close(),w.hide(),"backbutton"!==e&&Pd&&ii.backbutton.stack.pop(),Pd=!1}const _d=":r1/:r2/:r3/:r4/:r5/:r6/:r7/:r8";function Ld(e){return e.r1+"/"+e.r2+"/"+e.r3+"/"+e.r4+"/"+e.r5+"/"+e.r6+"/"+e.r7+"/"+e.r8.split("_").join(" ")}var Dd={init(){m.addListener("appUrlOpen",(({url:e})=>{setTimeout((()=>{const t=new URL(e),n=t.pathname;if(!Id.run(n)){const e=Ad.exec(n);if(e){const n=e[2],r=Rd.exec(t.hash),i={};n&&(i.color=n.substring(1)),r&&(i.ply=r[1]);const a=Jn(i);ii.set(`/game/${e[1]}?${a}`)}}}),100)}))}};const Id=new zr,Ad=/^\/(\w{8})(\/black|\/white)?$/,Rd=/^#(\d+)$/;Id.add("analysis",(()=>ii.set("/analyse"))),Id.add(`analysis/${_d}`,(({params:e})=>{const t=encodeURIComponent(Ld(e));ii.set(`/analyse/fen/${t}`)})),Id.add("editor",(()=>ii.set("/editor"))),Id.add(`editor/${_d}`,(({params:e})=>{const t=encodeURIComponent(Ld(e));ii.set(`/editor/${t}`)})),Id.add("inbox",(()=>ii.set("/inbox"))),Id.add("inbox/new",(()=>ii.set("/inbox/new"))),Id.add("challenge/:id",(({params:e})=>ii.set(`/game/${e.id}`))),Id.add("study",(()=>ii.set("/study"))),Id.add("study/:id",(({params:e})=>ii.set(`/study/${e.id}`))),Id.add("study/:id/:chapterId",(({params:e})=>ii.set(`/study/${e.id}/${e.chapterId}`))),Id.add("player",(()=>ii.set("/players"))),Id.add("tournament",(()=>ii.set("/tournament"))),Id.add("tournament/:id",(({params:e})=>ii.set(`/tournament/${e.id}`))),Id.add("training",(()=>ii.set("/training"))),Id.add("training/:id",(({params:e})=>ii.set(`/training/${e.id}`))),Id.add("tv",(()=>ii.set("/tv"))),Id.add("tv/:channel",(({params:e})=>ii.set(`/tv/${e.channel}`))),Id.add("@/:id",(({params:e})=>ii.set(`/@/${e.id}`))),Id.add("@/:id/tv",(({params:e})=>ii.set(`/@/${e.id}/tv`))),Id.add("@/:id/all",(({params:e})=>ii.set(`/@/${e.id}/games`))),Id.add("@/:id/perf/:key",(({params:e})=>ii.set(`/@/${e.id}/${e.key}/perf`))),Id.add("signup/confirm/:token",(({params:e})=>{const t=e.token;t&&Si.confirmEmail(t).then((e=>{Ed.close(),ii.set(`/@/${e.id}`)})).catch(hn)}));const Bd=a("CPUInfo");(async function(){await nt.migrate();const e=await nt.get("settings");Object.assign(ft,e)})().then((()=>Promise.all([m.getInfo().catch((()=>({version:Wt.packageVersion}))),f.getInfo(),f.getId(),"ios"===i.getPlatform()?Bd.nbCores().then((e=>e.value)).catch((()=>1)):Promise.resolve(navigator.hardwareConcurrency||1),Hu.getMaxMemory().then((e=>e.value)).catch((()=>16)),Hu.getCPUArch().then((e=>e.value)).catch((()=>"x86"))]))).then((([e,t,n,r,i,a])=>Bu(e,t,n,r,i,a))).then((()=>{fd.init(),Dd.init(),ai.init()})).then((function(){const e=pt.general.theme.background(),t=pt.general.theme.board();if(md(e),id(e)){const t=dd("bg",e);ad("bg",t).then((n=>{ud("bg",e,t,n)})).catch((()=>{pt.general.theme.background("dark")}))}if(!pt.general.theme.bundledBoardThemes.includes(t)){const e=dd("board",t);ad("board",e).then((n=>{ud("board",t,e,n)})).catch((()=>{pt.general.theme.board("brown")}))}})).then((async function(){const e=import("./i18n/en-GB.js").then((({default:e})=>{Object.assign(vt,e)})),t=pt.general.locale();return t&&void 0!==Ut[t]?e.then((()=>$t(t))):e.then((()=>f.getLanguageCode())).then((({value:e})=>$t(Rt(e)||"en-GB")))})).then((()=>Xr())).then((()=>{setTimeout((()=>{p.hide()}),500)}));export{oo as $,m as A,gn as B,Yi as C,Xn as D,ua as E,On as F,Ui as G,du as H,i as I,Ya as J,$i as K,Xa as L,Qa as M,g as N,Ga as O,Ka as P,io as Q,to as R,Ji as S,mn as T,eo as U,si as V,s as W,so as X,bd as Y,Ei as Z,ao as _,Yt as a,Ao as a$,ro as a0,no as a1,H as a2,wc as a3,Kl as a4,Ic as a5,br as a6,hn as a7,Dc as a8,_l as a9,Zi as aA,jt as aB,xn as aC,Lt as aD,ur as aE,So as aF,ko as aG,bn as aH,oc as aI,na as aJ,oa as aK,va as aL,ba as aM,uu as aN,vo as aO,La as aP,gu as aQ,Jt as aR,dc as aS,Xi as aT,iu as aU,nu as aV,lu as aW,ca as aX,bo as aY,hu as aZ,mu as a_,Rl as aa,pc as ab,ct as ac,Va as ad,hi as ae,Zl as af,jn as ag,ea as ah,lo as ai,hd as aj,Ed as ak,Su as al,ru as am,xt as an,nt as ao,Cn as ap,la as aq,Bi as ar,Ri as as,wo as at,Sn as au,Tn as av,wn as aw,Pn as ax,a as ay,Wt as az,Si as b,hc as b$,Io as b0,kn as b1,_n as b2,tc as b3,vn as b4,ya as b5,Fi as b6,w as b7,Nn as b8,qi as b9,uc as bA,Lr as bB,Mr as bC,Au as bD,Po as bE,Co as bF,ln as bG,cn as bH,Ku as bI,rl as bJ,gl as bK,wl as bL,pl as bM,sl as bN,fl as bO,Jc as bP,Zc as bQ,yl as bR,jr as bS,it as bT,$o as bU,qr as bV,y as bW,ta as bX,ic as bY,an as bZ,Ja as b_,mo as ba,ir as bb,er as bc,Ks as bd,Ys as be,z as bf,Wu as bg,Vu as bh,Gu as bi,sc as bj,cc as bk,lc as bl,yn as bm,Tr as bn,$r as bo,Cr as bp,Pr as bq,kr as br,Or as bs,Ai as bt,Ii as bu,po as bv,pu as bw,Rn as bx,fr as by,ac as bz,Dt as c,rc as c0,Eo as c1,To as c2,_t as c3,mc as c4,el as c5,hl as c6,nl as c7,cl as c8,Kc as c9,id as cA,cd as cB,ld as cC,md as cD,od as cE,sd as cF,ou as cG,Ut as cH,Rt as cI,qt as cJ,_r as cK,$t as cL,Bt as cM,Mn as cN,o as cO,da as cP,Hi as cQ,Wi as cR,fu as cS,En as cT,eu as cU,tu as cV,Ln as cW,ml as ca,kl as cb,ul as cc,dl as cd,zi as ce,Cs as cf,go as cg,ed as ch,Ki as ci,Pl as cj,Cl as ck,sn as cl,Nl as cm,Da as cn,Ia as co,Aa as cp,Ra as cq,za as cr,Ba as cs,$a as ct,Ua as cu,ha as cv,Jl as cw,sa as cx,ma as cy,ai as cz,F as d,xr as e,rr as f,pt as g,In as h,cr as i,Nr as j,dn as k,Er as l,Kn as m,fn as n,Qi as o,zc as p,Et as q,tn as r,Na as s,Dr as t,Gl as u,It as v,ii as w,Nt as x,Wc as y,Ot as z};
