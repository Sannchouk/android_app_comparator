import{bb as t,bc as e,T as o,a2 as n,q as a,f as s,d as r,r as i,w as c,b6 as h,b7 as d,m as u,C as l,af as p,D as g,b9 as m,g as v,bd as b,be as f,bf as w}from"./main.js";function k(t){return s(t.data.url.round)}function x(o,n=!1){return t(`/game/export/${o}${n?"?evals=0&clocks=0":"?literate=1"}`,{headers:{Accept:"application/x-chess-pgn, text/*","X-Requested-With":"__delete",[e]:"__delete"},credentials:"omit"},!0)}function y(t,e){return s("/api/crosstable/"+t+"/"+e,{cache:"reload"})}class C{constructor(e){var s;this.syncNotes=r((e=>{const s=e.target.value;var r,c;this.data.note!==s&&(r=this.data.game.id,c=s,t(`/${r}/note`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json, text/*"},body:o({text:c})},!1).catch((t=>{throw n.show({text:a("notesSynchronizationHasFailed"),duration:"short"}),t}))).then((()=>{this.data.note=s,i()}))}),1e3),this.open=()=>{c.backbutton.stack.push(h(this.close,"notes")),this.showing=!0},this.close=t=>{d.hide(),"backbutton"!==t&&this.showing&&c.backbutton.stack.pop(),this.showing=!1},this.syncing=!0,this.data=e,this.showing=!1,this.inputValue="",(s=e.game.id,t(`/${s}/note`)).then((t=>{this.data.note=t,this.syncing=!1,i()})).catch((()=>{this.syncing=!1,i(),n.show({text:"Could not read notes from server.",position:"bottom",duration:"short"})}))}}function N(t){return t.showing?u("div#notes.modal",{oncreate:m},[u("header",[u("button.modal_close",{oncreate:l(h(t.close,"notes"))},p),u("h2",a("notes"))]),u("div.modal_content",[t.syncing?u("div.notesTextarea.loading",g.getVdom()):u("textarea#notesTextarea.native_scroller",{placeholder:a("typePrivateNotesHere"),oninput:t.syncNotes,value:t.data.note})])]):null}const T=["pawn","knight","bishop","rook","queen"],_={oninit(t){const{ctrl:e}=t.attrs,o=t=>function(t,e){if(e.touches&&e.touches.length>1)return;if(!t.canDrop())return;const o=e.target.getAttribute("data-role"),n=e.target.getAttribute("data-color"),a=e.target.getAttribute("data-nb");if(!o||!n||"0"===a)return;if(!function(t,e){return t.movable.color===e&&(t.turnColor===e||t.predroppable.enabled)}(t.chessground.state,n))return;e.stopPropagation(),e.preventDefault();const s={role:o,color:n};t.chessground.dragNewPiece(e,s)}(e,t),n=t=>b(e.chessground,t),a=t=>f(e.chessground,t);this.pocketOnCreate=function(t){const e=t.dom;e.addEventListener("touchstart",o),e.addEventListener("touchmove",n),e.addEventListener("touchend",a)},this.pocketOnRemove=function(t){const e=t.dom;e.removeEventListener("touchstart",o),e.removeEventListener("touchmove",n),e.removeEventListener("touchend",a)}},view(t){const{crazyData:e,position:o,color:n,customPieceTheme:a}=t.attrs,s=e.pockets["white"===n?0:1],r=[a||v.general.theme.piece(),"pocket",o||""].join(" ");return u("div",{className:r,oncreate:this.pocketOnCreate,onremove:this.pocketOnRemove},T.map((t=>u("piece",{"data-role":t,"data-color":n,"data-nb":s[t]||0,className:t+" "+n}))))}};function E(t){var e=function(t){return t?1/0===(t=w(t))||-1/0===t?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}(t),o=e%1;return e==e?o?e-o:e:0}export{_ as C,C as N,y as a,x as g,N as n,k as r,E as t};
