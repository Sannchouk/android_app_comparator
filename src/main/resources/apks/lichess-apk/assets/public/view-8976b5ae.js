import{b1 as e,aI as t,g as a,b2 as n,b3 as o,b as i,q as s,at as r,aH as l,a2 as c,m as u,C as d,aS as p,o as h,ah as m,aT as f}from"./main.js";import{l as v,p as g,g as y,j as b}from"./game-0dbfee7c.js";import{b as M,g as k,o as w,r as N,d as _}from"./crazyValid-b1cecd22.js";import{C}from"./toInteger-d296e300.js";import{m as T,d as P,t as D,p as j}from"./chess-ef477519.js";function F(o,i){const s=i.uciMoves.length?i.uciMoves[i.uciMoves.length-1]:null,r=a.game.pieceMove();return{fen:i.fen,orientation:e(o),turnColor:i.player,lastMove:s?t(s):null,check:i.check,otb:"offline_otb"===o.game.id,coordinates:a.game.coords(),otbMode:a.otb.flipPieces()?"flip":"facing",symmetricCoordinates:"offline_otb"===o.game.id,autoCastle:!0,highlight:{lastMove:a.game.highlights(),check:a.game.highlights()},movable:{free:!1,color:v(o)?i.player:null,showDests:a.game.pieceDestinations(),dests:i.dests,rookCastle:1===a.game.rookCastle()},animation:{enabled:!!a.game.animations(),duration:n(a.game.animations())},premovable:{enabled:!1},draggable:{enabled:"drag"===r||"both"===r,centerPiece:o.pref.centerPiece,distance:3,magnified:a.game.magnified()},selectable:{enabled:"tap"===r||"both"===r}}}var x={make:function(e,t,a,n,i,s){const r=F(e,t);return r.movable.events={after:a,afterNewPiece:n},r.events={move:i,dropNewPiece:s},new o(r)},reload:function(e,t,a){e.reconfigure(F(t,a))},end:function(e){e.stop()},changeOTBMode:function(e,t){e.setOtbMode(t?"flip":"facing")}};const A={key:"standard",name:"Standard",short:"STD",title:"Standard rules of chess (FIDE)"};function S(e){const t=e.color||"white",o={color:t,username:"offline_ai"===e.id?i.appUser(s(t)):s(t),spectator:!1};return{game:{id:e.id,offline:!0,variant:e.variant||A,initialFen:e.initialFen||r,source:"offline",fen:e.fen||r,player:e.player||"white",turns:0,startedAtTurn:0,status:{id:20,name:"created"},speed:"unlimited",createdAt:Date.now()},player:o,opponent:{color:l(t),username:s(l(t))},pref:{animationDuration:n(a.game.animations()),centerPiece:e.pref&&e.pref.centerPiece||!1},steps:[],offlineClock:e.clock}}function z(e,t,a){var n;const o=null===(n=e.replay)||void 0===n?void 0:n.situation();e.data.game.status=t||{id:20,name:"started"},e.data.game.winner=a||(null==o?void 0:o.winner)}class R{constructor(e,t,a,n,o,i){this.situation=()=>this.situations[this.ply],this.addMove=(e,t,a)=>{const n=this.situation();T({variant:this.variant,fen:n.fen,pgnMoves:n.pgnMoves,uciMoves:n.uciMoves,promotion:a,orig:e,dest:t}).then(this.addMoveOrDrop).catch(console.error.bind(console))},this.addDrop=(e,t)=>{const a=this.situation();P({variant:this.variant,fen:a.fen,pgnMoves:a.pgnMoves,uciMoves:a.uciMoves,role:e,pos:t}).then(this.addMoveOrDrop).catch(console.error.bind(console))},this.claimDraw=()=>{const e=this.situation();D({variant:this.variant,initialFen:this.initialFen,pgnMoves:e.pgnMoves}).then((e=>{e.threefoldRepetition?this.onThreefoldRepetition(e.status):c.show({text:s("incorrectThreefoldClaim"),position:"center",duration:"short"})})).catch(console.error.bind(console))},this.pgn=(e,t)=>{const a=this.situation();return j({variant:this.variant,initialFen:this.initialFen,pgnMoves:a.pgnMoves,white:e,black:t})},this.addMoveOrDrop=e=>{this.ply++,this.ply<this.situations.length&&(this.situations=this.situations.slice(0,this.ply)),this.situations.push(e.situation),this.onReplayAdded(this.situation())},this.init(e,t,a,n),this.onReplayAdded=o,this.onThreefoldRepetition=i}init(e,t,a,n){this.variant=e,this.initialFen=t,this.situations=a,this.ply=n||0}}function I(e,t,a,n,o,i,s){var r;const c=null===(r=e.replay)||void 0===r?void 0:r.situation(),d=!!(null==c?void 0:c.crazyhouse),p=("player"===n?e.data.player:e.data.opponent).color,h=["playTable","offline",n,d?"crazy":"",void 0!==o?o?"mode_flip":"mode_facing":"",e.chessground.state.turnColor===e.data.player.color?"player_turn":"opponent_turn"].join(" ");return u("section",{id:n+"_info",className:h},u("div",{className:"antagonistInfos offline"+(d?" crazy":"")},u("div",{className:"antagonistUser"},t,d&&s?Q(s,p):""),d?null:u("div",{className:"ratingAndMaterial"},"horde"===e.data.game.variant.key?null:N(a),"threeCheck"===e.data.game.variant.key?u("div",{className:"checkCount"}," +",function(e,t){var a;const n=null===(a=e.replay)||void 0===a?void 0:a.situation();return(null==n?void 0:n.checkCount)?"white"===l(t)?n.checkCount.white:n.checkCount.black:0}(e,p)):null)),(null==c?void 0:c.crazyhouse)?u(C,{ctrl:e,crazyData:c.crazyhouse,color:p,position:n,customPieceTheme:i}):s?Q(s,p):null)}function U(e){return u("section",{className:"actions_bar"},u("button",{className:"action_bar_button fa fa-list",oncreate:d(e.actions.open)}),u("button",{className:"action_bar_button fa fa-plus-circle",oncreate:d(e.newGameMenu.open,(()=>c.show({text:s("createAGame"),duration:"short",position:"bottom"})))}),u("button",{className:"fa fa-share-alt action_bar_button",oncreate:d(e.sharePGN,(()=>c.show({text:s("sharePgn"),duration:"short",position:"bottom"})))}),u("button",{className:"action_bar_button","data-icon":"A",oncreate:d(e.goToAnalysis)}),H(e),q(e))}function O(e){if(!e.replay)return null;const t=e.replay.situation();if(y.finished(e.data)){const a=b(e.data),n=t.winner,o=y.toLabel(e.data.game.status.name,e.data.game.turns,e.data.game.winner,e.data.game.variant.key)+(n?". "+s("white"===n?"whiteIsVictorious":"blackIsVictorious")+".":"");return u("div",{className:"result"},a,u("br",null),u("em",{className:"resultStatus"},o))}return null}function G(e){return g(e.data)?u("button.draw-yes",{oncreate:d((()=>{var t;return null===(t=e.replay)||void 0===t?void 0:t.claimDraw()}))},u("span","½"),s("threefoldRepetition")):null}function L(e){const t=a.game.pieceNotation();return e.replay?u("div.replay.box",{className:t?" displayPieces":"",oncreate:t=>{setTimeout((()=>M(t.dom)),100),h((t=>w(e,t)),void 0,k)(t)},onupdate:e=>M(e.dom)},B(e.replay)):null}function V(e){const t=a.game.pieceNotation();return e.replay&&e.moveList?u("div.replay_inline",{className:t?" displayPieces":"",oncreate:t=>{setTimeout((()=>_(t.dom)),100),f((t=>w(e,t)),void 0,k)(t)},onupdate:e=>_(e.dom)},B(e.replay)):null}function H(e){return e.replay?u("button.action_bar_button.fa.fa-chevron-left",{oncreate:d(e.jumpPrev,e.jumpFirst),className:m({disabled:!(e.replay.ply>e.firstPly())})}):null}function q(e){return e.replay?u("button.action_bar_button.fa.fa-chevron-right",{oncreate:d(e.jumpNext,e.jumpLast),className:m({disabled:!(e.replay.ply<e.lastPly())})}):null}function B(e){return e.situations.filter((e=>void 0!==e.san)).map((t=>{return u("move.replayMove",{className:t.ply===e.ply?"current":"","data-ply":t.ply},[1&t.ply?u("index",(a=t.ply,n=!0,u("index",E(a,n)))):null,p(t.san)]);var a,n}))}function E(e,t){return function(e){return Math.floor((e-1)/2)+1}(e)+(t?e%2==1?".":"...":"")}function J(e){return(e<10?"0":"")+e}function K(e,t=!1){const a=new Date(e),n=a.getUTCMilliseconds(),o=J(a.getUTCMinutes()),i=J(a.getUTCSeconds());if(e>=36e5){return J(a.getUTCHours())+(t&&n<500?" ":":")+o}if(e<1e4){const e=Math.floor(n/100).toString();return[o+":"+i,u("tenths","."+e)]}return o+":"+i}function Q(e,t){const a=e.activeSide(),n=e.getTime(t),o=a===t,i="stage"===e.clockType?e.getMoves(t):null;return u("div",{className:m({clock:!0,outoftime:!n,running:o,offlineClock:!0,stageClock:!!i})},[K(n,o),i?u("div.clockMoves","Moves: "+i):null])}export{R,G as a,L as b,V as c,S as d,I as e,q as f,x as g,H as h,U as i,O as r,z as s};
