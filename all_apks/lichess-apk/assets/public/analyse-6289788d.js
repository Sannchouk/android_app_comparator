import{aH as t,g as a,bE as s,bF as e,F as r,aL as o,r as i,a7 as n,w as l,aF as c,bt as d,bu as m,aM as h,s as p,aJ as f,am as u,m as b,q as y,aU as v,aN as j}from"./main.js";import{l as g}from"./layout-e08f9316.js";import"./html-1975aa10.js";import"./perfs-9aa7202a.js";import{p as k,a as w}from"./fen-f2d95e2d.js";import"./CountdownTimer-b4d0f21b.js";import"./TabView-de024605.js";import{g as T,c as F,b as B}from"./offlineGames-f85dc070.js";import"./game-0dbfee7c.js";import{G}from"./GameTitle-217d24e1.js";import"./Board-0a9e6a9d.js";import"./promotion-0e7cb1ce.js";import"./index-c282ab51.js";import"./toInteger-d296e300.js";import"./chat-e47e82a7.js";import"./chess-ef477519.js";import"./vibrate-5137c134.js";import{g as x,A,r as C,a as I,o as $,l as _}from"./AnalyseCtrl-f6c4b237.js";import"./variant-1fcc5716.js";import"./studyXhr-30328b6a.js";import"./tree-aeadfd0f.js";import"./axis-5bab4d8c.js";const M={queen:0,rook:0,knight:0,bishop:0,pawn:0};var U={oninit(d){const m=d.attrs.source||"offline",h=d.attrs.id,p=d.attrs.color||"white",f=d.attrs.fen,u=d.attrs.variant,b=r(d.attrs.ply),y=d.attrs.tabId,v=void 0!==h||void 0!==f||"1"===d.attrs.goBack;if(o(),"online"===m&&h){const t=performance.now();x(h,p).then((a=>{const s=performance.now()-t;setTimeout((()=>{this.ctrl=new A(a,void 0,m,p,v,b,y),i()}),Math.max(400-s,0))})).catch((t=>{n(t),d.attrs.fallback&&d.attrs.curFen&&d.attrs.color?l.set(`/analyse/variant/standard/fen/${encodeURIComponent(d.attrs.curFen)}?color=${d.attrs.color}&goBack=1`):l.set("/analyse",!0),i()}))}else if("offline"===m&&"otb"===h)T().then((t=>{setTimeout((()=>{const a=t&&F(t,p);a?(a.player.spectator=!0,this.ctrl=new A(a,void 0,m,p,v,b,y),i()):l.set("/analyse",!0)}),400)}));else if("offline"===m&&"ai"===h)B().then((t=>{setTimeout((()=>{const a=t&&F(t,p);a?(a.player.spectator=!0,this.ctrl=new A(a,void 0,m,p,v,b,y),i()):l.set("/analyse",!0)}),400)}));else if(void 0===u){let t=a.analyse.syntheticVariant();f&&(t=c.has(t)?"standard":t);let s=`/analyse/variant/${t}`;f&&(s+=`/fen/${encodeURIComponent(f)}`),l.set(s,!0),i()}else this.ctrl=new A(function(r,o){const i=k(o),n=w(o),l=s(r),c=o||e(r);return{game:{fen:c,id:"synthetic",initialFen:c,player:i,source:"offline",status:{id:10,name:"created"},turns:0,startedAtTurn:0,variant:l},takebackable:!1,orientation:"white",opponent:{color:t(i)},player:{color:i},pref:{destination:a.game.pieceDestinations(),highlight:a.game.highlights()},treeParts:[{fen:c,ply:n,crazyhouse:"crazyhouse"===l.key?{pockets:[M,M]}:void 0,pgnMoves:[]}],userAnalysis:!0}}(u,f),void 0,m,p,v,b,y),i()},oncreate(t){"1"===t.attrs.slide?d(t.dom):m(t.dom)},onremove(){h(),p.destroy(),this.ctrl&&(this.ctrl.unload(),this.ctrl=void 0)},view(t){const a=f();if(this.ctrl){let t=null;this.ctrl.shouldGoBack&&(t="synthetic"===this.ctrl.data.game.id?u(b("div.main_header_title",y("analysis"))):u([b(G,{data:this.ctrl.data,subTitle:"date"}),v(this.ctrl.toggleBookmark,this.ctrl.data.bookmarked)]));const s=this.ctrl.shouldGoBack?null:b("div.main_header_title.withSub",[b("div",y("analysis")),C(this.ctrl)]);return g.board(j(s,t),I(this.ctrl,a),void 0,$(this.ctrl))}return _(a,t.attrs.color,t.attrs.curFen)}};export default U;
