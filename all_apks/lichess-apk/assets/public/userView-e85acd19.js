import{ay as e,az as n,b as a,f as s,r as l,k as t,a7 as o,w as i,T as c,u as r,ag as u,m,H as p,o as f,z as d,q as g,B as b,aA as N,am as h,aB as v,aC as w,c as k,aD as _}from"./main.js";import{l as T}from"./html-1975aa10.js";import{p as M,a as y}from"./perfs-9aa7202a.js";import{c as $}from"./countries-a19495bf.js";import{u as C,a as j,f as z,b as P,c as x}from"./userXhr-ce47bd25.js";const S=e("Browser",{web:()=>import("./web-689beddf.js").then((e=>new e.BrowserWeb))});function B(e,l=!1){const t=`${n.apiEndPoint}${e}`;a.isKidMode()?A(t):a.isConnected()&&!l?s("/auth/token",{method:"POST"},!0).then((n=>{S.open({url:`${n.url}?referrer=${encodeURIComponent(e)}`})})).catch((()=>{S.open({url:t})})):S.open({url:t})}function A(e){window.open(e,"_blank")}function R(e){const n=u(null);function s(e){Object.assign(n(),e),l()}const m=a.get();return m&&m.id===e&&n(m),C(e).then((e=>{n(e),l()})).then(a.refresh).catch((e=>{t()&&o(e)})),{user:n,isMe:()=>a.getUserId()===e,toggleFollowing(){const e=n();e&&O(e)&&e.following?j(e.id).then(s):e&&z(e.id).then(s)},toggleBlocking(){const e=n();e&&O(e)&&e.blocking?P(e.id).then(s):e&&x(e.id).then(s)},goToGames(){const e=n();if(e){const n={username:e.username};e.patron&&(n.patron="1"),e.title&&(n.title=e.title),i.set(`/@/${e.id}/games?${c(n)}`)}},goToUserTV(){const e=n();e&&i.set(`/@/${e.id}/tv`)},challenge(){const e=n();e&&r.open(e.id)},composeMessage(){const e=n();e&&i.set(`/inbox/new/${e.id}`)},followers(){const e=n();if(e){const n={username:e.username};e.title&&(n.title=e.title),i.set(`/@/${e.id}/related?${c(n)}`)}}}}function O(e){return void 0!==e.count}function U(e,n){const a=V(e.online,e.patron,e.username,e.title),s=n.isMe()?null:h(a);return p(s?null:a,s)}function V(e,n,a,s){const l=t()&&e?"online":"offline",o=m("span",n?{className:"userStatus patron "+l,"data-icon":"î€™"}:{className:"fa fa-circle userStatus "+l});return m("div.title",[o,m("span",[...s?[m("span.userTitle"+("BOT"===s?".bot":""),s)," "]:[],a])])}function F(e,n){return m("div",{id:"userProfile",className:"native_scroller page"},function(e){return e.tosViolation?m("section",{className:"warnings"},e.tosViolation?m("div",{className:"warning","data-icon":"j"},g("thisAccountViolatedTos")):null):null}(e),function(e){if(e.profile){const n=[e.profile.firstName,e.profile.lastName].filter((e=>null!=e)).join(" "),a=null!=e.profile.country?$[e.profile.country]:null,s=e.profile.location,l=g("memberSince")+" "+v(new Date(e.createdAt));return m("section",{className:"profileSection"},n?m("h3",{className:"fullname"},n):null,null!=e.profile.bio?m("p",{className:"profileBio"},m.trust(T(e.profile.bio))):null,m("div",null,null!=e.profile.fideRating?m("p",null,"FIDE rating: ",m("strong",null,e.profile.fideRating)):null,m("p",{className:"location"},s,null!=a&&t()?m("span",{className:"country"},null!=s?",":""," ",m("img",{className:"flag",src:w(`images/flags/${e.profile.country}.png`)}),a):null),m("p",null,l),e.seenAt?m("p",null,m.trust(g("lastSeenActive",`<small>${k(new Date(e.seenAt))}</small>`))):null))}return null}(e),function(e){let n=null;const a=e.playTime?g("tpTimeSpentPlaying",_(e.playTime.total)):null;O(e)&&(n=e.playTime&&e.playTime.tv>0?g("tpTimeSpentOnTV",_(e.playTime.tv)):null);return m("section",{className:"profileSection"},O(e)&&e.completionRate?m("p",null,g("gameCompletionRate",e.completionRate+"%")):null,a?m("p",null,a):null,n?m("p",null,n):null)}(e),function(e,n){return m("section",{className:"profileSection websiteLinks"},e.isMe()?m("p",null,m("a",{className:"external_link",oncreate:f((()=>B("/account/profile")))},g("editProfile"))):m("p",null,m("a",{className:"external_link",oncreate:f((()=>B(`/@/${n.id}`)))},"More on lichess.org")),n.patron?m("p",null,m("a",{className:"external_link",oncreate:f((()=>B("/patron")))},"Lichess Patron")):null)}(n,e),function(e){function n(e){return-1!==["blitz","bullet","rapid","classical","correspondence"].indexOf(e.key)||e.perf.games>0}return m("section",{id:"userProfileRatings",className:"perfs"},function(e){const n=y.map((n=>{const a=e.perfs[n[0]];return{key:n[0],name:n[1],perf:a||"-"}}));e.perfs.puzzle&&n.push({key:"puzzle",name:"Training",perf:e.perfs.puzzle});return n}(e).filter(n).map((n=>function(e,n,a,s){const l=function(e,n){return"puzzle"!==e&&n.games>0}(e,a);return m("div",{className:"profilePerf"+(l?" nav":""),"data-icon":b(e),oncreate:f((()=>{l&&i.set(`/@/${s.id}/${e}/perf`)}))},[m("span.name",n),m("div.rating",[a.rating,a.rd>=M?"?":null,N(a.prog),m("span.nb","/ "+a.games)])])}(n.key,n.name,n.perf,e))))}(e),function(e,n){return m("section",{id:"userProfileActions",className:"items_list_block noPadding"},O(n)?m("div",{className:"list_item nav",oncreate:f(e.goToGames)},d("nbGames",n.count.all)):null,a.isConnected()&&e.isMe()?m("div",{className:"list_item",oncreate:f((()=>i.set("/inbox")))},m("span",{className:"fa fa-envelope"}),g("inbox")):null,a.isConnected()&&e.isMe()?m("div",{className:"list_item",oncreate:f((()=>i.set("/account/preferences")))},m("span",{className:"fa fa-cog"}),g("preferences")):null,a.isConnected()&&e.isMe()?m("div",{className:"list_item nav",oncreate:f(e.followers)},m("span",{className:"fa fa-users"}),g("friends")):null,e.isMe()?null:m("div",{className:"list_item nav","data-icon":"1",oncreate:f(e.goToUserTV)},g("watchGames")),a.isConnected()&&!e.isMe()?m("div",{className:"list_item","data-icon":"U",oncreate:f(e.challenge)},g("challengeToPlay")):null,a.isConnected()&&!e.isMe()?m("div",{className:"list_item nav",oncreate:f(e.composeMessage)},m("span",{className:"fa fa-comment"}),g("composeMessage")):null,a.isConnected()&&O(n)&&n.followable&&!e.isMe()?m("div",{className:["list_item",n.blocking?"disabled":""].join(" ")},m("div",{className:"check_container"},m("label",{htmlFor:"user_following"},g("follow")),m("input",{id:"user_following",type:"checkbox",checked:n.following,disabled:n.blocking,onchange:e.toggleFollowing}))):null,a.isConnected()&&O(n)&&!e.isMe()?m("div",{className:["list_item",n.following?"disabled":""].join(" ")},m("div",{className:"check_container"},m("label",{htmlFor:"user_blocking"},g("block")),m("input",{id:"user_blocking",type:"checkbox",checked:n.blocking,disabled:n.following,onchange:e.toggleBlocking}))):null,a.isConnected()&&!e.isMe()?m("div",{className:"list_item","data-icon":"!",oncreate:f((()=>B(`/report?username=${n.username}`)))},g("reportXToModerators",n.username)):null,a.isConnected()&&e.isMe()?m("div",{className:"list_item",oncreate:f(a.logout)},m("span",{className:"fa fa-power-off"}),g("logOut")):null)}(n,e))}export{R as U,B as a,U as h,A as o,F as p,V as u};
